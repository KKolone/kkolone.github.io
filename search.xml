<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>K8s+Jenkins+gitea+Harbor实现DevOps</title>
    <url>/2022/05/04/K8s+Jenkins+gitea+Harbor%E5%AE%9E%E7%8E%B0DevOps/</url>
    <content><![CDATA[<p>介绍了如何使用jenkins+gitea+harbor+k8s实现简单的devops。</p>
<span id="more"></span>

<h1 id="集群环境准备"><a href="#集群环境准备" class="headerlink" title="集群环境准备"></a>集群环境准备</h1><h2 id="主机规划"><a href="#主机规划" class="headerlink" title="主机规划"></a>主机规划</h2><table>
<thead>
<tr>
<th>主机IP</th>
<th>软件角色</th>
<th>版本</th>
</tr>
</thead>
<tbody><tr>
<td>192.168.50.71</td>
<td>master</td>
<td>1.23.6</td>
</tr>
<tr>
<td>192.168.50.72</td>
<td>master</td>
<td>1.23.6</td>
</tr>
<tr>
<td>192.168.50.73</td>
<td>master</td>
<td>1.23.6</td>
</tr>
<tr>
<td>192.168.50.74</td>
<td>worker+jenkins</td>
<td>1.23.6+blueocean</td>
</tr>
<tr>
<td>192.168.50.150</td>
<td>gitea+harbor</td>
<td>**</td>
</tr>
</tbody></table>
<h2 id="部署gitea"><a href="#部署gitea" class="headerlink" title="部署gitea"></a>部署gitea</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker run -d --privileged=true --restart=always --name=gitea -p 10022:22 -p 3000:3000 -v /var/lib/gitea:/data gitea/gitea:latest</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/KKolone/img/main/img/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE1.png"></p>
<h2 id="部署harbor"><a href="#部署harbor" class="headerlink" title="部署harbor"></a>部署harbor</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">安装docker-compose并下载harbor最新包</span></span><br><span class="line">wget https://github.com/goharbor/harbor/releases/download/v2.4.1/harbor-offline-installer-v2.4.1.tgz</span><br><span class="line">wget https://github.com/docker/compose/releases/download/v2.2.3/docker-compose-linux-x86_64 &amp;&amp; mv docker-compose-linux-x86_64 docker-compose &amp;&amp; chmod +x docker-compose &amp;&amp; mv docker-compose /usr/local/bin/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">解压harbor-offline-installer-v2.4.1.tgz</span></span><br><span class="line">tar xf harbor-offline-installer-v2.4.1.tgz</span><br><span class="line"></span><br><span class="line">➜  harbor ls</span><br><span class="line">common  common.sh  docker-compose.yml  harbor.v2.4.1.tar.gz  harbor.yml  install.sh  LICENSE  prepare</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">配置文件大概内容如下，主要是修改hostname还有端口</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Configuration file of Harbor</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">The IP address or hostname to access admin UI and registry service.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">DO NOT use localhost or 127.0.0.1, because Harbor needs to be accessed by external clients.</span></span><br><span class="line">hostname: 192.168.50.150</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">http related config</span></span><br><span class="line">http:</span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">port <span class="keyword">for</span> http, default is 80. If https enabled, this port will redirect to https port</span></span><br><span class="line">  port: 85</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">https related config</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">https:</span></span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">https port <span class="keyword">for</span> harbor, default is 443</span></span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">port: 443</span></span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">The path of cert and key files <span class="keyword">for</span> nginx</span></span><br><span class="line"><span class="meta prompt_"> #</span><span class="language-bash">certificate: /your/certificate/path</span></span><br><span class="line"><span class="meta prompt_"> #</span><span class="language-bash">private_key: /your/private/key/path</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="comment"># Uncomment following will enable tls communication between all harbor components</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">internal_tls:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">  <span class="comment"># set enabled to true means internal tls is enabled</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">  enabled: <span class="literal">true</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">  <span class="comment"># put your cert and key files on dir</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">  <span class="built_in">dir</span>: /etc/harbor/tls/internal</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Uncomment external_url <span class="keyword">if</span> you want to <span class="built_in">enable</span> external proxy</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">And when it enabled the hostname will no longer used</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">external_url: https://reg.mydomain.com:8433</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">The initial password of Harbor admin</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">It only works <span class="keyword">in</span> first time to install harbor</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Remember Change the admin password from UI after launching Harbor.</span></span><br><span class="line">harbor_admin_password: Harbor12345</span><br></pre></td></tr></table></figure>

<h2 id="在k8s中部署jenkins"><a href="#在k8s中部署jenkins" class="headerlink" title="在k8s中部署jenkins"></a>在k8s中部署jenkins</h2><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Namespace</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">gitops</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolumeClaim</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">jenkins</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">gitops</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">storageClassName:</span> <span class="string">&quot;nfs-storage&quot;</span></span><br><span class="line">  <span class="attr">accessModes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ReadWriteMany</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">    <span class="attr">requests:</span></span><br><span class="line">      <span class="attr">storage:</span> <span class="string">5Gi</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">jenkins</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">gitops</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">jenkins</span> </span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">jenkins</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">jenkins</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">serviceAccountName:</span> <span class="string">jenkins</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">jenkins</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">registry.cn-hangzhou.aliyuncs.com/wqzy_k8s_images/jenkins:v1</span></span><br><span class="line">          <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">8080</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">50000</span></span><br><span class="line">          <span class="attr">resources:</span></span><br><span class="line">            <span class="attr">limits:</span></span><br><span class="line">              <span class="attr">cpu:</span> <span class="number">2</span></span><br><span class="line">              <span class="attr">memory:</span> <span class="string">4Gi</span></span><br><span class="line">            <span class="attr">requests:</span></span><br><span class="line">              <span class="attr">cpu:</span> <span class="number">1</span></span><br><span class="line">              <span class="attr">memory:</span> <span class="string">1Gi</span></span><br><span class="line">          <span class="attr">env:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">LIMITS_MEMORY</span></span><br><span class="line">              <span class="attr">valueFrom:</span></span><br><span class="line">                <span class="attr">resourceFieldRef:</span></span><br><span class="line">                  <span class="attr">resource:</span> <span class="string">limits.memory</span></span><br><span class="line">                  <span class="attr">divisor:</span> <span class="string">1Mi</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">JAVA_OPTS</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">-Xmx$(LIMITS_MEMORY)m</span> <span class="string">-XshowSettings:vm</span> <span class="string">-Dhudson.slaves.NodeProvisioner.initialDelay=0</span> <span class="string">-Dhudson.slaves.NodeProvisioner.MARGIN=50</span> <span class="string">-Dhudson.slaves.NodeProvisioner.MARGIN0=0.85</span> <span class="string">-Dhudson.security.csrf.GlobalCrumbIssuerConfiguration.DISABLE_CSRF_PROTECTION=true</span></span><br><span class="line">          <span class="attr">volumeMounts:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config</span></span><br><span class="line">              <span class="attr">mountPath:</span> <span class="string">/var/jenkins_home</span></span><br><span class="line">      <span class="attr">securityContext:</span></span><br><span class="line">        <span class="attr">fsGroup:</span> <span class="number">1000</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config</span></span><br><span class="line">        <span class="attr">persistentVolumeClaim:</span></span><br><span class="line">          <span class="attr">claimName:</span> <span class="string">jenkins</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">jenkins</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">gitops</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">jenkins</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">8080</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">nodePort:</span> <span class="number">30008</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">agent</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">50000</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">jenkins</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">gitops</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Role</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">jenkins</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">gitops</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">  <span class="attr">resources:</span> [<span class="string">&quot;pods&quot;</span>,<span class="string">&quot;events&quot;</span>]</span><br><span class="line">  <span class="attr">verbs:</span> [<span class="string">&quot;create&quot;</span>,<span class="string">&quot;delete&quot;</span>,<span class="string">&quot;get&quot;</span>,<span class="string">&quot;list&quot;</span>,<span class="string">&quot;patch&quot;</span>,<span class="string">&quot;update&quot;</span>,<span class="string">&quot;watch&quot;</span>]</span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">  <span class="attr">resources:</span> [<span class="string">&quot;pods/exec&quot;</span>]</span><br><span class="line">  <span class="attr">verbs:</span> [<span class="string">&quot;create&quot;</span>,<span class="string">&quot;delete&quot;</span>,<span class="string">&quot;get&quot;</span>,<span class="string">&quot;list&quot;</span>,<span class="string">&quot;patch&quot;</span>,<span class="string">&quot;update&quot;</span>,<span class="string">&quot;watch&quot;</span>]</span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">  <span class="attr">resources:</span> [<span class="string">&quot;pods/log&quot;</span>]</span><br><span class="line">  <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>,<span class="string">&quot;list&quot;</span>,<span class="string">&quot;watch&quot;</span>]</span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">  <span class="attr">resources:</span> [<span class="string">&quot;secrets&quot;</span>,<span class="string">&quot;events&quot;</span>]</span><br><span class="line">  <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">RoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">jenkins</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">gitops</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">Role</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">jenkins</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">jenkins</span></span><br></pre></td></tr></table></figure>

<p>查看jenkins的登录密码</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@master1 data]# kubectl logs  pod/jenkins-77b9fc5878-p4b77 -n gitops</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/KKolone/img/main/img/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE2.png"></p>
<p><img src="https://raw.githubusercontent.com/KKolone/img/main/img/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE3.png"></p>
<p><img src="https://raw.githubusercontent.com/KKolone/img/main/img/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE4.png"></p>
<p><img src="https://raw.githubusercontent.com/KKolone/img/main/img/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE5.png"></p>
<h2 id="安装插件"><a href="#安装插件" class="headerlink" title="安装插件"></a>安装插件</h2><p><img src="https://raw.githubusercontent.com/KKolone/img/main/img/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE6.png"></p>
<p><img src="https://raw.githubusercontent.com/KKolone/img/main/img/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE7.png"></p>
<p>装完之后重启</p>
<p><img src="https://raw.githubusercontent.com/KKolone/img/main/img/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE8.png"></p>
<h2 id="jenkins添加与K8s集群连接"><a href="#jenkins添加与K8s集群连接" class="headerlink" title="jenkins添加与K8s集群连接"></a>jenkins添加与K8s集群连接</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">在jenkins中添加kubernetes</span><br><span class="line">管理Jenkins-&gt;Manage Nodes and Clouds-&gt;configureClouds-&gt;Add</span><br><span class="line">输入Kubernetes 地址： https://kubernetes.default ，点击连接测试，测试通过的话，会显示k8s的版本信息</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/KKolone/img/main/img/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE9.png"></p>
<p><img src="https://raw.githubusercontent.com/KKolone/img/main/img/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE10.png"></p>
<p><img src="https://raw.githubusercontent.com/KKolone/img/main/img/image-20220504212929044.png" alt="image-20220504212929044"></p>
<p><img src="https://raw.githubusercontent.com/KKolone/img/main/img/image-20220504213022113.png" alt="image-20220504213022113"></p>
<p><img src="https://raw.githubusercontent.com/KKolone/img/main/img/image-20220504213058180.png" alt="image-20220504213058180"></p>
<h2 id="创建一个测试pipeline流水线"><a href="#创建一个测试pipeline流水线" class="headerlink" title="创建一个测试pipeline流水线"></a>创建一个测试pipeline流水线</h2><p><img src="https://raw.githubusercontent.com/KKolone/img/main/img/image-20220504213125700.png" alt="image-20220504213125700"></p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">    agent &#123;</span><br><span class="line">        kubernetes &#123;</span><br><span class="line">            yaml <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">apiVersion: v1</span></span><br><span class="line"><span class="string">kind: Pod</span></span><br><span class="line"><span class="string">metadata:</span></span><br><span class="line"><span class="string">  name: jenkins-slave</span></span><br><span class="line"><span class="string">  namespace: gitops</span></span><br><span class="line"><span class="string">spec:</span></span><br><span class="line"><span class="string">  containers:</span></span><br><span class="line"><span class="string">  - name: jnlp</span></span><br><span class="line"><span class="string">    image: &quot;registry.cn-hangzhou.aliyuncs.com/wqzy_k8s_images/jenkins-slave:v1&quot;</span></span><br><span class="line"><span class="string">    volumeMounts:</span></span><br><span class="line"><span class="string">      - name: docker-command</span></span><br><span class="line"><span class="string">        mountPath: /usr/bin/docker</span></span><br><span class="line"><span class="string">      - name: docker-sock</span></span><br><span class="line"><span class="string">        mountPath: /var/run/docker.sock</span></span><br><span class="line"><span class="string">      - name: maven-cache</span></span><br><span class="line"><span class="string">        mountPath: /root/.m2</span></span><br><span class="line"><span class="string">  volumes:</span></span><br><span class="line"><span class="string">    - name: docker-command</span></span><br><span class="line"><span class="string">      hostPath:</span></span><br><span class="line"><span class="string">        path: /usr/bin/docker</span></span><br><span class="line"><span class="string">    - name: docker-sock</span></span><br><span class="line"><span class="string">      hostPath:</span></span><br><span class="line"><span class="string">        path: /var/run/docker.sock</span></span><br><span class="line"><span class="string">    - name: maven-cache</span></span><br><span class="line"><span class="string">      persistentVolumeClaim:</span></span><br><span class="line"><span class="string">        claimName: jenkins-slave</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    environment &#123;</span><br><span class="line">            GITHUB_CREDENTIAL_ID = <span class="string">&#x27;gitea-id&#x27;</span></span><br><span class="line">            REGISTRY = <span class="string">&#x27;192.168.50.150:85&#x27;</span></span><br><span class="line">            DOCKERHUB_NAMESPACE = <span class="string">&#x27;repo&#x27;</span></span><br><span class="line">            APP_NAME = <span class="string">&#x27;develop&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(<span class="string">&#x27;拉取代码&#x27;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                checkout([<span class="attr">$class:</span> <span class="string">&#x27;GitSCM&#x27;</span>, <span class="attr">branches:</span> [[<span class="attr">name:</span> <span class="string">&#x27;*/master&#x27;</span>]], <span class="attr">extensions:</span> [], <span class="attr">userRemoteConfigs:</span> [[<span class="attr">url:</span> <span class="string">&#x27;http://192.168.50.150:3000/root/devops.git&#x27;</span>]]])</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(<span class="string">&#x27;构建maven工程&#x27;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                script &#123;</span><br><span class="line">                    sh <span class="string">&#x27;mvn clean package -Dmaven.test.skip=true&#x27;</span></span><br><span class="line">                   &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(<span class="string">&#x27;打包镜像并推送&#x27;</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh <span class="string">&#x27;docker build -t $REGISTRY/$DOCKERHUB_NAMESPACE/$APP_NAME:v$BUILD_NUMBER . &#x27;</span></span><br><span class="line">                withCredentials([usernamePassword(<span class="attr">credentialsId:</span> <span class="string">&#x27;myhub&#x27;</span>, <span class="attr">passwordVariable:</span> <span class="string">&#x27;DOCKER_PASSWORD&#x27;</span>, <span class="attr">usernameVariable:</span> <span class="string">&#x27;DOCKER_USERNAME&#x27;</span>)]) &#123;</span><br><span class="line">                 sh <span class="string">&#x27;docker login $REGISTRY -u &quot;$DOCKER_USERNAME&quot; -p &quot;$DOCKER_PASSWORD&quot;&#x27;</span></span><br><span class="line">                 sh <span class="string">&#x27;docker push  $REGISTRY/$DOCKERHUB_NAMESPACE/$APP_NAME:v$BUILD_NUMBER&#x27;</span></span><br><span class="line">                 sh <span class="string">&#x27;docker rmi   $REGISTRY/$DOCKERHUB_NAMESPACE/$APP_NAME:v$BUILD_NUMBER&#x27;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(<span class="string">&#x27;滚动更新&#x27;</span>) &#123;</span><br><span class="line">            environment &#123;</span><br><span class="line">              image_name = <span class="string">&quot;$REGISTRY/$DOCKERHUB_NAMESPACE/$APP_NAME:v$BUILD_NUMBER&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">            steps &#123;</span><br><span class="line">                configFileProvider([configFile(<span class="attr">fileId:</span> <span class="string">&#x27;777eb186-d427-4806-a21a-a88f4115e038&#x27;</span>, <span class="attr">targetLocation:</span> <span class="string">&#x27;admin.kubeconfig&#x27;</span>)]) &#123;</span><br><span class="line">                  sh <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                      sed -i &#x27;s#IMAGE_NAME#$&#123;image_name&#125;#&#x27; deploy.yaml</span></span><br><span class="line"><span class="string">                      kubectl apply -f deploy.yaml -n default --kubeconfig=admin.kubeconfig</span></span><br><span class="line"><span class="string">                      sleep 60</span></span><br><span class="line"><span class="string">                      kubectl get pods,svc -n default --kubeconfig=admin.kubeconfig</span></span><br><span class="line"><span class="string">                    &quot;&quot;&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>点击构建后会看到起了一个动态的slave pod来执行构建任务</p>
<p><img src="https://raw.githubusercontent.com/KKolone/img/main/img/image-20220504213331384.png" alt="image-20220504213331384"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">创建kubeconfig 文件，编写deploy.yaml pod模板文件</span><br><span class="line">在上面构建Jenkins-Slave镜像的时候，我们已经在镜像里安装了kubectl 命令，只需要再添加一个kubeconfig 文件去连接K8S 集群，创建标准的 deployment.yaml ,servies.yaml 文件 就可以使用 kubectl apply XXX.yaml 文件从而生成pod</span><br><span class="line"></span><br><span class="line"># 拿出kubeconfig文件 上传至jenkins</span><br><span class="line">存储kubectl用于连接k8s集群的kubeconfig配置文件,需要安装 Config File Provider 这个插件, 上面在部署jenkins 环境初始化的时候，已经安装好了该插件</span><br><span class="line">Manage Jenkins -&gt; Managed files -&gt; Add a new Config -&gt; Custom file（自定义文件）</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/KKolone/img/main/img/image-20220504213519935.png" alt="image-20220504213519935"></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">编写标准的deploy.yaml</span> <span class="string">模板</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">flask</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="string">REPLICAS</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">flask</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">flask</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">imagePullSecrets:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">SECRET_NAME</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">IMAGE_NAME</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">flask</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">8080</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">flask-svc</span> </span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">flask</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">8080</span></span><br><span class="line"></span><br><span class="line"><span class="string">定义环境变量，使用参数化构建，修改deploy.yaml文件</span></span><br><span class="line"><span class="string">//定义harbor的地址</span></span><br><span class="line"><span class="string">def</span> <span class="string">registry</span> <span class="string">=</span> <span class="string">&quot;registry.kubernetes.com&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">//</span> <span class="string">项目，BUILD_NUMBER</span> <span class="string">jenkins</span> <span class="string">内置变量，jenkins</span> <span class="string">构建编号</span></span><br><span class="line"><span class="string">def</span> <span class="string">project</span> <span class="string">=</span> <span class="string">&quot;library&quot;</span></span><br><span class="line"><span class="string">def</span> <span class="string">app_name</span> <span class="string">=</span> <span class="string">&quot;flask&quot;</span></span><br><span class="line"><span class="string">def</span> <span class="string">image_name</span> <span class="string">=</span> <span class="string">&quot;$&#123;registry&#125;/$&#123;project&#125;/$&#123;app_name&#125;:$&#123;BUILD_NUMBER&#125;&quot;</span></span><br><span class="line"><span class="string">def</span> <span class="string">git_address</span> <span class="string">=</span> <span class="string">&quot;http://10.0.0.15:3000/devops/devops.git&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">//</span> <span class="string">认证</span></span><br><span class="line"><span class="string">//k8s</span> <span class="string">连接harbor</span> <span class="string">证书</span></span><br><span class="line"><span class="string">def</span> <span class="string">secret_name</span> <span class="string">=</span> <span class="string">&quot;harbor&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">//jenkins中定义docker连接harbor的用户密码凭证</span></span><br><span class="line"><span class="string">def</span> <span class="string">docker_registry_auth</span> <span class="string">=</span> <span class="string">&quot;f175b48e-3be9-400a-b8a6-6fac1c35eab7&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">//jenkins中定义git连接gitlab的用户密码凭证</span></span><br><span class="line"><span class="string">def</span> <span class="string">git_auth</span> <span class="string">=</span> <span class="string">&quot;552986f7-f727-49ce-b6c4-993e24fd6dd3&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">//jenkins中Config</span> <span class="string">File</span> <span class="string">Provider插件</span> <span class="string">定义的kubeconfig</span> <span class="string">文件内容</span></span><br><span class="line"><span class="string">def</span> <span class="string">k8s_auth</span> <span class="string">=</span> <span class="string">&quot;d5a46a6e-8fa9-4147-a39d-1f5bd396c861&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">发布分支(prod,dev)</span></span><br><span class="line"><span class="string">副本数（1,3,5,7）</span></span><br><span class="line"><span class="string">命名空间（prod,dev）</span></span><br><span class="line"></span><br><span class="line"><span class="string">一个标准的deploy.yaml模板文件，需要把修改的内容：</span></span><br><span class="line"><span class="comment">#修改deploy.yaml 中镜像名称</span></span><br><span class="line"><span class="string">sed</span> <span class="string">-i</span> <span class="string">&#x27;s#IMAGE_NAME#$&#123;image_name&#125;#&#x27;</span> <span class="string">flask.yaml</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#修改deploy.yaml 中k8s连接harbor连接的secret</span></span><br><span class="line"><span class="string">sed</span> <span class="string">-i</span> <span class="string">&#x27;s#SECRET_NAME#$&#123;secret_name&#125;#&#x27;</span> <span class="string">flask.yaml</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#修改deploy.yaml 中副本的数量</span></span><br><span class="line"><span class="string">sed</span> <span class="string">-i</span> <span class="string">&#x27;s#REPLICAS#$&#123;ReplicaCount&#125;#&#x27;</span> <span class="string">flask.yaml</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#指定pod 创建在哪个命名空间下</span></span><br><span class="line"><span class="string">kubectl</span> <span class="string">apply</span> <span class="string">-f</span> <span class="string">flask.yaml</span> <span class="string">-n</span> <span class="string">$&#123;Namespace&#125;</span> <span class="string">--kubeconfig=admin.kubeconfig</span></span><br><span class="line"></span><br><span class="line"><span class="string">pipeline中引用示例：</span></span><br><span class="line"><span class="string">//参数化构建</span></span><br><span class="line"><span class="string">parameters</span> &#123;</span><br><span class="line">        <span class="attr">gitParameter branch:</span> <span class="string">&#x27;&#x27;</span>, <span class="attr">branchFilter:</span> <span class="string">&#x27;.*&#x27;</span>, <span class="attr">defaultValue:</span> <span class="string">&#x27;master&#x27;</span>, <span class="attr">description:</span> <span class="string">&#x27;选择发布的分支&#x27;</span>, <span class="attr">name:</span> <span class="string">&#x27;Branch&#x27;</span>, <span class="attr">quickFilterEnabled:</span> <span class="literal">false</span>, <span class="attr">selectedValue:</span> <span class="string">&#x27;NONE&#x27;</span>, <span class="attr">sortMode:</span> <span class="string">&#x27;NONE&#x27;</span>, <span class="attr">tagFilter:</span> <span class="string">&#x27;*&#x27;</span>, <span class="attr">type:</span> <span class="string">&#x27;PT_BRANCH&#x27;</span></span><br><span class="line">        <span class="string">choice</span> <span class="string">(choices:</span> [<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;7&#x27;</span>], <span class="attr">description:</span> <span class="string">&#x27;副本数&#x27;</span>, <span class="attr">name:</span> <span class="string">&#x27;ReplicaCount&#x27;</span><span class="string">)</span></span><br><span class="line">        <span class="string">choice</span> <span class="string">(choices:</span> [<span class="string">&#x27;default&#x27;</span>], <span class="attr">description:</span> <span class="string">&#x27;命名空间&#x27;</span>, <span class="attr">name:</span> <span class="string">&#x27;Namespace&#x27;</span><span class="string">)</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="string">//部署pod需要修改的内容</span></span><br><span class="line"><span class="string">sh</span> <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">sed -i &#x27;s#IMAGE_NAME#$&#123;image_name&#125;#&#x27; flask.yaml</span></span><br><span class="line"><span class="string">sed -i &#x27;s#SECRET_NAME#$&#123;secret_name&#125;#&#x27; flask.yaml</span></span><br><span class="line"><span class="string">sed -i &#x27;s#REPLICAS#$&#123;ReplicaCount&#125;#&#x27; flask.yaml</span></span><br><span class="line"><span class="string">kubectl apply -f deploy.yaml -n $&#123;Namespace&#125; --kubeconfig=admin.kubeconfig</span></span><br><span class="line"><span class="string">&quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line"><span class="comment"># 完整的pipeline 流水线 脚本</span></span><br><span class="line"></span><br><span class="line"><span class="string">def</span> <span class="string">registry</span> <span class="string">=</span> <span class="string">&quot;registry.kubernetes.com&quot;</span></span><br><span class="line"><span class="string">def</span> <span class="string">project</span> <span class="string">=</span> <span class="string">&quot;library&quot;</span></span><br><span class="line"><span class="string">def</span> <span class="string">app_name</span> <span class="string">=</span> <span class="string">&quot;flask&quot;</span></span><br><span class="line"><span class="string">def</span> <span class="string">image_name</span> <span class="string">=</span> <span class="string">&quot;$&#123;registry&#125;/$&#123;project&#125;/$&#123;app_name&#125;:$&#123;BUILD_NUMBER&#125;&quot;</span></span><br><span class="line"><span class="string">def</span> <span class="string">git_address</span> <span class="string">=</span> <span class="string">&quot;http://10.0.0.15:3000/devops/devops.git&quot;</span></span><br><span class="line"><span class="string">def</span> <span class="string">secret_name</span> <span class="string">=</span> <span class="string">&quot;harbor&quot;</span></span><br><span class="line"><span class="string">def</span> <span class="string">docker_registry_auth</span> <span class="string">=</span> <span class="string">&quot;f175b48e-3be9-400a-b8a6-6fac1c35eab7&quot;</span></span><br><span class="line"><span class="string">def</span> <span class="string">git_auth</span> <span class="string">=</span> <span class="string">&quot;552986f7-f727-49ce-b6c4-993e24fd6dd3&quot;</span></span><br><span class="line"><span class="string">def</span> <span class="string">k8s_auth</span> <span class="string">=</span> <span class="string">&quot;d5a46a6e-8fa9-4147-a39d-1f5bd396c861&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">pipeline</span> &#123;</span><br><span class="line">    <span class="string">agent</span> &#123;</span><br><span class="line">        <span class="string">kubernetes</span> &#123;</span><br><span class="line">            <span class="string">yaml</span> <span class="string">&#x27;&#x27;</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string">apiVersion: v1</span></span><br><span class="line"><span class="string">kind: Pod</span></span><br><span class="line"><span class="string">metadata:</span></span><br><span class="line"><span class="string">  name: jenkins-slave</span></span><br><span class="line"><span class="string">  namespace: gitops</span></span><br><span class="line"><span class="string">spec:</span></span><br><span class="line"><span class="string">  imagePullSecrets:</span></span><br><span class="line"><span class="string">  - name: harbor</span></span><br><span class="line"><span class="string">  containers:</span></span><br><span class="line"><span class="string">  - name: jnlp</span></span><br><span class="line"><span class="string">    image: &quot;registry.kubernetes.com/library/slave:latest&quot;</span></span><br><span class="line"><span class="string">    volumeMounts:</span></span><br><span class="line"><span class="string">      - name: docker-command</span></span><br><span class="line"><span class="string">        mountPath: /usr/bin/docker</span></span><br><span class="line"><span class="string">      - name: docker-sock</span></span><br><span class="line"><span class="string">        mountPath: /var/run/docker.sock</span></span><br><span class="line"><span class="string">      - name: maven-cache</span></span><br><span class="line"><span class="string">        mountPath: /root/.m2</span></span><br><span class="line"><span class="string">  volumes:</span></span><br><span class="line"><span class="string">    - name: docker-command</span></span><br><span class="line"><span class="string">      hostPath:</span></span><br><span class="line"><span class="string">        path: /usr/bin/docker</span></span><br><span class="line"><span class="string">    - name: docker-sock</span></span><br><span class="line"><span class="string">      hostPath:</span></span><br><span class="line"><span class="string">        path: /var/run/docker.sock</span></span><br><span class="line"><span class="string">    - name: maven-cache</span></span><br><span class="line"><span class="string">      persistentVolumeClaim:</span></span><br><span class="line"><span class="string">        claimName: jenkins-slave</span></span><br><span class="line"><span class="string">&#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="string">parameters</span> &#123;</span><br><span class="line">        <span class="attr">gitParameter branch:</span> <span class="string">&#x27;&#x27;</span>, <span class="attr">branchFilter:</span> <span class="string">&#x27;.*&#x27;</span>, <span class="attr">defaultValue:</span> <span class="string">&#x27;master&#x27;</span>, <span class="attr">description:</span> <span class="string">&#x27;选择发布的分支&#x27;</span>, <span class="attr">name:</span> <span class="string">&#x27;Branch&#x27;</span>, <span class="attr">quickFilterEnabled:</span> <span class="literal">false</span>, <span class="attr">selectedValue:</span> <span class="string">&#x27;NONE&#x27;</span>, <span class="attr">sortMode:</span> <span class="string">&#x27;NONE&#x27;</span>, <span class="attr">tagFilter:</span> <span class="string">&#x27;*&#x27;</span>, <span class="attr">type:</span> <span class="string">&#x27;PT_BRANCH&#x27;</span></span><br><span class="line">        <span class="string">choice</span> <span class="string">(choices:</span> [<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;7&#x27;</span>], <span class="attr">description:</span> <span class="string">&#x27;副本数&#x27;</span>, <span class="attr">name:</span> <span class="string">&#x27;ReplicaCount&#x27;</span><span class="string">)</span></span><br><span class="line">        <span class="string">choice</span> <span class="string">(choices:</span> [<span class="string">&#x27;default&#x27;</span>], <span class="attr">description:</span> <span class="string">&#x27;命名空间&#x27;</span>, <span class="attr">name:</span> <span class="string">&#x27;Namespace&#x27;</span><span class="string">)</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="string">stages</span> &#123;</span><br><span class="line">        <span class="string">stage(&#x27;拉取代码&#x27;)</span>&#123;</span><br><span class="line">            <span class="string">steps</span> &#123;</span><br><span class="line">                <span class="string">checkout(</span>[<span class="string">$class:</span> <span class="string">&#x27;GitSCM&#x27;</span>, </span><br><span class="line">                <span class="attr">branches:</span> [[<span class="attr">name:</span> <span class="string">&quot;$&#123;params.Branch&#125;&quot;</span>]], </span><br><span class="line">                <span class="attr">doGenerateSubmoduleConfigurations:</span> <span class="literal">false</span>, </span><br><span class="line">                <span class="attr">extensions:</span> [], <span class="attr">submoduleCfg:</span> [], </span><br><span class="line">                <span class="attr">userRemoteConfigs:</span> [[<span class="attr">credentialsId:</span> <span class="string">&quot;$&#123;git_auth&#125;&quot;</span>, <span class="attr">url:</span> <span class="string">&quot;$&#123;git_address&#125;&quot;</span>]]</span><br><span class="line">                ]<span class="string">)</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="string">stage(&#x27;构建镜像并推送仓库&#x27;)</span> &#123;</span><br><span class="line">             <span class="string">steps</span> &#123;</span><br><span class="line">                <span class="string">withCredentials(</span>[<span class="string">usernamePassword(credentialsId:</span> <span class="string">&quot;$&#123;docker_registry_auth&#125;&quot;</span>, <span class="attr">passwordVariable:</span> <span class="string">&#x27;password&#x27;</span>, <span class="attr">usernameVariable:</span> <span class="string">&#x27;username&#x27;</span><span class="string">)</span>]<span class="string">)</span> &#123;</span><br><span class="line">                <span class="string">sh</span> <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">                docker build -t $&#123;image_name&#125; .</span></span><br><span class="line"><span class="string">                docker login -u $&#123;username&#125; -p &#x27;$&#123;password&#125;&#x27; $&#123;registry&#125;</span></span><br><span class="line"><span class="string">                docker push $&#123;image_name&#125;</span></span><br><span class="line"><span class="string">                &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">           &#125; </span><br><span class="line">			</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="string">stage(&#x27;部署到K8S平台&#x27;)</span>&#123;</span><br><span class="line">             <span class="string">steps</span> &#123;</span><br><span class="line">              <span class="string">configFileProvider(</span>[<span class="string">configFile(fileId:</span> <span class="string">&quot;$&#123;k8s_auth&#125;&quot;</span>, <span class="attr">targetLocation:</span> <span class="string">&quot;admin.kubeconfig&quot;</span><span class="string">)</span>]<span class="string">)</span>&#123;</span><br><span class="line">                <span class="string">sh</span> <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">                  sed -i &#x27;s#IMAGE_NAME#$&#123;image_name&#125;#&#x27; flask.yaml</span></span><br><span class="line"><span class="string">                  sed -i &#x27;s#SECRET_NAME#$&#123;secret_name&#125;#&#x27; flask.yaml</span></span><br><span class="line"><span class="string">                  sed -i &#x27;s#REPLICAS#$&#123;ReplicaCount&#125;#&#x27; flask.yaml</span></span><br><span class="line"><span class="string">                  kubectl apply -f flask.yaml -n $&#123;Namespace&#125; --kubeconfig=admin.kubeconfig</span></span><br><span class="line"><span class="string">                  sleep 120</span></span><br><span class="line"><span class="string">                  kubectl get pods,svc -n $&#123;Namespace&#125; --kubeconfig=admin.kubeconfig</span></span><br><span class="line"><span class="string">                &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>k8s</tag>
        <tag>devops</tag>
      </tags>
  </entry>
  <entry>
    <title>制作jenkins slave镜像</title>
    <url>/2022/05/01/%E5%88%B6%E4%BD%9Cjenkins-slave%E9%95%9C%E5%83%8F/</url>
    <content><![CDATA[<p>jenkins-slave主要用作为jenkins构建时使用，当有构建任务时，会将构建任务交给jenkins-slave去做，master节点作为任务调度节点。下面介绍一下镜像制作流程。</p>
<span id="more"></span>

<p>构建镜像需要的包以及软件如下图：<br><img src="https://raw.githubusercontent.com/KKolone/img/main/img/image-20220504211905845.png" alt="image-20220504211905845"></p>
<p>已经打成tar包供下载，下载链接如下。</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">链接：https://pan.baidu.com/s/1T2uBx3fm7FlnFmiFd5aGIA </span><br><span class="line">提取码：6666</span><br></pre></td></tr></table></figure>

<p>Dockerfile</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">FROM jenkins/inbound-agent</span><br><span class="line"></span><br><span class="line">USER root</span><br><span class="line"></span><br><span class="line">WORKDIR /home/jenkins</span><br><span class="line"></span><br><span class="line">ADD  apache-maven-3.8.5-bin.tar.gz /usr/local/</span><br><span class="line">COPY helm kubectl /usr/bin/</span><br><span class="line">COPY settings.xml /usr/local/apache-maven-3.8.5/conf/settings.xml</span><br><span class="line"></span><br><span class="line">ENV MVN_HOME=/usr/local/apache-maven-3.8.5</span><br><span class="line">ENV PATH=$&#123;PATH&#125;:$&#123;JAVA_HOME&#125;/bin:$&#123;MVN_HOME&#125;/bin</span><br><span class="line"></span><br><span class="line">ENTRYPOINT [&quot;jenkins-slave&quot;]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>使用docerkbuile命令构建镜像，之后可以使用docker tag更改镜像名上传到阿里云</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker build -t my-jenkins-slave:v1 .</span><br></pre></td></tr></table></figure>

<p>起一个容器测试jdk跟mvn命令是否可用</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">➜  slave docker run -it --rm registry.cn-hangzhou.aliyuncs.com/wqzy_k8s_images/jenkins-slave:v1 /bin/bash</span><br><span class="line">root@0b1807c6b445:/home/jenkins# mvn -v</span><br><span class="line">Apache Maven 3.8.5 (3599d3414f046de2324203b78ddcf9b5e4388aa0)</span><br><span class="line">Maven home: /usr/local/apache-maven-3.8.5</span><br><span class="line">Java version: 11.0.13, vendor: Eclipse Adoptium, runtime: /opt/java/openjdk</span><br><span class="line">Default locale: en, platform encoding: UTF-8</span><br><span class="line">OS name: &quot;linux&quot;, version: &quot;3.10.0-1160.el7.x86_64&quot;, arch: &quot;amd64&quot;, family: &quot;unix&quot;</span><br><span class="line"></span><br><span class="line">root@0b1807c6b445:/home/jenkins# java -version</span><br><span class="line">openjdk version &quot;11.0.13&quot; 2021-10-19</span><br><span class="line">OpenJDK Runtime Environment Temurin-11.0.13+8 (build 11.0.13+8)</span><br><span class="line">OpenJDK 64-Bit Server VM Temurin-11.0.13+8 (build 11.0.13+8, mixed mode)</span><br><span class="line"></span><br><span class="line">root@0b1807c6b445:/home/jenkins# helm version</span><br><span class="line">version.BuildInfo&#123;Version:&quot;v3.8.1&quot;, GitCommit:&quot;5cb9af4b1b271d11d7a97a71df3ac337dd94ad37&quot;, GitTreeState:&quot;clean&quot;, GoVersion:&quot;go1.17.5&quot;&#125;</span><br><span class="line"></span><br><span class="line">root@0b1807c6b445:/home/jenkins# kubectl version</span><br><span class="line">Client Version: version.Info&#123;Major:&quot;1&quot;, Minor:&quot;23&quot;, GitVersion:&quot;v1.23.1&quot;, GitCommit:&quot;86ec240af8cbd1b60bcc4c03c20da9b98005b92e&quot;, GitTreeState:&quot;clean&quot;, BuildDate:&quot;2021-12-16T11:41:01Z&quot;, GoVersion:&quot;go1.17.5&quot;, Compiler:&quot;gc&quot;, Platform:&quot;linux/amd64&quot;&#125;</span><br><span class="line">The connection to the server localhost:8080 was refused - did you specify the right host or port?</span><br><span class="line"></span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>jenkins</tag>
      </tags>
  </entry>
  <entry>
    <title>后端数据持久化</title>
    <url>/2022/05/01/%E5%90%8E%E7%AB%AF%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96/</url>
    <content><![CDATA[<p>介绍了如何使用heketi管理glusterfs，以及部署nfs服务，作为k8s的后端存储</p>
<span id="more"></span>

<h1 id="一-nfs部署"><a href="#一-nfs部署" class="headerlink" title="一.nfs部署"></a>一.nfs部署</h1><h2 id="1-安装nfs服务"><a href="#1-安装nfs服务" class="headerlink" title="1.安装nfs服务"></a>1.安装nfs服务</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#在所有机器上安装</span></span><br><span class="line">yum install -y nfs-utils</span><br><span class="line"></span><br><span class="line"><span class="comment">#在nfs服务节点上</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;/nfs/data/ (insecure,rw,sync,no_root_squash)&quot;</span> &gt; /etc/exports</span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> -p /nfs/data</span><br><span class="line">systemctl <span class="built_in">enable</span> rpcbind --now</span><br><span class="line">systemctl <span class="built_in">enable</span> nfs-server --now</span><br><span class="line"><span class="comment">#配置生效</span></span><br><span class="line">exportfs -r</span><br><span class="line"></span><br><span class="line">showmount -e 192.168.50.71</span><br><span class="line"><span class="comment">#测试使用nfs服务作为持久化存储创建一次部署</span></span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    app: nginx-pv-demo</span><br><span class="line">  name: nginx-pv-demo</span><br><span class="line">spec:</span><br><span class="line">  replicas: 2</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: nginx-pv-demo</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: nginx-pv-demo</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - image: nginx</span><br><span class="line">        name: nginx</span><br><span class="line">        volumeMounts:</span><br><span class="line">        - name: html</span><br><span class="line">          mountPath: /usr/share/nginx/html</span><br><span class="line">      volumes:</span><br><span class="line">        - name: html</span><br><span class="line">          nfs:</span><br><span class="line">            server: 192.168.50.71     <span class="comment">#nfs服务器地址</span></span><br><span class="line">            path: /nfs/data/nginx-pv</span><br></pre></td></tr></table></figure>

<h2 id="2-创建pv"><a href="#2-创建pv" class="headerlink" title="2.创建pv"></a>2.创建pv</h2><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment">#nfs主节点</span></span><br><span class="line"><span class="string">mkdir</span> <span class="string">-p</span> <span class="string">/nfs/data/01</span></span><br><span class="line"><span class="string">mkdir</span> <span class="string">-p</span> <span class="string">/nfs/data/02</span></span><br><span class="line"><span class="string">mkdir</span> <span class="string">-p</span> <span class="string">/nfs/data/03</span></span><br><span class="line"></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolume</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pv01-10m</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">capacity:</span></span><br><span class="line">    <span class="attr">storage:</span> <span class="string">10M</span></span><br><span class="line">  <span class="attr">accessModes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ReadWriteMany</span></span><br><span class="line">  <span class="attr">storageClassName:</span> <span class="string">nfs</span></span><br><span class="line">  <span class="attr">nfs:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/nfs/data/01</span></span><br><span class="line">    <span class="attr">server:</span> <span class="number">192.168</span><span class="number">.50</span><span class="number">.71</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolume</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pv02-1gi</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">capacity:</span></span><br><span class="line">    <span class="attr">storage:</span> <span class="string">1Gi</span></span><br><span class="line">  <span class="attr">accessModes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ReadWriteMany</span></span><br><span class="line">  <span class="attr">storageClassName:</span> <span class="string">nfs</span></span><br><span class="line">  <span class="attr">nfs:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/nfs/data/02</span></span><br><span class="line">    <span class="attr">server:</span> <span class="number">192.168</span><span class="number">.50</span><span class="number">.71</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolume</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pv03-3gi</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">capacity:</span></span><br><span class="line">    <span class="attr">storage:</span> <span class="string">3Gi</span></span><br><span class="line">  <span class="attr">accessModes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ReadWriteMany</span></span><br><span class="line">  <span class="attr">storageClassName:</span> <span class="string">nfs</span></span><br><span class="line">  <span class="attr">nfs:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/nfs/data/03</span></span><br><span class="line">    <span class="attr">server:</span> <span class="number">192.168</span><span class="number">.50</span><span class="number">.71</span></span><br></pre></td></tr></table></figure>

<h2 id="3-创建一个部署并且使用pvc声明"><a href="#3-创建一个部署并且使用pvc声明" class="headerlink" title="3.创建一个部署并且使用pvc声明"></a>3.创建一个部署并且使用pvc声明</h2><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx-deploy-pvc</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-deploy-pvc</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nginx-deploy-pvc</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nginx-deploy-pvc</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">nginx:1.21-alpine</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">html</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/usr/share/nginx/html</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">html</span></span><br><span class="line">          <span class="attr">persistentVolumeClaim:</span></span><br><span class="line">            <span class="attr">claimName:</span> <span class="string">nginx-pvc</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolumeClaim</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-pvc</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">accessModes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ReadWriteMany</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">    <span class="attr">requests:</span></span><br><span class="line">      <span class="attr">storage:</span> <span class="string">200Mi</span></span><br><span class="line">  <span class="attr">storageClassName:</span> <span class="string">nfs</span></span><br></pre></td></tr></table></figure>

<h2 id="4-创建动态sc并测试pod"><a href="#4-创建动态sc并测试pod" class="headerlink" title="4.创建动态sc并测试pod"></a>4.创建动态sc并测试pod</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">helm repo add moikot &lt;https://moikot.github.io/helm-charts&gt;</span><br><span class="line">helm repo update</span><br><span class="line">helm install nfs-storage --<span class="built_in">set</span> storageClass.name=nfs-storage --<span class="built_in">set</span> nfs.server=192.168.50.71 --<span class="built_in">set</span> nfs.path=/nfs/data moikot/nfs-client-provisioner --version 1.3.0 -n provisioner --create-namespace</span><br></pre></td></tr></table></figure>

<p>如果遇到pvc一直pending的情况，先查看provisioner的log，大概率是selflink的问题，通过下面命令查看日志</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line">[<span class="string">root@master1</span> <span class="string">~</span>]<span class="comment"># kubectl logs nfs-client-provisioner-5499445f5b-h278g -n nfsstorage</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#编辑文件，加上下图这一条</span></span><br><span class="line">vim /etc/kubernetes/manifests/kube-apiserver.yaml</span><br><span class="line"></span><br><span class="line">- --feature-gates=RemoveSelfLink=<span class="literal">false</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">kubectl apply -f /etc/kubernetes/manifests/kube-apiserver.yaml</span><br></pre></td></tr></table></figure>

<h1 id="二-heketi管理glusterfs"><a href="#二-heketi管理glusterfs" class="headerlink" title="二.heketi管理glusterfs"></a>二.heketi管理glusterfs</h1><h2 id="1-安装heketi，创建heketi集群"><a href="#1-安装heketi，创建heketi集群" class="headerlink" title="1.安装heketi，创建heketi集群"></a>1.安装heketi，创建heketi集群</h2><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">主机规划</span><br><span class="line">192.168.50.71 master，</span><br><span class="line"></span><br><span class="line">192.168.50.72 node1</span><br><span class="line"></span><br><span class="line">192.168.50.73 node2</span><br></pre></td></tr></table></figure>

<h3 id="1-1添加gluster源，所有主机"><a href="#1-1添加gluster源，所有主机" class="headerlink" title="1.1添加gluster源，所有主机"></a>1.1添加gluster源，所有主机</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install centos-release-gluster -y</span><br></pre></td></tr></table></figure>

<h3 id="1-2node1和node2安装glusterfs-server包作为服务器-同时开启glusterd服务"><a href="#1-2node1和node2安装glusterfs-server包作为服务器-同时开启glusterd服务" class="headerlink" title="1.2node1和node2安装glusterfs-server包作为服务器,同时开启glusterd服务"></a>1.2node1和node2安装glusterfs-server包作为服务器,同时开启glusterd服务</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install glusterfs-server -y</span><br><span class="line"></span><br><span class="line">systemctl enable --now glusterd</span><br></pre></td></tr></table></figure>

<h3 id="1-3在master管理节点上下载heketi服务以及heketi客户端管理包"><a href="#1-3在master管理节点上下载heketi服务以及heketi客户端管理包" class="headerlink" title="1.3在master管理节点上下载heketi服务以及heketi客户端管理包"></a>1.3在master管理节点上下载heketi服务以及heketi客户端管理包</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">yum install -y heketi heketi-client</span><br></pre></td></tr></table></figure>

<h3 id="1-4创建heketi的ssh加密密钥，同时传送到node1和node2"><a href="#1-4创建heketi的ssh加密密钥，同时传送到node1和node2" class="headerlink" title="1.4创建heketi的ssh加密密钥，同时传送到node1和node2"></a>1.4创建heketi的ssh加密密钥，同时传送到node1和node2</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ssh-keygen -t rsa -f /etc/heketi/heketi_key -N &quot;&quot;</span><br><span class="line"></span><br><span class="line">ssh-copy-id -i /etc/heketi/heketi_key [root@192.168.50.72](http://root@192.168.50.72/)</span><br><span class="line"></span><br><span class="line">ssh-copy-id -i /etc/heketi/heketi_key [root@192.168.50.73](http://root@192.168.50.73/)</span><br></pre></td></tr></table></figure>

<h3 id="1-5修改heketi的配置文件，需要改的地方如下图"><a href="#1-5修改heketi的配置文件，需要改的地方如下图" class="headerlink" title="1.5修改heketi的配置文件，需要改的地方如下图"></a>1.5修改heketi的配置文件，需要改的地方如下图</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /etc/heketi/heketi.json</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/KKolone/img/main/img/image-20220504215342202.png" alt="image-20220504215342202"></p>
<h3 id="1-6赋予权限"><a href="#1-6赋予权限" class="headerlink" title="1.6赋予权限"></a>1.6赋予权限</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@master ~]# chown -R heketi:heketi /etc/heketi/</span><br><span class="line"></span><br><span class="line">[root@master ~]# chown -R heketi:heketi /var/lib/heketi</span><br></pre></td></tr></table></figure>

<h3 id="1-7启动heketi服务"><a href="#1-7启动heketi服务" class="headerlink" title="1.7启动heketi服务"></a>1.7启动heketi服务</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@master ~]# systemctl daemon-reload</span><br><span class="line"></span><br><span class="line">[root@master ~]# systemctl enable --now heketi</span><br><span class="line"></span><br><span class="line">[root@master ~]# curl 127.0.0.1:8080/hello</span><br><span class="line"></span><br><span class="line">Hello from Heketi[root@master ~]#</span><br></pre></td></tr></table></figure>

<h3 id="1-8创建变量，易于操作"><a href="#1-8创建变量，易于操作" class="headerlink" title="1.8创建变量，易于操作"></a>1.8创建变量，易于操作</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@master ~]# export HEKETI_CLI_USER=admin</span><br><span class="line"></span><br><span class="line">[root@master ~]# export HEKETI_CLI_KEY=admin@123</span><br></pre></td></tr></table></figure>

<h2 id="2-操作heketi-cli创建集群"><a href="#2-操作heketi-cli创建集群" class="headerlink" title="2.操作heketi-cli创建集群"></a>2.操作heketi-cli创建集群</h2><h3 id="2-1创建一个cluster集群"><a href="#2-1创建一个cluster集群" class="headerlink" title="2.1创建一个cluster集群"></a>2.1创建一个cluster集群</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@master ~]# heketi-cli cluster list</span><br><span class="line"></span><br><span class="line">Clusters:</span><br><span class="line"></span><br><span class="line">[root@master ~]# heketi-cli cluster create</span><br><span class="line"></span><br><span class="line">Cluster id: b7f3457d370de5a798bf1a0da6de1cd1</span><br><span class="line"></span><br><span class="line">[root@master ~]# heketi-cli cluster list</span><br><span class="line"></span><br><span class="line">Clusters:</span><br><span class="line"></span><br><span class="line">Id:b7f3457d370de5a798bf1a0da6de1cd1 [file][block]</span><br></pre></td></tr></table></figure>

<h3 id="2-2把node1和node2加入其中"><a href="#2-2把node1和node2加入其中" class="headerlink" title="2.2把node1和node2加入其中"></a>2.2把node1和node2加入其中</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@master ~]# heketi-cli node add --zone 1 --cluster b7f3457d370de5a798bf1a0da6de1cd1 --management-host-name node1 --storage-host-name 192.168.50.72</span><br><span class="line"></span><br><span class="line">Node information:</span><br><span class="line"></span><br><span class="line">Id: 0e99fee20e24204bf4519e542725e3da</span><br><span class="line"></span><br><span class="line">State: online</span><br><span class="line"></span><br><span class="line">Cluster Id: b7f3457d370de5a798bf1a0da6de1cd1</span><br><span class="line"></span><br><span class="line">Zone: 1</span><br><span class="line"></span><br><span class="line">Management Hostname node1</span><br><span class="line"></span><br><span class="line">Storage Hostname 192.168.50.72</span><br><span class="line"></span><br><span class="line">[root@master ~]# heketi-cli node add --zone 1 --cluster b7f3457d370de5a798bf1a0da6de1cd1 --management-host-name node2 --storage-host-name 192.168.50.73</span><br><span class="line"></span><br><span class="line">Node information:</span><br><span class="line"></span><br><span class="line">Id: b0b91b75016670b4466efe48f8ba37c5</span><br><span class="line"></span><br><span class="line">State: online</span><br><span class="line"></span><br><span class="line">Cluster Id: b7f3457d370de5a798bf1a0da6de1cd1</span><br><span class="line"></span><br><span class="line">Zone: 1</span><br><span class="line"></span><br><span class="line">Management Hostname node2</span><br><span class="line"></span><br><span class="line">Storage Hostname 192.168.50.73</span><br><span class="line"></span><br><span class="line">[root@master ~]# heketi-cli node list</span><br><span class="line"></span><br><span class="line">Id:0e99fee20e24204bf4519e542725e3da     Cluster:b7f3457d370de5a798bf1a0da6de1cd1</span><br><span class="line"></span><br><span class="line">Id:b0b91b75016670b4466efe48f8ba37c5     Cluster:b7f3457d370de5a798bf1a0da6de1cd1</span><br></pre></td></tr></table></figure>

<h3 id="2-3添加硬盘到集群"><a href="#2-3添加硬盘到集群" class="headerlink" title="2.3添加硬盘到集群"></a>2.3添加硬盘到集群</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@master ~]# heketi-cli device add --name=/dev/sdb --node=0e99fee20e24204bf4519e542725e3da</span><br><span class="line"></span><br><span class="line">Device added successfully</span><br><span class="line"></span><br><span class="line">[root@master ~]# heketi-cli device add --name=/dev/sdb --node=b0b91b75016670b4466efe48f8ba37c5</span><br><span class="line"></span><br><span class="line">Device added successfully</span><br></pre></td></tr></table></figure>

<h2 id="3-使用k8s创建默认存储类型以及创建pvc"><a href="#3-使用k8s创建默认存储类型以及创建pvc" class="headerlink" title="3.使用k8s创建默认存储类型以及创建pvc"></a>3.使用k8s创建默认存储类型以及创建pvc</h2><h3 id="创建sc并应用"><a href="#创建sc并应用" class="headerlink" title="创建sc并应用"></a>创建sc并应用</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@master glusterfs-provisioner]# cat storage-class-glusterfs.yaml</span><br><span class="line"></span><br><span class="line">apiVersion: [storage.k8s.io/v1](http://storage.k8s.io/v1)</span><br><span class="line"></span><br><span class="line">kind: StorageClass</span><br><span class="line"></span><br><span class="line">metadata:</span><br><span class="line"></span><br><span class="line">name: glusterfs</span><br><span class="line"></span><br><span class="line">annotations:</span><br><span class="line"></span><br><span class="line">[storageclass.beta.kubernetes.io/is-default-class:](http://storageclass.beta.kubernetes.io/is-default-class:) &quot;true&quot;</span><br><span class="line"></span><br><span class="line">provisioner: [kubernetes.io/glusterfs](http://kubernetes.io/glusterfs)</span><br><span class="line"></span><br><span class="line">parameters:</span><br><span class="line"></span><br><span class="line">resturl: &quot;http://192.168.50.71:8080&quot;</span><br><span class="line"></span><br><span class="line">restuser: &quot;admin&quot;</span><br><span class="line"></span><br><span class="line">restuserkey: &quot;admin@123&quot;</span><br><span class="line"></span><br><span class="line">volumetype: &quot;replicate:2&quot;</span><br></pre></td></tr></table></figure>

<p>如使用sc创建动态存储无需操作上面的使用heketi手动创建集群步骤，可以参考下面连接来操作，sc的yaml文件可以参考上方。</p>
<p><a href="https://www.cnblogs.com/minseo/p/12575604.html">https://www.cnblogs.com/minseo/p/12575604.html</a></p>
]]></content>
      <tags>
        <tag>k8s</tag>
      </tags>
  </entry>
  <entry>
    <title>更换容器运行时</title>
    <url>/2022/05/04/%E6%9B%B4%E6%8D%A2%E5%AE%B9%E5%99%A8%E8%BF%90%E8%A1%8C%E6%97%B6/</url>
    <content><![CDATA[<p>介绍如何将容器运行时从docker更换到containerd</p>
<span id="more"></span>]]></content>
      <tags>
        <tag>containerd</tag>
      </tags>
  </entry>
  <entry>
    <title>k8s高可用部署</title>
    <url>/2022/05/01/k8s%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B2/</url>
    <content><![CDATA[<p>主要介绍了使用kubeadm搭配haproxy和keepalived进行高可用部署。</p>
<span id="more"></span>

<h1 id="1-主机规划"><a href="#1-主机规划" class="headerlink" title="1.主机规划"></a>1.主机规划</h1><table>
<thead>
<tr>
<th>主机IP地址</th>
<th>主机名</th>
<th>主机配置</th>
<th>主机角色</th>
<th>软件角色</th>
</tr>
</thead>
<tbody><tr>
<td>192.168.50.71</td>
<td>master1</td>
<td>2C4G</td>
<td>master</td>
<td>kube-apiserver、kube-controller-manager、kube-scheduler、etcd、kubelet、kube-prox</td>
</tr>
<tr>
<td>192.168.50.72</td>
<td>master2</td>
<td>2C4G</td>
<td>master</td>
<td>kube-apiserver、kube-controller-manager、kube-scheduler、etcd、kubelet、kube-prox</td>
</tr>
<tr>
<td>192.168.50.73</td>
<td>master3</td>
<td>2C4G</td>
<td>master</td>
<td>kube-apiserver、kube-controller-manager、kube-scheduler、etcd、kubelet、kube-prox</td>
</tr>
<tr>
<td>192.168.50.74</td>
<td>node1</td>
<td>8C12G</td>
<td>worker</td>
<td>kubelet、kube-proxy</td>
</tr>
<tr>
<td>192.168.50.77</td>
<td>lb1</td>
<td>1C2G</td>
<td>LB</td>
<td>haproxy、keepalived</td>
</tr>
<tr>
<td>192.168.50.78</td>
<td>lb2</td>
<td>1C2G</td>
<td>LB</td>
<td>haproxy、keepalived</td>
</tr>
<tr>
<td>192.168.50.80</td>
<td>&#x2F;</td>
<td>&#x2F;</td>
<td>VIP</td>
<td></td>
</tr>
</tbody></table>
<h1 id="2-环境准备"><a href="#2-环境准备" class="headerlink" title="2.环境准备"></a>2.环境准备</h1><h2 id="2-1设置主机名"><a href="#2-1设置主机名" class="headerlink" title="2.1设置主机名"></a>2.1设置主机名</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">hostnamectl set-hostname xxx</span><br></pre></td></tr></table></figure>

<h2 id="2-2主机与IP地址解析"><a href="#2-2主机与IP地址解析" class="headerlink" title="2.2主机与IP地址解析"></a>2.2主机与IP地址解析</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt;&gt; /etc/hosts &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">192.168.50.71 master1</span></span><br><span class="line"><span class="string">192.168.50.72 master2</span></span><br><span class="line"><span class="string">192.168.50.73 master3</span></span><br><span class="line"><span class="string">192.168.50.74 node1</span></span><br><span class="line"><span class="string">192.168.50.77 lb1</span></span><br><span class="line"><span class="string">192.168.50.78 lb2</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<h2 id="2-3主机安全设置"><a href="#2-3主机安全设置" class="headerlink" title="2.3主机安全设置"></a>2.3主机安全设置</h2><h3 id="2-3-1-关闭防火墙"><a href="#2-3-1-关闭防火墙" class="headerlink" title="2.3.1 关闭防火墙"></a>2.3.1 关闭防火墙</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld</span><br></pre></td></tr></table></figure>

<h3 id="2-3-2-关闭selinux"><a href="#2-3-2-关闭selinux" class="headerlink" title="2.3.2 关闭selinux"></a>2.3.2 关闭selinux</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">setenforce 0</span><br><span class="line">sed -i <span class="string">&#x27;s/^SELINUX=enforcing$/SELINUX=disabled/&#x27;</span> /etc/selinux/config</span><br></pre></td></tr></table></figure>

<h2 id="2-4关闭交换分区"><a href="#2-4关闭交换分区" class="headerlink" title="2.4关闭交换分区"></a>2.4关闭交换分区</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">swapoff -a</span><br><span class="line">sed -ri <span class="string">&#x27;s/.swap./#&amp;/&#x27;</span> /etc/fstab</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;vm.swappiness=0&quot;</span> &gt;&gt; /etc/sysctl.conf</span><br><span class="line">sysctl -p</span><br></pre></td></tr></table></figure>

<h2 id="2-5主机时间同步"><a href="#2-5主机时间同步" class="headerlink" title="2.5主机时间同步"></a>2.5主机时间同步</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">安装软件</span><br><span class="line">yum -y install ntpdate</span><br><span class="line"></span><br><span class="line">制定时间同步计划任务</span><br><span class="line">crontab -e</span><br><span class="line">0 /1    ntpdate pool.ntp.org</span><br></pre></td></tr></table></figure>

<h2 id="2-6主机系统优化"><a href="#2-6主机系统优化" class="headerlink" title="2.6主机系统优化"></a>2.6主机系统优化</h2><blockquote>
<p>limit优化</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ulimit -SHn 65535</span><br><span class="line">cat &lt;&lt;EOF &gt;&gt; /etc/security/limits.conf</span><br><span class="line"> soft nofile 655360</span><br><span class="line"> hard nofile 131072</span><br><span class="line"> soft nproc 655350</span><br><span class="line"> hard nproc 655350</span><br><span class="line"> soft memlock unlimited</span><br><span class="line"> hard memlock unlimited</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<h2 id="2-7加载IPVS模块"><a href="#2-7加载IPVS模块" class="headerlink" title="2.7加载IPVS模块"></a>2.7加载IPVS模块</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum -y install ipset ipvsadm sysstat conntrack libseccomp</span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/sysconfig/modules/ipvs.modules &lt;&lt;<span class="string">EOF </span></span><br><span class="line"><span class="string">modprobe ip_vs </span></span><br><span class="line"><span class="string">modprobe ip_vs_rr </span></span><br><span class="line"><span class="string">modprobe ip_vs_wrr </span></span><br><span class="line"><span class="string">modprobe ip_vs_sh </span></span><br><span class="line"><span class="string">modprobe nf_conntrack </span></span><br><span class="line"><span class="string">modprobe ip_tables </span></span><br><span class="line"><span class="string">modprobe ip_set </span></span><br><span class="line"><span class="string">modprobe xt_set </span></span><br><span class="line"><span class="string">modprobe ipt_set </span></span><br><span class="line"><span class="string">modprobe ipt_rpfilter </span></span><br><span class="line"><span class="string">modprobe ipt_REJECT </span></span><br><span class="line"><span class="string">modprobe ipip </span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"><span class="built_in">chmod</span> 755 /etc/sysconfig/modules/ipvs.modules &amp;&amp; sh /etc/sysconfig/modules/ipvs.modules</span><br></pre></td></tr></table></figure>

<h2 id="2-8检查桥接流量"><a href="#2-8检查桥接流量" class="headerlink" title="2.8检查桥接流量"></a>2.8检查桥接流量</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#允许 iptables 检查桥接流量</span></span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/sysctl.d/k8s.conf &lt;&lt;<span class="string">EOF </span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-iptables=1 </span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-ip6tables=1 </span></span><br><span class="line"><span class="string">net.ipv4.ip_forward=1 </span></span><br><span class="line"><span class="string">vm.swappiness=0 </span></span><br><span class="line"><span class="string">net.ipv4.tcp_tw_recycle=0 </span></span><br><span class="line"><span class="string">net.ipv4.neigh.default.gc_thresh1=1024 </span></span><br><span class="line"><span class="string">net.ipv4.neigh.default.gc_thresh2=2048 </span></span><br><span class="line"><span class="string">net.ipv4.neigh.default.gc_thresh3=4096 </span></span><br><span class="line"><span class="string">vm.overcommit_memory=1 </span></span><br><span class="line"><span class="string">vm.panic_on_oom=0 </span></span><br><span class="line"><span class="string">fs.inotify.max_user_instances=8192 </span></span><br><span class="line"><span class="string">fs.inotify.max_user_watches=1048576 </span></span><br><span class="line"><span class="string">fs.file-max=52706963 </span></span><br><span class="line"><span class="string">fs.nr_open=52706963 </span></span><br><span class="line"><span class="string">net.ipv6.conf.all.disable_ipv6=1 </span></span><br><span class="line"><span class="string">net.netfilter.nf_conntrack_max=2310720 </span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">sysctl --system</span><br></pre></td></tr></table></figure>

<h2 id="2-9内核升级"><a href="#2-9内核升级" class="headerlink" title="2.9内核升级"></a>2.9内核升级</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org</span><br><span class="line">rpm -Uvh http://www.elrepo.org/elrepo-release-7.0-5.el7.elrepo.noarch.rpm</span><br><span class="line">yum --enablerepo=elrepo-kernel install -y kernel-lt</span><br><span class="line">grub2-set-default 0</span><br><span class="line">grub2-mkconfig -o /boot/grub2/grub.cfg</span><br></pre></td></tr></table></figure>

<p><a href="https://cloud.tencent.com/developer/article/1922228">CentOS升级内核</a></p>
<h2 id="2-10负载均衡"><a href="#2-10负载均衡" class="headerlink" title="2.10负载均衡"></a>2.10负载均衡</h2><h3 id="安装haproxy与keepalived"><a href="#安装haproxy与keepalived" class="headerlink" title="安装haproxy与keepalived"></a>安装haproxy与keepalived</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum -y install haproxy keepalived</span><br></pre></td></tr></table></figure>

<h3 id="haproxy配置"><a href="#haproxy配置" class="headerlink" title="haproxy配置"></a>haproxy配置</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt;/etc/haproxy/haproxy.cfg&lt;&lt;<span class="string">&quot;EOF&quot;</span></span><br><span class="line"><span class="comment">#---------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Example configuration for a possible web application.  See the</span></span><br><span class="line"><span class="comment"># full configuration options online.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   &lt;http://haproxy.1wt.eu/download/1.4/doc/configuration.txt&gt;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#---------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#---------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Global settings</span></span><br><span class="line"><span class="comment">#---------------------------------------------------------------------</span></span><br><span class="line">global</span><br><span class="line">    <span class="comment"># to have these messages end up in /var/log/haproxy.log you will</span></span><br><span class="line">    <span class="comment"># need to:</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># 1) configure syslog to accept network log events.  This is done</span></span><br><span class="line">    <span class="comment">#    by adding the &#x27;-r&#x27; option to the SYSLOGD_OPTIONS in</span></span><br><span class="line">    <span class="comment">#    /etc/sysconfig/syslog</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># 2) configure local2 events to go to the /var/log/haproxy.log</span></span><br><span class="line">    <span class="comment">#   file. A line like the following can be added to</span></span><br><span class="line">    <span class="comment">#   /etc/sysconfig/syslog</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment">#    local2.                       /var/log/haproxy.log</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="built_in">log</span>         127.0.0.1 local2</span><br><span class="line"></span><br><span class="line">    <span class="built_in">chroot</span>      /var/lib/haproxy</span><br><span class="line">    pidfile     /var/run/haproxy.pid</span><br><span class="line">    maxconn     4000</span><br><span class="line">    user        haproxy</span><br><span class="line">    group       haproxy</span><br><span class="line">    daemon</span><br><span class="line"></span><br><span class="line">    <span class="comment"># turn on stats unix socket</span></span><br><span class="line">    stats socket /var/lib/haproxy/stats</span><br><span class="line"></span><br><span class="line"><span class="comment">#---------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># common defaults that all the &#x27;listen&#x27; and &#x27;backend&#x27; sections will</span></span><br><span class="line"><span class="comment"># use if not designated in their block</span></span><br><span class="line"><span class="comment">#---------------------------------------------------------------------</span></span><br><span class="line">defaults</span><br><span class="line">    mode                    http</span><br><span class="line">    <span class="built_in">log</span>                     global</span><br><span class="line">    option                  httplog</span><br><span class="line">    option                  dontlognull</span><br><span class="line">    option http-server-close</span><br><span class="line">    option forwardfor       except 127.0.0.0/8</span><br><span class="line">    option                  redispatch</span><br><span class="line">    retries                 3</span><br><span class="line">    <span class="built_in">timeout</span> http-request    10s</span><br><span class="line">    <span class="built_in">timeout</span> queue           1m</span><br><span class="line">    <span class="built_in">timeout</span> connect         10s</span><br><span class="line">    <span class="built_in">timeout</span> client          1m</span><br><span class="line">    <span class="built_in">timeout</span> server          1m</span><br><span class="line">    <span class="built_in">timeout</span> http-keep-alive 10s</span><br><span class="line">    <span class="built_in">timeout</span> check           10s</span><br><span class="line">    maxconn                 3000</span><br><span class="line"></span><br><span class="line"><span class="comment">#---------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># main frontend which proxys to the backends</span></span><br><span class="line"><span class="comment">#---------------------------------------------------------------------</span></span><br><span class="line">frontend apiserver</span><br><span class="line">    <span class="built_in">bind</span> :6443</span><br><span class="line">    mode tcp</span><br><span class="line">    option tcplog</span><br><span class="line">    default_backend apiserver</span><br><span class="line"><span class="comment">#---------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># static backend for serving up images, stylesheets and such</span></span><br><span class="line"><span class="comment">#---------------------------------------------------------------------</span></span><br><span class="line">backend apiserver</span><br><span class="line">    option httpchk GET /healthz</span><br><span class="line">    http-check expect status 200</span><br><span class="line">    mode tcp</span><br><span class="line">    option ssl-hello-chk</span><br><span class="line">    balance  roundrobin</span><br><span class="line">    <span class="comment">#server为三个k8s master的地址:端口</span></span><br><span class="line">    server  master1 192.168.50.71:6443 check</span><br><span class="line">    server  master2 192.168.50.72:6443 check</span><br><span class="line">    server  master3 192.168.50.73:6443 check</span><br></pre></td></tr></table></figure>

<h3 id="keepalived配置-主从配置不一致，需要注意"><a href="#keepalived配置-主从配置不一致，需要注意" class="headerlink" title="keepalived配置(主从配置不一致，需要注意)"></a>keepalived配置(主从配置不一致，需要注意)</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt;/etc/keepalived/keepalived.conf&lt;&lt;<span class="string">&quot;EOF&quot;</span></span><br><span class="line">global_defs &#123;</span><br><span class="line">    router_id LVS_DEVEL</span><br><span class="line">&#125;</span><br><span class="line">vrrp_script check_apiserver &#123;</span><br><span class="line">  script <span class="string">&quot;/etc/keepalived/check_apiserver.sh&quot;</span>    <span class="comment">#健康检查脚本如下</span></span><br><span class="line">  interval 3</span><br><span class="line">  weight -2</span><br><span class="line">  fall 10</span><br><span class="line">  rise 2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state MASTER <span class="comment">#Master</span></span><br><span class="line">    interface ens160</span><br><span class="line">    virtual_router_id 51 <span class="comment">#主备的router_id保存一致</span></span><br><span class="line">    priority 101   <span class="comment">#Master的优先级要高于Backup</span></span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 42  <span class="comment">#主备的auth_pass保存一致</span></span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        192.168.50.80  <span class="comment">#VIP</span></span><br><span class="line">    &#125;</span><br><span class="line">    track_script &#123;</span><br><span class="line">        check_apiserver</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#健康检查脚本</span></span><br><span class="line"><span class="built_in">cat</span> /etc/keepalived/check_apiserver.sh</span><br><span class="line"><span class="comment">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">errorExit</span></span>() &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot; $&quot;</span> 1&gt;&amp;2</span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">curl --silent --max-time 2 --insecure https://localhost:6443/ -o /dev/null || errorExit <span class="string">&quot;Error GET https://localhost:6443/&quot;</span></span><br><span class="line"><span class="keyword">if</span> ip addr | grep -q 192.168.50.80; <span class="keyword">then</span></span><br><span class="line">    curl --silent --max-time 2 --insecure https://192.168.50.80:6443/ -o /dev/null || errorExit <span class="string">&quot;Error GET https://192.168.50.80:6443/&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<h2 id="2-11安装docker并启动"><a href="#2-11安装docker并启动" class="headerlink" title="2.11安装docker并启动"></a>2.11安装docker并启动</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install -y yum-utils</span><br><span class="line">yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class="line">yum install -y docker-ce docker-ce-cli containerd.io</span><br><span class="line">systemctl <span class="built_in">enable</span> --now docker</span><br></pre></td></tr></table></figure>

<p><a href="https://docs.docker.com/engine/install/centos/">Install Docker Engine on CentOS</a></p>
<p>配置阿里云镜像加速器</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">1. 安装／升级Docker客户端</span><br><span class="line">推荐安装1.10.0以上版本的Docker客户端，参考文档docker-ce</span><br><span class="line"></span><br><span class="line">2. 配置镜像加速器</span><br><span class="line">针对Docker客户端版本大于 1.10.0 的用户</span><br><span class="line"></span><br><span class="line">您可以通过修改daemon配置文件/etc/docker/daemon.json来使用加速器</span><br><span class="line"></span><br><span class="line">sudo <span class="built_in">mkdir</span> -p /etc/docker</span><br><span class="line">sudo <span class="built_in">tee</span> /etc/docker/daemon.json &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;&lt;https://hd1esep4.mirror.aliyuncs.com&gt;&quot;</span>],</span><br><span class="line"><span class="string">&quot;insecure-registries&quot;</span>: [<span class="string">&quot;192.168.50.150:85&quot;</span>],</span><br><span class="line"><span class="string">&quot;exec-opts&quot;</span>: [<span class="string">&quot;native.cgroupdriver=systemd&quot;</span>],</span><br><span class="line"><span class="string">&quot;log-driver&quot;</span>: <span class="string">&quot;json-file&quot;</span>,</span><br><span class="line"><span class="string">&quot;log-opts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;max-size&quot;</span>: <span class="string">&quot;100m&quot;</span> &#125;,</span><br><span class="line">        <span class="string">&quot;storage-driver&quot;</span>: <span class="string">&quot;overlay2&quot;</span>,</span><br><span class="line"><span class="string">&quot;storage-opts&quot;</span>: [ <span class="string">&quot;overlay2.override_kernel_check=true&quot;</span> ] &#125;</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure>

<h2 id="2-12安装kubelet，kubectl，kubeadm-每台机器"><a href="#2-12安装kubelet，kubectl，kubeadm-每台机器" class="headerlink" title="2.12安装kubelet，kubectl，kubeadm(每台机器)"></a>2.12安装kubelet，kubectl，kubeadm(每台机器)</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#配置k8s仓库，集群内的每台机器安装三大件</span></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF | sudo tee /etc/yum.repos.d/kubernetes.repo</span></span><br><span class="line"><span class="string">[kubernetes]</span></span><br><span class="line"><span class="string">name=Kubernetes</span></span><br><span class="line"><span class="string">baseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64</span></span><br><span class="line"><span class="string">enabled=1</span></span><br><span class="line"><span class="string">gpgcheck=0</span></span><br><span class="line"><span class="string">repo_gpgcheck=0</span></span><br><span class="line"><span class="string">gpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg</span></span><br><span class="line"><span class="string">   &lt;http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg&gt;</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">yum install -y kubelet-1.23.6 kubeadm-1.23.6 kubectl-1.23.6 </span><br><span class="line"></span><br><span class="line">systemctl <span class="built_in">enable</span> kubelet &amp;&amp; systemctl status kubelet</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/sysconfig/kubelet &lt;&lt;<span class="string">EOF </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">KUBELET_EXTRA_ARGS=--cgroup-driver=systemd </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">systemctl daemon-reload </span><br><span class="line"></span><br><span class="line"><span class="comment">#kubeadm config images list --kubernetes-version v1.23.6   查看这个版本所需的各种镜像版本</span></span><br></pre></td></tr></table></figure>

<h1 id="3-初始化安装"><a href="#3-初始化安装" class="headerlink" title="3.初始化安装"></a>3.初始化安装</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> ~/kubeadm_init &amp;&amp; <span class="built_in">cd</span> ~/kubeadm_init</span><br><span class="line">kubeadm config <span class="built_in">print</span> init-defaults &gt; kubeadm-init.yaml</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt; kubeadm-init.yaml &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">apiVersion: kubeadm.k8s.io/v1beta3</span></span><br><span class="line"><span class="string">bootstrapTokens:</span></span><br><span class="line"><span class="string">- groups:</span></span><br><span class="line"><span class="string">  - system:bootstrappers:kubeadm:default-node-token</span></span><br><span class="line"><span class="string">  token: abcdef.0123456789abcdef</span></span><br><span class="line"><span class="string">  ttl: 24h0m0s</span></span><br><span class="line"><span class="string">  usages:</span></span><br><span class="line"><span class="string">  - signing</span></span><br><span class="line"><span class="string">  - authentication</span></span><br><span class="line"><span class="string">kind: InitConfiguration</span></span><br><span class="line"><span class="string">localAPIEndpoint:</span></span><br><span class="line"><span class="string">  advertiseAddress: 192.168.50.71       #本机ip</span></span><br><span class="line"><span class="string">  bindPort: 6443</span></span><br><span class="line"><span class="string">nodeRegistration:</span></span><br><span class="line"><span class="string">  criSocket: /var/run/dockershim.sock</span></span><br><span class="line"><span class="string">  imagePullPolicy: IfNotPresent</span></span><br><span class="line"><span class="string">  name: master1                        #本机的主机名</span></span><br><span class="line"><span class="string">  taints:</span></span><br><span class="line"><span class="string">  - effect: &quot;NoSchedule&quot;</span></span><br><span class="line"><span class="string">    key: &quot;node-role.kubernetes.io/master&quot;</span></span><br><span class="line"><span class="string">---</span></span><br><span class="line"><span class="string">apiServer:</span></span><br><span class="line"><span class="string">  timeoutForControlPlane: 4m0s</span></span><br><span class="line"><span class="string">apiVersion: kubeadm.k8s.io/v1beta2</span></span><br><span class="line"><span class="string">certificatesDir: /etc/kubernetes/pki</span></span><br><span class="line"><span class="string">clusterName: kubernetes</span></span><br><span class="line"><span class="string">controlPlaneEndpoint: &quot;192.168.50.80:6443&quot;        #vip</span></span><br><span class="line"><span class="string">controllerManager: &#123;&#125;</span></span><br><span class="line"><span class="string">dns: </span></span><br><span class="line"><span class="string">  type: CoreDNS</span></span><br><span class="line"><span class="string">etcd:</span></span><br><span class="line"><span class="string">  local:</span></span><br><span class="line"><span class="string">    dataDir: /var/lib/etcd</span></span><br><span class="line"><span class="string">imageRepository: registry.aliyuncs.com/google_containers</span></span><br><span class="line"><span class="string">kind: ClusterConfiguration</span></span><br><span class="line"><span class="string">kubernetesVersion: 1.23.6</span></span><br><span class="line"><span class="string">networking:</span></span><br><span class="line"><span class="string">  dnsDomain: cluster.local</span></span><br><span class="line"><span class="string">  serviceSubnet: 10.96.0.0/12</span></span><br><span class="line"><span class="string">  podSubnet: 10.244.0.0/16  </span></span><br><span class="line"><span class="string">scheduler: &#123;&#125;</span></span><br><span class="line"><span class="string">--- </span></span><br><span class="line"><span class="string">apiVersion: kubeproxy.config.k8s.io/v1alpha1</span></span><br><span class="line"><span class="string">kind: KubeProxyConfiguration </span></span><br><span class="line"><span class="string">mode: ipvs</span></span><br><span class="line"><span class="string">--- </span></span><br><span class="line"><span class="string">apiVersion: kubelet.config.k8s.io/v1beta1</span></span><br><span class="line"><span class="string">kind: KubeletConfiguration </span></span><br><span class="line"><span class="string">cgroupDriver: systemd</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 预拉取镜像</span></span><br><span class="line">kubeadm config images pull --config kubeadm-init.yaml</span><br><span class="line"></span><br><span class="line">kubeadm init --config=kubeadm-init.yaml --upload-certs | <span class="built_in">tee</span> kubeadm-init.log</span><br></pre></td></tr></table></figure>

<h2 id="3-1重新生成token"><a href="#3-1重新生成token" class="headerlink" title="3.1重新生成token"></a>3.1重新生成token</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">1. 重新生成新的token:</span><br><span class="line">[root@node1 flannel]<span class="comment"># kubeadm  token create</span></span><br><span class="line">kiyfhw.xiacqbch8o8fa8qj</span><br><span class="line">[root@node1 flannel]<span class="comment"># kubeadm  token list</span></span><br><span class="line">TOKEN                     TTL         EXPIRES                     USAGES                   DESCRIPTION   EXTRA GROUPS</span><br><span class="line">gvvqwk.hn56nlsgsv11mik6   &lt;invalid&gt;   2018-10-25T14:16:06+08:00   authentication,signing   &lt;none&gt;        system:bootstrappers:kubeadm:default-node-token</span><br><span class="line">kiyfhw.xiacqbch8o8fa8qj   23h         2018-10-27T06:39:24+08:00   authentication,signing   &lt;none&gt;        system:bootstrappers:kubeadm:default-node-token</span><br><span class="line"></span><br><span class="line">2. 获取ca证书sha256编码<span class="built_in">hash</span>值:</span><br><span class="line">[root@node1 flannel]<span class="comment"># openssl x509 -pubkey -in /etc/kubernetes/pki/ca.crt | openssl rsa -pubin -outform der 2&gt;/dev/null | openssl dgst -sha256 -hex | sed &#x27;s/^. //&#x27;</span></span><br><span class="line">5417eb1b68bd4e7a4c82aded83abc55ec91bd601e45734d6aba85de8b1ebb057</span><br><span class="line"></span><br><span class="line">3. 节点加入集群:</span><br><span class="line">  kubeadm <span class="built_in">join</span> 192.168.50.71:6443 --token kiyfhw.xiacqbch8o8fa8qj --discovery-token-ca-cert-hash sha256:5417eb1b68bd4e7a4c82aded83abc55ec91bd601e45734d6aba85de8b1ebb057</span><br><span class="line">几秒钟后，您应该注意到kubectl get nodes在主服务器上运行时输出中的此节点。</span><br><span class="line"></span><br><span class="line">上面的方法比较繁琐，一步到位：</span><br><span class="line">kubeadm token create --print-join-command</span><br><span class="line"></span><br><span class="line">第二种方法：</span><br><span class="line">token=$(kubeadm token generate)</span><br><span class="line">kubeadm token create <span class="variable">$token</span> --print-join-command --ttl=0</span><br></pre></td></tr></table></figure>

<h2 id="3-2配置使用网络插件calico（主节点）"><a href="#3-2配置使用网络插件calico（主节点）" class="headerlink" title="3.2配置使用网络插件calico（主节点）"></a>3.2配置使用网络插件calico（主节点）</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">kubectl apply -f calico.yaml</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Source: calico/templates/calico-config.yaml</span></span><br><span class="line"><span class="comment"># This ConfigMap is used to configure a self-hosted Calico installation.</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">calico-config</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="comment"># Typha is disabled.</span></span><br><span class="line">  <span class="attr">typha_service_name:</span> <span class="string">&quot;none&quot;</span></span><br><span class="line">  <span class="comment"># Configure the backend to use.</span></span><br><span class="line">  <span class="attr">calico_backend:</span> <span class="string">&quot;bird&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Configure the MTU to use for workload interfaces and tunnels.</span></span><br><span class="line">  <span class="comment"># By default, MTU is auto-detected, and explicitly setting this field should not be required.</span></span><br><span class="line">  <span class="comment"># You can override auto-detection by providing a non-zero value.</span></span><br><span class="line">  <span class="attr">veth_mtu:</span> <span class="string">&quot;0&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># The CNI network configuration to install on each node. The special</span></span><br><span class="line">  <span class="comment"># values in this config will be automatically populated.</span></span><br><span class="line">  <span class="attr">cni_network_config:</span> <span class="string">|-</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">      &quot;name&quot;: &quot;k8s-pod-network&quot;,</span></span><br><span class="line"><span class="string">      &quot;cniVersion&quot;: &quot;0.3.1&quot;,</span></span><br><span class="line"><span class="string">      &quot;plugins&quot;: [</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">          &quot;type&quot;: &quot;calico&quot;,</span></span><br><span class="line"><span class="string">          &quot;log_level&quot;: &quot;info&quot;,</span></span><br><span class="line"><span class="string">          &quot;log_file_path&quot;: &quot;/var/log/calico/cni/cni.log&quot;,</span></span><br><span class="line"><span class="string">          &quot;datastore_type&quot;: &quot;kubernetes&quot;,</span></span><br><span class="line"><span class="string">          &quot;nodename&quot;: &quot;__KUBERNETES_NODE_NAME__&quot;,</span></span><br><span class="line"><span class="string">          &quot;mtu&quot;: __CNI_MTU__,</span></span><br><span class="line"><span class="string">          &quot;ipam&quot;: &#123;</span></span><br><span class="line"><span class="string">              &quot;type&quot;: &quot;calico-ipam&quot;</span></span><br><span class="line"><span class="string">          &#125;,</span></span><br><span class="line"><span class="string">          &quot;policy&quot;: &#123;</span></span><br><span class="line"><span class="string">              &quot;type&quot;: &quot;k8s&quot;</span></span><br><span class="line"><span class="string">          &#125;,</span></span><br><span class="line"><span class="string">          &quot;kubernetes&quot;: &#123;</span></span><br><span class="line"><span class="string">              &quot;kubeconfig&quot;: &quot;__KUBECONFIG_FILEPATH__&quot;</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">          &quot;type&quot;: &quot;portmap&quot;,</span></span><br><span class="line"><span class="string">          &quot;snat&quot;: true,</span></span><br><span class="line"><span class="string">          &quot;capabilities&quot;: &#123;&quot;portMappings&quot;: true&#125;</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">          &quot;type&quot;: &quot;bandwidth&quot;,</span></span><br><span class="line"><span class="string">          &quot;capabilities&quot;: &#123;&quot;bandwidth&quot;: true&#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      ]</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Source: calico/templates/kdd-crds.yaml</span></span><br><span class="line"></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apiextensions.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CustomResourceDefinition</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">bgpconfigurations.crd.projectcalico.org</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">group:</span> <span class="string">crd.projectcalico.org</span></span><br><span class="line">  <span class="attr">names:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">BGPConfiguration</span></span><br><span class="line">    <span class="attr">listKind:</span> <span class="string">BGPConfigurationList</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">bgpconfigurations</span></span><br><span class="line">    <span class="attr">singular:</span> <span class="string">bgpconfiguration</span></span><br><span class="line">  <span class="attr">scope:</span> <span class="string">Cluster</span></span><br><span class="line">  <span class="attr">versions:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">v1</span></span><br><span class="line">    <span class="attr">schema:</span></span><br><span class="line">      <span class="attr">openAPIV3Schema:</span></span><br><span class="line">        <span class="attr">description:</span> <span class="string">BGPConfiguration</span> <span class="string">contains</span> <span class="string">the</span> <span class="string">configuration</span> <span class="string">for</span> <span class="string">any</span> <span class="string">BGP</span> <span class="string">routing.</span></span><br><span class="line">        <span class="attr">properties:</span></span><br><span class="line">          <span class="attr">apiVersion:</span></span><br><span class="line">            <span class="attr">description:</span> <span class="string">&#x27;APIVersion defines the versioned schema of this representation</span></span><br><span class="line"><span class="string">              of an object. Servers should convert recognized schemas to the latest</span></span><br><span class="line"><span class="string">              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources&#x27;</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">          <span class="attr">kind:</span></span><br><span class="line">            <span class="attr">description:</span> <span class="string">&#x27;Kind is a string value representing the REST resource this</span></span><br><span class="line"><span class="string">              object represents. Servers may infer this from the endpoint the client</span></span><br><span class="line"><span class="string">              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds&#x27;</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">          <span class="attr">metadata:</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">          <span class="attr">spec:</span></span><br><span class="line">            <span class="attr">description:</span> <span class="string">BGPConfigurationSpec</span> <span class="string">contains</span> <span class="string">the</span> <span class="string">values</span> <span class="string">of</span> <span class="string">the</span> <span class="string">BGP</span> <span class="string">configuration.</span></span><br><span class="line">            <span class="attr">properties:</span></span><br><span class="line">              <span class="attr">asNumber:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;ASNumber is the default AS number used by a node. [Default:</span></span><br><span class="line"><span class="string">                  64512]&#x27;</span></span><br><span class="line">                <span class="attr">format:</span> <span class="string">int32</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">              <span class="attr">communities:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">Communities</span> <span class="string">is</span> <span class="string">a</span> <span class="string">list</span> <span class="string">of</span> <span class="string">BGP</span> <span class="string">community</span> <span class="string">values</span> <span class="string">and</span> <span class="string">their</span></span><br><span class="line">                  <span class="string">arbitrary</span> <span class="string">names</span> <span class="string">for</span> <span class="string">tagging</span> <span class="string">routes.</span></span><br><span class="line">                <span class="attr">items:</span></span><br><span class="line">                  <span class="attr">description:</span> <span class="string">Community</span> <span class="string">contains</span> <span class="string">standard</span> <span class="string">or</span> <span class="string">large</span> <span class="string">community</span> <span class="string">value</span></span><br><span class="line">                    <span class="string">and</span> <span class="string">its</span> <span class="string">name.</span></span><br><span class="line">                  <span class="attr">properties:</span></span><br><span class="line">                    <span class="attr">name:</span></span><br><span class="line">                      <span class="attr">description:</span> <span class="string">Name</span> <span class="string">given</span> <span class="string">to</span> <span class="string">community</span> <span class="string">value.</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                    <span class="attr">value:</span></span><br><span class="line">                      <span class="attr">description:</span> <span class="string">Value</span> <span class="string">must</span> <span class="string">be</span> <span class="string">of</span> <span class="string">format</span> <span class="string">`aa:nn`</span> <span class="string">or</span> <span class="string">`aa:nn:mm`.</span></span><br><span class="line">                        <span class="string">For</span> <span class="string">standard</span> <span class="string">community</span> <span class="string">use</span> <span class="string">`aa:nn`</span> <span class="string">format,</span> <span class="string">where</span> <span class="string">`aa`</span> <span class="string">and</span></span><br><span class="line">                        <span class="string">`nn`</span> <span class="string">are</span> <span class="number">16</span> <span class="string">bit</span> <span class="string">number.</span> <span class="string">For</span> <span class="string">large</span> <span class="string">community</span> <span class="string">use</span> <span class="string">`aa:nn:mm`</span></span><br><span class="line">                        <span class="string">format,</span> <span class="string">where</span> <span class="string">`aa`,</span> <span class="string">`nn`</span> <span class="string">and</span> <span class="string">`mm`</span> <span class="string">are</span> <span class="number">32</span> <span class="string">bit</span> <span class="string">number.</span> <span class="string">Where,</span></span><br><span class="line">                        <span class="string">`aa`</span> <span class="string">is</span> <span class="string">an</span> <span class="string">AS</span> <span class="string">Number,</span> <span class="string">`nn`</span> <span class="string">and</span> <span class="string">`mm`</span> <span class="string">are</span> <span class="string">per-AS</span> <span class="string">identifier.</span></span><br><span class="line">                      <span class="attr">pattern:</span> <span class="string">^(\d+):(\d+)$|^(\d+):(\d+):(\d+)$</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                  <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">              <span class="attr">listenPort:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">ListenPort</span> <span class="string">is</span> <span class="string">the</span> <span class="string">port</span> <span class="string">where</span> <span class="string">BGP</span> <span class="string">protocol</span> <span class="string">should</span> <span class="string">listen.</span></span><br><span class="line">                  <span class="string">Defaults</span> <span class="string">to</span> <span class="number">179</span></span><br><span class="line">                <span class="attr">maximum:</span> <span class="number">65535</span></span><br><span class="line">                <span class="attr">minimum:</span> <span class="number">1</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">              <span class="attr">logSeverityScreen:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;LogSeverityScreen is the log severity above which logs</span></span><br><span class="line"><span class="string">                  are sent to the stdout. [Default: INFO]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">nodeToNodeMeshEnabled:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;NodeToNodeMeshEnabled sets whether full node to node</span></span><br><span class="line"><span class="string">                  BGP mesh is enabled. [Default: true]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">boolean</span></span><br><span class="line">              <span class="attr">prefixAdvertisements:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">PrefixAdvertisements</span> <span class="string">contains</span> <span class="string">per-prefix</span> <span class="string">advertisement</span></span><br><span class="line">                  <span class="string">configuration.</span></span><br><span class="line">                <span class="attr">items:</span></span><br><span class="line">                  <span class="attr">description:</span> <span class="string">PrefixAdvertisement</span> <span class="string">configures</span> <span class="string">advertisement</span> <span class="string">properties</span></span><br><span class="line">                    <span class="string">for</span> <span class="string">the</span> <span class="string">specified</span> <span class="string">CIDR.</span></span><br><span class="line">                  <span class="attr">properties:</span></span><br><span class="line">                    <span class="attr">cidr:</span></span><br><span class="line">                      <span class="attr">description:</span> <span class="string">CIDR</span> <span class="string">for</span> <span class="string">which</span> <span class="string">properties</span> <span class="string">should</span> <span class="string">be</span> <span class="string">advertised.</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                    <span class="attr">communities:</span></span><br><span class="line">                      <span class="attr">description:</span> <span class="string">Communities</span> <span class="string">can</span> <span class="string">be</span> <span class="string">list</span> <span class="string">of</span> <span class="string">either</span> <span class="string">community</span> <span class="string">names</span></span><br><span class="line">                        <span class="string">already</span> <span class="string">defined</span> <span class="string">in</span> <span class="string">`Specs.Communities`</span> <span class="string">or</span> <span class="string">community</span> <span class="string">value</span></span><br><span class="line">                        <span class="string">of</span> <span class="string">format</span> <span class="string">`aa:nn`</span> <span class="string">or</span> <span class="string">`aa:nn:mm`.</span> <span class="string">For</span> <span class="string">standard</span> <span class="string">community</span> <span class="string">use</span></span><br><span class="line">                        <span class="string">`aa:nn`</span> <span class="string">format,</span> <span class="string">where</span> <span class="string">`aa`</span> <span class="string">and</span> <span class="string">`nn`</span> <span class="string">are</span> <span class="number">16</span> <span class="string">bit</span> <span class="string">number.</span> <span class="string">For</span></span><br><span class="line">                        <span class="string">large</span> <span class="string">community</span> <span class="string">use</span> <span class="string">`aa:nn:mm`</span> <span class="string">format,</span> <span class="string">where</span> <span class="string">`aa`,</span> <span class="string">`nn`</span> <span class="string">and</span></span><br><span class="line">                        <span class="string">`mm`</span> <span class="string">are</span> <span class="number">32</span> <span class="string">bit</span> <span class="string">number.</span> <span class="string">Where,`aa`</span> <span class="string">is</span> <span class="string">an</span> <span class="string">AS</span> <span class="string">Number,</span> <span class="string">`nn`</span> <span class="string">and</span></span><br><span class="line">                        <span class="string">`mm`</span> <span class="string">are</span> <span class="string">per-AS</span> <span class="string">identifier.</span></span><br><span class="line">                      <span class="attr">items:</span></span><br><span class="line">                        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                  <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">              <span class="attr">serviceClusterIPs:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">ServiceClusterIPs</span> <span class="string">are</span> <span class="string">the</span> <span class="string">CIDR</span> <span class="string">blocks</span> <span class="string">from</span> <span class="string">which</span> <span class="string">service</span></span><br><span class="line">                  <span class="string">cluster</span> <span class="string">IPs</span> <span class="string">are</span> <span class="string">allocated.</span> <span class="string">If</span> <span class="string">specified,</span> <span class="string">Calico</span> <span class="string">will</span> <span class="string">advertise</span> <span class="string">these</span></span><br><span class="line">                  <span class="string">blocks,</span> <span class="string">as</span> <span class="string">well</span> <span class="string">as</span> <span class="string">any</span> <span class="string">cluster</span> <span class="string">IPs</span> <span class="string">within</span> <span class="string">them.</span></span><br><span class="line">                <span class="attr">items:</span></span><br><span class="line">                  <span class="attr">description:</span> <span class="string">ServiceClusterIPBlock</span> <span class="string">represents</span> <span class="string">a</span> <span class="string">single</span> <span class="string">allowed</span> <span class="string">ClusterIP</span></span><br><span class="line">                    <span class="string">CIDR</span> <span class="string">block.</span></span><br><span class="line">                  <span class="attr">properties:</span></span><br><span class="line">                    <span class="attr">cidr:</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                  <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">              <span class="attr">serviceExternalIPs:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">ServiceExternalIPs</span> <span class="string">are</span> <span class="string">the</span> <span class="string">CIDR</span> <span class="string">blocks</span> <span class="string">for</span> <span class="string">Kubernetes</span></span><br><span class="line">                  <span class="string">Service</span> <span class="string">External</span> <span class="string">IPs.</span> <span class="string">Kubernetes</span> <span class="string">Service</span> <span class="string">ExternalIPs</span> <span class="string">will</span> <span class="string">only</span> <span class="string">be</span></span><br><span class="line">                  <span class="string">advertised</span> <span class="string">if</span> <span class="string">they</span> <span class="string">are</span> <span class="string">within</span> <span class="string">one</span> <span class="string">of</span> <span class="string">these</span> <span class="string">blocks.</span></span><br><span class="line">                <span class="attr">items:</span></span><br><span class="line">                  <span class="attr">description:</span> <span class="string">ServiceExternalIPBlock</span> <span class="string">represents</span> <span class="string">a</span> <span class="string">single</span> <span class="string">allowed</span></span><br><span class="line">                    <span class="string">External</span> <span class="string">IP</span> <span class="string">CIDR</span> <span class="string">block.</span></span><br><span class="line">                  <span class="attr">properties:</span></span><br><span class="line">                    <span class="attr">cidr:</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                  <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">              <span class="attr">serviceLoadBalancerIPs:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">ServiceLoadBalancerIPs</span> <span class="string">are</span> <span class="string">the</span> <span class="string">CIDR</span> <span class="string">blocks</span> <span class="string">for</span> <span class="string">Kubernetes</span></span><br><span class="line">                  <span class="string">Service</span> <span class="string">LoadBalancer</span> <span class="string">IPs.</span> <span class="string">Kubernetes</span> <span class="string">Service</span> <span class="string">status.LoadBalancer.Ingress</span></span><br><span class="line">                  <span class="string">IPs</span> <span class="string">will</span> <span class="string">only</span> <span class="string">be</span> <span class="string">advertised</span> <span class="string">if</span> <span class="string">they</span> <span class="string">are</span> <span class="string">within</span> <span class="string">one</span> <span class="string">of</span> <span class="string">these</span> <span class="string">blocks.</span></span><br><span class="line">                <span class="attr">items:</span></span><br><span class="line">                  <span class="attr">description:</span> <span class="string">ServiceLoadBalancerIPBlock</span> <span class="string">represents</span> <span class="string">a</span> <span class="string">single</span> <span class="string">allowed</span></span><br><span class="line">                    <span class="string">LoadBalancer</span> <span class="string">IP</span> <span class="string">CIDR</span> <span class="string">block.</span></span><br><span class="line">                  <span class="attr">properties:</span></span><br><span class="line">                    <span class="attr">cidr:</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                  <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">    <span class="attr">served:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">storage:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">status:</span></span><br><span class="line">  <span class="attr">acceptedNames:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">conditions:</span> []</span><br><span class="line">  <span class="attr">storedVersions:</span> []</span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apiextensions.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CustomResourceDefinition</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">bgppeers.crd.projectcalico.org</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">group:</span> <span class="string">crd.projectcalico.org</span></span><br><span class="line">  <span class="attr">names:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">BGPPeer</span></span><br><span class="line">    <span class="attr">listKind:</span> <span class="string">BGPPeerList</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">bgppeers</span></span><br><span class="line">    <span class="attr">singular:</span> <span class="string">bgppeer</span></span><br><span class="line">  <span class="attr">scope:</span> <span class="string">Cluster</span></span><br><span class="line">  <span class="attr">versions:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">v1</span></span><br><span class="line">    <span class="attr">schema:</span></span><br><span class="line">      <span class="attr">openAPIV3Schema:</span></span><br><span class="line">        <span class="attr">properties:</span></span><br><span class="line">          <span class="attr">apiVersion:</span></span><br><span class="line">            <span class="attr">description:</span> <span class="string">&#x27;APIVersion defines the versioned schema of this representation</span></span><br><span class="line"><span class="string">              of an object. Servers should convert recognized schemas to the latest</span></span><br><span class="line"><span class="string">              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources&#x27;</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">          <span class="attr">kind:</span></span><br><span class="line">            <span class="attr">description:</span> <span class="string">&#x27;Kind is a string value representing the REST resource this</span></span><br><span class="line"><span class="string">              object represents. Servers may infer this from the endpoint the client</span></span><br><span class="line"><span class="string">              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds&#x27;</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">          <span class="attr">metadata:</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">          <span class="attr">spec:</span></span><br><span class="line">            <span class="attr">description:</span> <span class="string">BGPPeerSpec</span> <span class="string">contains</span> <span class="string">the</span> <span class="string">specification</span> <span class="string">for</span> <span class="string">a</span> <span class="string">BGPPeer</span> <span class="string">resource.</span></span><br><span class="line">            <span class="attr">properties:</span></span><br><span class="line">              <span class="attr">asNumber:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">The</span> <span class="string">AS</span> <span class="string">Number</span> <span class="string">of</span> <span class="string">the</span> <span class="string">peer.</span></span><br><span class="line">                <span class="attr">format:</span> <span class="string">int32</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">              <span class="attr">keepOriginalNextHop:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">Option</span> <span class="string">to</span> <span class="string">keep</span> <span class="string">the</span> <span class="string">original</span> <span class="string">nexthop</span> <span class="string">field</span> <span class="string">when</span> <span class="string">routes</span></span><br><span class="line">                  <span class="string">are</span> <span class="string">sent</span> <span class="string">to</span> <span class="string">a</span> <span class="string">BGP</span> <span class="string">Peer.</span> <span class="string">Setting</span> <span class="string">&quot;true&quot;</span> <span class="string">configures</span> <span class="string">the</span> <span class="string">selected</span> <span class="string">BGP</span></span><br><span class="line">                  <span class="string">Peers</span> <span class="string">node</span> <span class="string">to</span> <span class="string">use</span> <span class="string">the</span> <span class="string">&quot;next hop keep;&quot;</span> <span class="string">instead</span> <span class="string">of</span> <span class="string">&quot;next hop self;&quot;</span><span class="string">(default)</span></span><br><span class="line">                  <span class="string">in</span> <span class="string">the</span> <span class="string">specific</span> <span class="string">branch</span> <span class="string">of</span> <span class="string">the</span> <span class="string">Node</span> <span class="string">on</span> <span class="string">&quot;bird.cfg&quot;</span><span class="string">.</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">boolean</span></span><br><span class="line">              <span class="attr">maxRestartTime:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">Time</span> <span class="string">to</span> <span class="string">allow</span> <span class="string">for</span> <span class="string">software</span> <span class="string">restart.</span>  <span class="string">When</span> <span class="string">specified,</span></span><br><span class="line">                  <span class="string">this</span> <span class="string">is</span> <span class="string">configured</span> <span class="string">as</span> <span class="string">the</span> <span class="string">graceful</span> <span class="string">restart</span> <span class="string">timeout.</span>  <span class="string">When</span> <span class="string">not</span> <span class="string">specified,</span></span><br><span class="line">                  <span class="string">the</span> <span class="string">BIRD</span> <span class="string">default</span> <span class="string">of</span> <span class="string">120s</span> <span class="string">is</span> <span class="string">used.</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">node:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">The</span> <span class="string">node</span> <span class="string">name</span> <span class="string">identifying</span> <span class="string">the</span> <span class="string">Calico</span> <span class="string">node</span> <span class="string">instance</span> <span class="string">that</span></span><br><span class="line">                  <span class="string">is</span> <span class="string">targeted</span> <span class="string">by</span> <span class="string">this</span> <span class="string">peer.</span> <span class="string">If</span> <span class="string">this</span> <span class="string">is</span> <span class="string">not</span> <span class="string">set,</span> <span class="string">and</span> <span class="literal">no</span> <span class="string">nodeSelector</span></span><br><span class="line">                  <span class="string">is</span> <span class="string">specified,</span> <span class="string">then</span> <span class="string">this</span> <span class="string">BGP</span> <span class="string">peer</span> <span class="string">selects</span> <span class="string">all</span> <span class="string">nodes</span> <span class="string">in</span> <span class="string">the</span> <span class="string">cluster.</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">nodeSelector:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">Selector</span> <span class="string">for</span> <span class="string">the</span> <span class="string">nodes</span> <span class="string">that</span> <span class="string">should</span> <span class="string">have</span> <span class="string">this</span> <span class="string">peering.</span>  <span class="string">When</span></span><br><span class="line">                  <span class="string">this</span> <span class="string">is</span> <span class="string">set,</span> <span class="string">the</span> <span class="string">Node</span> <span class="string">field</span> <span class="string">must</span> <span class="string">be</span> <span class="string">empty.</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">password:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">Optional</span> <span class="string">BGP</span> <span class="string">password</span> <span class="string">for</span> <span class="string">the</span> <span class="string">peerings</span> <span class="string">generated</span> <span class="string">by</span> <span class="string">this</span></span><br><span class="line">                  <span class="string">BGPPeer</span> <span class="string">resource.</span></span><br><span class="line">                <span class="attr">properties:</span></span><br><span class="line">                  <span class="attr">secretKeyRef:</span></span><br><span class="line">                    <span class="attr">description:</span> <span class="string">Selects</span> <span class="string">a</span> <span class="string">key</span> <span class="string">of</span> <span class="string">a</span> <span class="string">secret</span> <span class="string">in</span> <span class="string">the</span> <span class="string">node</span> <span class="string">pod&#x27;s</span> <span class="string">namespace.</span></span><br><span class="line">                    <span class="attr">properties:</span></span><br><span class="line">                      <span class="attr">key:</span></span><br><span class="line">                        <span class="attr">description:</span> <span class="string">The</span> <span class="string">key</span> <span class="string">of</span> <span class="string">the</span> <span class="string">secret</span> <span class="string">to</span> <span class="string">select</span> <span class="string">from.</span>  <span class="string">Must</span> <span class="string">be</span></span><br><span class="line">                          <span class="string">a</span> <span class="string">valid</span> <span class="string">secret</span> <span class="string">key.</span></span><br><span class="line">                        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                      <span class="attr">name:</span></span><br><span class="line">                        <span class="attr">description:</span> <span class="string">&#x27;Name of the referent. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names</span></span><br><span class="line"><span class="string">                          TODO: Add other useful fields. apiVersion, kind, uid?&#x27;</span></span><br><span class="line">                        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                      <span class="attr">optional:</span></span><br><span class="line">                        <span class="attr">description:</span> <span class="string">Specify</span> <span class="string">whether</span> <span class="string">the</span> <span class="string">Secret</span> <span class="string">or</span> <span class="string">its</span> <span class="string">key</span> <span class="string">must</span> <span class="string">be</span></span><br><span class="line">                          <span class="string">defined</span></span><br><span class="line">                        <span class="attr">type:</span> <span class="string">boolean</span></span><br><span class="line">                    <span class="attr">required:</span></span><br><span class="line">                    <span class="bullet">-</span> <span class="string">key</span></span><br><span class="line">                    <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">              <span class="attr">peerIP:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">The</span> <span class="string">IP</span> <span class="string">address</span> <span class="string">of</span> <span class="string">the</span> <span class="string">peer</span> <span class="string">followed</span> <span class="string">by</span> <span class="string">an</span> <span class="string">optional</span> <span class="string">port</span></span><br><span class="line">                  <span class="string">number</span> <span class="string">to</span> <span class="string">peer</span> <span class="string">with.</span> <span class="string">If</span> <span class="string">port</span> <span class="string">number</span> <span class="string">is</span> <span class="string">given,</span> <span class="string">format</span> <span class="string">should</span> <span class="string">be</span> <span class="string">`[&lt;IPv6&gt;]:port`</span></span><br><span class="line">                  <span class="string">or</span> <span class="string">`&lt;IPv4&gt;:&lt;port&gt;`</span> <span class="string">for</span> <span class="string">IPv4.</span> <span class="string">If</span> <span class="string">optional</span> <span class="string">port</span> <span class="string">number</span> <span class="string">is</span> <span class="string">not</span> <span class="string">set,</span></span><br><span class="line">                  <span class="string">and</span> <span class="string">this</span> <span class="string">peer</span> <span class="string">IP</span> <span class="string">and</span> <span class="string">ASNumber</span> <span class="string">belongs</span> <span class="string">to</span> <span class="string">a</span> <span class="string">calico/node</span> <span class="string">with</span> <span class="string">ListenPort</span></span><br><span class="line">                  <span class="string">set</span> <span class="string">in</span> <span class="string">BGPConfiguration,</span> <span class="string">then</span> <span class="string">we</span> <span class="string">use</span> <span class="string">that</span> <span class="string">port</span> <span class="string">to</span> <span class="string">peer.</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">peerSelector:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">Selector</span> <span class="string">for</span> <span class="string">the</span> <span class="string">remote</span> <span class="string">nodes</span> <span class="string">to</span> <span class="string">peer</span> <span class="string">with.</span>  <span class="string">When</span> <span class="string">this</span></span><br><span class="line">                  <span class="string">is</span> <span class="string">set,</span> <span class="string">the</span> <span class="string">PeerIP</span> <span class="string">and</span> <span class="string">ASNumber</span> <span class="string">fields</span> <span class="string">must</span> <span class="string">be</span> <span class="string">empty.</span>  <span class="string">For</span> <span class="string">each</span></span><br><span class="line">                  <span class="string">peering</span> <span class="string">between</span> <span class="string">the</span> <span class="string">local</span> <span class="string">node</span> <span class="string">and</span> <span class="string">selected</span> <span class="string">remote</span> <span class="string">nodes,</span> <span class="string">we</span> <span class="string">configure</span></span><br><span class="line">                  <span class="string">an</span> <span class="string">IPv4</span> <span class="string">peering</span> <span class="string">if</span> <span class="string">both</span> <span class="string">ends</span> <span class="string">have</span> <span class="string">NodeBGPSpec.IPv4Address</span> <span class="string">specified,</span></span><br><span class="line">                  <span class="string">and</span> <span class="string">an</span> <span class="string">IPv6</span> <span class="string">peering</span> <span class="string">if</span> <span class="string">both</span> <span class="string">ends</span> <span class="string">have</span> <span class="string">NodeBGPSpec.IPv6Address</span> <span class="string">specified.</span>  <span class="string">The</span></span><br><span class="line">                  <span class="string">remote</span> <span class="string">AS</span> <span class="string">number</span> <span class="string">comes</span> <span class="string">from</span> <span class="string">the</span> <span class="string">remote</span> <span class="string">node&#x27;s</span> <span class="string">NodeBGPSpec.ASNumber,</span></span><br><span class="line">                  <span class="string">or</span> <span class="string">the</span> <span class="string">global</span> <span class="string">default</span> <span class="string">if</span> <span class="string">that</span> <span class="string">is</span> <span class="string">not</span> <span class="string">set.</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">sourceAddress:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">Specifies</span> <span class="string">whether</span> <span class="string">and</span> <span class="string">how</span> <span class="string">to</span> <span class="string">configure</span> <span class="string">a</span> <span class="string">source</span> <span class="string">address</span></span><br><span class="line">                  <span class="string">for</span> <span class="string">the</span> <span class="string">peerings</span> <span class="string">generated</span> <span class="string">by</span> <span class="string">this</span> <span class="string">BGPPeer</span> <span class="string">resource.</span>  <span class="string">Default</span> <span class="string">value</span></span><br><span class="line">                  <span class="string">&quot;UseNodeIP&quot;</span> <span class="string">means</span> <span class="string">to</span> <span class="string">configure</span> <span class="string">the</span> <span class="string">node</span> <span class="string">IP</span> <span class="string">as</span> <span class="string">the</span> <span class="string">source</span> <span class="string">address.</span>  <span class="string">&quot;None&quot;</span></span><br><span class="line">                  <span class="string">means</span> <span class="string">not</span> <span class="string">to</span> <span class="string">configure</span> <span class="string">a</span> <span class="string">source</span> <span class="string">address.</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">    <span class="attr">served:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">storage:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">status:</span></span><br><span class="line">  <span class="attr">acceptedNames:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">conditions:</span> []</span><br><span class="line">  <span class="attr">storedVersions:</span> []</span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apiextensions.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CustomResourceDefinition</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">blockaffinities.crd.projectcalico.org</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">group:</span> <span class="string">crd.projectcalico.org</span></span><br><span class="line">  <span class="attr">names:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">BlockAffinity</span></span><br><span class="line">    <span class="attr">listKind:</span> <span class="string">BlockAffinityList</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">blockaffinities</span></span><br><span class="line">    <span class="attr">singular:</span> <span class="string">blockaffinity</span></span><br><span class="line">  <span class="attr">scope:</span> <span class="string">Cluster</span></span><br><span class="line">  <span class="attr">versions:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">v1</span></span><br><span class="line">    <span class="attr">schema:</span></span><br><span class="line">      <span class="attr">openAPIV3Schema:</span></span><br><span class="line">        <span class="attr">properties:</span></span><br><span class="line">          <span class="attr">apiVersion:</span></span><br><span class="line">            <span class="attr">description:</span> <span class="string">&#x27;APIVersion defines the versioned schema of this representation</span></span><br><span class="line"><span class="string">              of an object. Servers should convert recognized schemas to the latest</span></span><br><span class="line"><span class="string">              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources&#x27;</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">          <span class="attr">kind:</span></span><br><span class="line">            <span class="attr">description:</span> <span class="string">&#x27;Kind is a string value representing the REST resource this</span></span><br><span class="line"><span class="string">              object represents. Servers may infer this from the endpoint the client</span></span><br><span class="line"><span class="string">              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds&#x27;</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">          <span class="attr">metadata:</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">          <span class="attr">spec:</span></span><br><span class="line">            <span class="attr">description:</span> <span class="string">BlockAffinitySpec</span> <span class="string">contains</span> <span class="string">the</span> <span class="string">specification</span> <span class="string">for</span> <span class="string">a</span> <span class="string">BlockAffinity</span></span><br><span class="line">              <span class="string">resource.</span></span><br><span class="line">            <span class="attr">properties:</span></span><br><span class="line">              <span class="attr">cidr:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">deleted:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">Deleted</span> <span class="string">indicates</span> <span class="string">that</span> <span class="string">this</span> <span class="string">block</span> <span class="string">affinity</span> <span class="string">is</span> <span class="string">being</span> <span class="string">deleted.</span></span><br><span class="line">                  <span class="string">This</span> <span class="string">field</span> <span class="string">is</span> <span class="string">a</span> <span class="string">string</span> <span class="string">for</span> <span class="string">compatibility</span> <span class="string">with</span> <span class="string">older</span> <span class="string">releases</span> <span class="string">that</span></span><br><span class="line">                  <span class="string">mistakenly</span> <span class="string">treat</span> <span class="string">this</span> <span class="string">field</span> <span class="string">as</span> <span class="string">a</span> <span class="string">string.</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">node:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">state:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">            <span class="attr">required:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">cidr</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">deleted</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">node</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">state</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">    <span class="attr">served:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">storage:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">status:</span></span><br><span class="line">  <span class="attr">acceptedNames:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">conditions:</span> []</span><br><span class="line">  <span class="attr">storedVersions:</span> []</span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apiextensions.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CustomResourceDefinition</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">controller-gen.kubebuilder.io/version:</span> <span class="string">(devel)</span></span><br><span class="line">  <span class="attr">creationTimestamp:</span> <span class="literal">null</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">caliconodestatuses.crd.projectcalico.org</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">group:</span> <span class="string">crd.projectcalico.org</span></span><br><span class="line">  <span class="attr">names:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">CalicoNodeStatus</span></span><br><span class="line">    <span class="attr">listKind:</span> <span class="string">CalicoNodeStatusList</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">caliconodestatuses</span></span><br><span class="line">    <span class="attr">singular:</span> <span class="string">caliconodestatus</span></span><br><span class="line">  <span class="attr">scope:</span> <span class="string">Cluster</span></span><br><span class="line">  <span class="attr">versions:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">v1</span></span><br><span class="line">    <span class="attr">schema:</span></span><br><span class="line">      <span class="attr">openAPIV3Schema:</span></span><br><span class="line">        <span class="attr">properties:</span></span><br><span class="line">          <span class="attr">apiVersion:</span></span><br><span class="line">            <span class="attr">description:</span> <span class="string">&#x27;APIVersion defines the versioned schema of this representation</span></span><br><span class="line"><span class="string">              of an object. Servers should convert recognized schemas to the latest</span></span><br><span class="line"><span class="string">              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources&#x27;</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">          <span class="attr">kind:</span></span><br><span class="line">            <span class="attr">description:</span> <span class="string">&#x27;Kind is a string value representing the REST resource this</span></span><br><span class="line"><span class="string">              object represents. Servers may infer this from the endpoint the client</span></span><br><span class="line"><span class="string">              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds&#x27;</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">          <span class="attr">metadata:</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">          <span class="attr">spec:</span></span><br><span class="line">            <span class="attr">description:</span> <span class="string">CalicoNodeStatusSpec</span> <span class="string">contains</span> <span class="string">the</span> <span class="string">specification</span> <span class="string">for</span> <span class="string">a</span> <span class="string">CalicoNodeStatus</span></span><br><span class="line">              <span class="string">resource.</span></span><br><span class="line">            <span class="attr">properties:</span></span><br><span class="line">              <span class="attr">classes:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">Classes</span> <span class="string">declares</span> <span class="string">the</span> <span class="string">types</span> <span class="string">of</span> <span class="string">information</span> <span class="string">to</span> <span class="string">monitor</span></span><br><span class="line">                  <span class="string">for</span> <span class="string">this</span> <span class="string">calico/node,</span> <span class="string">and</span> <span class="string">allows</span> <span class="string">for</span> <span class="string">selective</span> <span class="string">status</span> <span class="string">reporting</span></span><br><span class="line">                  <span class="string">about</span> <span class="string">certain</span> <span class="string">subsets</span> <span class="string">of</span> <span class="string">information.</span></span><br><span class="line">                <span class="attr">items:</span></span><br><span class="line">                  <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">              <span class="attr">node:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">The</span> <span class="string">node</span> <span class="string">name</span> <span class="string">identifies</span> <span class="string">the</span> <span class="string">Calico</span> <span class="string">node</span> <span class="string">instance</span> <span class="string">for</span></span><br><span class="line">                  <span class="string">node</span> <span class="string">status.</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">updatePeriodSeconds:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">UpdatePeriodSeconds</span> <span class="string">is</span> <span class="string">the</span> <span class="string">period</span> <span class="string">at</span> <span class="string">which</span> <span class="string">CalicoNodeStatus</span></span><br><span class="line">                  <span class="string">should</span> <span class="string">be</span> <span class="string">updated.</span> <span class="string">Set</span> <span class="string">to</span> <span class="number">0</span> <span class="string">to</span> <span class="string">disable</span> <span class="string">CalicoNodeStatus</span> <span class="string">refresh.</span></span><br><span class="line">                  <span class="string">Maximum</span> <span class="string">update</span> <span class="string">period</span> <span class="string">is</span> <span class="string">one</span> <span class="string">day.</span></span><br><span class="line">                <span class="attr">format:</span> <span class="string">int32</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">          <span class="attr">status:</span></span><br><span class="line">            <span class="attr">description:</span> <span class="string">CalicoNodeStatusStatus</span> <span class="string">defines</span> <span class="string">the</span> <span class="string">observed</span> <span class="string">state</span> <span class="string">of</span> <span class="string">CalicoNodeStatus.</span></span><br><span class="line">              <span class="literal">No</span> <span class="string">validation</span> <span class="string">needed</span> <span class="string">for</span> <span class="string">status</span> <span class="string">since</span> <span class="string">it</span> <span class="string">is</span> <span class="string">updated</span> <span class="string">by</span> <span class="string">Calico.</span></span><br><span class="line">            <span class="attr">properties:</span></span><br><span class="line">              <span class="attr">agent:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">Agent</span> <span class="string">holds</span> <span class="string">agent</span> <span class="string">status</span> <span class="string">on</span> <span class="string">the</span> <span class="string">node.</span></span><br><span class="line">                <span class="attr">properties:</span></span><br><span class="line">                  <span class="attr">birdV4:</span></span><br><span class="line">                    <span class="attr">description:</span> <span class="string">BIRDV4</span> <span class="string">represents</span> <span class="string">the</span> <span class="string">latest</span> <span class="string">observed</span> <span class="string">status</span> <span class="string">of</span> <span class="string">bird4.</span></span><br><span class="line">                    <span class="attr">properties:</span></span><br><span class="line">                      <span class="attr">lastBootTime:</span></span><br><span class="line">                        <span class="attr">description:</span> <span class="string">LastBootTime</span> <span class="string">holds</span> <span class="string">the</span> <span class="string">value</span> <span class="string">of</span> <span class="string">lastBootTime</span></span><br><span class="line">                          <span class="string">from</span> <span class="string">bird.ctl</span> <span class="string">output.</span></span><br><span class="line">                        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                      <span class="attr">lastReconfigurationTime:</span></span><br><span class="line">                        <span class="attr">description:</span> <span class="string">LastReconfigurationTime</span> <span class="string">holds</span> <span class="string">the</span> <span class="string">value</span> <span class="string">of</span> <span class="string">lastReconfigTime</span></span><br><span class="line">                          <span class="string">from</span> <span class="string">bird.ctl</span> <span class="string">output.</span></span><br><span class="line">                        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                      <span class="attr">routerID:</span></span><br><span class="line">                        <span class="attr">description:</span> <span class="string">Router</span> <span class="string">ID</span> <span class="string">used</span> <span class="string">by</span> <span class="string">bird.</span></span><br><span class="line">                        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                      <span class="attr">state:</span></span><br><span class="line">                        <span class="attr">description:</span> <span class="string">The</span> <span class="string">state</span> <span class="string">of</span> <span class="string">the</span> <span class="string">BGP</span> <span class="string">Daemon.</span></span><br><span class="line">                        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                      <span class="attr">version:</span></span><br><span class="line">                        <span class="attr">description:</span> <span class="string">Version</span> <span class="string">of</span> <span class="string">the</span> <span class="string">BGP</span> <span class="string">daemon</span></span><br><span class="line">                        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                    <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                  <span class="attr">birdV6:</span></span><br><span class="line">                    <span class="attr">description:</span> <span class="string">BIRDV6</span> <span class="string">represents</span> <span class="string">the</span> <span class="string">latest</span> <span class="string">observed</span> <span class="string">status</span> <span class="string">of</span> <span class="string">bird6.</span></span><br><span class="line">                    <span class="attr">properties:</span></span><br><span class="line">                      <span class="attr">lastBootTime:</span></span><br><span class="line">                        <span class="attr">description:</span> <span class="string">LastBootTime</span> <span class="string">holds</span> <span class="string">the</span> <span class="string">value</span> <span class="string">of</span> <span class="string">lastBootTime</span></span><br><span class="line">                          <span class="string">from</span> <span class="string">bird.ctl</span> <span class="string">output.</span></span><br><span class="line">                        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                      <span class="attr">lastReconfigurationTime:</span></span><br><span class="line">                        <span class="attr">description:</span> <span class="string">LastReconfigurationTime</span> <span class="string">holds</span> <span class="string">the</span> <span class="string">value</span> <span class="string">of</span> <span class="string">lastReconfigTime</span></span><br><span class="line">                          <span class="string">from</span> <span class="string">bird.ctl</span> <span class="string">output.</span></span><br><span class="line">                        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                      <span class="attr">routerID:</span></span><br><span class="line">                        <span class="attr">description:</span> <span class="string">Router</span> <span class="string">ID</span> <span class="string">used</span> <span class="string">by</span> <span class="string">bird.</span></span><br><span class="line">                        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                      <span class="attr">state:</span></span><br><span class="line">                        <span class="attr">description:</span> <span class="string">The</span> <span class="string">state</span> <span class="string">of</span> <span class="string">the</span> <span class="string">BGP</span> <span class="string">Daemon.</span></span><br><span class="line">                        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                      <span class="attr">version:</span></span><br><span class="line">                        <span class="attr">description:</span> <span class="string">Version</span> <span class="string">of</span> <span class="string">the</span> <span class="string">BGP</span> <span class="string">daemon</span></span><br><span class="line">                        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                    <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">              <span class="attr">bgp:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">BGP</span> <span class="string">holds</span> <span class="string">node</span> <span class="string">BGP</span> <span class="string">status.</span></span><br><span class="line">                <span class="attr">properties:</span></span><br><span class="line">                  <span class="attr">numberEstablishedV4:</span></span><br><span class="line">                    <span class="attr">description:</span> <span class="string">The</span> <span class="string">total</span> <span class="string">number</span> <span class="string">of</span> <span class="string">IPv4</span> <span class="string">established</span> <span class="string">bgp</span> <span class="string">sessions.</span></span><br><span class="line">                    <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                  <span class="attr">numberEstablishedV6:</span></span><br><span class="line">                    <span class="attr">description:</span> <span class="string">The</span> <span class="string">total</span> <span class="string">number</span> <span class="string">of</span> <span class="string">IPv6</span> <span class="string">established</span> <span class="string">bgp</span> <span class="string">sessions.</span></span><br><span class="line">                    <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                  <span class="attr">numberNotEstablishedV4:</span></span><br><span class="line">                    <span class="attr">description:</span> <span class="string">The</span> <span class="string">total</span> <span class="string">number</span> <span class="string">of</span> <span class="string">IPv4</span> <span class="string">non-established</span> <span class="string">bgp</span> <span class="string">sessions.</span></span><br><span class="line">                    <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                  <span class="attr">numberNotEstablishedV6:</span></span><br><span class="line">                    <span class="attr">description:</span> <span class="string">The</span> <span class="string">total</span> <span class="string">number</span> <span class="string">of</span> <span class="string">IPv6</span> <span class="string">non-established</span> <span class="string">bgp</span> <span class="string">sessions.</span></span><br><span class="line">                    <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                  <span class="attr">peersV4:</span></span><br><span class="line">                    <span class="attr">description:</span> <span class="string">PeersV4</span> <span class="string">represents</span> <span class="string">IPv4</span> <span class="string">BGP</span> <span class="string">peers</span> <span class="string">status</span> <span class="string">on</span> <span class="string">the</span> <span class="string">node.</span></span><br><span class="line">                    <span class="attr">items:</span></span><br><span class="line">                      <span class="attr">description:</span> <span class="string">CalicoNodePeer</span> <span class="string">contains</span> <span class="string">the</span> <span class="string">status</span> <span class="string">of</span> <span class="string">BGP</span> <span class="string">peers</span></span><br><span class="line">                        <span class="string">on</span> <span class="string">the</span> <span class="string">node.</span></span><br><span class="line">                      <span class="attr">properties:</span></span><br><span class="line">                        <span class="attr">peerIP:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">IP</span> <span class="string">address</span> <span class="string">of</span> <span class="string">the</span> <span class="string">peer</span> <span class="string">whose</span> <span class="string">condition</span> <span class="string">we</span> <span class="string">are</span></span><br><span class="line">                            <span class="string">reporting.</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                        <span class="attr">since:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">Since</span> <span class="string">the</span> <span class="string">state</span> <span class="string">or</span> <span class="string">reason</span> <span class="string">last</span> <span class="string">changed.</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                        <span class="attr">state:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">State</span> <span class="string">is</span> <span class="string">the</span> <span class="string">BGP</span> <span class="string">session</span> <span class="string">state.</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                        <span class="attr">type:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">Type</span> <span class="string">indicates</span> <span class="string">whether</span> <span class="string">this</span> <span class="string">peer</span> <span class="string">is</span> <span class="string">configured</span></span><br><span class="line">                            <span class="string">via</span> <span class="string">the</span> <span class="string">node-to-node</span> <span class="string">mesh,</span> <span class="string">or</span> <span class="string">via</span> <span class="string">en</span> <span class="string">explicit</span> <span class="string">global</span> <span class="string">or</span></span><br><span class="line">                            <span class="string">per-node</span> <span class="string">BGPPeer</span> <span class="string">object.</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                    <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                  <span class="attr">peersV6:</span></span><br><span class="line">                    <span class="attr">description:</span> <span class="string">PeersV6</span> <span class="string">represents</span> <span class="string">IPv6</span> <span class="string">BGP</span> <span class="string">peers</span> <span class="string">status</span> <span class="string">on</span> <span class="string">the</span> <span class="string">node.</span></span><br><span class="line">                    <span class="attr">items:</span></span><br><span class="line">                      <span class="attr">description:</span> <span class="string">CalicoNodePeer</span> <span class="string">contains</span> <span class="string">the</span> <span class="string">status</span> <span class="string">of</span> <span class="string">BGP</span> <span class="string">peers</span></span><br><span class="line">                        <span class="string">on</span> <span class="string">the</span> <span class="string">node.</span></span><br><span class="line">                      <span class="attr">properties:</span></span><br><span class="line">                        <span class="attr">peerIP:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">IP</span> <span class="string">address</span> <span class="string">of</span> <span class="string">the</span> <span class="string">peer</span> <span class="string">whose</span> <span class="string">condition</span> <span class="string">we</span> <span class="string">are</span></span><br><span class="line">                            <span class="string">reporting.</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                        <span class="attr">since:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">Since</span> <span class="string">the</span> <span class="string">state</span> <span class="string">or</span> <span class="string">reason</span> <span class="string">last</span> <span class="string">changed.</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                        <span class="attr">state:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">State</span> <span class="string">is</span> <span class="string">the</span> <span class="string">BGP</span> <span class="string">session</span> <span class="string">state.</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                        <span class="attr">type:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">Type</span> <span class="string">indicates</span> <span class="string">whether</span> <span class="string">this</span> <span class="string">peer</span> <span class="string">is</span> <span class="string">configured</span></span><br><span class="line">                            <span class="string">via</span> <span class="string">the</span> <span class="string">node-to-node</span> <span class="string">mesh,</span> <span class="string">or</span> <span class="string">via</span> <span class="string">en</span> <span class="string">explicit</span> <span class="string">global</span> <span class="string">or</span></span><br><span class="line">                            <span class="string">per-node</span> <span class="string">BGPPeer</span> <span class="string">object.</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                    <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                <span class="attr">required:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">numberEstablishedV4</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">numberEstablishedV6</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">numberNotEstablishedV4</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">numberNotEstablishedV6</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">              <span class="attr">lastUpdated:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">LastUpdated</span> <span class="string">is</span> <span class="string">a</span> <span class="string">timestamp</span> <span class="string">representing</span> <span class="string">the</span> <span class="string">server</span> <span class="string">time</span></span><br><span class="line">                  <span class="string">when</span> <span class="string">CalicoNodeStatus</span> <span class="string">object</span> <span class="string">last</span> <span class="string">updated.</span> <span class="string">It</span> <span class="string">is</span> <span class="string">represented</span> <span class="string">in</span></span><br><span class="line">                  <span class="string">RFC3339</span> <span class="string">form</span> <span class="string">and</span> <span class="string">is</span> <span class="string">in</span> <span class="string">UTC.</span></span><br><span class="line">                <span class="attr">format:</span> <span class="string">date-time</span></span><br><span class="line">                <span class="attr">nullable:</span> <span class="literal">true</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">routes:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">Routes</span> <span class="string">reports</span> <span class="string">routes</span> <span class="string">known</span> <span class="string">to</span> <span class="string">the</span> <span class="string">Calico</span> <span class="string">BGP</span> <span class="string">daemon</span></span><br><span class="line">                  <span class="string">on</span> <span class="string">the</span> <span class="string">node.</span></span><br><span class="line">                <span class="attr">properties:</span></span><br><span class="line">                  <span class="attr">routesV4:</span></span><br><span class="line">                    <span class="attr">description:</span> <span class="string">RoutesV4</span> <span class="string">represents</span> <span class="string">IPv4</span> <span class="string">routes</span> <span class="string">on</span> <span class="string">the</span> <span class="string">node.</span></span><br><span class="line">                    <span class="attr">items:</span></span><br><span class="line">                      <span class="attr">description:</span> <span class="string">CalicoNodeRoute</span> <span class="string">contains</span> <span class="string">the</span> <span class="string">status</span> <span class="string">of</span> <span class="string">BGP</span> <span class="string">routes</span></span><br><span class="line">                        <span class="string">on</span> <span class="string">the</span> <span class="string">node.</span></span><br><span class="line">                      <span class="attr">properties:</span></span><br><span class="line">                        <span class="attr">destination:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">Destination</span> <span class="string">of</span> <span class="string">the</span> <span class="string">route.</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                        <span class="attr">gateway:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">Gateway</span> <span class="string">for</span> <span class="string">the</span> <span class="string">destination.</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                        <span class="attr">interface:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">Interface</span> <span class="string">for</span> <span class="string">the</span> <span class="string">destination</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                        <span class="attr">learnedFrom:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">LearnedFrom</span> <span class="string">contains</span> <span class="string">information</span> <span class="string">regarding</span></span><br><span class="line">                            <span class="string">where</span> <span class="string">this</span> <span class="string">route</span> <span class="string">originated.</span></span><br><span class="line">                          <span class="attr">properties:</span></span><br><span class="line">                            <span class="attr">peerIP:</span></span><br><span class="line">                              <span class="attr">description:</span> <span class="string">If</span> <span class="string">sourceType</span> <span class="string">is</span> <span class="string">NodeMesh</span> <span class="string">or</span> <span class="string">BGPPeer,</span> <span class="string">IP</span></span><br><span class="line">                                <span class="string">address</span> <span class="string">of</span> <span class="string">the</span> <span class="string">router</span> <span class="string">that</span> <span class="string">sent</span> <span class="string">us</span> <span class="string">this</span> <span class="string">route.</span></span><br><span class="line">                              <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                            <span class="attr">sourceType:</span></span><br><span class="line">                              <span class="attr">description:</span> <span class="string">Type</span> <span class="string">of</span> <span class="string">the</span> <span class="string">source</span> <span class="string">where</span> <span class="string">a</span> <span class="string">route</span> <span class="string">is</span> <span class="string">learned</span></span><br><span class="line">                                <span class="string">from.</span></span><br><span class="line">                              <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                        <span class="attr">type:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">Type</span> <span class="string">indicates</span> <span class="string">if</span> <span class="string">the</span> <span class="string">route</span> <span class="string">is</span> <span class="string">being</span> <span class="string">used</span> <span class="string">for</span></span><br><span class="line">                            <span class="string">forwarding</span> <span class="string">or</span> <span class="string">not.</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                    <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                  <span class="attr">routesV6:</span></span><br><span class="line">                    <span class="attr">description:</span> <span class="string">RoutesV6</span> <span class="string">represents</span> <span class="string">IPv6</span> <span class="string">routes</span> <span class="string">on</span> <span class="string">the</span> <span class="string">node.</span></span><br><span class="line">                    <span class="attr">items:</span></span><br><span class="line">                      <span class="attr">description:</span> <span class="string">CalicoNodeRoute</span> <span class="string">contains</span> <span class="string">the</span> <span class="string">status</span> <span class="string">of</span> <span class="string">BGP</span> <span class="string">routes</span></span><br><span class="line">                        <span class="string">on</span> <span class="string">the</span> <span class="string">node.</span></span><br><span class="line">                      <span class="attr">properties:</span></span><br><span class="line">                        <span class="attr">destination:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">Destination</span> <span class="string">of</span> <span class="string">the</span> <span class="string">route.</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                        <span class="attr">gateway:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">Gateway</span> <span class="string">for</span> <span class="string">the</span> <span class="string">destination.</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                        <span class="attr">interface:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">Interface</span> <span class="string">for</span> <span class="string">the</span> <span class="string">destination</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                        <span class="attr">learnedFrom:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">LearnedFrom</span> <span class="string">contains</span> <span class="string">information</span> <span class="string">regarding</span></span><br><span class="line">                            <span class="string">where</span> <span class="string">this</span> <span class="string">route</span> <span class="string">originated.</span></span><br><span class="line">                          <span class="attr">properties:</span></span><br><span class="line">                            <span class="attr">peerIP:</span></span><br><span class="line">                              <span class="attr">description:</span> <span class="string">If</span> <span class="string">sourceType</span> <span class="string">is</span> <span class="string">NodeMesh</span> <span class="string">or</span> <span class="string">BGPPeer,</span> <span class="string">IP</span></span><br><span class="line">                                <span class="string">address</span> <span class="string">of</span> <span class="string">the</span> <span class="string">router</span> <span class="string">that</span> <span class="string">sent</span> <span class="string">us</span> <span class="string">this</span> <span class="string">route.</span></span><br><span class="line">                              <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                            <span class="attr">sourceType:</span></span><br><span class="line">                              <span class="attr">description:</span> <span class="string">Type</span> <span class="string">of</span> <span class="string">the</span> <span class="string">source</span> <span class="string">where</span> <span class="string">a</span> <span class="string">route</span> <span class="string">is</span> <span class="string">learned</span></span><br><span class="line">                                <span class="string">from.</span></span><br><span class="line">                              <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                        <span class="attr">type:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">Type</span> <span class="string">indicates</span> <span class="string">if</span> <span class="string">the</span> <span class="string">route</span> <span class="string">is</span> <span class="string">being</span> <span class="string">used</span> <span class="string">for</span></span><br><span class="line">                            <span class="string">forwarding</span> <span class="string">or</span> <span class="string">not.</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                    <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">    <span class="attr">served:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">storage:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">status:</span></span><br><span class="line">  <span class="attr">acceptedNames:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">conditions:</span> []</span><br><span class="line">  <span class="attr">storedVersions:</span> []</span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apiextensions.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CustomResourceDefinition</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">clusterinformations.crd.projectcalico.org</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">group:</span> <span class="string">crd.projectcalico.org</span></span><br><span class="line">  <span class="attr">names:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">ClusterInformation</span></span><br><span class="line">    <span class="attr">listKind:</span> <span class="string">ClusterInformationList</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">clusterinformations</span></span><br><span class="line">    <span class="attr">singular:</span> <span class="string">clusterinformation</span></span><br><span class="line">  <span class="attr">scope:</span> <span class="string">Cluster</span></span><br><span class="line">  <span class="attr">versions:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">v1</span></span><br><span class="line">    <span class="attr">schema:</span></span><br><span class="line">      <span class="attr">openAPIV3Schema:</span></span><br><span class="line">        <span class="attr">description:</span> <span class="string">ClusterInformation</span> <span class="string">contains</span> <span class="string">the</span> <span class="string">cluster</span> <span class="string">specific</span> <span class="string">information.</span></span><br><span class="line">        <span class="attr">properties:</span></span><br><span class="line">          <span class="attr">apiVersion:</span></span><br><span class="line">            <span class="attr">description:</span> <span class="string">&#x27;APIVersion defines the versioned schema of this representation</span></span><br><span class="line"><span class="string">              of an object. Servers should convert recognized schemas to the latest</span></span><br><span class="line"><span class="string">              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources&#x27;</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">          <span class="attr">kind:</span></span><br><span class="line">            <span class="attr">description:</span> <span class="string">&#x27;Kind is a string value representing the REST resource this</span></span><br><span class="line"><span class="string">              object represents. Servers may infer this from the endpoint the client</span></span><br><span class="line"><span class="string">              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds&#x27;</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">          <span class="attr">metadata:</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">          <span class="attr">spec:</span></span><br><span class="line">            <span class="attr">description:</span> <span class="string">ClusterInformationSpec</span> <span class="string">contains</span> <span class="string">the</span> <span class="string">values</span> <span class="string">of</span> <span class="string">describing</span></span><br><span class="line">              <span class="string">the</span> <span class="string">cluster.</span></span><br><span class="line">            <span class="attr">properties:</span></span><br><span class="line">              <span class="attr">calicoVersion:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">CalicoVersion</span> <span class="string">is</span> <span class="string">the</span> <span class="string">version</span> <span class="string">of</span> <span class="string">Calico</span> <span class="string">that</span> <span class="string">the</span> <span class="string">cluster</span></span><br><span class="line">                  <span class="string">is</span> <span class="string">running</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">clusterGUID:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">ClusterGUID</span> <span class="string">is</span> <span class="string">the</span> <span class="string">GUID</span> <span class="string">of</span> <span class="string">the</span> <span class="string">cluster</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">clusterType:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">ClusterType</span> <span class="string">describes</span> <span class="string">the</span> <span class="string">type</span> <span class="string">of</span> <span class="string">the</span> <span class="string">cluster</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">datastoreReady:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">DatastoreReady</span> <span class="string">is</span> <span class="string">used</span> <span class="string">during</span> <span class="string">significant</span> <span class="string">datastore</span> <span class="string">migrations</span></span><br><span class="line">                  <span class="string">to</span> <span class="string">signal</span> <span class="string">to</span> <span class="string">components</span> <span class="string">such</span> <span class="string">as</span> <span class="string">Felix</span> <span class="string">that</span> <span class="string">it</span> <span class="string">should</span> <span class="string">wait</span> <span class="string">before</span></span><br><span class="line">                  <span class="string">accessing</span> <span class="string">the</span> <span class="string">datastore.</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">boolean</span></span><br><span class="line">              <span class="attr">variant:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">Variant</span> <span class="string">declares</span> <span class="string">which</span> <span class="string">variant</span> <span class="string">of</span> <span class="string">Calico</span> <span class="string">should</span> <span class="string">be</span> <span class="string">active.</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">    <span class="attr">served:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">storage:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">status:</span></span><br><span class="line">  <span class="attr">acceptedNames:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">conditions:</span> []</span><br><span class="line">  <span class="attr">storedVersions:</span> []</span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apiextensions.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CustomResourceDefinition</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">felixconfigurations.crd.projectcalico.org</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">group:</span> <span class="string">crd.projectcalico.org</span></span><br><span class="line">  <span class="attr">names:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">FelixConfiguration</span></span><br><span class="line">    <span class="attr">listKind:</span> <span class="string">FelixConfigurationList</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">felixconfigurations</span></span><br><span class="line">    <span class="attr">singular:</span> <span class="string">felixconfiguration</span></span><br><span class="line">  <span class="attr">scope:</span> <span class="string">Cluster</span></span><br><span class="line">  <span class="attr">versions:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">v1</span></span><br><span class="line">    <span class="attr">schema:</span></span><br><span class="line">      <span class="attr">openAPIV3Schema:</span></span><br><span class="line">        <span class="attr">description:</span> <span class="string">Felix</span> <span class="string">Configuration</span> <span class="string">contains</span> <span class="string">the</span> <span class="string">configuration</span> <span class="string">for</span> <span class="string">Felix.</span></span><br><span class="line">        <span class="attr">properties:</span></span><br><span class="line">          <span class="attr">apiVersion:</span></span><br><span class="line">            <span class="attr">description:</span> <span class="string">&#x27;APIVersion defines the versioned schema of this representation</span></span><br><span class="line"><span class="string">              of an object. Servers should convert recognized schemas to the latest</span></span><br><span class="line"><span class="string">              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources&#x27;</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">          <span class="attr">kind:</span></span><br><span class="line">            <span class="attr">description:</span> <span class="string">&#x27;Kind is a string value representing the REST resource this</span></span><br><span class="line"><span class="string">              object represents. Servers may infer this from the endpoint the client</span></span><br><span class="line"><span class="string">              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds&#x27;</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">          <span class="attr">metadata:</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">          <span class="attr">spec:</span></span><br><span class="line">            <span class="attr">description:</span> <span class="string">FelixConfigurationSpec</span> <span class="string">contains</span> <span class="string">the</span> <span class="string">values</span> <span class="string">of</span> <span class="string">the</span> <span class="string">Felix</span> <span class="string">configuration.</span></span><br><span class="line">            <span class="attr">properties:</span></span><br><span class="line">              <span class="attr">allowIPIPPacketsFromWorkloads:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;AllowIPIPPacketsFromWorkloads controls whether Felix</span></span><br><span class="line"><span class="string">                  will add a rule to drop IPIP encapsulated traffic from workloads</span></span><br><span class="line"><span class="string">                  [Default: false]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">boolean</span></span><br><span class="line">              <span class="attr">allowVXLANPacketsFromWorkloads:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;AllowVXLANPacketsFromWorkloads controls whether Felix</span></span><br><span class="line"><span class="string">                  will add a rule to drop VXLAN encapsulated traffic from workloads</span></span><br><span class="line"><span class="string">                  [Default: false]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">boolean</span></span><br><span class="line">              <span class="attr">awsSrcDstCheck:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;Set source-destination-check on AWS EC2 instances. Accepted</span></span><br><span class="line"><span class="string">                  value must be one of &quot;DoNothing&quot;, &quot;Enable&quot; or &quot;Disable&quot;. [Default:</span></span><br><span class="line"><span class="string">                  DoNothing]&#x27;</span></span><br><span class="line">                <span class="attr">enum:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">DoNothing</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">Enable</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">Disable</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">bpfConnectTimeLoadBalancingEnabled:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;BPFConnectTimeLoadBalancingEnabled when in BPF mode,</span></span><br><span class="line"><span class="string">                  controls whether Felix installs the connection-time load balancer.  The</span></span><br><span class="line"><span class="string">                  connect-time load balancer is required for the host to be able to</span></span><br><span class="line"><span class="string">                  reach Kubernetes services and it improves the performance of pod-to-service</span></span><br><span class="line"><span class="string">                  connections.  The only reason to disable it is for debugging purposes.  [Default:</span></span><br><span class="line"><span class="string">                  true]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">boolean</span></span><br><span class="line">              <span class="attr">bpfDataIfacePattern:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">BPFDataIfacePattern</span> <span class="string">is</span> <span class="string">a</span> <span class="string">regular</span> <span class="string">expression</span> <span class="string">that</span> <span class="string">controls</span></span><br><span class="line">                  <span class="string">which</span> <span class="string">interfaces</span> <span class="string">Felix</span> <span class="string">should</span> <span class="string">attach</span> <span class="string">BPF</span> <span class="string">programs</span> <span class="string">to</span> <span class="string">in</span> <span class="string">order</span> <span class="string">to</span></span><br><span class="line">                  <span class="string">catch</span> <span class="string">traffic</span> <span class="string">to/from</span> <span class="string">the</span> <span class="string">network.</span>  <span class="string">This</span> <span class="string">needs</span> <span class="string">to</span> <span class="string">match</span> <span class="string">the</span> <span class="string">interfaces</span></span><br><span class="line">                  <span class="string">that</span> <span class="string">Calico</span> <span class="string">workload</span> <span class="string">traffic</span> <span class="string">flows</span> <span class="string">over</span> <span class="string">as</span> <span class="string">well</span> <span class="string">as</span> <span class="string">any</span> <span class="string">interfaces</span></span><br><span class="line">                  <span class="string">that</span> <span class="string">handle</span> <span class="string">incoming</span> <span class="string">traffic</span> <span class="string">to</span> <span class="string">nodeports</span> <span class="string">and</span> <span class="string">services</span> <span class="string">from</span> <span class="string">outside</span></span><br><span class="line">                  <span class="string">the</span> <span class="string">cluster.</span>  <span class="string">It</span> <span class="string">should</span> <span class="string">not</span> <span class="string">match</span> <span class="string">the</span> <span class="string">workload</span> <span class="string">interfaces</span> <span class="string">(usually</span></span><br><span class="line">                  <span class="string">named</span> <span class="string">cali...).</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">bpfDisableUnprivileged:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;BPFDisableUnprivileged, if enabled, Felix sets the kernel.unprivileged_bpf_disabled</span></span><br><span class="line"><span class="string">                  sysctl to disable unprivileged use of BPF.  This ensures that unprivileged</span></span><br><span class="line"><span class="string">                  users cannot access Calico&#x27;</span><span class="string">&#x27;s BPF maps and cannot insert their own</span></span><br><span class="line"><span class="string">                  BPF programs to interfere with Calico&#x27;</span><span class="string">&#x27;s. [Default: true]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">boolean</span></span><br><span class="line">              <span class="attr">bpfEnabled:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;BPFEnabled, if enabled Felix will use the BPF dataplane.</span></span><br><span class="line"><span class="string">                  [Default: false]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">boolean</span></span><br><span class="line">              <span class="attr">bpfExtToServiceConnmark:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;BPFExtToServiceConnmark in BPF mode, control a 32bit</span></span><br><span class="line"><span class="string">                  mark that is set on connections from an external client to a local</span></span><br><span class="line"><span class="string">                  service. This mark allows us to control how packets of that connection</span></span><br><span class="line"><span class="string">                  are routed within the host and how is routing intepreted by RPF</span></span><br><span class="line"><span class="string">                  check. [Default: 0]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">              <span class="attr">bpfExternalServiceMode:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;BPFExternalServiceMode in BPF mode, controls how connections</span></span><br><span class="line"><span class="string">                  from outside the cluster to services (node ports and cluster IPs)</span></span><br><span class="line"><span class="string">                  are forwarded to remote workloads.  If set to &quot;Tunnel&quot; then both</span></span><br><span class="line"><span class="string">                  request and response traffic is tunneled to the remote node.  If</span></span><br><span class="line"><span class="string">                  set to &quot;DSR&quot;, the request traffic is tunneled but the response traffic</span></span><br><span class="line"><span class="string">                  is sent directly from the remote node.  In &quot;DSR&quot; mode, the remote</span></span><br><span class="line"><span class="string">                  node appears to use the IP of the ingress node; this requires a</span></span><br><span class="line"><span class="string">                  permissive L2 network.  [Default: Tunnel]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">bpfKubeProxyEndpointSlicesEnabled:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">BPFKubeProxyEndpointSlicesEnabled</span> <span class="string">in</span> <span class="string">BPF</span> <span class="string">mode,</span> <span class="string">controls</span></span><br><span class="line">                  <span class="string">whether</span> <span class="string">Felix&#x27;s</span> <span class="string">embedded</span> <span class="string">kube-proxy</span> <span class="string">accepts</span> <span class="string">EndpointSlices</span> <span class="string">or</span> <span class="string">not.</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">boolean</span></span><br><span class="line">              <span class="attr">bpfKubeProxyIptablesCleanupEnabled:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;BPFKubeProxyIptablesCleanupEnabled, if enabled in BPF</span></span><br><span class="line"><span class="string">                  mode, Felix will proactively clean up the upstream Kubernetes kube-proxy&#x27;</span><span class="string">&#x27;s</span></span><br><span class="line"><span class="string">                  iptables chains.  Should only be enabled if kube-proxy is not running.  [Default:</span></span><br><span class="line"><span class="string">                  true]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">boolean</span></span><br><span class="line">              <span class="attr">bpfKubeProxyMinSyncPeriod:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;BPFKubeProxyMinSyncPeriod, in BPF mode, controls the</span></span><br><span class="line"><span class="string">                  minimum time between updates to the dataplane for Felix&#x27;</span><span class="string">&#x27;s embedded</span></span><br><span class="line"><span class="string">                  kube-proxy.  Lower values give reduced set-up latency.  Higher values</span></span><br><span class="line"><span class="string">                  reduce Felix CPU usage by batching up more work.  [Default: 1s]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">bpfLogLevel:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;BPFLogLevel controls the log level of the BPF programs</span></span><br><span class="line"><span class="string">                  when in BPF dataplane mode.  One of &quot;Off&quot;, &quot;Info&quot;, or &quot;Debug&quot;.  The</span></span><br><span class="line"><span class="string">                  logs are emitted to the BPF trace pipe, accessible with the command</span></span><br><span class="line"><span class="string">                  `tc exec bpf debug`. [Default: Off].&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">chainInsertMode:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;ChainInsertMode controls whether Felix hooks the kernel&#x27;</span><span class="string">&#x27;s</span></span><br><span class="line"><span class="string">                  top-level iptables chains by inserting a rule at the top of the</span></span><br><span class="line"><span class="string">                  chain or by appending a rule at the bottom. insert is the safe default</span></span><br><span class="line"><span class="string">                  since it prevents Calico&#x27;</span><span class="string">&#x27;s rules from being bypassed. If you switch</span></span><br><span class="line"><span class="string">                  to append mode, be sure that the other rules in the chains signal</span></span><br><span class="line"><span class="string">                  acceptance by falling through to the Calico rules, otherwise the</span></span><br><span class="line"><span class="string">                  Calico policy will be bypassed. [Default: insert]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">dataplaneDriver:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">debugDisableLogDropping:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">boolean</span></span><br><span class="line">              <span class="attr">debugMemoryProfilePath:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">debugSimulateCalcGraphHangAfter:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">debugSimulateDataplaneHangAfter:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">defaultEndpointToHostAction:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;DefaultEndpointToHostAction controls what happens to</span></span><br><span class="line"><span class="string">                  traffic that goes from a workload endpoint to the host itself (after</span></span><br><span class="line"><span class="string">                  the traffic hits the endpoint egress policy). By default Calico</span></span><br><span class="line"><span class="string">                  blocks traffic from workload endpoints to the host itself with an</span></span><br><span class="line"><span class="string">                  iptables &quot;DROP&quot; action. If you want to allow some or all traffic</span></span><br><span class="line"><span class="string">                  from endpoint to host, set this parameter to RETURN or ACCEPT. Use</span></span><br><span class="line"><span class="string">                  RETURN if you have your own rules in the iptables &quot;INPUT&quot; chain;</span></span><br><span class="line"><span class="string">                  Calico will insert its rules at the top of that chain, then &quot;RETURN&quot;</span></span><br><span class="line"><span class="string">                  packets to the &quot;INPUT&quot; chain once it has completed processing workload</span></span><br><span class="line"><span class="string">                  endpoint egress policy. Use ACCEPT to unconditionally accept packets</span></span><br><span class="line"><span class="string">                  from workloads after processing workload endpoint egress policy.</span></span><br><span class="line"><span class="string">                  [Default: Drop]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">deviceRouteProtocol:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">This</span> <span class="string">defines</span> <span class="string">the</span> <span class="string">route</span> <span class="string">protocol</span> <span class="string">added</span> <span class="string">to</span> <span class="string">programmed</span> <span class="string">device</span></span><br><span class="line">                  <span class="string">routes,</span> <span class="string">by</span> <span class="string">default</span> <span class="string">this</span> <span class="string">will</span> <span class="string">be</span> <span class="string">RTPROT_BOOT</span> <span class="string">when</span> <span class="string">left</span> <span class="string">blank.</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">              <span class="attr">deviceRouteSourceAddress:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">This</span> <span class="string">is</span> <span class="string">the</span> <span class="string">source</span> <span class="string">address</span> <span class="string">to</span> <span class="string">use</span> <span class="string">on</span> <span class="string">programmed</span> <span class="string">device</span></span><br><span class="line">                  <span class="string">routes.</span> <span class="string">By</span> <span class="string">default</span> <span class="string">the</span> <span class="string">source</span> <span class="string">address</span> <span class="string">is</span> <span class="string">left</span> <span class="string">blank,</span> <span class="string">leaving</span> <span class="string">the</span></span><br><span class="line">                  <span class="string">kernel</span> <span class="string">to</span> <span class="string">choose</span> <span class="string">the</span> <span class="string">source</span> <span class="string">address</span> <span class="string">used.</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">disableConntrackInvalidCheck:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">boolean</span></span><br><span class="line">              <span class="attr">endpointReportingDelay:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">endpointReportingEnabled:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">boolean</span></span><br><span class="line">              <span class="attr">externalNodesList:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">ExternalNodesCIDRList</span> <span class="string">is</span> <span class="string">a</span> <span class="string">list</span> <span class="string">of</span> <span class="string">CIDR&#x27;s</span> <span class="string">of</span> <span class="string">external-non-calico-nodes</span></span><br><span class="line">                  <span class="string">which</span> <span class="string">may</span> <span class="string">source</span> <span class="string">tunnel</span> <span class="string">traffic</span> <span class="string">and</span> <span class="string">have</span> <span class="string">the</span> <span class="string">tunneled</span> <span class="string">traffic</span> <span class="string">be</span></span><br><span class="line">                  <span class="string">accepted</span> <span class="string">at</span> <span class="string">calico</span> <span class="string">nodes.</span></span><br><span class="line">                <span class="attr">items:</span></span><br><span class="line">                  <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">              <span class="attr">failsafeInboundHostPorts:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;FailsafeInboundHostPorts is a list of UDP/TCP ports</span></span><br><span class="line"><span class="string">                  and CIDRs that Felix will allow incoming traffic to host endpoints</span></span><br><span class="line"><span class="string">                  on irrespective of the security policy. This is useful to avoid</span></span><br><span class="line"><span class="string">                  accidentally cutting off a host with incorrect configuration. For</span></span><br><span class="line"><span class="string">                  back-compatibility, if the protocol is not specified, it defaults</span></span><br><span class="line"><span class="string">                  to &quot;tcp&quot;. If a CIDR is not specified, it will allow traffic from</span></span><br><span class="line"><span class="string">                  all addresses. To disable all inbound host ports, use the value</span></span><br><span class="line"><span class="string">                  none. The default value allows ssh access and DHCP. [Default: tcp:22,</span></span><br><span class="line"><span class="string">                  udp:68, tcp:179, tcp:2379, tcp:2380, tcp:6443, tcp:6666, tcp:6667]&#x27;</span></span><br><span class="line">                <span class="attr">items:</span></span><br><span class="line">                  <span class="attr">description:</span> <span class="string">ProtoPort</span> <span class="string">is</span> <span class="string">combination</span> <span class="string">of</span> <span class="string">protocol,</span> <span class="string">port,</span> <span class="string">and</span> <span class="string">CIDR.</span></span><br><span class="line">                    <span class="string">Protocol</span> <span class="string">and</span> <span class="string">port</span> <span class="string">must</span> <span class="string">be</span> <span class="string">specified.</span></span><br><span class="line">                  <span class="attr">properties:</span></span><br><span class="line">                    <span class="attr">net:</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                    <span class="attr">port:</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                    <span class="attr">protocol:</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                  <span class="attr">required:</span></span><br><span class="line">                  <span class="bullet">-</span> <span class="string">port</span></span><br><span class="line">                  <span class="bullet">-</span> <span class="string">protocol</span></span><br><span class="line">                  <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">              <span class="attr">failsafeOutboundHostPorts:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;FailsafeOutboundHostPorts is a list of UDP/TCP ports</span></span><br><span class="line"><span class="string">                  and CIDRs that Felix will allow outgoing traffic from host endpoints</span></span><br><span class="line"><span class="string">                  to irrespective of the security policy. This is useful to avoid</span></span><br><span class="line"><span class="string">                  accidentally cutting off a host with incorrect configuration. For</span></span><br><span class="line"><span class="string">                  back-compatibility, if the protocol is not specified, it defaults</span></span><br><span class="line"><span class="string">                  to &quot;tcp&quot;. If a CIDR is not specified, it will allow traffic from</span></span><br><span class="line"><span class="string">                  all addresses. To disable all outbound host ports, use the value</span></span><br><span class="line"><span class="string">                  none. The default value opens etcd&#x27;</span><span class="string">&#x27;s standard ports to ensure that</span></span><br><span class="line"><span class="string">                  Felix does not get cut off from etcd as well as allowing DHCP and</span></span><br><span class="line"><span class="string">                  DNS. [Default: tcp:179, tcp:2379, tcp:2380, tcp:6443, tcp:6666,</span></span><br><span class="line"><span class="string">                  tcp:6667, udp:53, udp:67]&#x27;</span></span><br><span class="line">                <span class="attr">items:</span></span><br><span class="line">                  <span class="attr">description:</span> <span class="string">ProtoPort</span> <span class="string">is</span> <span class="string">combination</span> <span class="string">of</span> <span class="string">protocol,</span> <span class="string">port,</span> <span class="string">and</span> <span class="string">CIDR.</span></span><br><span class="line">                    <span class="string">Protocol</span> <span class="string">and</span> <span class="string">port</span> <span class="string">must</span> <span class="string">be</span> <span class="string">specified.</span></span><br><span class="line">                  <span class="attr">properties:</span></span><br><span class="line">                    <span class="attr">net:</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                    <span class="attr">port:</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                    <span class="attr">protocol:</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                  <span class="attr">required:</span></span><br><span class="line">                  <span class="bullet">-</span> <span class="string">port</span></span><br><span class="line">                  <span class="bullet">-</span> <span class="string">protocol</span></span><br><span class="line">                  <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">              <span class="attr">featureDetectOverride:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">FeatureDetectOverride</span> <span class="string">is</span> <span class="string">used</span> <span class="string">to</span> <span class="string">override</span> <span class="string">the</span> <span class="string">feature</span></span><br><span class="line">                  <span class="string">detection.</span> <span class="string">Values</span> <span class="string">are</span> <span class="string">specified</span> <span class="string">in</span> <span class="string">a</span> <span class="string">comma</span> <span class="string">separated</span> <span class="string">list</span> <span class="string">with</span> <span class="literal">no</span></span><br><span class="line">                  <span class="string">spaces,</span> <span class="string">example;</span> <span class="string">&quot;SNATFullyRandom=true,MASQFullyRandom=false,RestoreSupportsLock=&quot;</span><span class="string">.</span></span><br><span class="line">                  <span class="string">&quot;true&quot;</span> <span class="string">or</span> <span class="string">&quot;false&quot;</span> <span class="string">will</span> <span class="string">force</span> <span class="string">the</span> <span class="string">feature,</span> <span class="string">empty</span> <span class="string">or</span> <span class="string">omitted</span> <span class="string">values</span></span><br><span class="line">                  <span class="string">are</span> <span class="string">auto-detected.</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">genericXDPEnabled:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;GenericXDPEnabled enables Generic XDP so network cards</span></span><br><span class="line"><span class="string">                  that don&#x27;</span><span class="string">&#x27;t support XDP offload or driver modes can use XDP. This</span></span><br><span class="line"><span class="string">                  is not recommended since it doesn&#x27;</span><span class="string">&#x27;t provide better performance</span></span><br><span class="line"><span class="string">                  than iptables. [Default: false]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">boolean</span></span><br><span class="line">              <span class="attr">healthEnabled:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">boolean</span></span><br><span class="line">              <span class="attr">healthHost:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">healthPort:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">              <span class="attr">interfaceExclude:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;InterfaceExclude is a comma-separated list of interfaces</span></span><br><span class="line"><span class="string">                  that Felix should exclude when monitoring for host endpoints. The</span></span><br><span class="line"><span class="string">                  default value ensures that Felix ignores Kubernetes&#x27;</span><span class="string">&#x27; IPVS dummy</span></span><br><span class="line"><span class="string">                  interface, which is used internally by kube-proxy. If you want to</span></span><br><span class="line"><span class="string">                  exclude multiple interface names using a single value, the list</span></span><br><span class="line"><span class="string">                  supports regular expressions. For regular expressions you must wrap</span></span><br><span class="line"><span class="string">                  the value with &#x27;</span><span class="string">&#x27;/&#x27;</span><span class="string">&#x27;. For example having values &#x27;</span><span class="string">&#x27;/^kube/,veth1&#x27;</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string">                  will exclude all interfaces that begin with &#x27;</span><span class="string">&#x27;kube&#x27;</span><span class="string">&#x27; and also the</span></span><br><span class="line"><span class="string">                  interface &#x27;</span><span class="string">&#x27;veth1&#x27;</span><span class="string">&#x27;. [Default: kube-ipvs0]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">interfacePrefix:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;InterfacePrefix is the interface name prefix that identifies</span></span><br><span class="line"><span class="string">                  workload endpoints and so distinguishes them from host endpoint</span></span><br><span class="line"><span class="string">                  interfaces. Note: in environments other than bare metal, the orchestrators</span></span><br><span class="line"><span class="string">                  configure this appropriately. For example our Kubernetes and Docker</span></span><br><span class="line"><span class="string">                  integrations set the &#x27;</span><span class="string">&#x27;cali&#x27;</span><span class="string">&#x27; value, and our OpenStack integration</span></span><br><span class="line"><span class="string">                  sets the &#x27;</span><span class="string">&#x27;tap&#x27;</span><span class="string">&#x27; value. [Default: cali]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">interfaceRefreshInterval:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">InterfaceRefreshInterval</span> <span class="string">is</span> <span class="string">the</span> <span class="string">period</span> <span class="string">at</span> <span class="string">which</span> <span class="string">Felix</span></span><br><span class="line">                  <span class="string">rescans</span> <span class="string">local</span> <span class="string">interfaces</span> <span class="string">to</span> <span class="string">verify</span> <span class="string">their</span> <span class="string">state.</span> <span class="string">The</span> <span class="string">rescan</span> <span class="string">can</span> <span class="string">be</span></span><br><span class="line">                  <span class="string">disabled</span> <span class="string">by</span> <span class="string">setting</span> <span class="string">the</span> <span class="string">interval</span> <span class="string">to</span> <span class="number">0</span><span class="string">.</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">ipipEnabled:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">boolean</span></span><br><span class="line">              <span class="attr">ipipMTU:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;IPIPMTU is the MTU to set on the tunnel device. See</span></span><br><span class="line"><span class="string">                  Configuring MTU [Default: 1440]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">              <span class="attr">ipsetsRefreshInterval:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;IpsetsRefreshInterval is the period at which Felix re-checks</span></span><br><span class="line"><span class="string">                  all iptables state to ensure that no other process has accidentally</span></span><br><span class="line"><span class="string">                  broken Calico&#x27;</span><span class="string">&#x27;s rules. Set to 0 to disable iptables refresh. [Default:</span></span><br><span class="line"><span class="string">                  90s]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">iptablesBackend:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">IptablesBackend</span> <span class="string">specifies</span> <span class="string">which</span> <span class="string">backend</span> <span class="string">of</span> <span class="string">iptables</span> <span class="string">will</span></span><br><span class="line">                  <span class="string">be</span> <span class="string">used.</span> <span class="string">The</span> <span class="string">default</span> <span class="string">is</span> <span class="string">legacy.</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">iptablesFilterAllowAction:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">iptablesLockFilePath:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;IptablesLockFilePath is the location of the iptables</span></span><br><span class="line"><span class="string">                  lock file. You may need to change this if the lock file is not in</span></span><br><span class="line"><span class="string">                  its standard location (for example if you have mapped it into Felix&#x27;</span><span class="string">&#x27;s</span></span><br><span class="line"><span class="string">                  container at a different path). [Default: /run/xtables.lock]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">iptablesLockProbeInterval:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;IptablesLockProbeInterval is the time that Felix will</span></span><br><span class="line"><span class="string">                  wait between attempts to acquire the iptables lock if it is not</span></span><br><span class="line"><span class="string">                  available. Lower values make Felix more responsive when the lock</span></span><br><span class="line"><span class="string">                  is contended, but use more CPU. [Default: 50ms]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">iptablesLockTimeout:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;IptablesLockTimeout is the time that Felix will wait</span></span><br><span class="line"><span class="string">                  for the iptables lock, or 0, to disable. To use this feature, Felix</span></span><br><span class="line"><span class="string">                  must share the iptables lock file with all other processes that</span></span><br><span class="line"><span class="string">                  also take the lock. When running Felix inside a container, this</span></span><br><span class="line"><span class="string">                  requires the /run directory of the host to be mounted into the calico/node</span></span><br><span class="line"><span class="string">                  or calico/felix container. [Default: 0s disabled]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">iptablesMangleAllowAction:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">iptablesMarkMask:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;IptablesMarkMask is the mask that Felix selects its</span></span><br><span class="line"><span class="string">                  IPTables Mark bits from. Should be a 32 bit hexadecimal number with</span></span><br><span class="line"><span class="string">                  at least 8 bits set, none of which clash with any other mark bits</span></span><br><span class="line"><span class="string">                  in use on the system. [Default: 0xff000000]&#x27;</span></span><br><span class="line">                <span class="attr">format:</span> <span class="string">int32</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">              <span class="attr">iptablesNATOutgoingInterfaceFilter:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">iptablesPostWriteCheckInterval:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;IptablesPostWriteCheckInterval is the period after Felix</span></span><br><span class="line"><span class="string">                  has done a write to the dataplane that it schedules an extra read</span></span><br><span class="line"><span class="string">                  back in order to check the write was not clobbered by another process.</span></span><br><span class="line"><span class="string">                  This should only occur if another application on the system doesn&#x27;</span><span class="string">&#x27;t</span></span><br><span class="line"><span class="string">                  respect the iptables lock. [Default: 1s]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">iptablesRefreshInterval:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;IptablesRefreshInterval is the period at which Felix</span></span><br><span class="line"><span class="string">                  re-checks the IP sets in the dataplane to ensure that no other process</span></span><br><span class="line"><span class="string">                  has accidentally broken Calico&#x27;</span><span class="string">&#x27;s rules. Set to 0 to disable IP</span></span><br><span class="line"><span class="string">                  sets refresh. Note: the default for this value is lower than the</span></span><br><span class="line"><span class="string">                  other refresh intervals as a workaround for a Linux kernel bug that</span></span><br><span class="line"><span class="string">                  was fixed in kernel version 4.11. If you are using v4.11 or greater</span></span><br><span class="line"><span class="string">                  you may want to set this to, a higher value to reduce Felix CPU</span></span><br><span class="line"><span class="string">                  usage. [Default: 10s]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">ipv6Support:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">boolean</span></span><br><span class="line">              <span class="attr">kubeNodePortRanges:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;KubeNodePortRanges holds list of port ranges used for</span></span><br><span class="line"><span class="string">                  service node ports. Only used if felix detects kube-proxy running</span></span><br><span class="line"><span class="string">                  in ipvs mode. Felix uses these ranges to separate host and workload</span></span><br><span class="line"><span class="string">                  traffic. [Default: 30000:32767].&#x27;</span></span><br><span class="line">                <span class="attr">items:</span></span><br><span class="line">                  <span class="attr">anyOf:</span></span><br><span class="line">                  <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                  <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                  <span class="attr">pattern:</span> <span class="string">^.*</span></span><br><span class="line">                  <span class="attr">x-kubernetes-int-or-string:</span> <span class="literal">true</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">              <span class="attr">logFilePath:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;LogFilePath is the full path to the Felix log. Set to</span></span><br><span class="line"><span class="string">                  none to disable file logging. [Default: /var/log/calico/felix.log]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">logPrefix:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;LogPrefix is the log prefix that Felix uses when rendering</span></span><br><span class="line"><span class="string">                  LOG rules. [Default: calico-packet]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">logSeverityFile:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;LogSeverityFile is the log severity above which logs</span></span><br><span class="line"><span class="string">                  are sent to the log file. [Default: Info]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">logSeverityScreen:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;LogSeverityScreen is the log severity above which logs</span></span><br><span class="line"><span class="string">                  are sent to the stdout. [Default: Info]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">logSeveritySys:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;LogSeveritySys is the log severity above which logs</span></span><br><span class="line"><span class="string">                  are sent to the syslog. Set to None for no logging to syslog. [Default:</span></span><br><span class="line"><span class="string">                  Info]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">maxIpsetSize:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">              <span class="attr">metadataAddr:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;MetadataAddr is the IP address or domain name of the</span></span><br><span class="line"><span class="string">                  server that can answer VM queries for cloud-init metadata. In OpenStack,</span></span><br><span class="line"><span class="string">                  this corresponds to the machine running nova-api (or in Ubuntu,</span></span><br><span class="line"><span class="string">                  nova-api-metadata). A value of none (case insensitive) means that</span></span><br><span class="line"><span class="string">                  Felix should not set up any NAT rule for the metadata path. [Default:</span></span><br><span class="line"><span class="string">                  127.0.0.1]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">metadataPort:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;MetadataPort is the port of the metadata server. This,</span></span><br><span class="line"><span class="string">                  combined with global.MetadataAddr (if not &#x27;</span><span class="string">&#x27;None&#x27;</span><span class="string">&#x27;), is used to</span></span><br><span class="line"><span class="string">                  set up a NAT rule, from 169.254.169.254:80 to MetadataAddr:MetadataPort.</span></span><br><span class="line"><span class="string">                  In most cases this should not need to be changed [Default: 8775].&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">              <span class="attr">mtuIfacePattern:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">MTUIfacePattern</span> <span class="string">is</span> <span class="string">a</span> <span class="string">regular</span> <span class="string">expression</span> <span class="string">that</span> <span class="string">controls</span></span><br><span class="line">                  <span class="string">which</span> <span class="string">interfaces</span> <span class="string">Felix</span> <span class="string">should</span> <span class="string">scan</span> <span class="string">in</span> <span class="string">order</span> <span class="string">to</span> <span class="string">calculate</span> <span class="string">the</span> <span class="string">host&#x27;s</span></span><br><span class="line">                  <span class="string">MTU.</span> <span class="string">This</span> <span class="string">should</span> <span class="string">not</span> <span class="string">match</span> <span class="string">workload</span> <span class="string">interfaces</span> <span class="string">(usually</span> <span class="string">named</span> <span class="string">cali...).</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">natOutgoingAddress:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">NATOutgoingAddress</span> <span class="string">specifies</span> <span class="string">an</span> <span class="string">address</span> <span class="string">to</span> <span class="string">use</span> <span class="string">when</span> <span class="string">performing</span></span><br><span class="line">                  <span class="string">source</span> <span class="string">NAT</span> <span class="string">for</span> <span class="string">traffic</span> <span class="string">in</span> <span class="string">a</span> <span class="string">natOutgoing</span> <span class="string">pool</span> <span class="string">that</span> <span class="string">is</span> <span class="string">leaving</span> <span class="string">the</span></span><br><span class="line">                  <span class="string">network.</span> <span class="string">By</span> <span class="string">default</span> <span class="string">the</span> <span class="string">address</span> <span class="string">used</span> <span class="string">is</span> <span class="string">an</span> <span class="string">address</span> <span class="string">on</span> <span class="string">the</span> <span class="string">interface</span></span><br><span class="line">                  <span class="string">the</span> <span class="string">traffic</span> <span class="string">is</span> <span class="string">leaving</span> <span class="string">on</span> <span class="string">(ie</span> <span class="string">it</span> <span class="string">uses</span> <span class="string">the</span> <span class="string">iptables</span> <span class="string">MASQUERADE</span> <span class="string">target)</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">natPortRange:</span></span><br><span class="line">                <span class="attr">anyOf:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">NATPortRange</span> <span class="string">specifies</span> <span class="string">the</span> <span class="string">range</span> <span class="string">of</span> <span class="string">ports</span> <span class="string">that</span> <span class="string">is</span> <span class="string">used</span></span><br><span class="line">                  <span class="string">for</span> <span class="string">port</span> <span class="string">mapping</span> <span class="string">when</span> <span class="string">doing</span> <span class="string">outgoing</span> <span class="string">NAT.</span> <span class="string">When</span> <span class="string">unset</span> <span class="string">the</span> <span class="string">default</span></span><br><span class="line">                  <span class="string">behavior</span> <span class="string">of</span> <span class="string">the</span> <span class="string">network</span> <span class="string">stack</span> <span class="string">is</span> <span class="string">used.</span></span><br><span class="line">                <span class="attr">pattern:</span> <span class="string">^.*</span></span><br><span class="line">                <span class="attr">x-kubernetes-int-or-string:</span> <span class="literal">true</span></span><br><span class="line">              <span class="attr">netlinkTimeout:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">openstackRegion:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;OpenstackRegion is the name of the region that a particular</span></span><br><span class="line"><span class="string">                  Felix belongs to. In a multi-region Calico/OpenStack deployment,</span></span><br><span class="line"><span class="string">                  this must be configured somehow for each Felix (here in the datamodel,</span></span><br><span class="line"><span class="string">                  or in felix.cfg or the environment on each compute node), and must</span></span><br><span class="line"><span class="string">                  match the [calico] openstack_region value configured in neutron.conf</span></span><br><span class="line"><span class="string">                  on each node. [Default: Empty]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">policySyncPathPrefix:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;PolicySyncPathPrefix is used to by Felix to communicate</span></span><br><span class="line"><span class="string">                  policy changes to external services, like Application layer policy.</span></span><br><span class="line"><span class="string">                  [Default: Empty]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">prometheusGoMetricsEnabled:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;PrometheusGoMetricsEnabled disables Go runtime metrics</span></span><br><span class="line"><span class="string">                  collection, which the Prometheus client does by default, when set</span></span><br><span class="line"><span class="string">                  to false. This reduces the number of metrics reported, reducing</span></span><br><span class="line"><span class="string">                  Prometheus load. [Default: true]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">boolean</span></span><br><span class="line">              <span class="attr">prometheusMetricsEnabled:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;PrometheusMetricsEnabled enables the Prometheus metrics</span></span><br><span class="line"><span class="string">                  server in Felix if set to true. [Default: false]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">boolean</span></span><br><span class="line">              <span class="attr">prometheusMetricsHost:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;PrometheusMetricsHost is the host that the Prometheus</span></span><br><span class="line"><span class="string">                  metrics server should bind to. [Default: empty]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">prometheusMetricsPort:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;PrometheusMetricsPort is the TCP port that the Prometheus</span></span><br><span class="line"><span class="string">                  metrics server should bind to. [Default: 9091]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">              <span class="attr">prometheusProcessMetricsEnabled:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;PrometheusProcessMetricsEnabled disables process metrics</span></span><br><span class="line"><span class="string">                  collection, which the Prometheus client does by default, when set</span></span><br><span class="line"><span class="string">                  to false. This reduces the number of metrics reported, reducing</span></span><br><span class="line"><span class="string">                  Prometheus load. [Default: true]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">boolean</span></span><br><span class="line">              <span class="attr">prometheusWireGuardMetricsEnabled:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;PrometheusWireGuardMetricsEnabled disables wireguard</span></span><br><span class="line"><span class="string">                  metrics collection, which the Prometheus client does by default,</span></span><br><span class="line"><span class="string">                  when set to false. This reduces the number of metrics reported,</span></span><br><span class="line"><span class="string">                  reducing Prometheus load. [Default: true]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">boolean</span></span><br><span class="line">              <span class="attr">removeExternalRoutes:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">Whether</span> <span class="string">or</span> <span class="string">not</span> <span class="string">to</span> <span class="string">remove</span> <span class="string">device</span> <span class="string">routes</span> <span class="string">that</span> <span class="string">have</span> <span class="string">not</span></span><br><span class="line">                  <span class="string">been</span> <span class="string">programmed</span> <span class="string">by</span> <span class="string">Felix.</span> <span class="string">Disabling</span> <span class="string">this</span> <span class="string">will</span> <span class="string">allow</span> <span class="string">external</span> <span class="string">applications</span></span><br><span class="line">                  <span class="string">to</span> <span class="string">also</span> <span class="string">add</span> <span class="string">device</span> <span class="string">routes.</span> <span class="string">This</span> <span class="string">is</span> <span class="string">enabled</span> <span class="string">by</span> <span class="string">default</span> <span class="string">which</span> <span class="string">means</span></span><br><span class="line">                  <span class="string">we</span> <span class="string">will</span> <span class="string">remove</span> <span class="string">externally</span> <span class="string">added</span> <span class="string">routes.</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">boolean</span></span><br><span class="line">              <span class="attr">reportingInterval:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;ReportingInterval is the interval at which Felix reports</span></span><br><span class="line"><span class="string">                  its status into the datastore or 0 to disable. Must be non-zero</span></span><br><span class="line"><span class="string">                  in OpenStack deployments. [Default: 30s]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">reportingTTL:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;ReportingTTL is the time-to-live setting for process-wide</span></span><br><span class="line"><span class="string">                  status reports. [Default: 90s]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">routeRefreshInterval:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;RouteRefreshInterval is the period at which Felix re-checks</span></span><br><span class="line"><span class="string">                  the routes in the dataplane to ensure that no other process has</span></span><br><span class="line"><span class="string">                  accidentally broken Calico&#x27;</span><span class="string">&#x27;s rules. Set to 0 to disable route refresh.</span></span><br><span class="line"><span class="string">                  [Default: 90s]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">routeSource:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;RouteSource configures where Felix gets its routing</span></span><br><span class="line"><span class="string">                  information. - WorkloadIPs: use workload endpoints to construct</span></span><br><span class="line"><span class="string">                  routes. - CalicoIPAM: the default - use IPAM data to construct routes.&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">routeTableRange:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">Calico</span> <span class="string">programs</span> <span class="string">additional</span> <span class="string">Linux</span> <span class="string">route</span> <span class="string">tables</span> <span class="string">for</span> <span class="string">various</span></span><br><span class="line">                  <span class="string">purposes.</span>  <span class="string">RouteTableRange</span> <span class="string">specifies</span> <span class="string">the</span> <span class="string">indices</span> <span class="string">of</span> <span class="string">the</span> <span class="string">route</span> <span class="string">tables</span></span><br><span class="line">                  <span class="string">that</span> <span class="string">Calico</span> <span class="string">should</span> <span class="string">use.</span></span><br><span class="line">                <span class="attr">properties:</span></span><br><span class="line">                  <span class="attr">max:</span></span><br><span class="line">                    <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                  <span class="attr">min:</span></span><br><span class="line">                    <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                <span class="attr">required:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">max</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">min</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">              <span class="attr">serviceLoopPrevention:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;When service IP advertisement is enabled, prevent routing</span></span><br><span class="line"><span class="string">                  loops to service IPs that are not in use, by dropping or rejecting</span></span><br><span class="line"><span class="string">                  packets that do not get DNAT&#x27;</span><span class="string">&#x27;d by kube-proxy. Unless set to &quot;Disabled&quot;,</span></span><br><span class="line"><span class="string">                  in which case such routing loops continue to be allowed. [Default:</span></span><br><span class="line"><span class="string">                  Drop]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">sidecarAccelerationEnabled:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;SidecarAccelerationEnabled enables experimental sidecar</span></span><br><span class="line"><span class="string">                  acceleration [Default: false]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">boolean</span></span><br><span class="line">              <span class="attr">usageReportingEnabled:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;UsageReportingEnabled reports anonymous Calico version</span></span><br><span class="line"><span class="string">                  number and cluster size to projectcalico.org. Logs warnings returned</span></span><br><span class="line"><span class="string">                  by the usage server. For example, if a significant security vulnerability</span></span><br><span class="line"><span class="string">                  has been discovered in the version of Calico being used. [Default:</span></span><br><span class="line"><span class="string">                  true]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">boolean</span></span><br><span class="line">              <span class="attr">usageReportingInitialDelay:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;UsageReportingInitialDelay controls the minimum delay</span></span><br><span class="line"><span class="string">                  before Felix makes a report. [Default: 300s]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">usageReportingInterval:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;UsageReportingInterval controls the interval at which</span></span><br><span class="line"><span class="string">                  Felix makes reports. [Default: 86400s]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">useInternalDataplaneDriver:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">boolean</span></span><br><span class="line">              <span class="attr">vxlanEnabled:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">boolean</span></span><br><span class="line">              <span class="attr">vxlanMTU:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;VXLANMTU is the MTU to set on the tunnel device. See</span></span><br><span class="line"><span class="string">                  Configuring MTU [Default: 1440]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">              <span class="attr">vxlanPort:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">              <span class="attr">vxlanVNI:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">              <span class="attr">wireguardEnabled:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;WireguardEnabled controls whether Wireguard is enabled.</span></span><br><span class="line"><span class="string">                  [Default: false]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">boolean</span></span><br><span class="line">              <span class="attr">wireguardHostEncryptionEnabled:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;WireguardHostEncryptionEnabled controls whether Wireguard</span></span><br><span class="line"><span class="string">                  host-to-host encryption is enabled. [Default: false]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">boolean</span></span><br><span class="line">              <span class="attr">wireguardInterfaceName:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;WireguardInterfaceName specifies the name to use for</span></span><br><span class="line"><span class="string">                  the Wireguard interface. [Default: wg.calico]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">wireguardListeningPort:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;WireguardListeningPort controls the listening port used</span></span><br><span class="line"><span class="string">                  by Wireguard. [Default: 51820]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">              <span class="attr">wireguardMTU:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;WireguardMTU controls the MTU on the Wireguard interface.</span></span><br><span class="line"><span class="string">                  See Configuring MTU [Default: 1420]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">              <span class="attr">wireguardRoutingRulePriority:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;WireguardRoutingRulePriority controls the priority value</span></span><br><span class="line"><span class="string">                  to use for the Wireguard routing rule. [Default: 99]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">              <span class="attr">xdpEnabled:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;XDPEnabled enables XDP acceleration for suitable untracked</span></span><br><span class="line"><span class="string">                  incoming deny rules. [Default: true]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">boolean</span></span><br><span class="line">              <span class="attr">xdpRefreshInterval:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;XDPRefreshInterval is the period at which Felix re-checks</span></span><br><span class="line"><span class="string">                  all XDP state to ensure that no other process has accidentally broken</span></span><br><span class="line"><span class="string">                  Calico&#x27;</span><span class="string">&#x27;s BPF maps or attached programs. Set to 0 to disable XDP</span></span><br><span class="line"><span class="string">                  refresh. [Default: 90s]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">    <span class="attr">served:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">storage:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">status:</span></span><br><span class="line">  <span class="attr">acceptedNames:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">conditions:</span> []</span><br><span class="line">  <span class="attr">storedVersions:</span> []</span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apiextensions.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CustomResourceDefinition</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">globalnetworkpolicies.crd.projectcalico.org</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">group:</span> <span class="string">crd.projectcalico.org</span></span><br><span class="line">  <span class="attr">names:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">GlobalNetworkPolicy</span></span><br><span class="line">    <span class="attr">listKind:</span> <span class="string">GlobalNetworkPolicyList</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">globalnetworkpolicies</span></span><br><span class="line">    <span class="attr">singular:</span> <span class="string">globalnetworkpolicy</span></span><br><span class="line">  <span class="attr">scope:</span> <span class="string">Cluster</span></span><br><span class="line">  <span class="attr">versions:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">v1</span></span><br><span class="line">    <span class="attr">schema:</span></span><br><span class="line">      <span class="attr">openAPIV3Schema:</span></span><br><span class="line">        <span class="attr">properties:</span></span><br><span class="line">          <span class="attr">apiVersion:</span></span><br><span class="line">            <span class="attr">description:</span> <span class="string">&#x27;APIVersion defines the versioned schema of this representation</span></span><br><span class="line"><span class="string">              of an object. Servers should convert recognized schemas to the latest</span></span><br><span class="line"><span class="string">              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources&#x27;</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">          <span class="attr">kind:</span></span><br><span class="line">            <span class="attr">description:</span> <span class="string">&#x27;Kind is a string value representing the REST resource this</span></span><br><span class="line"><span class="string">              object represents. Servers may infer this from the endpoint the client</span></span><br><span class="line"><span class="string">              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds&#x27;</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">          <span class="attr">metadata:</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">          <span class="attr">spec:</span></span><br><span class="line">            <span class="attr">properties:</span></span><br><span class="line">              <span class="attr">applyOnForward:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">ApplyOnForward</span> <span class="string">indicates</span> <span class="string">to</span> <span class="string">apply</span> <span class="string">the</span> <span class="string">rules</span> <span class="string">in</span> <span class="string">this</span> <span class="string">policy</span></span><br><span class="line">                  <span class="string">on</span> <span class="string">forward</span> <span class="string">traffic.</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">boolean</span></span><br><span class="line">              <span class="attr">doNotTrack:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">DoNotTrack</span> <span class="string">indicates</span> <span class="string">whether</span> <span class="string">packets</span> <span class="string">matched</span> <span class="string">by</span> <span class="string">the</span> <span class="string">rules</span></span><br><span class="line">                  <span class="string">in</span> <span class="string">this</span> <span class="string">policy</span> <span class="string">should</span> <span class="string">go</span> <span class="string">through</span> <span class="string">the</span> <span class="string">data</span> <span class="string">plane&#x27;s</span> <span class="string">connection</span> <span class="string">tracking,</span></span><br><span class="line">                  <span class="string">such</span> <span class="string">as</span> <span class="string">Linux</span> <span class="string">conntrack.</span>  <span class="string">If</span> <span class="literal">True</span><span class="string">,</span> <span class="string">the</span> <span class="string">rules</span> <span class="string">in</span> <span class="string">this</span> <span class="string">policy</span> <span class="string">are</span></span><br><span class="line">                  <span class="string">applied</span> <span class="string">before</span> <span class="string">any</span> <span class="string">data</span> <span class="string">plane</span> <span class="string">connection</span> <span class="string">tracking,</span> <span class="string">and</span> <span class="string">packets</span> <span class="string">allowed</span></span><br><span class="line">                  <span class="string">by</span> <span class="string">this</span> <span class="string">policy</span> <span class="string">are</span> <span class="string">marked</span> <span class="string">as</span> <span class="string">not</span> <span class="string">to</span> <span class="string">be</span> <span class="string">tracked.</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">boolean</span></span><br><span class="line">              <span class="attr">egress:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">The</span> <span class="string">ordered</span> <span class="string">set</span> <span class="string">of</span> <span class="string">egress</span> <span class="string">rules.</span>  <span class="string">Each</span> <span class="string">rule</span> <span class="string">contains</span></span><br><span class="line">                  <span class="string">a</span> <span class="string">set</span> <span class="string">of</span> <span class="string">packet</span> <span class="string">match</span> <span class="string">criteria</span> <span class="string">and</span> <span class="string">a</span> <span class="string">corresponding</span> <span class="string">action</span> <span class="string">to</span> <span class="string">apply.</span></span><br><span class="line">                <span class="attr">items:</span></span><br><span class="line">                  <span class="attr">description:</span> <span class="string">&quot;A Rule encapsulates a set of match criteria and an</span></span><br><span class="line"><span class="string">                    action.  Both selector-based security Policy and security Profiles</span></span><br><span class="line"><span class="string">                    reference rules - separated out as a list of rules for both ingress</span></span><br><span class="line"><span class="string">                    and egress packet matching. \n Each positive match criteria has</span></span><br><span class="line"><span class="string">                    a negated version, prefixed with \&quot;Not\&quot;. All the match criteria</span></span><br><span class="line"><span class="string">                    within a rule must be satisfied for a packet to match. A single</span></span><br><span class="line"><span class="string">                    rule can contain the positive and negative version of a match</span></span><br><span class="line"><span class="string">                    and both must be satisfied for the rule to match.&quot;</span></span><br><span class="line">                  <span class="attr">properties:</span></span><br><span class="line">                    <span class="attr">action:</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                    <span class="attr">destination:</span></span><br><span class="line">                      <span class="attr">description:</span> <span class="string">Destination</span> <span class="string">contains</span> <span class="string">the</span> <span class="string">match</span> <span class="string">criteria</span> <span class="string">that</span> <span class="string">apply</span></span><br><span class="line">                        <span class="string">to</span> <span class="string">destination</span> <span class="string">entity.</span></span><br><span class="line">                      <span class="attr">properties:</span></span><br><span class="line">                        <span class="attr">namespaceSelector:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">&quot;NamespaceSelector is an optional field that</span></span><br><span class="line"><span class="string">                            contains a selector expression. Only traffic that originates</span></span><br><span class="line"><span class="string">                            from (or terminates at) endpoints within the selected</span></span><br><span class="line"><span class="string">                            namespaces will be matched. When both NamespaceSelector</span></span><br><span class="line"><span class="string">                            and another selector are defined on the same rule, then</span></span><br><span class="line"><span class="string">                            only workload endpoints that are matched by both selectors</span></span><br><span class="line"><span class="string">                            will be selected by the rule. \n For NetworkPolicy, an</span></span><br><span class="line"><span class="string">                            empty NamespaceSelector implies that the Selector is limited</span></span><br><span class="line"><span class="string">                            to selecting only workload endpoints in the same namespace</span></span><br><span class="line"><span class="string">                            as the NetworkPolicy. \n For NetworkPolicy, `global()`</span></span><br><span class="line"><span class="string">                            NamespaceSelector implies that the Selector is limited</span></span><br><span class="line"><span class="string">                            to selecting only GlobalNetworkSet or HostEndpoint. \n</span></span><br><span class="line"><span class="string">                            For GlobalNetworkPolicy, an empty NamespaceSelector implies</span></span><br><span class="line"><span class="string">                            the Selector applies to workload endpoints across all</span></span><br><span class="line"><span class="string">                            namespaces.&quot;</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                        <span class="attr">nets:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">Nets</span> <span class="string">is</span> <span class="string">an</span> <span class="string">optional</span> <span class="string">field</span> <span class="string">that</span> <span class="string">restricts</span> <span class="string">the</span></span><br><span class="line">                            <span class="string">rule</span> <span class="string">to</span> <span class="string">only</span> <span class="string">apply</span> <span class="string">to</span> <span class="string">traffic</span> <span class="string">that</span> <span class="string">originates</span> <span class="string">from</span> <span class="string">(or</span></span><br><span class="line">                            <span class="string">terminates</span> <span class="string">at)</span> <span class="string">IP</span> <span class="string">addresses</span> <span class="string">in</span> <span class="string">any</span> <span class="string">of</span> <span class="string">the</span> <span class="string">given</span> <span class="string">subnets.</span></span><br><span class="line">                          <span class="attr">items:</span></span><br><span class="line">                            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                        <span class="attr">notNets:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">NotNets</span> <span class="string">is</span> <span class="string">the</span> <span class="string">negated</span> <span class="string">version</span> <span class="string">of</span> <span class="string">the</span> <span class="string">Nets</span></span><br><span class="line">                            <span class="string">field.</span></span><br><span class="line">                          <span class="attr">items:</span></span><br><span class="line">                            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                        <span class="attr">notPorts:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">NotPorts</span> <span class="string">is</span> <span class="string">the</span> <span class="string">negated</span> <span class="string">version</span> <span class="string">of</span> <span class="string">the</span> <span class="string">Ports</span></span><br><span class="line">                            <span class="string">field.</span> <span class="string">Since</span> <span class="string">only</span> <span class="string">some</span> <span class="string">protocols</span> <span class="string">have</span> <span class="string">ports,</span> <span class="string">if</span> <span class="string">any</span> <span class="string">ports</span></span><br><span class="line">                            <span class="string">are</span> <span class="string">specified</span> <span class="string">it</span> <span class="string">requires</span> <span class="string">the</span> <span class="string">Protocol</span> <span class="string">match</span> <span class="string">in</span> <span class="string">the</span> <span class="string">Rule</span></span><br><span class="line">                            <span class="string">to</span> <span class="string">be</span> <span class="string">set</span> <span class="string">to</span> <span class="string">&quot;TCP&quot;</span> <span class="string">or</span> <span class="string">&quot;UDP&quot;</span><span class="string">.</span></span><br><span class="line">                          <span class="attr">items:</span></span><br><span class="line">                            <span class="attr">anyOf:</span></span><br><span class="line">                            <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                            <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                            <span class="attr">pattern:</span> <span class="string">^.*</span></span><br><span class="line">                            <span class="attr">x-kubernetes-int-or-string:</span> <span class="literal">true</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                        <span class="attr">notSelector:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">NotSelector</span> <span class="string">is</span> <span class="string">the</span> <span class="string">negated</span> <span class="string">version</span> <span class="string">of</span> <span class="string">the</span> <span class="string">Selector</span></span><br><span class="line">                            <span class="string">field.</span>  <span class="string">See</span> <span class="string">Selector</span> <span class="string">field</span> <span class="string">for</span> <span class="string">subtleties</span> <span class="string">with</span> <span class="string">negated</span></span><br><span class="line">                            <span class="string">selectors.</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                        <span class="attr">ports:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">&quot;Ports is an optional field that restricts</span></span><br><span class="line"><span class="string">                            the rule to only apply to traffic that has a source (destination)</span></span><br><span class="line"><span class="string">                            port that matches one of these ranges/values. This value</span></span><br><span class="line"><span class="string">                            is a list of integers or strings that represent ranges</span></span><br><span class="line"><span class="string">                            of ports. \n Since only some protocols have ports, if</span></span><br><span class="line"><span class="string">                            any ports are specified it requires the Protocol match</span></span><br><span class="line"><span class="string">                            in the Rule to be set to \&quot;TCP\&quot; or \&quot;UDP\&quot;.&quot;</span></span><br><span class="line">                          <span class="attr">items:</span></span><br><span class="line">                            <span class="attr">anyOf:</span></span><br><span class="line">                            <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                            <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                            <span class="attr">pattern:</span> <span class="string">^.*</span></span><br><span class="line">                            <span class="attr">x-kubernetes-int-or-string:</span> <span class="literal">true</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                        <span class="attr">selector:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">&quot;Selector is an optional field that contains</span></span><br><span class="line"><span class="string">                            a selector expression (see Policy for sample syntax).</span></span><br><span class="line"><span class="string">                            \ Only traffic that originates from (terminates at) endpoints</span></span><br><span class="line"><span class="string">                            matching the selector will be matched. \n Note that: in</span></span><br><span class="line"><span class="string">                            addition to the negated version of the Selector (see NotSelector</span></span><br><span class="line"><span class="string">                            below), the selector expression syntax itself supports</span></span><br><span class="line"><span class="string">                            negation.  The two types of negation are subtly different.</span></span><br><span class="line"><span class="string">                            One negates the set of matched endpoints, the other negates</span></span><br><span class="line"><span class="string">                            the whole match: \n \tSelector = \&quot;!has(my_label)\&quot; matches</span></span><br><span class="line"><span class="string">                            packets that are from other Calico-controlled \tendpoints</span></span><br><span class="line"><span class="string">                            that do not have the label \&quot;my_label\&quot;. \n \tNotSelector</span></span><br><span class="line"><span class="string">                            = \&quot;has(my_label)\&quot; matches packets that are not from</span></span><br><span class="line"><span class="string">                            Calico-controlled \tendpoints that do have the label \&quot;my_label\&quot;.</span></span><br><span class="line"><span class="string">                            \n The effect is that the latter will accept packets from</span></span><br><span class="line"><span class="string">                            non-Calico sources whereas the former is limited to packets</span></span><br><span class="line"><span class="string">                            from Calico-controlled endpoints.&quot;</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                        <span class="attr">serviceAccounts:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">ServiceAccounts</span> <span class="string">is</span> <span class="string">an</span> <span class="string">optional</span> <span class="string">field</span> <span class="string">that</span> <span class="string">restricts</span></span><br><span class="line">                            <span class="string">the</span> <span class="string">rule</span> <span class="string">to</span> <span class="string">only</span> <span class="string">apply</span> <span class="string">to</span> <span class="string">traffic</span> <span class="string">that</span> <span class="string">originates</span> <span class="string">from</span></span><br><span class="line">                            <span class="string">(or</span> <span class="string">terminates</span> <span class="string">at)</span> <span class="string">a</span> <span class="string">pod</span> <span class="string">running</span> <span class="string">as</span> <span class="string">a</span> <span class="string">matching</span> <span class="string">service</span></span><br><span class="line">                            <span class="string">account.</span></span><br><span class="line">                          <span class="attr">properties:</span></span><br><span class="line">                            <span class="attr">names:</span></span><br><span class="line">                              <span class="attr">description:</span> <span class="string">Names</span> <span class="string">is</span> <span class="string">an</span> <span class="string">optional</span> <span class="string">field</span> <span class="string">that</span> <span class="string">restricts</span></span><br><span class="line">                                <span class="string">the</span> <span class="string">rule</span> <span class="string">to</span> <span class="string">only</span> <span class="string">apply</span> <span class="string">to</span> <span class="string">traffic</span> <span class="string">that</span> <span class="string">originates</span></span><br><span class="line">                                <span class="string">from</span> <span class="string">(or</span> <span class="string">terminates</span> <span class="string">at)</span> <span class="string">a</span> <span class="string">pod</span> <span class="string">running</span> <span class="string">as</span> <span class="string">a</span> <span class="string">service</span></span><br><span class="line">                                <span class="string">account</span> <span class="string">whose</span> <span class="string">name</span> <span class="string">is</span> <span class="string">in</span> <span class="string">the</span> <span class="string">list.</span></span><br><span class="line">                              <span class="attr">items:</span></span><br><span class="line">                                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                              <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                            <span class="attr">selector:</span></span><br><span class="line">                              <span class="attr">description:</span> <span class="string">Selector</span> <span class="string">is</span> <span class="string">an</span> <span class="string">optional</span> <span class="string">field</span> <span class="string">that</span> <span class="string">restricts</span></span><br><span class="line">                                <span class="string">the</span> <span class="string">rule</span> <span class="string">to</span> <span class="string">only</span> <span class="string">apply</span> <span class="string">to</span> <span class="string">traffic</span> <span class="string">that</span> <span class="string">originates</span></span><br><span class="line">                                <span class="string">from</span> <span class="string">(or</span> <span class="string">terminates</span> <span class="string">at)</span> <span class="string">a</span> <span class="string">pod</span> <span class="string">running</span> <span class="string">as</span> <span class="string">a</span> <span class="string">service</span></span><br><span class="line">                                <span class="string">account</span> <span class="string">that</span> <span class="string">matches</span> <span class="string">the</span> <span class="string">given</span> <span class="string">label</span> <span class="string">selector.</span> <span class="string">If</span></span><br><span class="line">                                <span class="string">both</span> <span class="string">Names</span> <span class="string">and</span> <span class="string">Selector</span> <span class="string">are</span> <span class="string">specified</span> <span class="string">then</span> <span class="string">they</span> <span class="string">are</span></span><br><span class="line">                                <span class="string">AND&#x27;ed.</span></span><br><span class="line">                              <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                        <span class="attr">services:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">&quot;Services is an optional field that contains</span></span><br><span class="line"><span class="string">                            options for matching Kubernetes Services. If specified,</span></span><br><span class="line"><span class="string">                            only traffic that originates from or terminates at endpoints</span></span><br><span class="line"><span class="string">                            within the selected service(s) will be matched, and only</span></span><br><span class="line"><span class="string">                            to/from each endpoint&#x27;s port. \n Services cannot be specified</span></span><br><span class="line"><span class="string">                            on the same rule as Selector, NotSelector, NamespaceSelector,</span></span><br><span class="line"><span class="string">                            Nets, NotNets or ServiceAccounts. \n Ports and NotPorts</span></span><br><span class="line"><span class="string">                            can only be specified with Services on ingress rules.&quot;</span></span><br><span class="line">                          <span class="attr">properties:</span></span><br><span class="line">                            <span class="attr">name:</span></span><br><span class="line">                              <span class="attr">description:</span> <span class="string">Name</span> <span class="string">specifies</span> <span class="string">the</span> <span class="string">name</span> <span class="string">of</span> <span class="string">a</span> <span class="string">Kubernetes</span></span><br><span class="line">                                <span class="string">Service</span> <span class="string">to</span> <span class="string">match.</span></span><br><span class="line">                              <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                            <span class="attr">namespace:</span></span><br><span class="line">                              <span class="attr">description:</span> <span class="string">Namespace</span> <span class="string">specifies</span> <span class="string">the</span> <span class="string">namespace</span> <span class="string">of</span> <span class="string">the</span></span><br><span class="line">                                <span class="string">given</span> <span class="string">Service.</span> <span class="string">If</span> <span class="string">left</span> <span class="string">empty,</span> <span class="string">the</span> <span class="string">rule</span> <span class="string">will</span> <span class="string">match</span></span><br><span class="line">                                <span class="string">within</span> <span class="string">this</span> <span class="string">policy&#x27;s</span> <span class="string">namespace.</span></span><br><span class="line">                              <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                    <span class="attr">http:</span></span><br><span class="line">                      <span class="attr">description:</span> <span class="string">HTTP</span> <span class="string">contains</span> <span class="string">match</span> <span class="string">criteria</span> <span class="string">that</span> <span class="string">apply</span> <span class="string">to</span> <span class="string">HTTP</span></span><br><span class="line">                        <span class="string">requests.</span></span><br><span class="line">                      <span class="attr">properties:</span></span><br><span class="line">                        <span class="attr">methods:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">Methods</span> <span class="string">is</span> <span class="string">an</span> <span class="string">optional</span> <span class="string">field</span> <span class="string">that</span> <span class="string">restricts</span></span><br><span class="line">                            <span class="string">the</span> <span class="string">rule</span> <span class="string">to</span> <span class="string">apply</span> <span class="string">only</span> <span class="string">to</span> <span class="string">HTTP</span> <span class="string">requests</span> <span class="string">that</span> <span class="string">use</span> <span class="string">one</span> <span class="string">of</span></span><br><span class="line">                            <span class="string">the</span> <span class="string">listed</span> <span class="string">HTTP</span> <span class="string">Methods</span> <span class="string">(e.g.</span> <span class="string">GET,</span> <span class="string">PUT,</span> <span class="string">etc.)</span> <span class="string">Multiple</span></span><br><span class="line">                            <span class="string">methods</span> <span class="string">are</span> <span class="string">OR&#x27;d</span> <span class="string">together.</span></span><br><span class="line">                          <span class="attr">items:</span></span><br><span class="line">                            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                        <span class="attr">paths:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">&#x27;Paths is an optional field that restricts</span></span><br><span class="line"><span class="string">                            the rule to apply to HTTP requests that use one of the</span></span><br><span class="line"><span class="string">                            listed HTTP Paths. Multiple paths are OR&#x27;</span><span class="string">&#x27;d together.</span></span><br><span class="line"><span class="string">                            e.g: - exact: /foo - prefix: /bar NOTE: Each entry may</span></span><br><span class="line"><span class="string">                            ONLY specify either a `exact` or a `prefix` match. The</span></span><br><span class="line"><span class="string">                            validator will check for it.&#x27;</span></span><br><span class="line">                          <span class="attr">items:</span></span><br><span class="line">                            <span class="attr">description:</span> <span class="string">&#x27;HTTPPath specifies an HTTP path to match.</span></span><br><span class="line"><span class="string">                              It may be either of the form: exact: &lt;path&gt;: which matches</span></span><br><span class="line"><span class="string">                              the path exactly or prefix: &lt;path-prefix&gt;: which matches</span></span><br><span class="line"><span class="string">                              the path prefix&#x27;</span></span><br><span class="line">                            <span class="attr">properties:</span></span><br><span class="line">                              <span class="attr">exact:</span></span><br><span class="line">                                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                              <span class="attr">prefix:</span></span><br><span class="line">                                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                            <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                    <span class="attr">icmp:</span></span><br><span class="line">                      <span class="attr">description:</span> <span class="string">ICMP</span> <span class="string">is</span> <span class="string">an</span> <span class="string">optional</span> <span class="string">field</span> <span class="string">that</span> <span class="string">restricts</span> <span class="string">the</span> <span class="string">rule</span></span><br><span class="line">                        <span class="string">to</span> <span class="string">apply</span> <span class="string">to</span> <span class="string">a</span> <span class="string">specific</span> <span class="string">type</span> <span class="string">and</span> <span class="string">code</span> <span class="string">of</span> <span class="string">ICMP</span> <span class="string">traffic.</span>  <span class="string">This</span></span><br><span class="line">                        <span class="string">should</span> <span class="string">only</span> <span class="string">be</span> <span class="string">specified</span> <span class="string">if</span> <span class="string">the</span> <span class="string">Protocol</span> <span class="string">field</span> <span class="string">is</span> <span class="string">set</span> <span class="string">to</span> <span class="string">&quot;ICMP&quot;</span></span><br><span class="line">                        <span class="string">or</span> <span class="string">&quot;ICMPv6&quot;</span><span class="string">.</span></span><br><span class="line">                      <span class="attr">properties:</span></span><br><span class="line">                        <span class="attr">code:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">Match</span> <span class="string">on</span> <span class="string">a</span> <span class="string">specific</span> <span class="string">ICMP</span> <span class="string">code.</span>  <span class="string">If</span> <span class="string">specified,</span></span><br><span class="line">                            <span class="string">the</span> <span class="string">Type</span> <span class="string">value</span> <span class="string">must</span> <span class="string">also</span> <span class="string">be</span> <span class="string">specified.</span> <span class="string">This</span> <span class="string">is</span> <span class="string">a</span> <span class="string">technical</span></span><br><span class="line">                            <span class="string">limitation</span> <span class="string">imposed</span> <span class="string">by</span> <span class="string">the</span> <span class="string">kernel&#x27;s</span> <span class="string">iptables</span> <span class="string">firewall,</span></span><br><span class="line">                            <span class="string">which</span> <span class="string">Calico</span> <span class="string">uses</span> <span class="string">to</span> <span class="string">enforce</span> <span class="string">the</span> <span class="string">rule.</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                        <span class="attr">type:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">Match</span> <span class="string">on</span> <span class="string">a</span> <span class="string">specific</span> <span class="string">ICMP</span> <span class="string">type.</span>  <span class="string">For</span> <span class="string">example</span></span><br><span class="line">                            <span class="string">a</span> <span class="string">value</span> <span class="string">of</span> <span class="number">8</span> <span class="string">refers</span> <span class="string">to</span> <span class="string">ICMP</span> <span class="string">Echo</span> <span class="string">Request</span> <span class="string">(i.e.</span> <span class="string">pings).</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                    <span class="attr">ipVersion:</span></span><br><span class="line">                      <span class="attr">description:</span> <span class="string">IPVersion</span> <span class="string">is</span> <span class="string">an</span> <span class="string">optional</span> <span class="string">field</span> <span class="string">that</span> <span class="string">restricts</span> <span class="string">the</span></span><br><span class="line">                        <span class="string">rule</span> <span class="string">to</span> <span class="string">only</span> <span class="string">match</span> <span class="string">a</span> <span class="string">specific</span> <span class="string">IP</span> <span class="string">version.</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                    <span class="attr">metadata:</span></span><br><span class="line">                      <span class="attr">description:</span> <span class="string">Metadata</span> <span class="string">contains</span> <span class="string">additional</span> <span class="string">information</span> <span class="string">for</span> <span class="string">this</span></span><br><span class="line">                        <span class="string">rule</span></span><br><span class="line">                      <span class="attr">properties:</span></span><br><span class="line">                        <span class="attr">annotations:</span></span><br><span class="line">                          <span class="attr">additionalProperties:</span></span><br><span class="line">                            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">Annotations</span> <span class="string">is</span> <span class="string">a</span> <span class="string">set</span> <span class="string">of</span> <span class="string">key</span> <span class="string">value</span> <span class="string">pairs</span> <span class="string">that</span></span><br><span class="line">                            <span class="string">give</span> <span class="string">extra</span> <span class="string">information</span> <span class="string">about</span> <span class="string">the</span> <span class="string">rule</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                    <span class="attr">notICMP:</span></span><br><span class="line">                      <span class="attr">description:</span> <span class="string">NotICMP</span> <span class="string">is</span> <span class="string">the</span> <span class="string">negated</span> <span class="string">version</span> <span class="string">of</span> <span class="string">the</span> <span class="string">ICMP</span> <span class="string">field.</span></span><br><span class="line">                      <span class="attr">properties:</span></span><br><span class="line">                        <span class="attr">code:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">Match</span> <span class="string">on</span> <span class="string">a</span> <span class="string">specific</span> <span class="string">ICMP</span> <span class="string">code.</span>  <span class="string">If</span> <span class="string">specified,</span></span><br><span class="line">                            <span class="string">the</span> <span class="string">Type</span> <span class="string">value</span> <span class="string">must</span> <span class="string">also</span> <span class="string">be</span> <span class="string">specified.</span> <span class="string">This</span> <span class="string">is</span> <span class="string">a</span> <span class="string">technical</span></span><br><span class="line">                            <span class="string">limitation</span> <span class="string">imposed</span> <span class="string">by</span> <span class="string">the</span> <span class="string">kernel&#x27;s</span> <span class="string">iptables</span> <span class="string">firewall,</span></span><br><span class="line">                            <span class="string">which</span> <span class="string">Calico</span> <span class="string">uses</span> <span class="string">to</span> <span class="string">enforce</span> <span class="string">the</span> <span class="string">rule.</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                        <span class="attr">type:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">Match</span> <span class="string">on</span> <span class="string">a</span> <span class="string">specific</span> <span class="string">ICMP</span> <span class="string">type.</span>  <span class="string">For</span> <span class="string">example</span></span><br><span class="line">                            <span class="string">a</span> <span class="string">value</span> <span class="string">of</span> <span class="number">8</span> <span class="string">refers</span> <span class="string">to</span> <span class="string">ICMP</span> <span class="string">Echo</span> <span class="string">Request</span> <span class="string">(i.e.</span> <span class="string">pings).</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                    <span class="attr">notProtocol:</span></span><br><span class="line">                      <span class="attr">anyOf:</span></span><br><span class="line">                      <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                      <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                      <span class="attr">description:</span> <span class="string">NotProtocol</span> <span class="string">is</span> <span class="string">the</span> <span class="string">negated</span> <span class="string">version</span> <span class="string">of</span> <span class="string">the</span> <span class="string">Protocol</span></span><br><span class="line">                        <span class="string">field.</span></span><br><span class="line">                      <span class="attr">pattern:</span> <span class="string">^.*</span></span><br><span class="line">                      <span class="attr">x-kubernetes-int-or-string:</span> <span class="literal">true</span></span><br><span class="line">                    <span class="attr">protocol:</span></span><br><span class="line">                      <span class="attr">anyOf:</span></span><br><span class="line">                      <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                      <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                      <span class="attr">description:</span> <span class="string">&quot;Protocol is an optional field that restricts the</span></span><br><span class="line"><span class="string">                        rule to only apply to traffic of a specific IP protocol. Required</span></span><br><span class="line"><span class="string">                        if any of the EntityRules contain Ports (because ports only</span></span><br><span class="line"><span class="string">                        apply to certain protocols). \n Must be one of these string</span></span><br><span class="line"><span class="string">                        values: \&quot;TCP\&quot;, \&quot;UDP\&quot;, \&quot;ICMP\&quot;, \&quot;ICMPv6\&quot;, \&quot;SCTP\&quot;,</span></span><br><span class="line"><span class="string">                        \&quot;UDPLite\&quot; or an integer in the range 1-255.&quot;</span></span><br><span class="line">                      <span class="attr">pattern:</span> <span class="string">^.*</span></span><br><span class="line">                      <span class="attr">x-kubernetes-int-or-string:</span> <span class="literal">true</span></span><br><span class="line">                    <span class="attr">source:</span></span><br><span class="line">                      <span class="attr">description:</span> <span class="string">Source</span> <span class="string">contains</span> <span class="string">the</span> <span class="string">match</span> <span class="string">criteria</span> <span class="string">that</span> <span class="string">apply</span> <span class="string">to</span></span><br><span class="line">                        <span class="string">source</span> <span class="string">entity.</span></span><br><span class="line">                      <span class="attr">properties:</span></span><br><span class="line">                        <span class="attr">namespaceSelector:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">&quot;NamespaceSelector is an optional field that</span></span><br><span class="line"><span class="string">                            contains a selector expression. Only traffic that originates</span></span><br><span class="line"><span class="string">                            from (or terminates at) endpoints within the selected</span></span><br><span class="line"><span class="string">                            namespaces will be matched. When both NamespaceSelector</span></span><br><span class="line"><span class="string">                            and another selector are defined on the same rule, then</span></span><br><span class="line"><span class="string">                            only workload endpoints that are matched by both selectors</span></span><br><span class="line"><span class="string">                            will be selected by the rule. \n For NetworkPolicy, an</span></span><br><span class="line"><span class="string">                            empty NamespaceSelector implies that the Selector is limited</span></span><br><span class="line"><span class="string">                            to selecting only workload endpoints in the same namespace</span></span><br><span class="line"><span class="string">                            as the NetworkPolicy. \n For NetworkPolicy, `global()`</span></span><br><span class="line"><span class="string">                            NamespaceSelector implies that the Selector is limited</span></span><br><span class="line"><span class="string">                            to selecting only GlobalNetworkSet or HostEndpoint. \n</span></span><br><span class="line"><span class="string">                            For GlobalNetworkPolicy, an empty NamespaceSelector implies</span></span><br><span class="line"><span class="string">                            the Selector applies to workload endpoints across all</span></span><br><span class="line"><span class="string">                            namespaces.&quot;</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                        <span class="attr">nets:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">Nets</span> <span class="string">is</span> <span class="string">an</span> <span class="string">optional</span> <span class="string">field</span> <span class="string">that</span> <span class="string">restricts</span> <span class="string">the</span></span><br><span class="line">                            <span class="string">rule</span> <span class="string">to</span> <span class="string">only</span> <span class="string">apply</span> <span class="string">to</span> <span class="string">traffic</span> <span class="string">that</span> <span class="string">originates</span> <span class="string">from</span> <span class="string">(or</span></span><br><span class="line">                            <span class="string">terminates</span> <span class="string">at)</span> <span class="string">IP</span> <span class="string">addresses</span> <span class="string">in</span> <span class="string">any</span> <span class="string">of</span> <span class="string">the</span> <span class="string">given</span> <span class="string">subnets.</span></span><br><span class="line">                          <span class="attr">items:</span></span><br><span class="line">                            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                        <span class="attr">notNets:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">NotNets</span> <span class="string">is</span> <span class="string">the</span> <span class="string">negated</span> <span class="string">version</span> <span class="string">of</span> <span class="string">the</span> <span class="string">Nets</span></span><br><span class="line">                            <span class="string">field.</span></span><br><span class="line">                          <span class="attr">items:</span></span><br><span class="line">                            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                        <span class="attr">notPorts:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">NotPorts</span> <span class="string">is</span> <span class="string">the</span> <span class="string">negated</span> <span class="string">version</span> <span class="string">of</span> <span class="string">the</span> <span class="string">Ports</span></span><br><span class="line">                            <span class="string">field.</span> <span class="string">Since</span> <span class="string">only</span> <span class="string">some</span> <span class="string">protocols</span> <span class="string">have</span> <span class="string">ports,</span> <span class="string">if</span> <span class="string">any</span> <span class="string">ports</span></span><br><span class="line">                            <span class="string">are</span> <span class="string">specified</span> <span class="string">it</span> <span class="string">requires</span> <span class="string">the</span> <span class="string">Protocol</span> <span class="string">match</span> <span class="string">in</span> <span class="string">the</span> <span class="string">Rule</span></span><br><span class="line">                            <span class="string">to</span> <span class="string">be</span> <span class="string">set</span> <span class="string">to</span> <span class="string">&quot;TCP&quot;</span> <span class="string">or</span> <span class="string">&quot;UDP&quot;</span><span class="string">.</span></span><br><span class="line">                          <span class="attr">items:</span></span><br><span class="line">                            <span class="attr">anyOf:</span></span><br><span class="line">                            <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                            <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                            <span class="attr">pattern:</span> <span class="string">^.*</span></span><br><span class="line">                            <span class="attr">x-kubernetes-int-or-string:</span> <span class="literal">true</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                        <span class="attr">notSelector:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">NotSelector</span> <span class="string">is</span> <span class="string">the</span> <span class="string">negated</span> <span class="string">version</span> <span class="string">of</span> <span class="string">the</span> <span class="string">Selector</span></span><br><span class="line">                            <span class="string">field.</span>  <span class="string">See</span> <span class="string">Selector</span> <span class="string">field</span> <span class="string">for</span> <span class="string">subtleties</span> <span class="string">with</span> <span class="string">negated</span></span><br><span class="line">                            <span class="string">selectors.</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                        <span class="attr">ports:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">&quot;Ports is an optional field that restricts</span></span><br><span class="line"><span class="string">                            the rule to only apply to traffic that has a source (destination)</span></span><br><span class="line"><span class="string">                            port that matches one of these ranges/values. This value</span></span><br><span class="line"><span class="string">                            is a list of integers or strings that represent ranges</span></span><br><span class="line"><span class="string">                            of ports. \n Since only some protocols have ports, if</span></span><br><span class="line"><span class="string">                            any ports are specified it requires the Protocol match</span></span><br><span class="line"><span class="string">                            in the Rule to be set to \&quot;TCP\&quot; or \&quot;UDP\&quot;.&quot;</span></span><br><span class="line">                          <span class="attr">items:</span></span><br><span class="line">                            <span class="attr">anyOf:</span></span><br><span class="line">                            <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                            <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                            <span class="attr">pattern:</span> <span class="string">^.*</span></span><br><span class="line">                            <span class="attr">x-kubernetes-int-or-string:</span> <span class="literal">true</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                        <span class="attr">selector:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">&quot;Selector is an optional field that contains</span></span><br><span class="line"><span class="string">                            a selector expression (see Policy for sample syntax).</span></span><br><span class="line"><span class="string">                            \ Only traffic that originates from (terminates at) endpoints</span></span><br><span class="line"><span class="string">                            matching the selector will be matched. \n Note that: in</span></span><br><span class="line"><span class="string">                            addition to the negated version of the Selector (see NotSelector</span></span><br><span class="line"><span class="string">                            below), the selector expression syntax itself supports</span></span><br><span class="line"><span class="string">                            negation.  The two types of negation are subtly different.</span></span><br><span class="line"><span class="string">                            One negates the set of matched endpoints, the other negates</span></span><br><span class="line"><span class="string">                            the whole match: \n \tSelector = \&quot;!has(my_label)\&quot; matches</span></span><br><span class="line"><span class="string">                            packets that are from other Calico-controlled \tendpoints</span></span><br><span class="line"><span class="string">                            that do not have the label \&quot;my_label\&quot;. \n \tNotSelector</span></span><br><span class="line"><span class="string">                            = \&quot;has(my_label)\&quot; matches packets that are not from</span></span><br><span class="line"><span class="string">                            Calico-controlled \tendpoints that do have the label \&quot;my_label\&quot;.</span></span><br><span class="line"><span class="string">                            \n The effect is that the latter will accept packets from</span></span><br><span class="line"><span class="string">                            non-Calico sources whereas the former is limited to packets</span></span><br><span class="line"><span class="string">                            from Calico-controlled endpoints.&quot;</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                        <span class="attr">serviceAccounts:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">ServiceAccounts</span> <span class="string">is</span> <span class="string">an</span> <span class="string">optional</span> <span class="string">field</span> <span class="string">that</span> <span class="string">restricts</span></span><br><span class="line">                            <span class="string">the</span> <span class="string">rule</span> <span class="string">to</span> <span class="string">only</span> <span class="string">apply</span> <span class="string">to</span> <span class="string">traffic</span> <span class="string">that</span> <span class="string">originates</span> <span class="string">from</span></span><br><span class="line">                            <span class="string">(or</span> <span class="string">terminates</span> <span class="string">at)</span> <span class="string">a</span> <span class="string">pod</span> <span class="string">running</span> <span class="string">as</span> <span class="string">a</span> <span class="string">matching</span> <span class="string">service</span></span><br><span class="line">                            <span class="string">account.</span></span><br><span class="line">                          <span class="attr">properties:</span></span><br><span class="line">                            <span class="attr">names:</span></span><br><span class="line">                              <span class="attr">description:</span> <span class="string">Names</span> <span class="string">is</span> <span class="string">an</span> <span class="string">optional</span> <span class="string">field</span> <span class="string">that</span> <span class="string">restricts</span></span><br><span class="line">                                <span class="string">the</span> <span class="string">rule</span> <span class="string">to</span> <span class="string">only</span> <span class="string">apply</span> <span class="string">to</span> <span class="string">traffic</span> <span class="string">that</span> <span class="string">originates</span></span><br><span class="line">                                <span class="string">from</span> <span class="string">(or</span> <span class="string">terminates</span> <span class="string">at)</span> <span class="string">a</span> <span class="string">pod</span> <span class="string">running</span> <span class="string">as</span> <span class="string">a</span> <span class="string">service</span></span><br><span class="line">                                <span class="string">account</span> <span class="string">whose</span> <span class="string">name</span> <span class="string">is</span> <span class="string">in</span> <span class="string">the</span> <span class="string">list.</span></span><br><span class="line">                              <span class="attr">items:</span></span><br><span class="line">                                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                              <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                            <span class="attr">selector:</span></span><br><span class="line">                              <span class="attr">description:</span> <span class="string">Selector</span> <span class="string">is</span> <span class="string">an</span> <span class="string">optional</span> <span class="string">field</span> <span class="string">that</span> <span class="string">restricts</span></span><br><span class="line">                                <span class="string">the</span> <span class="string">rule</span> <span class="string">to</span> <span class="string">only</span> <span class="string">apply</span> <span class="string">to</span> <span class="string">traffic</span> <span class="string">that</span> <span class="string">originates</span></span><br><span class="line">                                <span class="string">from</span> <span class="string">(or</span> <span class="string">terminates</span> <span class="string">at)</span> <span class="string">a</span> <span class="string">pod</span> <span class="string">running</span> <span class="string">as</span> <span class="string">a</span> <span class="string">service</span></span><br><span class="line">                                <span class="string">account</span> <span class="string">that</span> <span class="string">matches</span> <span class="string">the</span> <span class="string">given</span> <span class="string">label</span> <span class="string">selector.</span> <span class="string">If</span></span><br><span class="line">                                <span class="string">both</span> <span class="string">Names</span> <span class="string">and</span> <span class="string">Selector</span> <span class="string">are</span> <span class="string">specified</span> <span class="string">then</span> <span class="string">they</span> <span class="string">are</span></span><br><span class="line">                                <span class="string">AND&#x27;ed.</span></span><br><span class="line">                              <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                        <span class="attr">services:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">&quot;Services is an optional field that contains</span></span><br><span class="line"><span class="string">                            options for matching Kubernetes Services. If specified,</span></span><br><span class="line"><span class="string">                            only traffic that originates from or terminates at endpoints</span></span><br><span class="line"><span class="string">                            within the selected service(s) will be matched, and only</span></span><br><span class="line"><span class="string">                            to/from each endpoint&#x27;s port. \n Services cannot be specified</span></span><br><span class="line"><span class="string">                            on the same rule as Selector, NotSelector, NamespaceSelector,</span></span><br><span class="line"><span class="string">                            Nets, NotNets or ServiceAccounts. \n Ports and NotPorts</span></span><br><span class="line"><span class="string">                            can only be specified with Services on ingress rules.&quot;</span></span><br><span class="line">                          <span class="attr">properties:</span></span><br><span class="line">                            <span class="attr">name:</span></span><br><span class="line">                              <span class="attr">description:</span> <span class="string">Name</span> <span class="string">specifies</span> <span class="string">the</span> <span class="string">name</span> <span class="string">of</span> <span class="string">a</span> <span class="string">Kubernetes</span></span><br><span class="line">                                <span class="string">Service</span> <span class="string">to</span> <span class="string">match.</span></span><br><span class="line">                              <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                            <span class="attr">namespace:</span></span><br><span class="line">                              <span class="attr">description:</span> <span class="string">Namespace</span> <span class="string">specifies</span> <span class="string">the</span> <span class="string">namespace</span> <span class="string">of</span> <span class="string">the</span></span><br><span class="line">                                <span class="string">given</span> <span class="string">Service.</span> <span class="string">If</span> <span class="string">left</span> <span class="string">empty,</span> <span class="string">the</span> <span class="string">rule</span> <span class="string">will</span> <span class="string">match</span></span><br><span class="line">                                <span class="string">within</span> <span class="string">this</span> <span class="string">policy&#x27;s</span> <span class="string">namespace.</span></span><br><span class="line">                              <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                  <span class="attr">required:</span></span><br><span class="line">                  <span class="bullet">-</span> <span class="string">action</span></span><br><span class="line">                  <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">              <span class="attr">ingress:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">The</span> <span class="string">ordered</span> <span class="string">set</span> <span class="string">of</span> <span class="string">ingress</span> <span class="string">rules.</span>  <span class="string">Each</span> <span class="string">rule</span> <span class="string">contains</span></span><br><span class="line">                  <span class="string">a</span> <span class="string">set</span> <span class="string">of</span> <span class="string">packet</span> <span class="string">match</span> <span class="string">criteria</span> <span class="string">and</span> <span class="string">a</span> <span class="string">corresponding</span> <span class="string">action</span> <span class="string">to</span> <span class="string">apply.</span></span><br><span class="line">                <span class="attr">items:</span></span><br><span class="line">                  <span class="attr">description:</span> <span class="string">&quot;A Rule encapsulates a set of match criteria and an</span></span><br><span class="line"><span class="string">                    action.  Both selector-based security Policy and security Profiles</span></span><br><span class="line"><span class="string">                    reference rules - separated out as a list of rules for both ingress</span></span><br><span class="line"><span class="string">                    and egress packet matching. \n Each positive match criteria has</span></span><br><span class="line"><span class="string">                    a negated version, prefixed with \&quot;Not\&quot;. All the match criteria</span></span><br><span class="line"><span class="string">                    within a rule must be satisfied for a packet to match. A single</span></span><br><span class="line"><span class="string">                    rule can contain the positive and negative version of a match</span></span><br><span class="line"><span class="string">                    and both must be satisfied for the rule to match.&quot;</span></span><br><span class="line">                  <span class="attr">properties:</span></span><br><span class="line">                    <span class="attr">action:</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                    <span class="attr">destination:</span></span><br><span class="line">                      <span class="attr">description:</span> <span class="string">Destination</span> <span class="string">contains</span> <span class="string">the</span> <span class="string">match</span> <span class="string">criteria</span> <span class="string">that</span> <span class="string">apply</span></span><br><span class="line">                        <span class="string">to</span> <span class="string">destination</span> <span class="string">entity.</span></span><br><span class="line">                      <span class="attr">properties:</span></span><br><span class="line">                        <span class="attr">namespaceSelector:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">&quot;NamespaceSelector is an optional field that</span></span><br><span class="line"><span class="string">                            contains a selector expression. Only traffic that originates</span></span><br><span class="line"><span class="string">                            from (or terminates at) endpoints within the selected</span></span><br><span class="line"><span class="string">                            namespaces will be matched. When both NamespaceSelector</span></span><br><span class="line"><span class="string">                            and another selector are defined on the same rule, then</span></span><br><span class="line"><span class="string">                            only workload endpoints that are matched by both selectors</span></span><br><span class="line"><span class="string">                            will be selected by the rule. \n For NetworkPolicy, an</span></span><br><span class="line"><span class="string">                            empty NamespaceSelector implies that the Selector is limited</span></span><br><span class="line"><span class="string">                            to selecting only workload endpoints in the same namespace</span></span><br><span class="line"><span class="string">                            as the NetworkPolicy. \n For NetworkPolicy, `global()`</span></span><br><span class="line"><span class="string">                            NamespaceSelector implies that the Selector is limited</span></span><br><span class="line"><span class="string">                            to selecting only GlobalNetworkSet or HostEndpoint. \n</span></span><br><span class="line"><span class="string">                            For GlobalNetworkPolicy, an empty NamespaceSelector implies</span></span><br><span class="line"><span class="string">                            the Selector applies to workload endpoints across all</span></span><br><span class="line"><span class="string">                            namespaces.&quot;</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                        <span class="attr">nets:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">Nets</span> <span class="string">is</span> <span class="string">an</span> <span class="string">optional</span> <span class="string">field</span> <span class="string">that</span> <span class="string">restricts</span> <span class="string">the</span></span><br><span class="line">                            <span class="string">rule</span> <span class="string">to</span> <span class="string">only</span> <span class="string">apply</span> <span class="string">to</span> <span class="string">traffic</span> <span class="string">that</span> <span class="string">originates</span> <span class="string">from</span> <span class="string">(or</span></span><br><span class="line">                            <span class="string">terminates</span> <span class="string">at)</span> <span class="string">IP</span> <span class="string">addresses</span> <span class="string">in</span> <span class="string">any</span> <span class="string">of</span> <span class="string">the</span> <span class="string">given</span> <span class="string">subnets.</span></span><br><span class="line">                          <span class="attr">items:</span></span><br><span class="line">                            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                        <span class="attr">notNets:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">NotNets</span> <span class="string">is</span> <span class="string">the</span> <span class="string">negated</span> <span class="string">version</span> <span class="string">of</span> <span class="string">the</span> <span class="string">Nets</span></span><br><span class="line">                            <span class="string">field.</span></span><br><span class="line">                          <span class="attr">items:</span></span><br><span class="line">                            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                        <span class="attr">notPorts:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">NotPorts</span> <span class="string">is</span> <span class="string">the</span> <span class="string">negated</span> <span class="string">version</span> <span class="string">of</span> <span class="string">the</span> <span class="string">Ports</span></span><br><span class="line">                            <span class="string">field.</span> <span class="string">Since</span> <span class="string">only</span> <span class="string">some</span> <span class="string">protocols</span> <span class="string">have</span> <span class="string">ports,</span> <span class="string">if</span> <span class="string">any</span> <span class="string">ports</span></span><br><span class="line">                            <span class="string">are</span> <span class="string">specified</span> <span class="string">it</span> <span class="string">requires</span> <span class="string">the</span> <span class="string">Protocol</span> <span class="string">match</span> <span class="string">in</span> <span class="string">the</span> <span class="string">Rule</span></span><br><span class="line">                            <span class="string">to</span> <span class="string">be</span> <span class="string">set</span> <span class="string">to</span> <span class="string">&quot;TCP&quot;</span> <span class="string">or</span> <span class="string">&quot;UDP&quot;</span><span class="string">.</span></span><br><span class="line">                          <span class="attr">items:</span></span><br><span class="line">                            <span class="attr">anyOf:</span></span><br><span class="line">                            <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                            <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                            <span class="attr">pattern:</span> <span class="string">^.*</span></span><br><span class="line">                            <span class="attr">x-kubernetes-int-or-string:</span> <span class="literal">true</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                        <span class="attr">notSelector:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">NotSelector</span> <span class="string">is</span> <span class="string">the</span> <span class="string">negated</span> <span class="string">version</span> <span class="string">of</span> <span class="string">the</span> <span class="string">Selector</span></span><br><span class="line">                            <span class="string">field.</span>  <span class="string">See</span> <span class="string">Selector</span> <span class="string">field</span> <span class="string">for</span> <span class="string">subtleties</span> <span class="string">with</span> <span class="string">negated</span></span><br><span class="line">                            <span class="string">selectors.</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                        <span class="attr">ports:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">&quot;Ports is an optional field that restricts</span></span><br><span class="line"><span class="string">                            the rule to only apply to traffic that has a source (destination)</span></span><br><span class="line"><span class="string">                            port that matches one of these ranges/values. This value</span></span><br><span class="line"><span class="string">                            is a list of integers or strings that represent ranges</span></span><br><span class="line"><span class="string">                            of ports. \n Since only some protocols have ports, if</span></span><br><span class="line"><span class="string">                            any ports are specified it requires the Protocol match</span></span><br><span class="line"><span class="string">                            in the Rule to be set to \&quot;TCP\&quot; or \&quot;UDP\&quot;.&quot;</span></span><br><span class="line">                          <span class="attr">items:</span></span><br><span class="line">                            <span class="attr">anyOf:</span></span><br><span class="line">                            <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                            <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                            <span class="attr">pattern:</span> <span class="string">^.*</span></span><br><span class="line">                            <span class="attr">x-kubernetes-int-or-string:</span> <span class="literal">true</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                        <span class="attr">selector:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">&quot;Selector is an optional field that contains</span></span><br><span class="line"><span class="string">                            a selector expression (see Policy for sample syntax).</span></span><br><span class="line"><span class="string">                            \ Only traffic that originates from (terminates at) endpoints</span></span><br><span class="line"><span class="string">                            matching the selector will be matched. \n Note that: in</span></span><br><span class="line"><span class="string">                            addition to the negated version of the Selector (see NotSelector</span></span><br><span class="line"><span class="string">                            below), the selector expression syntax itself supports</span></span><br><span class="line"><span class="string">                            negation.  The two types of negation are subtly different.</span></span><br><span class="line"><span class="string">                            One negates the set of matched endpoints, the other negates</span></span><br><span class="line"><span class="string">                            the whole match: \n \tSelector = \&quot;!has(my_label)\&quot; matches</span></span><br><span class="line"><span class="string">                            packets that are from other Calico-controlled \tendpoints</span></span><br><span class="line"><span class="string">                            that do not have the label \&quot;my_label\&quot;. \n \tNotSelector</span></span><br><span class="line"><span class="string">                            = \&quot;has(my_label)\&quot; matches packets that are not from</span></span><br><span class="line"><span class="string">                            Calico-controlled \tendpoints that do have the label \&quot;my_label\&quot;.</span></span><br><span class="line"><span class="string">                            \n The effect is that the latter will accept packets from</span></span><br><span class="line"><span class="string">                            non-Calico sources whereas the former is limited to packets</span></span><br><span class="line"><span class="string">                            from Calico-controlled endpoints.&quot;</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                        <span class="attr">serviceAccounts:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">ServiceAccounts</span> <span class="string">is</span> <span class="string">an</span> <span class="string">optional</span> <span class="string">field</span> <span class="string">that</span> <span class="string">restricts</span></span><br><span class="line">                            <span class="string">the</span> <span class="string">rule</span> <span class="string">to</span> <span class="string">only</span> <span class="string">apply</span> <span class="string">to</span> <span class="string">traffic</span> <span class="string">that</span> <span class="string">originates</span> <span class="string">from</span></span><br><span class="line">                            <span class="string">(or</span> <span class="string">terminates</span> <span class="string">at)</span> <span class="string">a</span> <span class="string">pod</span> <span class="string">running</span> <span class="string">as</span> <span class="string">a</span> <span class="string">matching</span> <span class="string">service</span></span><br><span class="line">                            <span class="string">account.</span></span><br><span class="line">                          <span class="attr">properties:</span></span><br><span class="line">                            <span class="attr">names:</span></span><br><span class="line">                              <span class="attr">description:</span> <span class="string">Names</span> <span class="string">is</span> <span class="string">an</span> <span class="string">optional</span> <span class="string">field</span> <span class="string">that</span> <span class="string">restricts</span></span><br><span class="line">                                <span class="string">the</span> <span class="string">rule</span> <span class="string">to</span> <span class="string">only</span> <span class="string">apply</span> <span class="string">to</span> <span class="string">traffic</span> <span class="string">that</span> <span class="string">originates</span></span><br><span class="line">                                <span class="string">from</span> <span class="string">(or</span> <span class="string">terminates</span> <span class="string">at)</span> <span class="string">a</span> <span class="string">pod</span> <span class="string">running</span> <span class="string">as</span> <span class="string">a</span> <span class="string">service</span></span><br><span class="line">                                <span class="string">account</span> <span class="string">whose</span> <span class="string">name</span> <span class="string">is</span> <span class="string">in</span> <span class="string">the</span> <span class="string">list.</span></span><br><span class="line">                              <span class="attr">items:</span></span><br><span class="line">                                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                              <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                            <span class="attr">selector:</span></span><br><span class="line">                              <span class="attr">description:</span> <span class="string">Selector</span> <span class="string">is</span> <span class="string">an</span> <span class="string">optional</span> <span class="string">field</span> <span class="string">that</span> <span class="string">restricts</span></span><br><span class="line">                                <span class="string">the</span> <span class="string">rule</span> <span class="string">to</span> <span class="string">only</span> <span class="string">apply</span> <span class="string">to</span> <span class="string">traffic</span> <span class="string">that</span> <span class="string">originates</span></span><br><span class="line">                                <span class="string">from</span> <span class="string">(or</span> <span class="string">terminates</span> <span class="string">at)</span> <span class="string">a</span> <span class="string">pod</span> <span class="string">running</span> <span class="string">as</span> <span class="string">a</span> <span class="string">service</span></span><br><span class="line">                                <span class="string">account</span> <span class="string">that</span> <span class="string">matches</span> <span class="string">the</span> <span class="string">given</span> <span class="string">label</span> <span class="string">selector.</span> <span class="string">If</span></span><br><span class="line">                                <span class="string">both</span> <span class="string">Names</span> <span class="string">and</span> <span class="string">Selector</span> <span class="string">are</span> <span class="string">specified</span> <span class="string">then</span> <span class="string">they</span> <span class="string">are</span></span><br><span class="line">                                <span class="string">AND&#x27;ed.</span></span><br><span class="line">                              <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                        <span class="attr">services:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">&quot;Services is an optional field that contains</span></span><br><span class="line"><span class="string">                            options for matching Kubernetes Services. If specified,</span></span><br><span class="line"><span class="string">                            only traffic that originates from or terminates at endpoints</span></span><br><span class="line"><span class="string">                            within the selected service(s) will be matched, and only</span></span><br><span class="line"><span class="string">                            to/from each endpoint&#x27;s port. \n Services cannot be specified</span></span><br><span class="line"><span class="string">                            on the same rule as Selector, NotSelector, NamespaceSelector,</span></span><br><span class="line"><span class="string">                            Nets, NotNets or ServiceAccounts. \n Ports and NotPorts</span></span><br><span class="line"><span class="string">                            can only be specified with Services on ingress rules.&quot;</span></span><br><span class="line">                          <span class="attr">properties:</span></span><br><span class="line">                            <span class="attr">name:</span></span><br><span class="line">                              <span class="attr">description:</span> <span class="string">Name</span> <span class="string">specifies</span> <span class="string">the</span> <span class="string">name</span> <span class="string">of</span> <span class="string">a</span> <span class="string">Kubernetes</span></span><br><span class="line">                                <span class="string">Service</span> <span class="string">to</span> <span class="string">match.</span></span><br><span class="line">                              <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                            <span class="attr">namespace:</span></span><br><span class="line">                              <span class="attr">description:</span> <span class="string">Namespace</span> <span class="string">specifies</span> <span class="string">the</span> <span class="string">namespace</span> <span class="string">of</span> <span class="string">the</span></span><br><span class="line">                                <span class="string">given</span> <span class="string">Service.</span> <span class="string">If</span> <span class="string">left</span> <span class="string">empty,</span> <span class="string">the</span> <span class="string">rule</span> <span class="string">will</span> <span class="string">match</span></span><br><span class="line">                                <span class="string">within</span> <span class="string">this</span> <span class="string">policy&#x27;s</span> <span class="string">namespace.</span></span><br><span class="line">                              <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                    <span class="attr">http:</span></span><br><span class="line">                      <span class="attr">description:</span> <span class="string">HTTP</span> <span class="string">contains</span> <span class="string">match</span> <span class="string">criteria</span> <span class="string">that</span> <span class="string">apply</span> <span class="string">to</span> <span class="string">HTTP</span></span><br><span class="line">                        <span class="string">requests.</span></span><br><span class="line">                      <span class="attr">properties:</span></span><br><span class="line">                        <span class="attr">methods:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">Methods</span> <span class="string">is</span> <span class="string">an</span> <span class="string">optional</span> <span class="string">field</span> <span class="string">that</span> <span class="string">restricts</span></span><br><span class="line">                            <span class="string">the</span> <span class="string">rule</span> <span class="string">to</span> <span class="string">apply</span> <span class="string">only</span> <span class="string">to</span> <span class="string">HTTP</span> <span class="string">requests</span> <span class="string">that</span> <span class="string">use</span> <span class="string">one</span> <span class="string">of</span></span><br><span class="line">                            <span class="string">the</span> <span class="string">listed</span> <span class="string">HTTP</span> <span class="string">Methods</span> <span class="string">(e.g.</span> <span class="string">GET,</span> <span class="string">PUT,</span> <span class="string">etc.)</span> <span class="string">Multiple</span></span><br><span class="line">                            <span class="string">methods</span> <span class="string">are</span> <span class="string">OR&#x27;d</span> <span class="string">together.</span></span><br><span class="line">                          <span class="attr">items:</span></span><br><span class="line">                            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                        <span class="attr">paths:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">&#x27;Paths is an optional field that restricts</span></span><br><span class="line"><span class="string">                            the rule to apply to HTTP requests that use one of the</span></span><br><span class="line"><span class="string">                            listed HTTP Paths. Multiple paths are OR&#x27;</span><span class="string">&#x27;d together.</span></span><br><span class="line"><span class="string">                            e.g: - exact: /foo - prefix: /bar NOTE: Each entry may</span></span><br><span class="line"><span class="string">                            ONLY specify either a `exact` or a `prefix` match. The</span></span><br><span class="line"><span class="string">                            validator will check for it.&#x27;</span></span><br><span class="line">                          <span class="attr">items:</span></span><br><span class="line">                            <span class="attr">description:</span> <span class="string">&#x27;HTTPPath specifies an HTTP path to match.</span></span><br><span class="line"><span class="string">                              It may be either of the form: exact: &lt;path&gt;: which matches</span></span><br><span class="line"><span class="string">                              the path exactly or prefix: &lt;path-prefix&gt;: which matches</span></span><br><span class="line"><span class="string">                              the path prefix&#x27;</span></span><br><span class="line">                            <span class="attr">properties:</span></span><br><span class="line">                              <span class="attr">exact:</span></span><br><span class="line">                                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                              <span class="attr">prefix:</span></span><br><span class="line">                                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                            <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                    <span class="attr">icmp:</span></span><br><span class="line">                      <span class="attr">description:</span> <span class="string">ICMP</span> <span class="string">is</span> <span class="string">an</span> <span class="string">optional</span> <span class="string">field</span> <span class="string">that</span> <span class="string">restricts</span> <span class="string">the</span> <span class="string">rule</span></span><br><span class="line">                        <span class="string">to</span> <span class="string">apply</span> <span class="string">to</span> <span class="string">a</span> <span class="string">specific</span> <span class="string">type</span> <span class="string">and</span> <span class="string">code</span> <span class="string">of</span> <span class="string">ICMP</span> <span class="string">traffic.</span>  <span class="string">This</span></span><br><span class="line">                        <span class="string">should</span> <span class="string">only</span> <span class="string">be</span> <span class="string">specified</span> <span class="string">if</span> <span class="string">the</span> <span class="string">Protocol</span> <span class="string">field</span> <span class="string">is</span> <span class="string">set</span> <span class="string">to</span> <span class="string">&quot;ICMP&quot;</span></span><br><span class="line">                        <span class="string">or</span> <span class="string">&quot;ICMPv6&quot;</span><span class="string">.</span></span><br><span class="line">                      <span class="attr">properties:</span></span><br><span class="line">                        <span class="attr">code:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">Match</span> <span class="string">on</span> <span class="string">a</span> <span class="string">specific</span> <span class="string">ICMP</span> <span class="string">code.</span>  <span class="string">If</span> <span class="string">specified,</span></span><br><span class="line">                            <span class="string">the</span> <span class="string">Type</span> <span class="string">value</span> <span class="string">must</span> <span class="string">also</span> <span class="string">be</span> <span class="string">specified.</span> <span class="string">This</span> <span class="string">is</span> <span class="string">a</span> <span class="string">technical</span></span><br><span class="line">                            <span class="string">limitation</span> <span class="string">imposed</span> <span class="string">by</span> <span class="string">the</span> <span class="string">kernel&#x27;s</span> <span class="string">iptables</span> <span class="string">firewall,</span></span><br><span class="line">                            <span class="string">which</span> <span class="string">Calico</span> <span class="string">uses</span> <span class="string">to</span> <span class="string">enforce</span> <span class="string">the</span> <span class="string">rule.</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                        <span class="attr">type:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">Match</span> <span class="string">on</span> <span class="string">a</span> <span class="string">specific</span> <span class="string">ICMP</span> <span class="string">type.</span>  <span class="string">For</span> <span class="string">example</span></span><br><span class="line">                            <span class="string">a</span> <span class="string">value</span> <span class="string">of</span> <span class="number">8</span> <span class="string">refers</span> <span class="string">to</span> <span class="string">ICMP</span> <span class="string">Echo</span> <span class="string">Request</span> <span class="string">(i.e.</span> <span class="string">pings).</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                    <span class="attr">ipVersion:</span></span><br><span class="line">                      <span class="attr">description:</span> <span class="string">IPVersion</span> <span class="string">is</span> <span class="string">an</span> <span class="string">optional</span> <span class="string">field</span> <span class="string">that</span> <span class="string">restricts</span> <span class="string">the</span></span><br><span class="line">                        <span class="string">rule</span> <span class="string">to</span> <span class="string">only</span> <span class="string">match</span> <span class="string">a</span> <span class="string">specific</span> <span class="string">IP</span> <span class="string">version.</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                    <span class="attr">metadata:</span></span><br><span class="line">                      <span class="attr">description:</span> <span class="string">Metadata</span> <span class="string">contains</span> <span class="string">additional</span> <span class="string">information</span> <span class="string">for</span> <span class="string">this</span></span><br><span class="line">                        <span class="string">rule</span></span><br><span class="line">                      <span class="attr">properties:</span></span><br><span class="line">                        <span class="attr">annotations:</span></span><br><span class="line">                          <span class="attr">additionalProperties:</span></span><br><span class="line">                            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">Annotations</span> <span class="string">is</span> <span class="string">a</span> <span class="string">set</span> <span class="string">of</span> <span class="string">key</span> <span class="string">value</span> <span class="string">pairs</span> <span class="string">that</span></span><br><span class="line">                            <span class="string">give</span> <span class="string">extra</span> <span class="string">information</span> <span class="string">about</span> <span class="string">the</span> <span class="string">rule</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                    <span class="attr">notICMP:</span></span><br><span class="line">                      <span class="attr">description:</span> <span class="string">NotICMP</span> <span class="string">is</span> <span class="string">the</span> <span class="string">negated</span> <span class="string">version</span> <span class="string">of</span> <span class="string">the</span> <span class="string">ICMP</span> <span class="string">field.</span></span><br><span class="line">                      <span class="attr">properties:</span></span><br><span class="line">                        <span class="attr">code:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">Match</span> <span class="string">on</span> <span class="string">a</span> <span class="string">specific</span> <span class="string">ICMP</span> <span class="string">code.</span>  <span class="string">If</span> <span class="string">specified,</span></span><br><span class="line">                            <span class="string">the</span> <span class="string">Type</span> <span class="string">value</span> <span class="string">must</span> <span class="string">also</span> <span class="string">be</span> <span class="string">specified.</span> <span class="string">This</span> <span class="string">is</span> <span class="string">a</span> <span class="string">technical</span></span><br><span class="line">                            <span class="string">limitation</span> <span class="string">imposed</span> <span class="string">by</span> <span class="string">the</span> <span class="string">kernel&#x27;s</span> <span class="string">iptables</span> <span class="string">firewall,</span></span><br><span class="line">                            <span class="string">which</span> <span class="string">Calico</span> <span class="string">uses</span> <span class="string">to</span> <span class="string">enforce</span> <span class="string">the</span> <span class="string">rule.</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                        <span class="attr">type:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">Match</span> <span class="string">on</span> <span class="string">a</span> <span class="string">specific</span> <span class="string">ICMP</span> <span class="string">type.</span>  <span class="string">For</span> <span class="string">example</span></span><br><span class="line">                            <span class="string">a</span> <span class="string">value</span> <span class="string">of</span> <span class="number">8</span> <span class="string">refers</span> <span class="string">to</span> <span class="string">ICMP</span> <span class="string">Echo</span> <span class="string">Request</span> <span class="string">(i.e.</span> <span class="string">pings).</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                    <span class="attr">notProtocol:</span></span><br><span class="line">                      <span class="attr">anyOf:</span></span><br><span class="line">                      <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                      <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                      <span class="attr">description:</span> <span class="string">NotProtocol</span> <span class="string">is</span> <span class="string">the</span> <span class="string">negated</span> <span class="string">version</span> <span class="string">of</span> <span class="string">the</span> <span class="string">Protocol</span></span><br><span class="line">                        <span class="string">field.</span></span><br><span class="line">                      <span class="attr">pattern:</span> <span class="string">^.*</span></span><br><span class="line">                      <span class="attr">x-kubernetes-int-or-string:</span> <span class="literal">true</span></span><br><span class="line">                    <span class="attr">protocol:</span></span><br><span class="line">                      <span class="attr">anyOf:</span></span><br><span class="line">                      <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                      <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                      <span class="attr">description:</span> <span class="string">&quot;Protocol is an optional field that restricts the</span></span><br><span class="line"><span class="string">                        rule to only apply to traffic of a specific IP protocol. Required</span></span><br><span class="line"><span class="string">                        if any of the EntityRules contain Ports (because ports only</span></span><br><span class="line"><span class="string">                        apply to certain protocols). \n Must be one of these string</span></span><br><span class="line"><span class="string">                        values: \&quot;TCP\&quot;, \&quot;UDP\&quot;, \&quot;ICMP\&quot;, \&quot;ICMPv6\&quot;, \&quot;SCTP\&quot;,</span></span><br><span class="line"><span class="string">                        \&quot;UDPLite\&quot; or an integer in the range 1-255.&quot;</span></span><br><span class="line">                      <span class="attr">pattern:</span> <span class="string">^.*</span></span><br><span class="line">                      <span class="attr">x-kubernetes-int-or-string:</span> <span class="literal">true</span></span><br><span class="line">                    <span class="attr">source:</span></span><br><span class="line">                      <span class="attr">description:</span> <span class="string">Source</span> <span class="string">contains</span> <span class="string">the</span> <span class="string">match</span> <span class="string">criteria</span> <span class="string">that</span> <span class="string">apply</span> <span class="string">to</span></span><br><span class="line">                        <span class="string">source</span> <span class="string">entity.</span></span><br><span class="line">                      <span class="attr">properties:</span></span><br><span class="line">                        <span class="attr">namespaceSelector:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">&quot;NamespaceSelector is an optional field that</span></span><br><span class="line"><span class="string">                            contains a selector expression. Only traffic that originates</span></span><br><span class="line"><span class="string">                            from (or terminates at) endpoints within the selected</span></span><br><span class="line"><span class="string">                            namespaces will be matched. When both NamespaceSelector</span></span><br><span class="line"><span class="string">                            and another selector are defined on the same rule, then</span></span><br><span class="line"><span class="string">                            only workload endpoints that are matched by both selectors</span></span><br><span class="line"><span class="string">                            will be selected by the rule. \n For NetworkPolicy, an</span></span><br><span class="line"><span class="string">                            empty NamespaceSelector implies that the Selector is limited</span></span><br><span class="line"><span class="string">                            to selecting only workload endpoints in the same namespace</span></span><br><span class="line"><span class="string">                            as the NetworkPolicy. \n For NetworkPolicy, `global()`</span></span><br><span class="line"><span class="string">                            NamespaceSelector implies that the Selector is limited</span></span><br><span class="line"><span class="string">                            to selecting only GlobalNetworkSet or HostEndpoint. \n</span></span><br><span class="line"><span class="string">                            For GlobalNetworkPolicy, an empty NamespaceSelector implies</span></span><br><span class="line"><span class="string">                            the Selector applies to workload endpoints across all</span></span><br><span class="line"><span class="string">                            namespaces.&quot;</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                        <span class="attr">nets:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">Nets</span> <span class="string">is</span> <span class="string">an</span> <span class="string">optional</span> <span class="string">field</span> <span class="string">that</span> <span class="string">restricts</span> <span class="string">the</span></span><br><span class="line">                            <span class="string">rule</span> <span class="string">to</span> <span class="string">only</span> <span class="string">apply</span> <span class="string">to</span> <span class="string">traffic</span> <span class="string">that</span> <span class="string">originates</span> <span class="string">from</span> <span class="string">(or</span></span><br><span class="line">                            <span class="string">terminates</span> <span class="string">at)</span> <span class="string">IP</span> <span class="string">addresses</span> <span class="string">in</span> <span class="string">any</span> <span class="string">of</span> <span class="string">the</span> <span class="string">given</span> <span class="string">subnets.</span></span><br><span class="line">                          <span class="attr">items:</span></span><br><span class="line">                            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                        <span class="attr">notNets:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">NotNets</span> <span class="string">is</span> <span class="string">the</span> <span class="string">negated</span> <span class="string">version</span> <span class="string">of</span> <span class="string">the</span> <span class="string">Nets</span></span><br><span class="line">                            <span class="string">field.</span></span><br><span class="line">                          <span class="attr">items:</span></span><br><span class="line">                            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                        <span class="attr">notPorts:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">NotPorts</span> <span class="string">is</span> <span class="string">the</span> <span class="string">negated</span> <span class="string">version</span> <span class="string">of</span> <span class="string">the</span> <span class="string">Ports</span></span><br><span class="line">                            <span class="string">field.</span> <span class="string">Since</span> <span class="string">only</span> <span class="string">some</span> <span class="string">protocols</span> <span class="string">have</span> <span class="string">ports,</span> <span class="string">if</span> <span class="string">any</span> <span class="string">ports</span></span><br><span class="line">                            <span class="string">are</span> <span class="string">specified</span> <span class="string">it</span> <span class="string">requires</span> <span class="string">the</span> <span class="string">Protocol</span> <span class="string">match</span> <span class="string">in</span> <span class="string">the</span> <span class="string">Rule</span></span><br><span class="line">                            <span class="string">to</span> <span class="string">be</span> <span class="string">set</span> <span class="string">to</span> <span class="string">&quot;TCP&quot;</span> <span class="string">or</span> <span class="string">&quot;UDP&quot;</span><span class="string">.</span></span><br><span class="line">                          <span class="attr">items:</span></span><br><span class="line">                            <span class="attr">anyOf:</span></span><br><span class="line">                            <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                            <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                            <span class="attr">pattern:</span> <span class="string">^.*</span></span><br><span class="line">                            <span class="attr">x-kubernetes-int-or-string:</span> <span class="literal">true</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                        <span class="attr">notSelector:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">NotSelector</span> <span class="string">is</span> <span class="string">the</span> <span class="string">negated</span> <span class="string">version</span> <span class="string">of</span> <span class="string">the</span> <span class="string">Selector</span></span><br><span class="line">                            <span class="string">field.</span>  <span class="string">See</span> <span class="string">Selector</span> <span class="string">field</span> <span class="string">for</span> <span class="string">subtleties</span> <span class="string">with</span> <span class="string">negated</span></span><br><span class="line">                            <span class="string">selectors.</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                        <span class="attr">ports:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">&quot;Ports is an optional field that restricts</span></span><br><span class="line"><span class="string">                            the rule to only apply to traffic that has a source (destination)</span></span><br><span class="line"><span class="string">                            port that matches one of these ranges/values. This value</span></span><br><span class="line"><span class="string">                            is a list of integers or strings that represent ranges</span></span><br><span class="line"><span class="string">                            of ports. \n Since only some protocols have ports, if</span></span><br><span class="line"><span class="string">                            any ports are specified it requires the Protocol match</span></span><br><span class="line"><span class="string">                            in the Rule to be set to \&quot;TCP\&quot; or \&quot;UDP\&quot;.&quot;</span></span><br><span class="line">                          <span class="attr">items:</span></span><br><span class="line">                            <span class="attr">anyOf:</span></span><br><span class="line">                            <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                            <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                            <span class="attr">pattern:</span> <span class="string">^.*</span></span><br><span class="line">                            <span class="attr">x-kubernetes-int-or-string:</span> <span class="literal">true</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                        <span class="attr">selector:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">&quot;Selector is an optional field that contains</span></span><br><span class="line"><span class="string">                            a selector expression (see Policy for sample syntax).</span></span><br><span class="line"><span class="string">                            \ Only traffic that originates from (terminates at) endpoints</span></span><br><span class="line"><span class="string">                            matching the selector will be matched. \n Note that: in</span></span><br><span class="line"><span class="string">                            addition to the negated version of the Selector (see NotSelector</span></span><br><span class="line"><span class="string">                            below), the selector expression syntax itself supports</span></span><br><span class="line"><span class="string">                            negation.  The two types of negation are subtly different.</span></span><br><span class="line"><span class="string">                            One negates the set of matched endpoints, the other negates</span></span><br><span class="line"><span class="string">                            the whole match: \n \tSelector = \&quot;!has(my_label)\&quot; matches</span></span><br><span class="line"><span class="string">                            packets that are from other Calico-controlled \tendpoints</span></span><br><span class="line"><span class="string">                            that do not have the label \&quot;my_label\&quot;. \n \tNotSelector</span></span><br><span class="line"><span class="string">                            = \&quot;has(my_label)\&quot; matches packets that are not from</span></span><br><span class="line"><span class="string">                            Calico-controlled \tendpoints that do have the label \&quot;my_label\&quot;.</span></span><br><span class="line"><span class="string">                            \n The effect is that the latter will accept packets from</span></span><br><span class="line"><span class="string">                            non-Calico sources whereas the former is limited to packets</span></span><br><span class="line"><span class="string">                            from Calico-controlled endpoints.&quot;</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                        <span class="attr">serviceAccounts:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">ServiceAccounts</span> <span class="string">is</span> <span class="string">an</span> <span class="string">optional</span> <span class="string">field</span> <span class="string">that</span> <span class="string">restricts</span></span><br><span class="line">                            <span class="string">the</span> <span class="string">rule</span> <span class="string">to</span> <span class="string">only</span> <span class="string">apply</span> <span class="string">to</span> <span class="string">traffic</span> <span class="string">that</span> <span class="string">originates</span> <span class="string">from</span></span><br><span class="line">                            <span class="string">(or</span> <span class="string">terminates</span> <span class="string">at)</span> <span class="string">a</span> <span class="string">pod</span> <span class="string">running</span> <span class="string">as</span> <span class="string">a</span> <span class="string">matching</span> <span class="string">service</span></span><br><span class="line">                            <span class="string">account.</span></span><br><span class="line">                          <span class="attr">properties:</span></span><br><span class="line">                            <span class="attr">names:</span></span><br><span class="line">                              <span class="attr">description:</span> <span class="string">Names</span> <span class="string">is</span> <span class="string">an</span> <span class="string">optional</span> <span class="string">field</span> <span class="string">that</span> <span class="string">restricts</span></span><br><span class="line">                                <span class="string">the</span> <span class="string">rule</span> <span class="string">to</span> <span class="string">only</span> <span class="string">apply</span> <span class="string">to</span> <span class="string">traffic</span> <span class="string">that</span> <span class="string">originates</span></span><br><span class="line">                                <span class="string">from</span> <span class="string">(or</span> <span class="string">terminates</span> <span class="string">at)</span> <span class="string">a</span> <span class="string">pod</span> <span class="string">running</span> <span class="string">as</span> <span class="string">a</span> <span class="string">service</span></span><br><span class="line">                                <span class="string">account</span> <span class="string">whose</span> <span class="string">name</span> <span class="string">is</span> <span class="string">in</span> <span class="string">the</span> <span class="string">list.</span></span><br><span class="line">                              <span class="attr">items:</span></span><br><span class="line">                                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                              <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                            <span class="attr">selector:</span></span><br><span class="line">                              <span class="attr">description:</span> <span class="string">Selector</span> <span class="string">is</span> <span class="string">an</span> <span class="string">optional</span> <span class="string">field</span> <span class="string">that</span> <span class="string">restricts</span></span><br><span class="line">                                <span class="string">the</span> <span class="string">rule</span> <span class="string">to</span> <span class="string">only</span> <span class="string">apply</span> <span class="string">to</span> <span class="string">traffic</span> <span class="string">that</span> <span class="string">originates</span></span><br><span class="line">                                <span class="string">from</span> <span class="string">(or</span> <span class="string">terminates</span> <span class="string">at)</span> <span class="string">a</span> <span class="string">pod</span> <span class="string">running</span> <span class="string">as</span> <span class="string">a</span> <span class="string">service</span></span><br><span class="line">                                <span class="string">account</span> <span class="string">that</span> <span class="string">matches</span> <span class="string">the</span> <span class="string">given</span> <span class="string">label</span> <span class="string">selector.</span> <span class="string">If</span></span><br><span class="line">                                <span class="string">both</span> <span class="string">Names</span> <span class="string">and</span> <span class="string">Selector</span> <span class="string">are</span> <span class="string">specified</span> <span class="string">then</span> <span class="string">they</span> <span class="string">are</span></span><br><span class="line">                                <span class="string">AND&#x27;ed.</span></span><br><span class="line">                              <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                        <span class="attr">services:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">&quot;Services is an optional field that contains</span></span><br><span class="line"><span class="string">                            options for matching Kubernetes Services. If specified,</span></span><br><span class="line"><span class="string">                            only traffic that originates from or terminates at endpoints</span></span><br><span class="line"><span class="string">                            within the selected service(s) will be matched, and only</span></span><br><span class="line"><span class="string">                            to/from each endpoint&#x27;s port. \n Services cannot be specified</span></span><br><span class="line"><span class="string">                            on the same rule as Selector, NotSelector, NamespaceSelector,</span></span><br><span class="line"><span class="string">                            Nets, NotNets or ServiceAccounts. \n Ports and NotPorts</span></span><br><span class="line"><span class="string">                            can only be specified with Services on ingress rules.&quot;</span></span><br><span class="line">                          <span class="attr">properties:</span></span><br><span class="line">                            <span class="attr">name:</span></span><br><span class="line">                              <span class="attr">description:</span> <span class="string">Name</span> <span class="string">specifies</span> <span class="string">the</span> <span class="string">name</span> <span class="string">of</span> <span class="string">a</span> <span class="string">Kubernetes</span></span><br><span class="line">                                <span class="string">Service</span> <span class="string">to</span> <span class="string">match.</span></span><br><span class="line">                              <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                            <span class="attr">namespace:</span></span><br><span class="line">                              <span class="attr">description:</span> <span class="string">Namespace</span> <span class="string">specifies</span> <span class="string">the</span> <span class="string">namespace</span> <span class="string">of</span> <span class="string">the</span></span><br><span class="line">                                <span class="string">given</span> <span class="string">Service.</span> <span class="string">If</span> <span class="string">left</span> <span class="string">empty,</span> <span class="string">the</span> <span class="string">rule</span> <span class="string">will</span> <span class="string">match</span></span><br><span class="line">                                <span class="string">within</span> <span class="string">this</span> <span class="string">policy&#x27;s</span> <span class="string">namespace.</span></span><br><span class="line">                              <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                  <span class="attr">required:</span></span><br><span class="line">                  <span class="bullet">-</span> <span class="string">action</span></span><br><span class="line">                  <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">              <span class="attr">namespaceSelector:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">NamespaceSelector</span> <span class="string">is</span> <span class="string">an</span> <span class="string">optional</span> <span class="string">field</span> <span class="string">for</span> <span class="string">an</span> <span class="string">expression</span></span><br><span class="line">                  <span class="string">used</span> <span class="string">to</span> <span class="string">select</span> <span class="string">a</span> <span class="string">pod</span> <span class="string">based</span> <span class="string">on</span> <span class="string">namespaces.</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">order:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">Order</span> <span class="string">is</span> <span class="string">an</span> <span class="string">optional</span> <span class="string">field</span> <span class="string">that</span> <span class="string">specifies</span> <span class="string">the</span> <span class="string">order</span> <span class="string">in</span></span><br><span class="line">                  <span class="string">which</span> <span class="string">the</span> <span class="string">policy</span> <span class="string">is</span> <span class="string">applied.</span> <span class="string">Policies</span> <span class="string">with</span> <span class="string">higher</span> <span class="string">&quot;order&quot;</span> <span class="string">are</span> <span class="string">applied</span></span><br><span class="line">                  <span class="string">after</span> <span class="string">those</span> <span class="string">with</span> <span class="string">lower</span> <span class="string">order.</span>  <span class="string">If</span> <span class="string">the</span> <span class="string">order</span> <span class="string">is</span> <span class="string">omitted,</span> <span class="string">it</span> <span class="string">may</span> <span class="string">be</span></span><br><span class="line">                  <span class="string">considered</span> <span class="string">to</span> <span class="string">be</span> <span class="string">&quot;infinite&quot;</span> <span class="bullet">-</span> <span class="string">i.e.</span> <span class="string">the</span> <span class="string">policy</span> <span class="string">will</span> <span class="string">be</span> <span class="string">applied</span> <span class="string">last.</span>  <span class="string">Policies</span></span><br><span class="line">                  <span class="string">with</span> <span class="string">identical</span> <span class="string">order</span> <span class="string">will</span> <span class="string">be</span> <span class="string">applied</span> <span class="string">in</span> <span class="string">alphanumerical</span> <span class="string">order</span> <span class="string">based</span></span><br><span class="line">                  <span class="string">on</span> <span class="string">the</span> <span class="string">Policy</span> <span class="string">&quot;Name&quot;</span><span class="string">.</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">number</span></span><br><span class="line">              <span class="attr">preDNAT:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">PreDNAT</span> <span class="string">indicates</span> <span class="string">to</span> <span class="string">apply</span> <span class="string">the</span> <span class="string">rules</span> <span class="string">in</span> <span class="string">this</span> <span class="string">policy</span> <span class="string">before</span></span><br><span class="line">                  <span class="string">any</span> <span class="string">DNAT.</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">boolean</span></span><br><span class="line">              <span class="attr">selector:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&quot;The selector is an expression used to pick pick out</span></span><br><span class="line"><span class="string">                  the endpoints that the policy should be applied to. \n Selector</span></span><br><span class="line"><span class="string">                  expressions follow this syntax: \n \tlabel == \&quot;string_literal\&quot;</span></span><br><span class="line"><span class="string">                  \ -&gt;  comparison, e.g. my_label == \&quot;foo bar\&quot; \tlabel != \&quot;string_literal\&quot;</span></span><br><span class="line"><span class="string">                  \  -&gt;  not equal; also matches if label is not present \tlabel in</span></span><br><span class="line"><span class="string">                  &#123; \&quot;a\&quot;, \&quot;b\&quot;, \&quot;c\&quot;, ... &#125;  -&gt;  true if the value of label X is</span></span><br><span class="line"><span class="string">                  one of \&quot;a\&quot;, \&quot;b\&quot;, \&quot;c\&quot; \tlabel not in &#123; \&quot;a\&quot;, \&quot;b\&quot;, \&quot;c\&quot;,</span></span><br><span class="line"><span class="string">                  ... &#125;  -&gt;  true if the value of label X is not one of \&quot;a\&quot;, \&quot;b\&quot;,</span></span><br><span class="line"><span class="string">                  \&quot;c\&quot; \thas(label_name)  -&gt; True if that label is present \t! expr</span></span><br><span class="line"><span class="string">                  -&gt; negation of expr \texpr &amp;&amp; expr  -&gt; Short-circuit and \texpr</span></span><br><span class="line"><span class="string">                  || expr  -&gt; Short-circuit or \t( expr ) -&gt; parens for grouping \tall()</span></span><br><span class="line"><span class="string">                  or the empty selector -&gt; matches all endpoints. \n Label names are</span></span><br><span class="line"><span class="string">                  allowed to contain alphanumerics, -, _ and /. String literals are</span></span><br><span class="line"><span class="string">                  more permissive but they do not support escape characters. \n Examples</span></span><br><span class="line"><span class="string">                  (with made-up labels): \n \ttype == \&quot;webserver\&quot; &amp;&amp; deployment</span></span><br><span class="line"><span class="string">                  == \&quot;prod\&quot; \ttype in &#123;\&quot;frontend\&quot;, \&quot;backend\&quot;&#125; \tdeployment !=</span></span><br><span class="line"><span class="string">                  \&quot;dev\&quot; \t! has(label_name)&quot;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">serviceAccountSelector:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">ServiceAccountSelector</span> <span class="string">is</span> <span class="string">an</span> <span class="string">optional</span> <span class="string">field</span> <span class="string">for</span> <span class="string">an</span> <span class="string">expression</span></span><br><span class="line">                  <span class="string">used</span> <span class="string">to</span> <span class="string">select</span> <span class="string">a</span> <span class="string">pod</span> <span class="string">based</span> <span class="string">on</span> <span class="string">service</span> <span class="string">accounts.</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">types:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&quot;Types indicates whether this policy applies to ingress,</span></span><br><span class="line"><span class="string">                  or to egress, or to both.  When not explicitly specified (and so</span></span><br><span class="line"><span class="string">                  the value on creation is empty or nil), Calico defaults Types according</span></span><br><span class="line"><span class="string">                  to what Ingress and Egress rules are present in the policy.  The</span></span><br><span class="line"><span class="string">                  default is: \n - [ PolicyTypeIngress ], if there are no Egress rules</span></span><br><span class="line"><span class="string">                  (including the case where there are   also no Ingress rules) \n</span></span><br><span class="line"><span class="string">                  - [ PolicyTypeEgress ], if there are Egress rules but no Ingress</span></span><br><span class="line"><span class="string">                  rules \n - [ PolicyTypeIngress, PolicyTypeEgress ], if there are</span></span><br><span class="line"><span class="string">                  both Ingress and Egress rules. \n When the policy is read back again,</span></span><br><span class="line"><span class="string">                  Types will always be one of these values, never empty or nil.&quot;</span></span><br><span class="line">                <span class="attr">items:</span></span><br><span class="line">                  <span class="attr">description:</span> <span class="string">PolicyType</span> <span class="string">enumerates</span> <span class="string">the</span> <span class="string">possible</span> <span class="string">values</span> <span class="string">of</span> <span class="string">the</span> <span class="string">PolicySpec</span></span><br><span class="line">                    <span class="string">Types</span> <span class="string">field.</span></span><br><span class="line">                  <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">    <span class="attr">served:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">storage:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">status:</span></span><br><span class="line">  <span class="attr">acceptedNames:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">conditions:</span> []</span><br><span class="line">  <span class="attr">storedVersions:</span> []</span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apiextensions.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CustomResourceDefinition</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">globalnetworksets.crd.projectcalico.org</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">group:</span> <span class="string">crd.projectcalico.org</span></span><br><span class="line">  <span class="attr">names:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">GlobalNetworkSet</span></span><br><span class="line">    <span class="attr">listKind:</span> <span class="string">GlobalNetworkSetList</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">globalnetworksets</span></span><br><span class="line">    <span class="attr">singular:</span> <span class="string">globalnetworkset</span></span><br><span class="line">  <span class="attr">scope:</span> <span class="string">Cluster</span></span><br><span class="line">  <span class="attr">versions:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">v1</span></span><br><span class="line">    <span class="attr">schema:</span></span><br><span class="line">      <span class="attr">openAPIV3Schema:</span></span><br><span class="line">        <span class="attr">description:</span> <span class="string">GlobalNetworkSet</span> <span class="string">contains</span> <span class="string">a</span> <span class="string">set</span> <span class="string">of</span> <span class="string">arbitrary</span> <span class="string">IP</span> <span class="string">sub-networks/CIDRs</span></span><br><span class="line">          <span class="string">that</span> <span class="string">share</span> <span class="string">labels</span> <span class="string">to</span> <span class="string">allow</span> <span class="string">rules</span> <span class="string">to</span> <span class="string">refer</span> <span class="string">to</span> <span class="string">them</span> <span class="string">via</span> <span class="string">selectors.</span>  <span class="string">The</span> <span class="string">labels</span></span><br><span class="line">          <span class="string">of</span> <span class="string">GlobalNetworkSet</span> <span class="string">are</span> <span class="string">not</span> <span class="string">namespaced.</span></span><br><span class="line">        <span class="attr">properties:</span></span><br><span class="line">          <span class="attr">apiVersion:</span></span><br><span class="line">            <span class="attr">description:</span> <span class="string">&#x27;APIVersion defines the versioned schema of this representation</span></span><br><span class="line"><span class="string">              of an object. Servers should convert recognized schemas to the latest</span></span><br><span class="line"><span class="string">              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources&#x27;</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">          <span class="attr">kind:</span></span><br><span class="line">            <span class="attr">description:</span> <span class="string">&#x27;Kind is a string value representing the REST resource this</span></span><br><span class="line"><span class="string">              object represents. Servers may infer this from the endpoint the client</span></span><br><span class="line"><span class="string">              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds&#x27;</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">          <span class="attr">metadata:</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">          <span class="attr">spec:</span></span><br><span class="line">            <span class="attr">description:</span> <span class="string">GlobalNetworkSetSpec</span> <span class="string">contains</span> <span class="string">the</span> <span class="string">specification</span> <span class="string">for</span> <span class="string">a</span> <span class="string">NetworkSet</span></span><br><span class="line">              <span class="string">resource.</span></span><br><span class="line">            <span class="attr">properties:</span></span><br><span class="line">              <span class="attr">nets:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">The</span> <span class="string">list</span> <span class="string">of</span> <span class="string">IP</span> <span class="string">networks</span> <span class="string">that</span> <span class="string">belong</span> <span class="string">to</span> <span class="string">this</span> <span class="string">set.</span></span><br><span class="line">                <span class="attr">items:</span></span><br><span class="line">                  <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">    <span class="attr">served:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">storage:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">status:</span></span><br><span class="line">  <span class="attr">acceptedNames:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">conditions:</span> []</span><br><span class="line">  <span class="attr">storedVersions:</span> []</span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apiextensions.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CustomResourceDefinition</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">hostendpoints.crd.projectcalico.org</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">group:</span> <span class="string">crd.projectcalico.org</span></span><br><span class="line">  <span class="attr">names:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">HostEndpoint</span></span><br><span class="line">    <span class="attr">listKind:</span> <span class="string">HostEndpointList</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">hostendpoints</span></span><br><span class="line">    <span class="attr">singular:</span> <span class="string">hostendpoint</span></span><br><span class="line">  <span class="attr">scope:</span> <span class="string">Cluster</span></span><br><span class="line">  <span class="attr">versions:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">v1</span></span><br><span class="line">    <span class="attr">schema:</span></span><br><span class="line">      <span class="attr">openAPIV3Schema:</span></span><br><span class="line">        <span class="attr">properties:</span></span><br><span class="line">          <span class="attr">apiVersion:</span></span><br><span class="line">            <span class="attr">description:</span> <span class="string">&#x27;APIVersion defines the versioned schema of this representation</span></span><br><span class="line"><span class="string">              of an object. Servers should convert recognized schemas to the latest</span></span><br><span class="line"><span class="string">              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources&#x27;</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">          <span class="attr">kind:</span></span><br><span class="line">            <span class="attr">description:</span> <span class="string">&#x27;Kind is a string value representing the REST resource this</span></span><br><span class="line"><span class="string">              object represents. Servers may infer this from the endpoint the client</span></span><br><span class="line"><span class="string">              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds&#x27;</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">          <span class="attr">metadata:</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">          <span class="attr">spec:</span></span><br><span class="line">            <span class="attr">description:</span> <span class="string">HostEndpointSpec</span> <span class="string">contains</span> <span class="string">the</span> <span class="string">specification</span> <span class="string">for</span> <span class="string">a</span> <span class="string">HostEndpoint</span></span><br><span class="line">              <span class="string">resource.</span></span><br><span class="line">            <span class="attr">properties:</span></span><br><span class="line">              <span class="attr">expectedIPs:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&quot;The expected IP addresses (IPv4 and IPv6) of the endpoint.</span></span><br><span class="line"><span class="string">                  If \&quot;InterfaceName\&quot; is not present, Calico will look for an interface</span></span><br><span class="line"><span class="string">                  matching any of the IPs in the list and apply policy to that. Note:</span></span><br><span class="line"><span class="string">                  \tWhen using the selector match criteria in an ingress or egress</span></span><br><span class="line"><span class="string">                  security Policy \tor Profile, Calico converts the selector into</span></span><br><span class="line"><span class="string">                  a set of IP addresses. For host \tendpoints, the ExpectedIPs field</span></span><br><span class="line"><span class="string">                  is used for that purpose. (If only the interface \tname is specified,</span></span><br><span class="line"><span class="string">                  Calico does not learn the IPs of the interface for use in match</span></span><br><span class="line"><span class="string">                  \tcriteria.)&quot;</span></span><br><span class="line">                <span class="attr">items:</span></span><br><span class="line">                  <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">              <span class="attr">interfaceName:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&quot;Either \&quot;*\&quot;, or the name of a specific Linux interface</span></span><br><span class="line"><span class="string">                  to apply policy to; or empty.  \&quot;*\&quot; indicates that this HostEndpoint</span></span><br><span class="line"><span class="string">                  governs all traffic to, from or through the default network namespace</span></span><br><span class="line"><span class="string">                  of the host named by the \&quot;Node\&quot; field; entering and leaving that</span></span><br><span class="line"><span class="string">                  namespace via any interface, including those from/to non-host-networked</span></span><br><span class="line"><span class="string">                  local workloads. \n If InterfaceName is not \&quot;*\&quot;, this HostEndpoint</span></span><br><span class="line"><span class="string">                  only governs traffic that enters or leaves the host through the</span></span><br><span class="line"><span class="string">                  specific interface named by InterfaceName, or - when InterfaceName</span></span><br><span class="line"><span class="string">                  is empty - through the specific interface that has one of the IPs</span></span><br><span class="line"><span class="string">                  in ExpectedIPs. Therefore, when InterfaceName is empty, at least</span></span><br><span class="line"><span class="string">                  one expected IP must be specified.  Only external interfaces (such</span></span><br><span class="line"><span class="string">                  as \&quot;eth0\&quot;) are supported here; it isn&#x27;t possible for a HostEndpoint</span></span><br><span class="line"><span class="string">                  to protect traffic through a specific local workload interface.</span></span><br><span class="line"><span class="string">                  \n Note: Only some kinds of policy are implemented for \&quot;*\&quot; HostEndpoints;</span></span><br><span class="line"><span class="string">                  initially just pre-DNAT policy.  Please check Calico documentation</span></span><br><span class="line"><span class="string">                  for the latest position.&quot;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">node:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">The</span> <span class="string">node</span> <span class="string">name</span> <span class="string">identifying</span> <span class="string">the</span> <span class="string">Calico</span> <span class="string">node</span> <span class="string">instance.</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">ports:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">Ports</span> <span class="string">contains</span> <span class="string">the</span> <span class="string">endpoint&#x27;s</span> <span class="string">named</span> <span class="string">ports,</span> <span class="string">which</span> <span class="string">may</span></span><br><span class="line">                  <span class="string">be</span> <span class="string">referenced</span> <span class="string">in</span> <span class="string">security</span> <span class="string">policy</span> <span class="string">rules.</span></span><br><span class="line">                <span class="attr">items:</span></span><br><span class="line">                  <span class="attr">properties:</span></span><br><span class="line">                    <span class="attr">name:</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                    <span class="attr">port:</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                    <span class="attr">protocol:</span></span><br><span class="line">                      <span class="attr">anyOf:</span></span><br><span class="line">                      <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                      <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                      <span class="attr">pattern:</span> <span class="string">^.*</span></span><br><span class="line">                      <span class="attr">x-kubernetes-int-or-string:</span> <span class="literal">true</span></span><br><span class="line">                  <span class="attr">required:</span></span><br><span class="line">                  <span class="bullet">-</span> <span class="string">name</span></span><br><span class="line">                  <span class="bullet">-</span> <span class="string">port</span></span><br><span class="line">                  <span class="bullet">-</span> <span class="string">protocol</span></span><br><span class="line">                  <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">              <span class="attr">profiles:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">A</span> <span class="string">list</span> <span class="string">of</span> <span class="string">identifiers</span> <span class="string">of</span> <span class="string">security</span> <span class="string">Profile</span> <span class="string">objects</span> <span class="string">that</span></span><br><span class="line">                  <span class="string">apply</span> <span class="string">to</span> <span class="string">this</span> <span class="string">endpoint.</span> <span class="string">Each</span> <span class="string">profile</span> <span class="string">is</span> <span class="string">applied</span> <span class="string">in</span> <span class="string">the</span> <span class="string">order</span> <span class="string">that</span></span><br><span class="line">                  <span class="string">they</span> <span class="string">appear</span> <span class="string">in</span> <span class="string">this</span> <span class="string">list.</span>  <span class="string">Profile</span> <span class="string">rules</span> <span class="string">are</span> <span class="string">applied</span> <span class="string">after</span> <span class="string">the</span> <span class="string">selector-based</span></span><br><span class="line">                  <span class="string">security</span> <span class="string">policy.</span></span><br><span class="line">                <span class="attr">items:</span></span><br><span class="line">                  <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">    <span class="attr">served:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">storage:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">status:</span></span><br><span class="line">  <span class="attr">acceptedNames:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">conditions:</span> []</span><br><span class="line">  <span class="attr">storedVersions:</span> []</span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apiextensions.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CustomResourceDefinition</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ipamblocks.crd.projectcalico.org</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">group:</span> <span class="string">crd.projectcalico.org</span></span><br><span class="line">  <span class="attr">names:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">IPAMBlock</span></span><br><span class="line">    <span class="attr">listKind:</span> <span class="string">IPAMBlockList</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">ipamblocks</span></span><br><span class="line">    <span class="attr">singular:</span> <span class="string">ipamblock</span></span><br><span class="line">  <span class="attr">scope:</span> <span class="string">Cluster</span></span><br><span class="line">  <span class="attr">versions:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">v1</span></span><br><span class="line">    <span class="attr">schema:</span></span><br><span class="line">      <span class="attr">openAPIV3Schema:</span></span><br><span class="line">        <span class="attr">properties:</span></span><br><span class="line">          <span class="attr">apiVersion:</span></span><br><span class="line">            <span class="attr">description:</span> <span class="string">&#x27;APIVersion defines the versioned schema of this representation</span></span><br><span class="line"><span class="string">              of an object. Servers should convert recognized schemas to the latest</span></span><br><span class="line"><span class="string">              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources&#x27;</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">          <span class="attr">kind:</span></span><br><span class="line">            <span class="attr">description:</span> <span class="string">&#x27;Kind is a string value representing the REST resource this</span></span><br><span class="line"><span class="string">              object represents. Servers may infer this from the endpoint the client</span></span><br><span class="line"><span class="string">              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds&#x27;</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">          <span class="attr">metadata:</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">          <span class="attr">spec:</span></span><br><span class="line">            <span class="attr">description:</span> <span class="string">IPAMBlockSpec</span> <span class="string">contains</span> <span class="string">the</span> <span class="string">specification</span> <span class="string">for</span> <span class="string">an</span> <span class="string">IPAMBlock</span></span><br><span class="line">              <span class="string">resource.</span></span><br><span class="line">            <span class="attr">properties:</span></span><br><span class="line">              <span class="attr">affinity:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">allocations:</span></span><br><span class="line">                <span class="attr">items:</span></span><br><span class="line">                  <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                  <span class="comment"># <span class="doctag">TODO:</span> This nullable is manually added in. We should update controller-gen</span></span><br><span class="line">                  <span class="comment"># to handle []*int properly itself.</span></span><br><span class="line">                  <span class="attr">nullable:</span> <span class="literal">true</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">              <span class="attr">attributes:</span></span><br><span class="line">                <span class="attr">items:</span></span><br><span class="line">                  <span class="attr">properties:</span></span><br><span class="line">                    <span class="attr">handle_id:</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                    <span class="attr">secondary:</span></span><br><span class="line">                      <span class="attr">additionalProperties:</span></span><br><span class="line">                        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                  <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">              <span class="attr">cidr:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">deleted:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">boolean</span></span><br><span class="line">              <span class="attr">strictAffinity:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">boolean</span></span><br><span class="line">              <span class="attr">unallocated:</span></span><br><span class="line">                <span class="attr">items:</span></span><br><span class="line">                  <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">            <span class="attr">required:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">allocations</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">attributes</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">cidr</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">strictAffinity</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">unallocated</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">    <span class="attr">served:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">storage:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">status:</span></span><br><span class="line">  <span class="attr">acceptedNames:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">conditions:</span> []</span><br><span class="line">  <span class="attr">storedVersions:</span> []</span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apiextensions.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CustomResourceDefinition</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ipamconfigs.crd.projectcalico.org</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">group:</span> <span class="string">crd.projectcalico.org</span></span><br><span class="line">  <span class="attr">names:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">IPAMConfig</span></span><br><span class="line">    <span class="attr">listKind:</span> <span class="string">IPAMConfigList</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">ipamconfigs</span></span><br><span class="line">    <span class="attr">singular:</span> <span class="string">ipamconfig</span></span><br><span class="line">  <span class="attr">scope:</span> <span class="string">Cluster</span></span><br><span class="line">  <span class="attr">versions:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">v1</span></span><br><span class="line">    <span class="attr">schema:</span></span><br><span class="line">      <span class="attr">openAPIV3Schema:</span></span><br><span class="line">        <span class="attr">properties:</span></span><br><span class="line">          <span class="attr">apiVersion:</span></span><br><span class="line">            <span class="attr">description:</span> <span class="string">&#x27;APIVersion defines the versioned schema of this representation</span></span><br><span class="line"><span class="string">              of an object. Servers should convert recognized schemas to the latest</span></span><br><span class="line"><span class="string">              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources&#x27;</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">          <span class="attr">kind:</span></span><br><span class="line">            <span class="attr">description:</span> <span class="string">&#x27;Kind is a string value representing the REST resource this</span></span><br><span class="line"><span class="string">              object represents. Servers may infer this from the endpoint the client</span></span><br><span class="line"><span class="string">              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds&#x27;</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">          <span class="attr">metadata:</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">          <span class="attr">spec:</span></span><br><span class="line">            <span class="attr">description:</span> <span class="string">IPAMConfigSpec</span> <span class="string">contains</span> <span class="string">the</span> <span class="string">specification</span> <span class="string">for</span> <span class="string">an</span> <span class="string">IPAMConfig</span></span><br><span class="line">              <span class="string">resource.</span></span><br><span class="line">            <span class="attr">properties:</span></span><br><span class="line">              <span class="attr">autoAllocateBlocks:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">boolean</span></span><br><span class="line">              <span class="attr">maxBlocksPerHost:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">MaxBlocksPerHost,</span> <span class="string">if</span> <span class="string">non-zero,</span> <span class="string">is</span> <span class="string">the</span> <span class="string">max</span> <span class="string">number</span> <span class="string">of</span> <span class="string">blocks</span></span><br><span class="line">                  <span class="string">that</span> <span class="string">can</span> <span class="string">be</span> <span class="string">affine</span> <span class="string">to</span> <span class="string">each</span> <span class="string">host.</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">              <span class="attr">strictAffinity:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">boolean</span></span><br><span class="line">            <span class="attr">required:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">autoAllocateBlocks</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">strictAffinity</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">    <span class="attr">served:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">storage:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">status:</span></span><br><span class="line">  <span class="attr">acceptedNames:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">conditions:</span> []</span><br><span class="line">  <span class="attr">storedVersions:</span> []</span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apiextensions.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CustomResourceDefinition</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ipamhandles.crd.projectcalico.org</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">group:</span> <span class="string">crd.projectcalico.org</span></span><br><span class="line">  <span class="attr">names:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">IPAMHandle</span></span><br><span class="line">    <span class="attr">listKind:</span> <span class="string">IPAMHandleList</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">ipamhandles</span></span><br><span class="line">    <span class="attr">singular:</span> <span class="string">ipamhandle</span></span><br><span class="line">  <span class="attr">scope:</span> <span class="string">Cluster</span></span><br><span class="line">  <span class="attr">versions:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">v1</span></span><br><span class="line">    <span class="attr">schema:</span></span><br><span class="line">      <span class="attr">openAPIV3Schema:</span></span><br><span class="line">        <span class="attr">properties:</span></span><br><span class="line">          <span class="attr">apiVersion:</span></span><br><span class="line">            <span class="attr">description:</span> <span class="string">&#x27;APIVersion defines the versioned schema of this representation</span></span><br><span class="line"><span class="string">              of an object. Servers should convert recognized schemas to the latest</span></span><br><span class="line"><span class="string">              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources&#x27;</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">          <span class="attr">kind:</span></span><br><span class="line">            <span class="attr">description:</span> <span class="string">&#x27;Kind is a string value representing the REST resource this</span></span><br><span class="line"><span class="string">              object represents. Servers may infer this from the endpoint the client</span></span><br><span class="line"><span class="string">              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds&#x27;</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">          <span class="attr">metadata:</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">          <span class="attr">spec:</span></span><br><span class="line">            <span class="attr">description:</span> <span class="string">IPAMHandleSpec</span> <span class="string">contains</span> <span class="string">the</span> <span class="string">specification</span> <span class="string">for</span> <span class="string">an</span> <span class="string">IPAMHandle</span></span><br><span class="line">              <span class="string">resource.</span></span><br><span class="line">            <span class="attr">properties:</span></span><br><span class="line">              <span class="attr">block:</span></span><br><span class="line">                <span class="attr">additionalProperties:</span></span><br><span class="line">                  <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">              <span class="attr">deleted:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">boolean</span></span><br><span class="line">              <span class="attr">handleID:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">            <span class="attr">required:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">block</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">handleID</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">    <span class="attr">served:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">storage:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">status:</span></span><br><span class="line">  <span class="attr">acceptedNames:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">conditions:</span> []</span><br><span class="line">  <span class="attr">storedVersions:</span> []</span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apiextensions.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CustomResourceDefinition</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ippools.crd.projectcalico.org</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">group:</span> <span class="string">crd.projectcalico.org</span></span><br><span class="line">  <span class="attr">names:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">IPPool</span></span><br><span class="line">    <span class="attr">listKind:</span> <span class="string">IPPoolList</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">ippools</span></span><br><span class="line">    <span class="attr">singular:</span> <span class="string">ippool</span></span><br><span class="line">  <span class="attr">scope:</span> <span class="string">Cluster</span></span><br><span class="line">  <span class="attr">versions:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">v1</span></span><br><span class="line">    <span class="attr">schema:</span></span><br><span class="line">      <span class="attr">openAPIV3Schema:</span></span><br><span class="line">        <span class="attr">properties:</span></span><br><span class="line">          <span class="attr">apiVersion:</span></span><br><span class="line">            <span class="attr">description:</span> <span class="string">&#x27;APIVersion defines the versioned schema of this representation</span></span><br><span class="line"><span class="string">              of an object. Servers should convert recognized schemas to the latest</span></span><br><span class="line"><span class="string">              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources&#x27;</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">          <span class="attr">kind:</span></span><br><span class="line">            <span class="attr">description:</span> <span class="string">&#x27;Kind is a string value representing the REST resource this</span></span><br><span class="line"><span class="string">              object represents. Servers may infer this from the endpoint the client</span></span><br><span class="line"><span class="string">              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds&#x27;</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">          <span class="attr">metadata:</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">          <span class="attr">spec:</span></span><br><span class="line">            <span class="attr">description:</span> <span class="string">IPPoolSpec</span> <span class="string">contains</span> <span class="string">the</span> <span class="string">specification</span> <span class="string">for</span> <span class="string">an</span> <span class="string">IPPool</span> <span class="string">resource.</span></span><br><span class="line">            <span class="attr">properties:</span></span><br><span class="line">              <span class="attr">allowedUses:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">AllowedUse</span> <span class="string">controls</span> <span class="string">what</span> <span class="string">the</span> <span class="string">IP</span> <span class="string">pool</span> <span class="string">will</span> <span class="string">be</span> <span class="string">used</span> <span class="string">for.</span>  <span class="string">If</span></span><br><span class="line">                  <span class="string">not</span> <span class="string">specified</span> <span class="string">or</span> <span class="string">empty,</span> <span class="string">defaults</span> <span class="string">to</span> [<span class="string">&quot;Tunnel&quot;</span>, <span class="string">&quot;Workload&quot;</span>] <span class="string">for</span> <span class="string">back-compatibility</span></span><br><span class="line">                <span class="attr">items:</span></span><br><span class="line">                  <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">              <span class="attr">blockSize:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">The</span> <span class="string">block</span> <span class="string">size</span> <span class="string">to</span> <span class="string">use</span> <span class="string">for</span> <span class="string">IP</span> <span class="string">address</span> <span class="string">assignments</span> <span class="string">from</span></span><br><span class="line">                  <span class="string">this</span> <span class="string">pool.</span> <span class="string">Defaults</span> <span class="string">to</span> <span class="number">26</span> <span class="string">for</span> <span class="string">IPv4</span> <span class="string">and</span> <span class="number">112</span> <span class="string">for</span> <span class="string">IPv6.</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">              <span class="attr">cidr:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">The</span> <span class="string">pool</span> <span class="string">CIDR.</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">disabled:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">When</span> <span class="string">disabled</span> <span class="string">is</span> <span class="literal">true</span><span class="string">,</span> <span class="string">Calico</span> <span class="string">IPAM</span> <span class="string">will</span> <span class="string">not</span> <span class="string">assign</span> <span class="string">addresses</span></span><br><span class="line">                  <span class="string">from</span> <span class="string">this</span> <span class="string">pool.</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">boolean</span></span><br><span class="line">              <span class="attr">disableBGPExport:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&quot;Disable exporting routes from this IP Pool&#x27;s CIDR over</span></span><br><span class="line"><span class="string">                  BGP. [Default: false]&quot;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">boolean</span></span><br><span class="line">              <span class="attr">ipip:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;Deprecated: this field is only used for APIv1 backwards</span></span><br><span class="line"><span class="string">                  compatibility. Setting this field is not allowed, this field is</span></span><br><span class="line"><span class="string">                  for internal use only.&#x27;</span></span><br><span class="line">                <span class="attr">properties:</span></span><br><span class="line">                  <span class="attr">enabled:</span></span><br><span class="line">                    <span class="attr">description:</span> <span class="string">When</span> <span class="string">enabled</span> <span class="string">is</span> <span class="literal">true</span><span class="string">,</span> <span class="string">ipip</span> <span class="string">tunneling</span> <span class="string">will</span> <span class="string">be</span> <span class="string">used</span></span><br><span class="line">                      <span class="string">to</span> <span class="string">deliver</span> <span class="string">packets</span> <span class="string">to</span> <span class="string">destinations</span> <span class="string">within</span> <span class="string">this</span> <span class="string">pool.</span></span><br><span class="line">                    <span class="attr">type:</span> <span class="string">boolean</span></span><br><span class="line">                  <span class="attr">mode:</span></span><br><span class="line">                    <span class="attr">description:</span> <span class="string">The</span> <span class="string">IPIP</span> <span class="string">mode.</span>  <span class="string">This</span> <span class="string">can</span> <span class="string">be</span> <span class="string">one</span> <span class="string">of</span> <span class="string">&quot;always&quot;</span> <span class="string">or</span> <span class="string">&quot;cross-subnet&quot;</span><span class="string">.</span>  <span class="string">A</span></span><br><span class="line">                      <span class="string">mode</span> <span class="string">of</span> <span class="string">&quot;always&quot;</span> <span class="string">will</span> <span class="string">also</span> <span class="string">use</span> <span class="string">IPIP</span> <span class="string">tunneling</span> <span class="string">for</span> <span class="string">routing</span> <span class="string">to</span></span><br><span class="line">                      <span class="string">destination</span> <span class="string">IP</span> <span class="string">addresses</span> <span class="string">within</span> <span class="string">this</span> <span class="string">pool.</span>  <span class="string">A</span> <span class="string">mode</span> <span class="string">of</span> <span class="string">&quot;cross-subnet&quot;</span></span><br><span class="line">                      <span class="string">will</span> <span class="string">only</span> <span class="string">use</span> <span class="string">IPIP</span> <span class="string">tunneling</span> <span class="string">when</span> <span class="string">the</span> <span class="string">destination</span> <span class="string">node</span> <span class="string">is</span> <span class="string">on</span></span><br><span class="line">                      <span class="string">a</span> <span class="string">different</span> <span class="string">subnet</span> <span class="string">to</span> <span class="string">the</span> <span class="string">originating</span> <span class="string">node.</span>  <span class="string">The</span> <span class="string">default</span> <span class="string">value</span></span><br><span class="line">                      <span class="string">(if</span> <span class="string">not</span> <span class="string">specified)</span> <span class="string">is</span> <span class="string">&quot;always&quot;</span><span class="string">.</span></span><br><span class="line">                    <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">              <span class="attr">ipipMode:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">Contains</span> <span class="string">configuration</span> <span class="string">for</span> <span class="string">IPIP</span> <span class="string">tunneling</span> <span class="string">for</span> <span class="string">this</span> <span class="string">pool.</span></span><br><span class="line">                  <span class="string">If</span> <span class="string">not</span> <span class="string">specified,</span> <span class="string">then</span> <span class="string">this</span> <span class="string">is</span> <span class="string">defaulted</span> <span class="string">to</span> <span class="string">&quot;Never&quot;</span> <span class="string">(i.e.</span> <span class="string">IPIP</span> <span class="string">tunneling</span></span><br><span class="line">                  <span class="string">is</span> <span class="string">disabled).</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">nat-outgoing:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;Deprecated: this field is only used for APIv1 backwards</span></span><br><span class="line"><span class="string">                  compatibility. Setting this field is not allowed, this field is</span></span><br><span class="line"><span class="string">                  for internal use only.&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">boolean</span></span><br><span class="line">              <span class="attr">natOutgoing:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">When</span> <span class="string">nat-outgoing</span> <span class="string">is</span> <span class="literal">true</span><span class="string">,</span> <span class="string">packets</span> <span class="string">sent</span> <span class="string">from</span> <span class="string">Calico</span> <span class="string">networked</span></span><br><span class="line">                  <span class="string">containers</span> <span class="string">in</span> <span class="string">this</span> <span class="string">pool</span> <span class="string">to</span> <span class="string">destinations</span> <span class="string">outside</span> <span class="string">of</span> <span class="string">this</span> <span class="string">pool</span> <span class="string">will</span></span><br><span class="line">                  <span class="string">be</span> <span class="string">masqueraded.</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">boolean</span></span><br><span class="line">              <span class="attr">nodeSelector:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">Allows</span> <span class="string">IPPool</span> <span class="string">to</span> <span class="string">allocate</span> <span class="string">for</span> <span class="string">a</span> <span class="string">specific</span> <span class="string">node</span> <span class="string">by</span> <span class="string">label</span></span><br><span class="line">                  <span class="string">selector.</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">vxlanMode:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">Contains</span> <span class="string">configuration</span> <span class="string">for</span> <span class="string">VXLAN</span> <span class="string">tunneling</span> <span class="string">for</span> <span class="string">this</span> <span class="string">pool.</span></span><br><span class="line">                  <span class="string">If</span> <span class="string">not</span> <span class="string">specified,</span> <span class="string">then</span> <span class="string">this</span> <span class="string">is</span> <span class="string">defaulted</span> <span class="string">to</span> <span class="string">&quot;Never&quot;</span> <span class="string">(i.e.</span> <span class="string">VXLAN</span></span><br><span class="line">                  <span class="string">tunneling</span> <span class="string">is</span> <span class="string">disabled).</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">            <span class="attr">required:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">cidr</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">    <span class="attr">served:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">storage:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">status:</span></span><br><span class="line">  <span class="attr">acceptedNames:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">conditions:</span> []</span><br><span class="line">  <span class="attr">storedVersions:</span> []</span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apiextensions.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CustomResourceDefinition</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ipreservations.crd.projectcalico.org</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">group:</span> <span class="string">crd.projectcalico.org</span></span><br><span class="line">  <span class="attr">names:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">IPReservation</span></span><br><span class="line">    <span class="attr">listKind:</span> <span class="string">IPReservationList</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">ipreservations</span></span><br><span class="line">    <span class="attr">singular:</span> <span class="string">ipreservation</span></span><br><span class="line">  <span class="attr">scope:</span> <span class="string">Cluster</span></span><br><span class="line">  <span class="attr">versions:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">v1</span></span><br><span class="line">    <span class="attr">schema:</span></span><br><span class="line">      <span class="attr">openAPIV3Schema:</span></span><br><span class="line">        <span class="attr">properties:</span></span><br><span class="line">          <span class="attr">apiVersion:</span></span><br><span class="line">            <span class="attr">description:</span> <span class="string">&#x27;APIVersion defines the versioned schema of this representation</span></span><br><span class="line"><span class="string">              of an object. Servers should convert recognized schemas to the latest</span></span><br><span class="line"><span class="string">              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources&#x27;</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">          <span class="attr">kind:</span></span><br><span class="line">            <span class="attr">description:</span> <span class="string">&#x27;Kind is a string value representing the REST resource this</span></span><br><span class="line"><span class="string">              object represents. Servers may infer this from the endpoint the client</span></span><br><span class="line"><span class="string">              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds&#x27;</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">          <span class="attr">metadata:</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">          <span class="attr">spec:</span></span><br><span class="line">            <span class="attr">description:</span> <span class="string">IPReservationSpec</span> <span class="string">contains</span> <span class="string">the</span> <span class="string">specification</span> <span class="string">for</span> <span class="string">an</span> <span class="string">IPReservation</span></span><br><span class="line">              <span class="string">resource.</span></span><br><span class="line">            <span class="attr">properties:</span></span><br><span class="line">              <span class="attr">reservedCIDRs:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">ReservedCIDRs</span> <span class="string">is</span> <span class="string">a</span> <span class="string">list</span> <span class="string">of</span> <span class="string">CIDRs</span> <span class="string">and/or</span> <span class="string">IP</span> <span class="string">addresses</span></span><br><span class="line">                  <span class="string">that</span> <span class="string">Calico</span> <span class="string">IPAM</span> <span class="string">will</span> <span class="string">exclude</span> <span class="string">from</span> <span class="string">new</span> <span class="string">allocations.</span></span><br><span class="line">                <span class="attr">items:</span></span><br><span class="line">                  <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">    <span class="attr">served:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">storage:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">status:</span></span><br><span class="line">  <span class="attr">acceptedNames:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">conditions:</span> []</span><br><span class="line">  <span class="attr">storedVersions:</span> []</span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apiextensions.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CustomResourceDefinition</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kubecontrollersconfigurations.crd.projectcalico.org</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">group:</span> <span class="string">crd.projectcalico.org</span></span><br><span class="line">  <span class="attr">names:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">KubeControllersConfiguration</span></span><br><span class="line">    <span class="attr">listKind:</span> <span class="string">KubeControllersConfigurationList</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">kubecontrollersconfigurations</span></span><br><span class="line">    <span class="attr">singular:</span> <span class="string">kubecontrollersconfiguration</span></span><br><span class="line">  <span class="attr">scope:</span> <span class="string">Cluster</span></span><br><span class="line">  <span class="attr">versions:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">v1</span></span><br><span class="line">    <span class="attr">schema:</span></span><br><span class="line">      <span class="attr">openAPIV3Schema:</span></span><br><span class="line">        <span class="attr">properties:</span></span><br><span class="line">          <span class="attr">apiVersion:</span></span><br><span class="line">            <span class="attr">description:</span> <span class="string">&#x27;APIVersion defines the versioned schema of this representation</span></span><br><span class="line"><span class="string">              of an object. Servers should convert recognized schemas to the latest</span></span><br><span class="line"><span class="string">              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources&#x27;</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">          <span class="attr">kind:</span></span><br><span class="line">            <span class="attr">description:</span> <span class="string">&#x27;Kind is a string value representing the REST resource this</span></span><br><span class="line"><span class="string">              object represents. Servers may infer this from the endpoint the client</span></span><br><span class="line"><span class="string">              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds&#x27;</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">          <span class="attr">metadata:</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">          <span class="attr">spec:</span></span><br><span class="line">            <span class="attr">description:</span> <span class="string">KubeControllersConfigurationSpec</span> <span class="string">contains</span> <span class="string">the</span> <span class="string">values</span> <span class="string">of</span> <span class="string">the</span></span><br><span class="line">              <span class="string">Kubernetes</span> <span class="string">controllers</span> <span class="string">configuration.</span></span><br><span class="line">            <span class="attr">properties:</span></span><br><span class="line">              <span class="attr">controllers:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">Controllers</span> <span class="string">enables</span> <span class="string">and</span> <span class="string">configures</span> <span class="string">individual</span> <span class="string">Kubernetes</span></span><br><span class="line">                  <span class="string">controllers</span></span><br><span class="line">                <span class="attr">properties:</span></span><br><span class="line">                  <span class="attr">namespace:</span></span><br><span class="line">                    <span class="attr">description:</span> <span class="string">Namespace</span> <span class="string">enables</span> <span class="string">and</span> <span class="string">configures</span> <span class="string">the</span> <span class="string">namespace</span> <span class="string">controller.</span></span><br><span class="line">                      <span class="string">Enabled</span> <span class="string">by</span> <span class="string">default,</span> <span class="string">set</span> <span class="string">to</span> <span class="string">nil</span> <span class="string">to</span> <span class="string">disable.</span></span><br><span class="line">                    <span class="attr">properties:</span></span><br><span class="line">                      <span class="attr">reconcilerPeriod:</span></span><br><span class="line">                        <span class="attr">description:</span> <span class="string">&#x27;ReconcilerPeriod is the period to perform reconciliation</span></span><br><span class="line"><span class="string">                          with the Calico datastore. [Default: 5m]&#x27;</span></span><br><span class="line">                        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                    <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                  <span class="attr">node:</span></span><br><span class="line">                    <span class="attr">description:</span> <span class="string">Node</span> <span class="string">enables</span> <span class="string">and</span> <span class="string">configures</span> <span class="string">the</span> <span class="string">node</span> <span class="string">controller.</span></span><br><span class="line">                      <span class="string">Enabled</span> <span class="string">by</span> <span class="string">default,</span> <span class="string">set</span> <span class="string">to</span> <span class="string">nil</span> <span class="string">to</span> <span class="string">disable.</span></span><br><span class="line">                    <span class="attr">properties:</span></span><br><span class="line">                      <span class="attr">hostEndpoint:</span></span><br><span class="line">                        <span class="attr">description:</span> <span class="string">HostEndpoint</span> <span class="string">controls</span> <span class="string">syncing</span> <span class="string">nodes</span> <span class="string">to</span> <span class="string">host</span> <span class="string">endpoints.</span></span><br><span class="line">                          <span class="string">Disabled</span> <span class="string">by</span> <span class="string">default,</span> <span class="string">set</span> <span class="string">to</span> <span class="string">nil</span> <span class="string">to</span> <span class="string">disable.</span></span><br><span class="line">                        <span class="attr">properties:</span></span><br><span class="line">                          <span class="attr">autoCreate:</span></span><br><span class="line">                            <span class="attr">description:</span> <span class="string">&#x27;AutoCreate enables automatic creation of</span></span><br><span class="line"><span class="string">                              host endpoints for every node. [Default: Disabled]&#x27;</span></span><br><span class="line">                            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                        <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                      <span class="attr">leakGracePeriod:</span></span><br><span class="line">                        <span class="attr">description:</span> <span class="string">&#x27;LeakGracePeriod is the period used by the controller</span></span><br><span class="line"><span class="string">                          to determine if an IP address has been leaked. Set to 0</span></span><br><span class="line"><span class="string">                          to disable IP garbage collection. [Default: 15m]&#x27;</span></span><br><span class="line">                        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                      <span class="attr">reconcilerPeriod:</span></span><br><span class="line">                        <span class="attr">description:</span> <span class="string">&#x27;ReconcilerPeriod is the period to perform reconciliation</span></span><br><span class="line"><span class="string">                          with the Calico datastore. [Default: 5m]&#x27;</span></span><br><span class="line">                        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                      <span class="attr">syncLabels:</span></span><br><span class="line">                        <span class="attr">description:</span> <span class="string">&#x27;SyncLabels controls whether to copy Kubernetes</span></span><br><span class="line"><span class="string">                          node labels to Calico nodes. [Default: Enabled]&#x27;</span></span><br><span class="line">                        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                    <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                  <span class="attr">policy:</span></span><br><span class="line">                    <span class="attr">description:</span> <span class="string">Policy</span> <span class="string">enables</span> <span class="string">and</span> <span class="string">configures</span> <span class="string">the</span> <span class="string">policy</span> <span class="string">controller.</span></span><br><span class="line">                      <span class="string">Enabled</span> <span class="string">by</span> <span class="string">default,</span> <span class="string">set</span> <span class="string">to</span> <span class="string">nil</span> <span class="string">to</span> <span class="string">disable.</span></span><br><span class="line">                    <span class="attr">properties:</span></span><br><span class="line">                      <span class="attr">reconcilerPeriod:</span></span><br><span class="line">                        <span class="attr">description:</span> <span class="string">&#x27;ReconcilerPeriod is the period to perform reconciliation</span></span><br><span class="line"><span class="string">                          with the Calico datastore. [Default: 5m]&#x27;</span></span><br><span class="line">                        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                    <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                  <span class="attr">serviceAccount:</span></span><br><span class="line">                    <span class="attr">description:</span> <span class="string">ServiceAccount</span> <span class="string">enables</span> <span class="string">and</span> <span class="string">configures</span> <span class="string">the</span> <span class="string">service</span></span><br><span class="line">                      <span class="string">account</span> <span class="string">controller.</span> <span class="string">Enabled</span> <span class="string">by</span> <span class="string">default,</span> <span class="string">set</span> <span class="string">to</span> <span class="string">nil</span> <span class="string">to</span> <span class="string">disable.</span></span><br><span class="line">                    <span class="attr">properties:</span></span><br><span class="line">                      <span class="attr">reconcilerPeriod:</span></span><br><span class="line">                        <span class="attr">description:</span> <span class="string">&#x27;ReconcilerPeriod is the period to perform reconciliation</span></span><br><span class="line"><span class="string">                          with the Calico datastore. [Default: 5m]&#x27;</span></span><br><span class="line">                        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                    <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                  <span class="attr">workloadEndpoint:</span></span><br><span class="line">                    <span class="attr">description:</span> <span class="string">WorkloadEndpoint</span> <span class="string">enables</span> <span class="string">and</span> <span class="string">configures</span> <span class="string">the</span> <span class="string">workload</span></span><br><span class="line">                      <span class="string">endpoint</span> <span class="string">controller.</span> <span class="string">Enabled</span> <span class="string">by</span> <span class="string">default,</span> <span class="string">set</span> <span class="string">to</span> <span class="string">nil</span> <span class="string">to</span> <span class="string">disable.</span></span><br><span class="line">                    <span class="attr">properties:</span></span><br><span class="line">                      <span class="attr">reconcilerPeriod:</span></span><br><span class="line">                        <span class="attr">description:</span> <span class="string">&#x27;ReconcilerPeriod is the period to perform reconciliation</span></span><br><span class="line"><span class="string">                          with the Calico datastore. [Default: 5m]&#x27;</span></span><br><span class="line">                        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                    <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">              <span class="attr">etcdV3CompactionPeriod:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;EtcdV3CompactionPeriod is the period between etcdv3</span></span><br><span class="line"><span class="string">                  compaction requests. Set to 0 to disable. [Default: 10m]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">healthChecks:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;HealthChecks enables or disables support for health</span></span><br><span class="line"><span class="string">                  checks [Default: Enabled]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">logSeverityScreen:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;LogSeverityScreen is the log severity above which logs</span></span><br><span class="line"><span class="string">                  are sent to the stdout. [Default: Info]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">prometheusMetricsPort:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&#x27;PrometheusMetricsPort is the TCP port that the Prometheus</span></span><br><span class="line"><span class="string">                  metrics server should bind to. Set to 0 to disable. [Default: 9094]&#x27;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">            <span class="attr">required:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">controllers</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">          <span class="attr">status:</span></span><br><span class="line">            <span class="attr">description:</span> <span class="string">KubeControllersConfigurationStatus</span> <span class="string">represents</span> <span class="string">the</span> <span class="string">status</span></span><br><span class="line">              <span class="string">of</span> <span class="string">the</span> <span class="string">configuration.</span> <span class="string">It&#x27;s</span> <span class="string">useful</span> <span class="string">for</span> <span class="string">admins</span> <span class="string">to</span> <span class="string">be</span> <span class="string">able</span> <span class="string">to</span> <span class="string">see</span> <span class="string">the</span> <span class="string">actual</span></span><br><span class="line">              <span class="string">config</span> <span class="string">that</span> <span class="string">was</span> <span class="string">applied,</span> <span class="string">which</span> <span class="string">can</span> <span class="string">be</span> <span class="string">modified</span> <span class="string">by</span> <span class="string">environment</span> <span class="string">variables</span></span><br><span class="line">              <span class="string">on</span> <span class="string">the</span> <span class="string">kube-controllers</span> <span class="string">process.</span></span><br><span class="line">            <span class="attr">properties:</span></span><br><span class="line">              <span class="attr">environmentVars:</span></span><br><span class="line">                <span class="attr">additionalProperties:</span></span><br><span class="line">                  <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">EnvironmentVars</span> <span class="string">contains</span> <span class="string">the</span> <span class="string">environment</span> <span class="string">variables</span> <span class="string">on</span></span><br><span class="line">                  <span class="string">the</span> <span class="string">kube-controllers</span> <span class="string">that</span> <span class="string">influenced</span> <span class="string">the</span> <span class="string">RunningConfig.</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">              <span class="attr">runningConfig:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">RunningConfig</span> <span class="string">contains</span> <span class="string">the</span> <span class="string">effective</span> <span class="string">config</span> <span class="string">that</span> <span class="string">is</span> <span class="string">running</span></span><br><span class="line">                  <span class="string">in</span> <span class="string">the</span> <span class="string">kube-controllers</span> <span class="string">pod,</span> <span class="string">after</span> <span class="string">merging</span> <span class="string">the</span> <span class="string">API</span> <span class="string">resource</span> <span class="string">with</span></span><br><span class="line">                  <span class="string">any</span> <span class="string">environment</span> <span class="string">variables.</span></span><br><span class="line">                <span class="attr">properties:</span></span><br><span class="line">                  <span class="attr">controllers:</span></span><br><span class="line">                    <span class="attr">description:</span> <span class="string">Controllers</span> <span class="string">enables</span> <span class="string">and</span> <span class="string">configures</span> <span class="string">individual</span> <span class="string">Kubernetes</span></span><br><span class="line">                      <span class="string">controllers</span></span><br><span class="line">                    <span class="attr">properties:</span></span><br><span class="line">                      <span class="attr">namespace:</span></span><br><span class="line">                        <span class="attr">description:</span> <span class="string">Namespace</span> <span class="string">enables</span> <span class="string">and</span> <span class="string">configures</span> <span class="string">the</span> <span class="string">namespace</span></span><br><span class="line">                          <span class="string">controller.</span> <span class="string">Enabled</span> <span class="string">by</span> <span class="string">default,</span> <span class="string">set</span> <span class="string">to</span> <span class="string">nil</span> <span class="string">to</span> <span class="string">disable.</span></span><br><span class="line">                        <span class="attr">properties:</span></span><br><span class="line">                          <span class="attr">reconcilerPeriod:</span></span><br><span class="line">                            <span class="attr">description:</span> <span class="string">&#x27;ReconcilerPeriod is the period to perform</span></span><br><span class="line"><span class="string">                              reconciliation with the Calico datastore. [Default:</span></span><br><span class="line"><span class="string">                              5m]&#x27;</span></span><br><span class="line">                            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                        <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                      <span class="attr">node:</span></span><br><span class="line">                        <span class="attr">description:</span> <span class="string">Node</span> <span class="string">enables</span> <span class="string">and</span> <span class="string">configures</span> <span class="string">the</span> <span class="string">node</span> <span class="string">controller.</span></span><br><span class="line">                          <span class="string">Enabled</span> <span class="string">by</span> <span class="string">default,</span> <span class="string">set</span> <span class="string">to</span> <span class="string">nil</span> <span class="string">to</span> <span class="string">disable.</span></span><br><span class="line">                        <span class="attr">properties:</span></span><br><span class="line">                          <span class="attr">hostEndpoint:</span></span><br><span class="line">                            <span class="attr">description:</span> <span class="string">HostEndpoint</span> <span class="string">controls</span> <span class="string">syncing</span> <span class="string">nodes</span> <span class="string">to</span> <span class="string">host</span></span><br><span class="line">                              <span class="string">endpoints.</span> <span class="string">Disabled</span> <span class="string">by</span> <span class="string">default,</span> <span class="string">set</span> <span class="string">to</span> <span class="string">nil</span> <span class="string">to</span> <span class="string">disable.</span></span><br><span class="line">                            <span class="attr">properties:</span></span><br><span class="line">                              <span class="attr">autoCreate:</span></span><br><span class="line">                                <span class="attr">description:</span> <span class="string">&#x27;AutoCreate enables automatic creation</span></span><br><span class="line"><span class="string">                                  of host endpoints for every node. [Default: Disabled]&#x27;</span></span><br><span class="line">                                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                            <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                          <span class="attr">leakGracePeriod:</span></span><br><span class="line">                            <span class="attr">description:</span> <span class="string">&#x27;LeakGracePeriod is the period used by the</span></span><br><span class="line"><span class="string">                              controller to determine if an IP address has been leaked.</span></span><br><span class="line"><span class="string">                              Set to 0 to disable IP garbage collection. [Default:</span></span><br><span class="line"><span class="string">                              15m]&#x27;</span></span><br><span class="line">                            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                          <span class="attr">reconcilerPeriod:</span></span><br><span class="line">                            <span class="attr">description:</span> <span class="string">&#x27;ReconcilerPeriod is the period to perform</span></span><br><span class="line"><span class="string">                              reconciliation with the Calico datastore. [Default:</span></span><br><span class="line"><span class="string">                              5m]&#x27;</span></span><br><span class="line">                            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                          <span class="attr">syncLabels:</span></span><br><span class="line">                            <span class="attr">description:</span> <span class="string">&#x27;SyncLabels controls whether to copy Kubernetes</span></span><br><span class="line"><span class="string">                              node labels to Calico nodes. [Default: Enabled]&#x27;</span></span><br><span class="line">                            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                        <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                      <span class="attr">policy:</span></span><br><span class="line">                        <span class="attr">description:</span> <span class="string">Policy</span> <span class="string">enables</span> <span class="string">and</span> <span class="string">configures</span> <span class="string">the</span> <span class="string">policy</span> <span class="string">controller.</span></span><br><span class="line">                          <span class="string">Enabled</span> <span class="string">by</span> <span class="string">default,</span> <span class="string">set</span> <span class="string">to</span> <span class="string">nil</span> <span class="string">to</span> <span class="string">disable.</span></span><br><span class="line">                        <span class="attr">properties:</span></span><br><span class="line">                          <span class="attr">reconcilerPeriod:</span></span><br><span class="line">                            <span class="attr">description:</span> <span class="string">&#x27;ReconcilerPeriod is the period to perform</span></span><br><span class="line"><span class="string">                              reconciliation with the Calico datastore. [Default:</span></span><br><span class="line"><span class="string">                              5m]&#x27;</span></span><br><span class="line">                            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                        <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                      <span class="attr">serviceAccount:</span></span><br><span class="line">                        <span class="attr">description:</span> <span class="string">ServiceAccount</span> <span class="string">enables</span> <span class="string">and</span> <span class="string">configures</span> <span class="string">the</span> <span class="string">service</span></span><br><span class="line">                          <span class="string">account</span> <span class="string">controller.</span> <span class="string">Enabled</span> <span class="string">by</span> <span class="string">default,</span> <span class="string">set</span> <span class="string">to</span> <span class="string">nil</span> <span class="string">to</span> <span class="string">disable.</span></span><br><span class="line">                        <span class="attr">properties:</span></span><br><span class="line">                          <span class="attr">reconcilerPeriod:</span></span><br><span class="line">                            <span class="attr">description:</span> <span class="string">&#x27;ReconcilerPeriod is the period to perform</span></span><br><span class="line"><span class="string">                              reconciliation with the Calico datastore. [Default:</span></span><br><span class="line"><span class="string">                              5m]&#x27;</span></span><br><span class="line">                            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                        <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                      <span class="attr">workloadEndpoint:</span></span><br><span class="line">                        <span class="attr">description:</span> <span class="string">WorkloadEndpoint</span> <span class="string">enables</span> <span class="string">and</span> <span class="string">configures</span> <span class="string">the</span> <span class="string">workload</span></span><br><span class="line">                          <span class="string">endpoint</span> <span class="string">controller.</span> <span class="string">Enabled</span> <span class="string">by</span> <span class="string">default,</span> <span class="string">set</span> <span class="string">to</span> <span class="string">nil</span> <span class="string">to</span> <span class="string">disable.</span></span><br><span class="line">                        <span class="attr">properties:</span></span><br><span class="line">                          <span class="attr">reconcilerPeriod:</span></span><br><span class="line">                            <span class="attr">description:</span> <span class="string">&#x27;ReconcilerPeriod is the period to perform</span></span><br><span class="line"><span class="string">                              reconciliation with the Calico datastore. [Default:</span></span><br><span class="line"><span class="string">                              5m]&#x27;</span></span><br><span class="line">                            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                        <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                    <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                  <span class="attr">etcdV3CompactionPeriod:</span></span><br><span class="line">                    <span class="attr">description:</span> <span class="string">&#x27;EtcdV3CompactionPeriod is the period between etcdv3</span></span><br><span class="line"><span class="string">                      compaction requests. Set to 0 to disable. [Default: 10m]&#x27;</span></span><br><span class="line">                    <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                  <span class="attr">healthChecks:</span></span><br><span class="line">                    <span class="attr">description:</span> <span class="string">&#x27;HealthChecks enables or disables support for health</span></span><br><span class="line"><span class="string">                      checks [Default: Enabled]&#x27;</span></span><br><span class="line">                    <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                  <span class="attr">logSeverityScreen:</span></span><br><span class="line">                    <span class="attr">description:</span> <span class="string">&#x27;LogSeverityScreen is the log severity above which</span></span><br><span class="line"><span class="string">                      logs are sent to the stdout. [Default: Info]&#x27;</span></span><br><span class="line">                    <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                  <span class="attr">prometheusMetricsPort:</span></span><br><span class="line">                    <span class="attr">description:</span> <span class="string">&#x27;PrometheusMetricsPort is the TCP port that the Prometheus</span></span><br><span class="line"><span class="string">                      metrics server should bind to. Set to 0 to disable. [Default:</span></span><br><span class="line"><span class="string">                      9094]&#x27;</span></span><br><span class="line">                    <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                <span class="attr">required:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">controllers</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">    <span class="attr">served:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">storage:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">status:</span></span><br><span class="line">  <span class="attr">acceptedNames:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">conditions:</span> []</span><br><span class="line">  <span class="attr">storedVersions:</span> []</span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apiextensions.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CustomResourceDefinition</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">networkpolicies.crd.projectcalico.org</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">group:</span> <span class="string">crd.projectcalico.org</span></span><br><span class="line">  <span class="attr">names:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">NetworkPolicy</span></span><br><span class="line">    <span class="attr">listKind:</span> <span class="string">NetworkPolicyList</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">networkpolicies</span></span><br><span class="line">    <span class="attr">singular:</span> <span class="string">networkpolicy</span></span><br><span class="line">  <span class="attr">scope:</span> <span class="string">Namespaced</span></span><br><span class="line">  <span class="attr">versions:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">v1</span></span><br><span class="line">    <span class="attr">schema:</span></span><br><span class="line">      <span class="attr">openAPIV3Schema:</span></span><br><span class="line">        <span class="attr">properties:</span></span><br><span class="line">          <span class="attr">apiVersion:</span></span><br><span class="line">            <span class="attr">description:</span> <span class="string">&#x27;APIVersion defines the versioned schema of this representation</span></span><br><span class="line"><span class="string">              of an object. Servers should convert recognized schemas to the latest</span></span><br><span class="line"><span class="string">              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources&#x27;</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">          <span class="attr">kind:</span></span><br><span class="line">            <span class="attr">description:</span> <span class="string">&#x27;Kind is a string value representing the REST resource this</span></span><br><span class="line"><span class="string">              object represents. Servers may infer this from the endpoint the client</span></span><br><span class="line"><span class="string">              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds&#x27;</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">          <span class="attr">metadata:</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">          <span class="attr">spec:</span></span><br><span class="line">            <span class="attr">properties:</span></span><br><span class="line">              <span class="attr">egress:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">The</span> <span class="string">ordered</span> <span class="string">set</span> <span class="string">of</span> <span class="string">egress</span> <span class="string">rules.</span>  <span class="string">Each</span> <span class="string">rule</span> <span class="string">contains</span></span><br><span class="line">                  <span class="string">a</span> <span class="string">set</span> <span class="string">of</span> <span class="string">packet</span> <span class="string">match</span> <span class="string">criteria</span> <span class="string">and</span> <span class="string">a</span> <span class="string">corresponding</span> <span class="string">action</span> <span class="string">to</span> <span class="string">apply.</span></span><br><span class="line">                <span class="attr">items:</span></span><br><span class="line">                  <span class="attr">description:</span> <span class="string">&quot;A Rule encapsulates a set of match criteria and an</span></span><br><span class="line"><span class="string">                    action.  Both selector-based security Policy and security Profiles</span></span><br><span class="line"><span class="string">                    reference rules - separated out as a list of rules for both ingress</span></span><br><span class="line"><span class="string">                    and egress packet matching. \n Each positive match criteria has</span></span><br><span class="line"><span class="string">                    a negated version, prefixed with \&quot;Not\&quot;. All the match criteria</span></span><br><span class="line"><span class="string">                    within a rule must be satisfied for a packet to match. A single</span></span><br><span class="line"><span class="string">                    rule can contain the positive and negative version of a match</span></span><br><span class="line"><span class="string">                    and both must be satisfied for the rule to match.&quot;</span></span><br><span class="line">                  <span class="attr">properties:</span></span><br><span class="line">                    <span class="attr">action:</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                    <span class="attr">destination:</span></span><br><span class="line">                      <span class="attr">description:</span> <span class="string">Destination</span> <span class="string">contains</span> <span class="string">the</span> <span class="string">match</span> <span class="string">criteria</span> <span class="string">that</span> <span class="string">apply</span></span><br><span class="line">                        <span class="string">to</span> <span class="string">destination</span> <span class="string">entity.</span></span><br><span class="line">                      <span class="attr">properties:</span></span><br><span class="line">                        <span class="attr">namespaceSelector:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">&quot;NamespaceSelector is an optional field that</span></span><br><span class="line"><span class="string">                            contains a selector expression. Only traffic that originates</span></span><br><span class="line"><span class="string">                            from (or terminates at) endpoints within the selected</span></span><br><span class="line"><span class="string">                            namespaces will be matched. When both NamespaceSelector</span></span><br><span class="line"><span class="string">                            and another selector are defined on the same rule, then</span></span><br><span class="line"><span class="string">                            only workload endpoints that are matched by both selectors</span></span><br><span class="line"><span class="string">                            will be selected by the rule. \n For NetworkPolicy, an</span></span><br><span class="line"><span class="string">                            empty NamespaceSelector implies that the Selector is limited</span></span><br><span class="line"><span class="string">                            to selecting only workload endpoints in the same namespace</span></span><br><span class="line"><span class="string">                            as the NetworkPolicy. \n For NetworkPolicy, `global()`</span></span><br><span class="line"><span class="string">                            NamespaceSelector implies that the Selector is limited</span></span><br><span class="line"><span class="string">                            to selecting only GlobalNetworkSet or HostEndpoint. \n</span></span><br><span class="line"><span class="string">                            For GlobalNetworkPolicy, an empty NamespaceSelector implies</span></span><br><span class="line"><span class="string">                            the Selector applies to workload endpoints across all</span></span><br><span class="line"><span class="string">                            namespaces.&quot;</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                        <span class="attr">nets:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">Nets</span> <span class="string">is</span> <span class="string">an</span> <span class="string">optional</span> <span class="string">field</span> <span class="string">that</span> <span class="string">restricts</span> <span class="string">the</span></span><br><span class="line">                            <span class="string">rule</span> <span class="string">to</span> <span class="string">only</span> <span class="string">apply</span> <span class="string">to</span> <span class="string">traffic</span> <span class="string">that</span> <span class="string">originates</span> <span class="string">from</span> <span class="string">(or</span></span><br><span class="line">                            <span class="string">terminates</span> <span class="string">at)</span> <span class="string">IP</span> <span class="string">addresses</span> <span class="string">in</span> <span class="string">any</span> <span class="string">of</span> <span class="string">the</span> <span class="string">given</span> <span class="string">subnets.</span></span><br><span class="line">                          <span class="attr">items:</span></span><br><span class="line">                            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                        <span class="attr">notNets:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">NotNets</span> <span class="string">is</span> <span class="string">the</span> <span class="string">negated</span> <span class="string">version</span> <span class="string">of</span> <span class="string">the</span> <span class="string">Nets</span></span><br><span class="line">                            <span class="string">field.</span></span><br><span class="line">                          <span class="attr">items:</span></span><br><span class="line">                            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                        <span class="attr">notPorts:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">NotPorts</span> <span class="string">is</span> <span class="string">the</span> <span class="string">negated</span> <span class="string">version</span> <span class="string">of</span> <span class="string">the</span> <span class="string">Ports</span></span><br><span class="line">                            <span class="string">field.</span> <span class="string">Since</span> <span class="string">only</span> <span class="string">some</span> <span class="string">protocols</span> <span class="string">have</span> <span class="string">ports,</span> <span class="string">if</span> <span class="string">any</span> <span class="string">ports</span></span><br><span class="line">                            <span class="string">are</span> <span class="string">specified</span> <span class="string">it</span> <span class="string">requires</span> <span class="string">the</span> <span class="string">Protocol</span> <span class="string">match</span> <span class="string">in</span> <span class="string">the</span> <span class="string">Rule</span></span><br><span class="line">                            <span class="string">to</span> <span class="string">be</span> <span class="string">set</span> <span class="string">to</span> <span class="string">&quot;TCP&quot;</span> <span class="string">or</span> <span class="string">&quot;UDP&quot;</span><span class="string">.</span></span><br><span class="line">                          <span class="attr">items:</span></span><br><span class="line">                            <span class="attr">anyOf:</span></span><br><span class="line">                            <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                            <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                            <span class="attr">pattern:</span> <span class="string">^.*</span></span><br><span class="line">                            <span class="attr">x-kubernetes-int-or-string:</span> <span class="literal">true</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                        <span class="attr">notSelector:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">NotSelector</span> <span class="string">is</span> <span class="string">the</span> <span class="string">negated</span> <span class="string">version</span> <span class="string">of</span> <span class="string">the</span> <span class="string">Selector</span></span><br><span class="line">                            <span class="string">field.</span>  <span class="string">See</span> <span class="string">Selector</span> <span class="string">field</span> <span class="string">for</span> <span class="string">subtleties</span> <span class="string">with</span> <span class="string">negated</span></span><br><span class="line">                            <span class="string">selectors.</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                        <span class="attr">ports:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">&quot;Ports is an optional field that restricts</span></span><br><span class="line"><span class="string">                            the rule to only apply to traffic that has a source (destination)</span></span><br><span class="line"><span class="string">                            port that matches one of these ranges/values. This value</span></span><br><span class="line"><span class="string">                            is a list of integers or strings that represent ranges</span></span><br><span class="line"><span class="string">                            of ports. \n Since only some protocols have ports, if</span></span><br><span class="line"><span class="string">                            any ports are specified it requires the Protocol match</span></span><br><span class="line"><span class="string">                            in the Rule to be set to \&quot;TCP\&quot; or \&quot;UDP\&quot;.&quot;</span></span><br><span class="line">                          <span class="attr">items:</span></span><br><span class="line">                            <span class="attr">anyOf:</span></span><br><span class="line">                            <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                            <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                            <span class="attr">pattern:</span> <span class="string">^.*</span></span><br><span class="line">                            <span class="attr">x-kubernetes-int-or-string:</span> <span class="literal">true</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                        <span class="attr">selector:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">&quot;Selector is an optional field that contains</span></span><br><span class="line"><span class="string">                            a selector expression (see Policy for sample syntax).</span></span><br><span class="line"><span class="string">                            \ Only traffic that originates from (terminates at) endpoints</span></span><br><span class="line"><span class="string">                            matching the selector will be matched. \n Note that: in</span></span><br><span class="line"><span class="string">                            addition to the negated version of the Selector (see NotSelector</span></span><br><span class="line"><span class="string">                            below), the selector expression syntax itself supports</span></span><br><span class="line"><span class="string">                            negation.  The two types of negation are subtly different.</span></span><br><span class="line"><span class="string">                            One negates the set of matched endpoints, the other negates</span></span><br><span class="line"><span class="string">                            the whole match: \n \tSelector = \&quot;!has(my_label)\&quot; matches</span></span><br><span class="line"><span class="string">                            packets that are from other Calico-controlled \tendpoints</span></span><br><span class="line"><span class="string">                            that do not have the label \&quot;my_label\&quot;. \n \tNotSelector</span></span><br><span class="line"><span class="string">                            = \&quot;has(my_label)\&quot; matches packets that are not from</span></span><br><span class="line"><span class="string">                            Calico-controlled \tendpoints that do have the label \&quot;my_label\&quot;.</span></span><br><span class="line"><span class="string">                            \n The effect is that the latter will accept packets from</span></span><br><span class="line"><span class="string">                            non-Calico sources whereas the former is limited to packets</span></span><br><span class="line"><span class="string">                            from Calico-controlled endpoints.&quot;</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                        <span class="attr">serviceAccounts:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">ServiceAccounts</span> <span class="string">is</span> <span class="string">an</span> <span class="string">optional</span> <span class="string">field</span> <span class="string">that</span> <span class="string">restricts</span></span><br><span class="line">                            <span class="string">the</span> <span class="string">rule</span> <span class="string">to</span> <span class="string">only</span> <span class="string">apply</span> <span class="string">to</span> <span class="string">traffic</span> <span class="string">that</span> <span class="string">originates</span> <span class="string">from</span></span><br><span class="line">                            <span class="string">(or</span> <span class="string">terminates</span> <span class="string">at)</span> <span class="string">a</span> <span class="string">pod</span> <span class="string">running</span> <span class="string">as</span> <span class="string">a</span> <span class="string">matching</span> <span class="string">service</span></span><br><span class="line">                            <span class="string">account.</span></span><br><span class="line">                          <span class="attr">properties:</span></span><br><span class="line">                            <span class="attr">names:</span></span><br><span class="line">                              <span class="attr">description:</span> <span class="string">Names</span> <span class="string">is</span> <span class="string">an</span> <span class="string">optional</span> <span class="string">field</span> <span class="string">that</span> <span class="string">restricts</span></span><br><span class="line">                                <span class="string">the</span> <span class="string">rule</span> <span class="string">to</span> <span class="string">only</span> <span class="string">apply</span> <span class="string">to</span> <span class="string">traffic</span> <span class="string">that</span> <span class="string">originates</span></span><br><span class="line">                                <span class="string">from</span> <span class="string">(or</span> <span class="string">terminates</span> <span class="string">at)</span> <span class="string">a</span> <span class="string">pod</span> <span class="string">running</span> <span class="string">as</span> <span class="string">a</span> <span class="string">service</span></span><br><span class="line">                                <span class="string">account</span> <span class="string">whose</span> <span class="string">name</span> <span class="string">is</span> <span class="string">in</span> <span class="string">the</span> <span class="string">list.</span></span><br><span class="line">                              <span class="attr">items:</span></span><br><span class="line">                                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                              <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                            <span class="attr">selector:</span></span><br><span class="line">                              <span class="attr">description:</span> <span class="string">Selector</span> <span class="string">is</span> <span class="string">an</span> <span class="string">optional</span> <span class="string">field</span> <span class="string">that</span> <span class="string">restricts</span></span><br><span class="line">                                <span class="string">the</span> <span class="string">rule</span> <span class="string">to</span> <span class="string">only</span> <span class="string">apply</span> <span class="string">to</span> <span class="string">traffic</span> <span class="string">that</span> <span class="string">originates</span></span><br><span class="line">                                <span class="string">from</span> <span class="string">(or</span> <span class="string">terminates</span> <span class="string">at)</span> <span class="string">a</span> <span class="string">pod</span> <span class="string">running</span> <span class="string">as</span> <span class="string">a</span> <span class="string">service</span></span><br><span class="line">                                <span class="string">account</span> <span class="string">that</span> <span class="string">matches</span> <span class="string">the</span> <span class="string">given</span> <span class="string">label</span> <span class="string">selector.</span> <span class="string">If</span></span><br><span class="line">                                <span class="string">both</span> <span class="string">Names</span> <span class="string">and</span> <span class="string">Selector</span> <span class="string">are</span> <span class="string">specified</span> <span class="string">then</span> <span class="string">they</span> <span class="string">are</span></span><br><span class="line">                                <span class="string">AND&#x27;ed.</span></span><br><span class="line">                              <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                        <span class="attr">services:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">&quot;Services is an optional field that contains</span></span><br><span class="line"><span class="string">                            options for matching Kubernetes Services. If specified,</span></span><br><span class="line"><span class="string">                            only traffic that originates from or terminates at endpoints</span></span><br><span class="line"><span class="string">                            within the selected service(s) will be matched, and only</span></span><br><span class="line"><span class="string">                            to/from each endpoint&#x27;s port. \n Services cannot be specified</span></span><br><span class="line"><span class="string">                            on the same rule as Selector, NotSelector, NamespaceSelector,</span></span><br><span class="line"><span class="string">                            Nets, NotNets or ServiceAccounts. \n Ports and NotPorts</span></span><br><span class="line"><span class="string">                            can only be specified with Services on ingress rules.&quot;</span></span><br><span class="line">                          <span class="attr">properties:</span></span><br><span class="line">                            <span class="attr">name:</span></span><br><span class="line">                              <span class="attr">description:</span> <span class="string">Name</span> <span class="string">specifies</span> <span class="string">the</span> <span class="string">name</span> <span class="string">of</span> <span class="string">a</span> <span class="string">Kubernetes</span></span><br><span class="line">                                <span class="string">Service</span> <span class="string">to</span> <span class="string">match.</span></span><br><span class="line">                              <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                            <span class="attr">namespace:</span></span><br><span class="line">                              <span class="attr">description:</span> <span class="string">Namespace</span> <span class="string">specifies</span> <span class="string">the</span> <span class="string">namespace</span> <span class="string">of</span> <span class="string">the</span></span><br><span class="line">                                <span class="string">given</span> <span class="string">Service.</span> <span class="string">If</span> <span class="string">left</span> <span class="string">empty,</span> <span class="string">the</span> <span class="string">rule</span> <span class="string">will</span> <span class="string">match</span></span><br><span class="line">                                <span class="string">within</span> <span class="string">this</span> <span class="string">policy&#x27;s</span> <span class="string">namespace.</span></span><br><span class="line">                              <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                    <span class="attr">http:</span></span><br><span class="line">                      <span class="attr">description:</span> <span class="string">HTTP</span> <span class="string">contains</span> <span class="string">match</span> <span class="string">criteria</span> <span class="string">that</span> <span class="string">apply</span> <span class="string">to</span> <span class="string">HTTP</span></span><br><span class="line">                        <span class="string">requests.</span></span><br><span class="line">                      <span class="attr">properties:</span></span><br><span class="line">                        <span class="attr">methods:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">Methods</span> <span class="string">is</span> <span class="string">an</span> <span class="string">optional</span> <span class="string">field</span> <span class="string">that</span> <span class="string">restricts</span></span><br><span class="line">                            <span class="string">the</span> <span class="string">rule</span> <span class="string">to</span> <span class="string">apply</span> <span class="string">only</span> <span class="string">to</span> <span class="string">HTTP</span> <span class="string">requests</span> <span class="string">that</span> <span class="string">use</span> <span class="string">one</span> <span class="string">of</span></span><br><span class="line">                            <span class="string">the</span> <span class="string">listed</span> <span class="string">HTTP</span> <span class="string">Methods</span> <span class="string">(e.g.</span> <span class="string">GET,</span> <span class="string">PUT,</span> <span class="string">etc.)</span> <span class="string">Multiple</span></span><br><span class="line">                            <span class="string">methods</span> <span class="string">are</span> <span class="string">OR&#x27;d</span> <span class="string">together.</span></span><br><span class="line">                          <span class="attr">items:</span></span><br><span class="line">                            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                        <span class="attr">paths:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">&#x27;Paths is an optional field that restricts</span></span><br><span class="line"><span class="string">                            the rule to apply to HTTP requests that use one of the</span></span><br><span class="line"><span class="string">                            listed HTTP Paths. Multiple paths are OR&#x27;</span><span class="string">&#x27;d together.</span></span><br><span class="line"><span class="string">                            e.g: - exact: /foo - prefix: /bar NOTE: Each entry may</span></span><br><span class="line"><span class="string">                            ONLY specify either a `exact` or a `prefix` match. The</span></span><br><span class="line"><span class="string">                            validator will check for it.&#x27;</span></span><br><span class="line">                          <span class="attr">items:</span></span><br><span class="line">                            <span class="attr">description:</span> <span class="string">&#x27;HTTPPath specifies an HTTP path to match.</span></span><br><span class="line"><span class="string">                              It may be either of the form: exact: &lt;path&gt;: which matches</span></span><br><span class="line"><span class="string">                              the path exactly or prefix: &lt;path-prefix&gt;: which matches</span></span><br><span class="line"><span class="string">                              the path prefix&#x27;</span></span><br><span class="line">                            <span class="attr">properties:</span></span><br><span class="line">                              <span class="attr">exact:</span></span><br><span class="line">                                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                              <span class="attr">prefix:</span></span><br><span class="line">                                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                            <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                    <span class="attr">icmp:</span></span><br><span class="line">                      <span class="attr">description:</span> <span class="string">ICMP</span> <span class="string">is</span> <span class="string">an</span> <span class="string">optional</span> <span class="string">field</span> <span class="string">that</span> <span class="string">restricts</span> <span class="string">the</span> <span class="string">rule</span></span><br><span class="line">                        <span class="string">to</span> <span class="string">apply</span> <span class="string">to</span> <span class="string">a</span> <span class="string">specific</span> <span class="string">type</span> <span class="string">and</span> <span class="string">code</span> <span class="string">of</span> <span class="string">ICMP</span> <span class="string">traffic.</span>  <span class="string">This</span></span><br><span class="line">                        <span class="string">should</span> <span class="string">only</span> <span class="string">be</span> <span class="string">specified</span> <span class="string">if</span> <span class="string">the</span> <span class="string">Protocol</span> <span class="string">field</span> <span class="string">is</span> <span class="string">set</span> <span class="string">to</span> <span class="string">&quot;ICMP&quot;</span></span><br><span class="line">                        <span class="string">or</span> <span class="string">&quot;ICMPv6&quot;</span><span class="string">.</span></span><br><span class="line">                      <span class="attr">properties:</span></span><br><span class="line">                        <span class="attr">code:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">Match</span> <span class="string">on</span> <span class="string">a</span> <span class="string">specific</span> <span class="string">ICMP</span> <span class="string">code.</span>  <span class="string">If</span> <span class="string">specified,</span></span><br><span class="line">                            <span class="string">the</span> <span class="string">Type</span> <span class="string">value</span> <span class="string">must</span> <span class="string">also</span> <span class="string">be</span> <span class="string">specified.</span> <span class="string">This</span> <span class="string">is</span> <span class="string">a</span> <span class="string">technical</span></span><br><span class="line">                            <span class="string">limitation</span> <span class="string">imposed</span> <span class="string">by</span> <span class="string">the</span> <span class="string">kernel&#x27;s</span> <span class="string">iptables</span> <span class="string">firewall,</span></span><br><span class="line">                            <span class="string">which</span> <span class="string">Calico</span> <span class="string">uses</span> <span class="string">to</span> <span class="string">enforce</span> <span class="string">the</span> <span class="string">rule.</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                        <span class="attr">type:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">Match</span> <span class="string">on</span> <span class="string">a</span> <span class="string">specific</span> <span class="string">ICMP</span> <span class="string">type.</span>  <span class="string">For</span> <span class="string">example</span></span><br><span class="line">                            <span class="string">a</span> <span class="string">value</span> <span class="string">of</span> <span class="number">8</span> <span class="string">refers</span> <span class="string">to</span> <span class="string">ICMP</span> <span class="string">Echo</span> <span class="string">Request</span> <span class="string">(i.e.</span> <span class="string">pings).</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                    <span class="attr">ipVersion:</span></span><br><span class="line">                      <span class="attr">description:</span> <span class="string">IPVersion</span> <span class="string">is</span> <span class="string">an</span> <span class="string">optional</span> <span class="string">field</span> <span class="string">that</span> <span class="string">restricts</span> <span class="string">the</span></span><br><span class="line">                        <span class="string">rule</span> <span class="string">to</span> <span class="string">only</span> <span class="string">match</span> <span class="string">a</span> <span class="string">specific</span> <span class="string">IP</span> <span class="string">version.</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                    <span class="attr">metadata:</span></span><br><span class="line">                      <span class="attr">description:</span> <span class="string">Metadata</span> <span class="string">contains</span> <span class="string">additional</span> <span class="string">information</span> <span class="string">for</span> <span class="string">this</span></span><br><span class="line">                        <span class="string">rule</span></span><br><span class="line">                      <span class="attr">properties:</span></span><br><span class="line">                        <span class="attr">annotations:</span></span><br><span class="line">                          <span class="attr">additionalProperties:</span></span><br><span class="line">                            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">Annotations</span> <span class="string">is</span> <span class="string">a</span> <span class="string">set</span> <span class="string">of</span> <span class="string">key</span> <span class="string">value</span> <span class="string">pairs</span> <span class="string">that</span></span><br><span class="line">                            <span class="string">give</span> <span class="string">extra</span> <span class="string">information</span> <span class="string">about</span> <span class="string">the</span> <span class="string">rule</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                    <span class="attr">notICMP:</span></span><br><span class="line">                      <span class="attr">description:</span> <span class="string">NotICMP</span> <span class="string">is</span> <span class="string">the</span> <span class="string">negated</span> <span class="string">version</span> <span class="string">of</span> <span class="string">the</span> <span class="string">ICMP</span> <span class="string">field.</span></span><br><span class="line">                      <span class="attr">properties:</span></span><br><span class="line">                        <span class="attr">code:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">Match</span> <span class="string">on</span> <span class="string">a</span> <span class="string">specific</span> <span class="string">ICMP</span> <span class="string">code.</span>  <span class="string">If</span> <span class="string">specified,</span></span><br><span class="line">                            <span class="string">the</span> <span class="string">Type</span> <span class="string">value</span> <span class="string">must</span> <span class="string">also</span> <span class="string">be</span> <span class="string">specified.</span> <span class="string">This</span> <span class="string">is</span> <span class="string">a</span> <span class="string">technical</span></span><br><span class="line">                            <span class="string">limitation</span> <span class="string">imposed</span> <span class="string">by</span> <span class="string">the</span> <span class="string">kernel&#x27;s</span> <span class="string">iptables</span> <span class="string">firewall,</span></span><br><span class="line">                            <span class="string">which</span> <span class="string">Calico</span> <span class="string">uses</span> <span class="string">to</span> <span class="string">enforce</span> <span class="string">the</span> <span class="string">rule.</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                        <span class="attr">type:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">Match</span> <span class="string">on</span> <span class="string">a</span> <span class="string">specific</span> <span class="string">ICMP</span> <span class="string">type.</span>  <span class="string">For</span> <span class="string">example</span></span><br><span class="line">                            <span class="string">a</span> <span class="string">value</span> <span class="string">of</span> <span class="number">8</span> <span class="string">refers</span> <span class="string">to</span> <span class="string">ICMP</span> <span class="string">Echo</span> <span class="string">Request</span> <span class="string">(i.e.</span> <span class="string">pings).</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                    <span class="attr">notProtocol:</span></span><br><span class="line">                      <span class="attr">anyOf:</span></span><br><span class="line">                      <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                      <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                      <span class="attr">description:</span> <span class="string">NotProtocol</span> <span class="string">is</span> <span class="string">the</span> <span class="string">negated</span> <span class="string">version</span> <span class="string">of</span> <span class="string">the</span> <span class="string">Protocol</span></span><br><span class="line">                        <span class="string">field.</span></span><br><span class="line">                      <span class="attr">pattern:</span> <span class="string">^.*</span></span><br><span class="line">                      <span class="attr">x-kubernetes-int-or-string:</span> <span class="literal">true</span></span><br><span class="line">                    <span class="attr">protocol:</span></span><br><span class="line">                      <span class="attr">anyOf:</span></span><br><span class="line">                      <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                      <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                      <span class="attr">description:</span> <span class="string">&quot;Protocol is an optional field that restricts the</span></span><br><span class="line"><span class="string">                        rule to only apply to traffic of a specific IP protocol. Required</span></span><br><span class="line"><span class="string">                        if any of the EntityRules contain Ports (because ports only</span></span><br><span class="line"><span class="string">                        apply to certain protocols). \n Must be one of these string</span></span><br><span class="line"><span class="string">                        values: \&quot;TCP\&quot;, \&quot;UDP\&quot;, \&quot;ICMP\&quot;, \&quot;ICMPv6\&quot;, \&quot;SCTP\&quot;,</span></span><br><span class="line"><span class="string">                        \&quot;UDPLite\&quot; or an integer in the range 1-255.&quot;</span></span><br><span class="line">                      <span class="attr">pattern:</span> <span class="string">^.*</span></span><br><span class="line">                      <span class="attr">x-kubernetes-int-or-string:</span> <span class="literal">true</span></span><br><span class="line">                    <span class="attr">source:</span></span><br><span class="line">                      <span class="attr">description:</span> <span class="string">Source</span> <span class="string">contains</span> <span class="string">the</span> <span class="string">match</span> <span class="string">criteria</span> <span class="string">that</span> <span class="string">apply</span> <span class="string">to</span></span><br><span class="line">                        <span class="string">source</span> <span class="string">entity.</span></span><br><span class="line">                      <span class="attr">properties:</span></span><br><span class="line">                        <span class="attr">namespaceSelector:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">&quot;NamespaceSelector is an optional field that</span></span><br><span class="line"><span class="string">                            contains a selector expression. Only traffic that originates</span></span><br><span class="line"><span class="string">                            from (or terminates at) endpoints within the selected</span></span><br><span class="line"><span class="string">                            namespaces will be matched. When both NamespaceSelector</span></span><br><span class="line"><span class="string">                            and another selector are defined on the same rule, then</span></span><br><span class="line"><span class="string">                            only workload endpoints that are matched by both selectors</span></span><br><span class="line"><span class="string">                            will be selected by the rule. \n For NetworkPolicy, an</span></span><br><span class="line"><span class="string">                            empty NamespaceSelector implies that the Selector is limited</span></span><br><span class="line"><span class="string">                            to selecting only workload endpoints in the same namespace</span></span><br><span class="line"><span class="string">                            as the NetworkPolicy. \n For NetworkPolicy, `global()`</span></span><br><span class="line"><span class="string">                            NamespaceSelector implies that the Selector is limited</span></span><br><span class="line"><span class="string">                            to selecting only GlobalNetworkSet or HostEndpoint. \n</span></span><br><span class="line"><span class="string">                            For GlobalNetworkPolicy, an empty NamespaceSelector implies</span></span><br><span class="line"><span class="string">                            the Selector applies to workload endpoints across all</span></span><br><span class="line"><span class="string">                            namespaces.&quot;</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                        <span class="attr">nets:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">Nets</span> <span class="string">is</span> <span class="string">an</span> <span class="string">optional</span> <span class="string">field</span> <span class="string">that</span> <span class="string">restricts</span> <span class="string">the</span></span><br><span class="line">                            <span class="string">rule</span> <span class="string">to</span> <span class="string">only</span> <span class="string">apply</span> <span class="string">to</span> <span class="string">traffic</span> <span class="string">that</span> <span class="string">originates</span> <span class="string">from</span> <span class="string">(or</span></span><br><span class="line">                            <span class="string">terminates</span> <span class="string">at)</span> <span class="string">IP</span> <span class="string">addresses</span> <span class="string">in</span> <span class="string">any</span> <span class="string">of</span> <span class="string">the</span> <span class="string">given</span> <span class="string">subnets.</span></span><br><span class="line">                          <span class="attr">items:</span></span><br><span class="line">                            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                        <span class="attr">notNets:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">NotNets</span> <span class="string">is</span> <span class="string">the</span> <span class="string">negated</span> <span class="string">version</span> <span class="string">of</span> <span class="string">the</span> <span class="string">Nets</span></span><br><span class="line">                            <span class="string">field.</span></span><br><span class="line">                          <span class="attr">items:</span></span><br><span class="line">                            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                        <span class="attr">notPorts:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">NotPorts</span> <span class="string">is</span> <span class="string">the</span> <span class="string">negated</span> <span class="string">version</span> <span class="string">of</span> <span class="string">the</span> <span class="string">Ports</span></span><br><span class="line">                            <span class="string">field.</span> <span class="string">Since</span> <span class="string">only</span> <span class="string">some</span> <span class="string">protocols</span> <span class="string">have</span> <span class="string">ports,</span> <span class="string">if</span> <span class="string">any</span> <span class="string">ports</span></span><br><span class="line">                            <span class="string">are</span> <span class="string">specified</span> <span class="string">it</span> <span class="string">requires</span> <span class="string">the</span> <span class="string">Protocol</span> <span class="string">match</span> <span class="string">in</span> <span class="string">the</span> <span class="string">Rule</span></span><br><span class="line">                            <span class="string">to</span> <span class="string">be</span> <span class="string">set</span> <span class="string">to</span> <span class="string">&quot;TCP&quot;</span> <span class="string">or</span> <span class="string">&quot;UDP&quot;</span><span class="string">.</span></span><br><span class="line">                          <span class="attr">items:</span></span><br><span class="line">                            <span class="attr">anyOf:</span></span><br><span class="line">                            <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                            <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                            <span class="attr">pattern:</span> <span class="string">^.*</span></span><br><span class="line">                            <span class="attr">x-kubernetes-int-or-string:</span> <span class="literal">true</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                        <span class="attr">notSelector:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">NotSelector</span> <span class="string">is</span> <span class="string">the</span> <span class="string">negated</span> <span class="string">version</span> <span class="string">of</span> <span class="string">the</span> <span class="string">Selector</span></span><br><span class="line">                            <span class="string">field.</span>  <span class="string">See</span> <span class="string">Selector</span> <span class="string">field</span> <span class="string">for</span> <span class="string">subtleties</span> <span class="string">with</span> <span class="string">negated</span></span><br><span class="line">                            <span class="string">selectors.</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                        <span class="attr">ports:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">&quot;Ports is an optional field that restricts</span></span><br><span class="line"><span class="string">                            the rule to only apply to traffic that has a source (destination)</span></span><br><span class="line"><span class="string">                            port that matches one of these ranges/values. This value</span></span><br><span class="line"><span class="string">                            is a list of integers or strings that represent ranges</span></span><br><span class="line"><span class="string">                            of ports. \n Since only some protocols have ports, if</span></span><br><span class="line"><span class="string">                            any ports are specified it requires the Protocol match</span></span><br><span class="line"><span class="string">                            in the Rule to be set to \&quot;TCP\&quot; or \&quot;UDP\&quot;.&quot;</span></span><br><span class="line">                          <span class="attr">items:</span></span><br><span class="line">                            <span class="attr">anyOf:</span></span><br><span class="line">                            <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                            <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                            <span class="attr">pattern:</span> <span class="string">^.*</span></span><br><span class="line">                            <span class="attr">x-kubernetes-int-or-string:</span> <span class="literal">true</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                        <span class="attr">selector:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">&quot;Selector is an optional field that contains</span></span><br><span class="line"><span class="string">                            a selector expression (see Policy for sample syntax).</span></span><br><span class="line"><span class="string">                            \ Only traffic that originates from (terminates at) endpoints</span></span><br><span class="line"><span class="string">                            matching the selector will be matched. \n Note that: in</span></span><br><span class="line"><span class="string">                            addition to the negated version of the Selector (see NotSelector</span></span><br><span class="line"><span class="string">                            below), the selector expression syntax itself supports</span></span><br><span class="line"><span class="string">                            negation.  The two types of negation are subtly different.</span></span><br><span class="line"><span class="string">                            One negates the set of matched endpoints, the other negates</span></span><br><span class="line"><span class="string">                            the whole match: \n \tSelector = \&quot;!has(my_label)\&quot; matches</span></span><br><span class="line"><span class="string">                            packets that are from other Calico-controlled \tendpoints</span></span><br><span class="line"><span class="string">                            that do not have the label \&quot;my_label\&quot;. \n \tNotSelector</span></span><br><span class="line"><span class="string">                            = \&quot;has(my_label)\&quot; matches packets that are not from</span></span><br><span class="line"><span class="string">                            Calico-controlled \tendpoints that do have the label \&quot;my_label\&quot;.</span></span><br><span class="line"><span class="string">                            \n The effect is that the latter will accept packets from</span></span><br><span class="line"><span class="string">                            non-Calico sources whereas the former is limited to packets</span></span><br><span class="line"><span class="string">                            from Calico-controlled endpoints.&quot;</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                        <span class="attr">serviceAccounts:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">ServiceAccounts</span> <span class="string">is</span> <span class="string">an</span> <span class="string">optional</span> <span class="string">field</span> <span class="string">that</span> <span class="string">restricts</span></span><br><span class="line">                            <span class="string">the</span> <span class="string">rule</span> <span class="string">to</span> <span class="string">only</span> <span class="string">apply</span> <span class="string">to</span> <span class="string">traffic</span> <span class="string">that</span> <span class="string">originates</span> <span class="string">from</span></span><br><span class="line">                            <span class="string">(or</span> <span class="string">terminates</span> <span class="string">at)</span> <span class="string">a</span> <span class="string">pod</span> <span class="string">running</span> <span class="string">as</span> <span class="string">a</span> <span class="string">matching</span> <span class="string">service</span></span><br><span class="line">                            <span class="string">account.</span></span><br><span class="line">                          <span class="attr">properties:</span></span><br><span class="line">                            <span class="attr">names:</span></span><br><span class="line">                              <span class="attr">description:</span> <span class="string">Names</span> <span class="string">is</span> <span class="string">an</span> <span class="string">optional</span> <span class="string">field</span> <span class="string">that</span> <span class="string">restricts</span></span><br><span class="line">                                <span class="string">the</span> <span class="string">rule</span> <span class="string">to</span> <span class="string">only</span> <span class="string">apply</span> <span class="string">to</span> <span class="string">traffic</span> <span class="string">that</span> <span class="string">originates</span></span><br><span class="line">                                <span class="string">from</span> <span class="string">(or</span> <span class="string">terminates</span> <span class="string">at)</span> <span class="string">a</span> <span class="string">pod</span> <span class="string">running</span> <span class="string">as</span> <span class="string">a</span> <span class="string">service</span></span><br><span class="line">                                <span class="string">account</span> <span class="string">whose</span> <span class="string">name</span> <span class="string">is</span> <span class="string">in</span> <span class="string">the</span> <span class="string">list.</span></span><br><span class="line">                              <span class="attr">items:</span></span><br><span class="line">                                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                              <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                            <span class="attr">selector:</span></span><br><span class="line">                              <span class="attr">description:</span> <span class="string">Selector</span> <span class="string">is</span> <span class="string">an</span> <span class="string">optional</span> <span class="string">field</span> <span class="string">that</span> <span class="string">restricts</span></span><br><span class="line">                                <span class="string">the</span> <span class="string">rule</span> <span class="string">to</span> <span class="string">only</span> <span class="string">apply</span> <span class="string">to</span> <span class="string">traffic</span> <span class="string">that</span> <span class="string">originates</span></span><br><span class="line">                                <span class="string">from</span> <span class="string">(or</span> <span class="string">terminates</span> <span class="string">at)</span> <span class="string">a</span> <span class="string">pod</span> <span class="string">running</span> <span class="string">as</span> <span class="string">a</span> <span class="string">service</span></span><br><span class="line">                                <span class="string">account</span> <span class="string">that</span> <span class="string">matches</span> <span class="string">the</span> <span class="string">given</span> <span class="string">label</span> <span class="string">selector.</span> <span class="string">If</span></span><br><span class="line">                                <span class="string">both</span> <span class="string">Names</span> <span class="string">and</span> <span class="string">Selector</span> <span class="string">are</span> <span class="string">specified</span> <span class="string">then</span> <span class="string">they</span> <span class="string">are</span></span><br><span class="line">                                <span class="string">AND&#x27;ed.</span></span><br><span class="line">                              <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                        <span class="attr">services:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">&quot;Services is an optional field that contains</span></span><br><span class="line"><span class="string">                            options for matching Kubernetes Services. If specified,</span></span><br><span class="line"><span class="string">                            only traffic that originates from or terminates at endpoints</span></span><br><span class="line"><span class="string">                            within the selected service(s) will be matched, and only</span></span><br><span class="line"><span class="string">                            to/from each endpoint&#x27;s port. \n Services cannot be specified</span></span><br><span class="line"><span class="string">                            on the same rule as Selector, NotSelector, NamespaceSelector,</span></span><br><span class="line"><span class="string">                            Nets, NotNets or ServiceAccounts. \n Ports and NotPorts</span></span><br><span class="line"><span class="string">                            can only be specified with Services on ingress rules.&quot;</span></span><br><span class="line">                          <span class="attr">properties:</span></span><br><span class="line">                            <span class="attr">name:</span></span><br><span class="line">                              <span class="attr">description:</span> <span class="string">Name</span> <span class="string">specifies</span> <span class="string">the</span> <span class="string">name</span> <span class="string">of</span> <span class="string">a</span> <span class="string">Kubernetes</span></span><br><span class="line">                                <span class="string">Service</span> <span class="string">to</span> <span class="string">match.</span></span><br><span class="line">                              <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                            <span class="attr">namespace:</span></span><br><span class="line">                              <span class="attr">description:</span> <span class="string">Namespace</span> <span class="string">specifies</span> <span class="string">the</span> <span class="string">namespace</span> <span class="string">of</span> <span class="string">the</span></span><br><span class="line">                                <span class="string">given</span> <span class="string">Service.</span> <span class="string">If</span> <span class="string">left</span> <span class="string">empty,</span> <span class="string">the</span> <span class="string">rule</span> <span class="string">will</span> <span class="string">match</span></span><br><span class="line">                                <span class="string">within</span> <span class="string">this</span> <span class="string">policy&#x27;s</span> <span class="string">namespace.</span></span><br><span class="line">                              <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                  <span class="attr">required:</span></span><br><span class="line">                  <span class="bullet">-</span> <span class="string">action</span></span><br><span class="line">                  <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">              <span class="attr">ingress:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">The</span> <span class="string">ordered</span> <span class="string">set</span> <span class="string">of</span> <span class="string">ingress</span> <span class="string">rules.</span>  <span class="string">Each</span> <span class="string">rule</span> <span class="string">contains</span></span><br><span class="line">                  <span class="string">a</span> <span class="string">set</span> <span class="string">of</span> <span class="string">packet</span> <span class="string">match</span> <span class="string">criteria</span> <span class="string">and</span> <span class="string">a</span> <span class="string">corresponding</span> <span class="string">action</span> <span class="string">to</span> <span class="string">apply.</span></span><br><span class="line">                <span class="attr">items:</span></span><br><span class="line">                  <span class="attr">description:</span> <span class="string">&quot;A Rule encapsulates a set of match criteria and an</span></span><br><span class="line"><span class="string">                    action.  Both selector-based security Policy and security Profiles</span></span><br><span class="line"><span class="string">                    reference rules - separated out as a list of rules for both ingress</span></span><br><span class="line"><span class="string">                    and egress packet matching. \n Each positive match criteria has</span></span><br><span class="line"><span class="string">                    a negated version, prefixed with \&quot;Not\&quot;. All the match criteria</span></span><br><span class="line"><span class="string">                    within a rule must be satisfied for a packet to match. A single</span></span><br><span class="line"><span class="string">                    rule can contain the positive and negative version of a match</span></span><br><span class="line"><span class="string">                    and both must be satisfied for the rule to match.&quot;</span></span><br><span class="line">                  <span class="attr">properties:</span></span><br><span class="line">                    <span class="attr">action:</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                    <span class="attr">destination:</span></span><br><span class="line">                      <span class="attr">description:</span> <span class="string">Destination</span> <span class="string">contains</span> <span class="string">the</span> <span class="string">match</span> <span class="string">criteria</span> <span class="string">that</span> <span class="string">apply</span></span><br><span class="line">                        <span class="string">to</span> <span class="string">destination</span> <span class="string">entity.</span></span><br><span class="line">                      <span class="attr">properties:</span></span><br><span class="line">                        <span class="attr">namespaceSelector:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">&quot;NamespaceSelector is an optional field that</span></span><br><span class="line"><span class="string">                            contains a selector expression. Only traffic that originates</span></span><br><span class="line"><span class="string">                            from (or terminates at) endpoints within the selected</span></span><br><span class="line"><span class="string">                            namespaces will be matched. When both NamespaceSelector</span></span><br><span class="line"><span class="string">                            and another selector are defined on the same rule, then</span></span><br><span class="line"><span class="string">                            only workload endpoints that are matched by both selectors</span></span><br><span class="line"><span class="string">                            will be selected by the rule. \n For NetworkPolicy, an</span></span><br><span class="line"><span class="string">                            empty NamespaceSelector implies that the Selector is limited</span></span><br><span class="line"><span class="string">                            to selecting only workload endpoints in the same namespace</span></span><br><span class="line"><span class="string">                            as the NetworkPolicy. \n For NetworkPolicy, `global()`</span></span><br><span class="line"><span class="string">                            NamespaceSelector implies that the Selector is limited</span></span><br><span class="line"><span class="string">                            to selecting only GlobalNetworkSet or HostEndpoint. \n</span></span><br><span class="line"><span class="string">                            For GlobalNetworkPolicy, an empty NamespaceSelector implies</span></span><br><span class="line"><span class="string">                            the Selector applies to workload endpoints across all</span></span><br><span class="line"><span class="string">                            namespaces.&quot;</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                        <span class="attr">nets:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">Nets</span> <span class="string">is</span> <span class="string">an</span> <span class="string">optional</span> <span class="string">field</span> <span class="string">that</span> <span class="string">restricts</span> <span class="string">the</span></span><br><span class="line">                            <span class="string">rule</span> <span class="string">to</span> <span class="string">only</span> <span class="string">apply</span> <span class="string">to</span> <span class="string">traffic</span> <span class="string">that</span> <span class="string">originates</span> <span class="string">from</span> <span class="string">(or</span></span><br><span class="line">                            <span class="string">terminates</span> <span class="string">at)</span> <span class="string">IP</span> <span class="string">addresses</span> <span class="string">in</span> <span class="string">any</span> <span class="string">of</span> <span class="string">the</span> <span class="string">given</span> <span class="string">subnets.</span></span><br><span class="line">                          <span class="attr">items:</span></span><br><span class="line">                            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                        <span class="attr">notNets:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">NotNets</span> <span class="string">is</span> <span class="string">the</span> <span class="string">negated</span> <span class="string">version</span> <span class="string">of</span> <span class="string">the</span> <span class="string">Nets</span></span><br><span class="line">                            <span class="string">field.</span></span><br><span class="line">                          <span class="attr">items:</span></span><br><span class="line">                            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                        <span class="attr">notPorts:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">NotPorts</span> <span class="string">is</span> <span class="string">the</span> <span class="string">negated</span> <span class="string">version</span> <span class="string">of</span> <span class="string">the</span> <span class="string">Ports</span></span><br><span class="line">                            <span class="string">field.</span> <span class="string">Since</span> <span class="string">only</span> <span class="string">some</span> <span class="string">protocols</span> <span class="string">have</span> <span class="string">ports,</span> <span class="string">if</span> <span class="string">any</span> <span class="string">ports</span></span><br><span class="line">                            <span class="string">are</span> <span class="string">specified</span> <span class="string">it</span> <span class="string">requires</span> <span class="string">the</span> <span class="string">Protocol</span> <span class="string">match</span> <span class="string">in</span> <span class="string">the</span> <span class="string">Rule</span></span><br><span class="line">                            <span class="string">to</span> <span class="string">be</span> <span class="string">set</span> <span class="string">to</span> <span class="string">&quot;TCP&quot;</span> <span class="string">or</span> <span class="string">&quot;UDP&quot;</span><span class="string">.</span></span><br><span class="line">                          <span class="attr">items:</span></span><br><span class="line">                            <span class="attr">anyOf:</span></span><br><span class="line">                            <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                            <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                            <span class="attr">pattern:</span> <span class="string">^.*</span></span><br><span class="line">                            <span class="attr">x-kubernetes-int-or-string:</span> <span class="literal">true</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                        <span class="attr">notSelector:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">NotSelector</span> <span class="string">is</span> <span class="string">the</span> <span class="string">negated</span> <span class="string">version</span> <span class="string">of</span> <span class="string">the</span> <span class="string">Selector</span></span><br><span class="line">                            <span class="string">field.</span>  <span class="string">See</span> <span class="string">Selector</span> <span class="string">field</span> <span class="string">for</span> <span class="string">subtleties</span> <span class="string">with</span> <span class="string">negated</span></span><br><span class="line">                            <span class="string">selectors.</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                        <span class="attr">ports:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">&quot;Ports is an optional field that restricts</span></span><br><span class="line"><span class="string">                            the rule to only apply to traffic that has a source (destination)</span></span><br><span class="line"><span class="string">                            port that matches one of these ranges/values. This value</span></span><br><span class="line"><span class="string">                            is a list of integers or strings that represent ranges</span></span><br><span class="line"><span class="string">                            of ports. \n Since only some protocols have ports, if</span></span><br><span class="line"><span class="string">                            any ports are specified it requires the Protocol match</span></span><br><span class="line"><span class="string">                            in the Rule to be set to \&quot;TCP\&quot; or \&quot;UDP\&quot;.&quot;</span></span><br><span class="line">                          <span class="attr">items:</span></span><br><span class="line">                            <span class="attr">anyOf:</span></span><br><span class="line">                            <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                            <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                            <span class="attr">pattern:</span> <span class="string">^.*</span></span><br><span class="line">                            <span class="attr">x-kubernetes-int-or-string:</span> <span class="literal">true</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                        <span class="attr">selector:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">&quot;Selector is an optional field that contains</span></span><br><span class="line"><span class="string">                            a selector expression (see Policy for sample syntax).</span></span><br><span class="line"><span class="string">                            \ Only traffic that originates from (terminates at) endpoints</span></span><br><span class="line"><span class="string">                            matching the selector will be matched. \n Note that: in</span></span><br><span class="line"><span class="string">                            addition to the negated version of the Selector (see NotSelector</span></span><br><span class="line"><span class="string">                            below), the selector expression syntax itself supports</span></span><br><span class="line"><span class="string">                            negation.  The two types of negation are subtly different.</span></span><br><span class="line"><span class="string">                            One negates the set of matched endpoints, the other negates</span></span><br><span class="line"><span class="string">                            the whole match: \n \tSelector = \&quot;!has(my_label)\&quot; matches</span></span><br><span class="line"><span class="string">                            packets that are from other Calico-controlled \tendpoints</span></span><br><span class="line"><span class="string">                            that do not have the label \&quot;my_label\&quot;. \n \tNotSelector</span></span><br><span class="line"><span class="string">                            = \&quot;has(my_label)\&quot; matches packets that are not from</span></span><br><span class="line"><span class="string">                            Calico-controlled \tendpoints that do have the label \&quot;my_label\&quot;.</span></span><br><span class="line"><span class="string">                            \n The effect is that the latter will accept packets from</span></span><br><span class="line"><span class="string">                            non-Calico sources whereas the former is limited to packets</span></span><br><span class="line"><span class="string">                            from Calico-controlled endpoints.&quot;</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                        <span class="attr">serviceAccounts:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">ServiceAccounts</span> <span class="string">is</span> <span class="string">an</span> <span class="string">optional</span> <span class="string">field</span> <span class="string">that</span> <span class="string">restricts</span></span><br><span class="line">                            <span class="string">the</span> <span class="string">rule</span> <span class="string">to</span> <span class="string">only</span> <span class="string">apply</span> <span class="string">to</span> <span class="string">traffic</span> <span class="string">that</span> <span class="string">originates</span> <span class="string">from</span></span><br><span class="line">                            <span class="string">(or</span> <span class="string">terminates</span> <span class="string">at)</span> <span class="string">a</span> <span class="string">pod</span> <span class="string">running</span> <span class="string">as</span> <span class="string">a</span> <span class="string">matching</span> <span class="string">service</span></span><br><span class="line">                            <span class="string">account.</span></span><br><span class="line">                          <span class="attr">properties:</span></span><br><span class="line">                            <span class="attr">names:</span></span><br><span class="line">                              <span class="attr">description:</span> <span class="string">Names</span> <span class="string">is</span> <span class="string">an</span> <span class="string">optional</span> <span class="string">field</span> <span class="string">that</span> <span class="string">restricts</span></span><br><span class="line">                                <span class="string">the</span> <span class="string">rule</span> <span class="string">to</span> <span class="string">only</span> <span class="string">apply</span> <span class="string">to</span> <span class="string">traffic</span> <span class="string">that</span> <span class="string">originates</span></span><br><span class="line">                                <span class="string">from</span> <span class="string">(or</span> <span class="string">terminates</span> <span class="string">at)</span> <span class="string">a</span> <span class="string">pod</span> <span class="string">running</span> <span class="string">as</span> <span class="string">a</span> <span class="string">service</span></span><br><span class="line">                                <span class="string">account</span> <span class="string">whose</span> <span class="string">name</span> <span class="string">is</span> <span class="string">in</span> <span class="string">the</span> <span class="string">list.</span></span><br><span class="line">                              <span class="attr">items:</span></span><br><span class="line">                                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                              <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                            <span class="attr">selector:</span></span><br><span class="line">                              <span class="attr">description:</span> <span class="string">Selector</span> <span class="string">is</span> <span class="string">an</span> <span class="string">optional</span> <span class="string">field</span> <span class="string">that</span> <span class="string">restricts</span></span><br><span class="line">                                <span class="string">the</span> <span class="string">rule</span> <span class="string">to</span> <span class="string">only</span> <span class="string">apply</span> <span class="string">to</span> <span class="string">traffic</span> <span class="string">that</span> <span class="string">originates</span></span><br><span class="line">                                <span class="string">from</span> <span class="string">(or</span> <span class="string">terminates</span> <span class="string">at)</span> <span class="string">a</span> <span class="string">pod</span> <span class="string">running</span> <span class="string">as</span> <span class="string">a</span> <span class="string">service</span></span><br><span class="line">                                <span class="string">account</span> <span class="string">that</span> <span class="string">matches</span> <span class="string">the</span> <span class="string">given</span> <span class="string">label</span> <span class="string">selector.</span> <span class="string">If</span></span><br><span class="line">                                <span class="string">both</span> <span class="string">Names</span> <span class="string">and</span> <span class="string">Selector</span> <span class="string">are</span> <span class="string">specified</span> <span class="string">then</span> <span class="string">they</span> <span class="string">are</span></span><br><span class="line">                                <span class="string">AND&#x27;ed.</span></span><br><span class="line">                              <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                        <span class="attr">services:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">&quot;Services is an optional field that contains</span></span><br><span class="line"><span class="string">                            options for matching Kubernetes Services. If specified,</span></span><br><span class="line"><span class="string">                            only traffic that originates from or terminates at endpoints</span></span><br><span class="line"><span class="string">                            within the selected service(s) will be matched, and only</span></span><br><span class="line"><span class="string">                            to/from each endpoint&#x27;s port. \n Services cannot be specified</span></span><br><span class="line"><span class="string">                            on the same rule as Selector, NotSelector, NamespaceSelector,</span></span><br><span class="line"><span class="string">                            Nets, NotNets or ServiceAccounts. \n Ports and NotPorts</span></span><br><span class="line"><span class="string">                            can only be specified with Services on ingress rules.&quot;</span></span><br><span class="line">                          <span class="attr">properties:</span></span><br><span class="line">                            <span class="attr">name:</span></span><br><span class="line">                              <span class="attr">description:</span> <span class="string">Name</span> <span class="string">specifies</span> <span class="string">the</span> <span class="string">name</span> <span class="string">of</span> <span class="string">a</span> <span class="string">Kubernetes</span></span><br><span class="line">                                <span class="string">Service</span> <span class="string">to</span> <span class="string">match.</span></span><br><span class="line">                              <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                            <span class="attr">namespace:</span></span><br><span class="line">                              <span class="attr">description:</span> <span class="string">Namespace</span> <span class="string">specifies</span> <span class="string">the</span> <span class="string">namespace</span> <span class="string">of</span> <span class="string">the</span></span><br><span class="line">                                <span class="string">given</span> <span class="string">Service.</span> <span class="string">If</span> <span class="string">left</span> <span class="string">empty,</span> <span class="string">the</span> <span class="string">rule</span> <span class="string">will</span> <span class="string">match</span></span><br><span class="line">                                <span class="string">within</span> <span class="string">this</span> <span class="string">policy&#x27;s</span> <span class="string">namespace.</span></span><br><span class="line">                              <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                    <span class="attr">http:</span></span><br><span class="line">                      <span class="attr">description:</span> <span class="string">HTTP</span> <span class="string">contains</span> <span class="string">match</span> <span class="string">criteria</span> <span class="string">that</span> <span class="string">apply</span> <span class="string">to</span> <span class="string">HTTP</span></span><br><span class="line">                        <span class="string">requests.</span></span><br><span class="line">                      <span class="attr">properties:</span></span><br><span class="line">                        <span class="attr">methods:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">Methods</span> <span class="string">is</span> <span class="string">an</span> <span class="string">optional</span> <span class="string">field</span> <span class="string">that</span> <span class="string">restricts</span></span><br><span class="line">                            <span class="string">the</span> <span class="string">rule</span> <span class="string">to</span> <span class="string">apply</span> <span class="string">only</span> <span class="string">to</span> <span class="string">HTTP</span> <span class="string">requests</span> <span class="string">that</span> <span class="string">use</span> <span class="string">one</span> <span class="string">of</span></span><br><span class="line">                            <span class="string">the</span> <span class="string">listed</span> <span class="string">HTTP</span> <span class="string">Methods</span> <span class="string">(e.g.</span> <span class="string">GET,</span> <span class="string">PUT,</span> <span class="string">etc.)</span> <span class="string">Multiple</span></span><br><span class="line">                            <span class="string">methods</span> <span class="string">are</span> <span class="string">OR&#x27;d</span> <span class="string">together.</span></span><br><span class="line">                          <span class="attr">items:</span></span><br><span class="line">                            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                        <span class="attr">paths:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">&#x27;Paths is an optional field that restricts</span></span><br><span class="line"><span class="string">                            the rule to apply to HTTP requests that use one of the</span></span><br><span class="line"><span class="string">                            listed HTTP Paths. Multiple paths are OR&#x27;</span><span class="string">&#x27;d together.</span></span><br><span class="line"><span class="string">                            e.g: - exact: /foo - prefix: /bar NOTE: Each entry may</span></span><br><span class="line"><span class="string">                            ONLY specify either a `exact` or a `prefix` match. The</span></span><br><span class="line"><span class="string">                            validator will check for it.&#x27;</span></span><br><span class="line">                          <span class="attr">items:</span></span><br><span class="line">                            <span class="attr">description:</span> <span class="string">&#x27;HTTPPath specifies an HTTP path to match.</span></span><br><span class="line"><span class="string">                              It may be either of the form: exact: &lt;path&gt;: which matches</span></span><br><span class="line"><span class="string">                              the path exactly or prefix: &lt;path-prefix&gt;: which matches</span></span><br><span class="line"><span class="string">                              the path prefix&#x27;</span></span><br><span class="line">                            <span class="attr">properties:</span></span><br><span class="line">                              <span class="attr">exact:</span></span><br><span class="line">                                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                              <span class="attr">prefix:</span></span><br><span class="line">                                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                            <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                    <span class="attr">icmp:</span></span><br><span class="line">                      <span class="attr">description:</span> <span class="string">ICMP</span> <span class="string">is</span> <span class="string">an</span> <span class="string">optional</span> <span class="string">field</span> <span class="string">that</span> <span class="string">restricts</span> <span class="string">the</span> <span class="string">rule</span></span><br><span class="line">                        <span class="string">to</span> <span class="string">apply</span> <span class="string">to</span> <span class="string">a</span> <span class="string">specific</span> <span class="string">type</span> <span class="string">and</span> <span class="string">code</span> <span class="string">of</span> <span class="string">ICMP</span> <span class="string">traffic.</span>  <span class="string">This</span></span><br><span class="line">                        <span class="string">should</span> <span class="string">only</span> <span class="string">be</span> <span class="string">specified</span> <span class="string">if</span> <span class="string">the</span> <span class="string">Protocol</span> <span class="string">field</span> <span class="string">is</span> <span class="string">set</span> <span class="string">to</span> <span class="string">&quot;ICMP&quot;</span></span><br><span class="line">                        <span class="string">or</span> <span class="string">&quot;ICMPv6&quot;</span><span class="string">.</span></span><br><span class="line">                      <span class="attr">properties:</span></span><br><span class="line">                        <span class="attr">code:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">Match</span> <span class="string">on</span> <span class="string">a</span> <span class="string">specific</span> <span class="string">ICMP</span> <span class="string">code.</span>  <span class="string">If</span> <span class="string">specified,</span></span><br><span class="line">                            <span class="string">the</span> <span class="string">Type</span> <span class="string">value</span> <span class="string">must</span> <span class="string">also</span> <span class="string">be</span> <span class="string">specified.</span> <span class="string">This</span> <span class="string">is</span> <span class="string">a</span> <span class="string">technical</span></span><br><span class="line">                            <span class="string">limitation</span> <span class="string">imposed</span> <span class="string">by</span> <span class="string">the</span> <span class="string">kernel&#x27;s</span> <span class="string">iptables</span> <span class="string">firewall,</span></span><br><span class="line">                            <span class="string">which</span> <span class="string">Calico</span> <span class="string">uses</span> <span class="string">to</span> <span class="string">enforce</span> <span class="string">the</span> <span class="string">rule.</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                        <span class="attr">type:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">Match</span> <span class="string">on</span> <span class="string">a</span> <span class="string">specific</span> <span class="string">ICMP</span> <span class="string">type.</span>  <span class="string">For</span> <span class="string">example</span></span><br><span class="line">                            <span class="string">a</span> <span class="string">value</span> <span class="string">of</span> <span class="number">8</span> <span class="string">refers</span> <span class="string">to</span> <span class="string">ICMP</span> <span class="string">Echo</span> <span class="string">Request</span> <span class="string">(i.e.</span> <span class="string">pings).</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                    <span class="attr">ipVersion:</span></span><br><span class="line">                      <span class="attr">description:</span> <span class="string">IPVersion</span> <span class="string">is</span> <span class="string">an</span> <span class="string">optional</span> <span class="string">field</span> <span class="string">that</span> <span class="string">restricts</span> <span class="string">the</span></span><br><span class="line">                        <span class="string">rule</span> <span class="string">to</span> <span class="string">only</span> <span class="string">match</span> <span class="string">a</span> <span class="string">specific</span> <span class="string">IP</span> <span class="string">version.</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                    <span class="attr">metadata:</span></span><br><span class="line">                      <span class="attr">description:</span> <span class="string">Metadata</span> <span class="string">contains</span> <span class="string">additional</span> <span class="string">information</span> <span class="string">for</span> <span class="string">this</span></span><br><span class="line">                        <span class="string">rule</span></span><br><span class="line">                      <span class="attr">properties:</span></span><br><span class="line">                        <span class="attr">annotations:</span></span><br><span class="line">                          <span class="attr">additionalProperties:</span></span><br><span class="line">                            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">Annotations</span> <span class="string">is</span> <span class="string">a</span> <span class="string">set</span> <span class="string">of</span> <span class="string">key</span> <span class="string">value</span> <span class="string">pairs</span> <span class="string">that</span></span><br><span class="line">                            <span class="string">give</span> <span class="string">extra</span> <span class="string">information</span> <span class="string">about</span> <span class="string">the</span> <span class="string">rule</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                    <span class="attr">notICMP:</span></span><br><span class="line">                      <span class="attr">description:</span> <span class="string">NotICMP</span> <span class="string">is</span> <span class="string">the</span> <span class="string">negated</span> <span class="string">version</span> <span class="string">of</span> <span class="string">the</span> <span class="string">ICMP</span> <span class="string">field.</span></span><br><span class="line">                      <span class="attr">properties:</span></span><br><span class="line">                        <span class="attr">code:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">Match</span> <span class="string">on</span> <span class="string">a</span> <span class="string">specific</span> <span class="string">ICMP</span> <span class="string">code.</span>  <span class="string">If</span> <span class="string">specified,</span></span><br><span class="line">                            <span class="string">the</span> <span class="string">Type</span> <span class="string">value</span> <span class="string">must</span> <span class="string">also</span> <span class="string">be</span> <span class="string">specified.</span> <span class="string">This</span> <span class="string">is</span> <span class="string">a</span> <span class="string">technical</span></span><br><span class="line">                            <span class="string">limitation</span> <span class="string">imposed</span> <span class="string">by</span> <span class="string">the</span> <span class="string">kernel&#x27;s</span> <span class="string">iptables</span> <span class="string">firewall,</span></span><br><span class="line">                            <span class="string">which</span> <span class="string">Calico</span> <span class="string">uses</span> <span class="string">to</span> <span class="string">enforce</span> <span class="string">the</span> <span class="string">rule.</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                        <span class="attr">type:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">Match</span> <span class="string">on</span> <span class="string">a</span> <span class="string">specific</span> <span class="string">ICMP</span> <span class="string">type.</span>  <span class="string">For</span> <span class="string">example</span></span><br><span class="line">                            <span class="string">a</span> <span class="string">value</span> <span class="string">of</span> <span class="number">8</span> <span class="string">refers</span> <span class="string">to</span> <span class="string">ICMP</span> <span class="string">Echo</span> <span class="string">Request</span> <span class="string">(i.e.</span> <span class="string">pings).</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                    <span class="attr">notProtocol:</span></span><br><span class="line">                      <span class="attr">anyOf:</span></span><br><span class="line">                      <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                      <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                      <span class="attr">description:</span> <span class="string">NotProtocol</span> <span class="string">is</span> <span class="string">the</span> <span class="string">negated</span> <span class="string">version</span> <span class="string">of</span> <span class="string">the</span> <span class="string">Protocol</span></span><br><span class="line">                        <span class="string">field.</span></span><br><span class="line">                      <span class="attr">pattern:</span> <span class="string">^.*</span></span><br><span class="line">                      <span class="attr">x-kubernetes-int-or-string:</span> <span class="literal">true</span></span><br><span class="line">                    <span class="attr">protocol:</span></span><br><span class="line">                      <span class="attr">anyOf:</span></span><br><span class="line">                      <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                      <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                      <span class="attr">description:</span> <span class="string">&quot;Protocol is an optional field that restricts the</span></span><br><span class="line"><span class="string">                        rule to only apply to traffic of a specific IP protocol. Required</span></span><br><span class="line"><span class="string">                        if any of the EntityRules contain Ports (because ports only</span></span><br><span class="line"><span class="string">                        apply to certain protocols). \n Must be one of these string</span></span><br><span class="line"><span class="string">                        values: \&quot;TCP\&quot;, \&quot;UDP\&quot;, \&quot;ICMP\&quot;, \&quot;ICMPv6\&quot;, \&quot;SCTP\&quot;,</span></span><br><span class="line"><span class="string">                        \&quot;UDPLite\&quot; or an integer in the range 1-255.&quot;</span></span><br><span class="line">                      <span class="attr">pattern:</span> <span class="string">^.*</span></span><br><span class="line">                      <span class="attr">x-kubernetes-int-or-string:</span> <span class="literal">true</span></span><br><span class="line">                    <span class="attr">source:</span></span><br><span class="line">                      <span class="attr">description:</span> <span class="string">Source</span> <span class="string">contains</span> <span class="string">the</span> <span class="string">match</span> <span class="string">criteria</span> <span class="string">that</span> <span class="string">apply</span> <span class="string">to</span></span><br><span class="line">                        <span class="string">source</span> <span class="string">entity.</span></span><br><span class="line">                      <span class="attr">properties:</span></span><br><span class="line">                        <span class="attr">namespaceSelector:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">&quot;NamespaceSelector is an optional field that</span></span><br><span class="line"><span class="string">                            contains a selector expression. Only traffic that originates</span></span><br><span class="line"><span class="string">                            from (or terminates at) endpoints within the selected</span></span><br><span class="line"><span class="string">                            namespaces will be matched. When both NamespaceSelector</span></span><br><span class="line"><span class="string">                            and another selector are defined on the same rule, then</span></span><br><span class="line"><span class="string">                            only workload endpoints that are matched by both selectors</span></span><br><span class="line"><span class="string">                            will be selected by the rule. \n For NetworkPolicy, an</span></span><br><span class="line"><span class="string">                            empty NamespaceSelector implies that the Selector is limited</span></span><br><span class="line"><span class="string">                            to selecting only workload endpoints in the same namespace</span></span><br><span class="line"><span class="string">                            as the NetworkPolicy. \n For NetworkPolicy, `global()`</span></span><br><span class="line"><span class="string">                            NamespaceSelector implies that the Selector is limited</span></span><br><span class="line"><span class="string">                            to selecting only GlobalNetworkSet or HostEndpoint. \n</span></span><br><span class="line"><span class="string">                            For GlobalNetworkPolicy, an empty NamespaceSelector implies</span></span><br><span class="line"><span class="string">                            the Selector applies to workload endpoints across all</span></span><br><span class="line"><span class="string">                            namespaces.&quot;</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                        <span class="attr">nets:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">Nets</span> <span class="string">is</span> <span class="string">an</span> <span class="string">optional</span> <span class="string">field</span> <span class="string">that</span> <span class="string">restricts</span> <span class="string">the</span></span><br><span class="line">                            <span class="string">rule</span> <span class="string">to</span> <span class="string">only</span> <span class="string">apply</span> <span class="string">to</span> <span class="string">traffic</span> <span class="string">that</span> <span class="string">originates</span> <span class="string">from</span> <span class="string">(or</span></span><br><span class="line">                            <span class="string">terminates</span> <span class="string">at)</span> <span class="string">IP</span> <span class="string">addresses</span> <span class="string">in</span> <span class="string">any</span> <span class="string">of</span> <span class="string">the</span> <span class="string">given</span> <span class="string">subnets.</span></span><br><span class="line">                          <span class="attr">items:</span></span><br><span class="line">                            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                        <span class="attr">notNets:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">NotNets</span> <span class="string">is</span> <span class="string">the</span> <span class="string">negated</span> <span class="string">version</span> <span class="string">of</span> <span class="string">the</span> <span class="string">Nets</span></span><br><span class="line">                            <span class="string">field.</span></span><br><span class="line">                          <span class="attr">items:</span></span><br><span class="line">                            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                        <span class="attr">notPorts:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">NotPorts</span> <span class="string">is</span> <span class="string">the</span> <span class="string">negated</span> <span class="string">version</span> <span class="string">of</span> <span class="string">the</span> <span class="string">Ports</span></span><br><span class="line">                            <span class="string">field.</span> <span class="string">Since</span> <span class="string">only</span> <span class="string">some</span> <span class="string">protocols</span> <span class="string">have</span> <span class="string">ports,</span> <span class="string">if</span> <span class="string">any</span> <span class="string">ports</span></span><br><span class="line">                            <span class="string">are</span> <span class="string">specified</span> <span class="string">it</span> <span class="string">requires</span> <span class="string">the</span> <span class="string">Protocol</span> <span class="string">match</span> <span class="string">in</span> <span class="string">the</span> <span class="string">Rule</span></span><br><span class="line">                            <span class="string">to</span> <span class="string">be</span> <span class="string">set</span> <span class="string">to</span> <span class="string">&quot;TCP&quot;</span> <span class="string">or</span> <span class="string">&quot;UDP&quot;</span><span class="string">.</span></span><br><span class="line">                          <span class="attr">items:</span></span><br><span class="line">                            <span class="attr">anyOf:</span></span><br><span class="line">                            <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                            <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                            <span class="attr">pattern:</span> <span class="string">^.*</span></span><br><span class="line">                            <span class="attr">x-kubernetes-int-or-string:</span> <span class="literal">true</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                        <span class="attr">notSelector:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">NotSelector</span> <span class="string">is</span> <span class="string">the</span> <span class="string">negated</span> <span class="string">version</span> <span class="string">of</span> <span class="string">the</span> <span class="string">Selector</span></span><br><span class="line">                            <span class="string">field.</span>  <span class="string">See</span> <span class="string">Selector</span> <span class="string">field</span> <span class="string">for</span> <span class="string">subtleties</span> <span class="string">with</span> <span class="string">negated</span></span><br><span class="line">                            <span class="string">selectors.</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                        <span class="attr">ports:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">&quot;Ports is an optional field that restricts</span></span><br><span class="line"><span class="string">                            the rule to only apply to traffic that has a source (destination)</span></span><br><span class="line"><span class="string">                            port that matches one of these ranges/values. This value</span></span><br><span class="line"><span class="string">                            is a list of integers or strings that represent ranges</span></span><br><span class="line"><span class="string">                            of ports. \n Since only some protocols have ports, if</span></span><br><span class="line"><span class="string">                            any ports are specified it requires the Protocol match</span></span><br><span class="line"><span class="string">                            in the Rule to be set to \&quot;TCP\&quot; or \&quot;UDP\&quot;.&quot;</span></span><br><span class="line">                          <span class="attr">items:</span></span><br><span class="line">                            <span class="attr">anyOf:</span></span><br><span class="line">                            <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">                            <span class="bullet">-</span> <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                            <span class="attr">pattern:</span> <span class="string">^.*</span></span><br><span class="line">                            <span class="attr">x-kubernetes-int-or-string:</span> <span class="literal">true</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                        <span class="attr">selector:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">&quot;Selector is an optional field that contains</span></span><br><span class="line"><span class="string">                            a selector expression (see Policy for sample syntax).</span></span><br><span class="line"><span class="string">                            \ Only traffic that originates from (terminates at) endpoints</span></span><br><span class="line"><span class="string">                            matching the selector will be matched. \n Note that: in</span></span><br><span class="line"><span class="string">                            addition to the negated version of the Selector (see NotSelector</span></span><br><span class="line"><span class="string">                            below), the selector expression syntax itself supports</span></span><br><span class="line"><span class="string">                            negation.  The two types of negation are subtly different.</span></span><br><span class="line"><span class="string">                            One negates the set of matched endpoints, the other negates</span></span><br><span class="line"><span class="string">                            the whole match: \n \tSelector = \&quot;!has(my_label)\&quot; matches</span></span><br><span class="line"><span class="string">                            packets that are from other Calico-controlled \tendpoints</span></span><br><span class="line"><span class="string">                            that do not have the label \&quot;my_label\&quot;. \n \tNotSelector</span></span><br><span class="line"><span class="string">                            = \&quot;has(my_label)\&quot; matches packets that are not from</span></span><br><span class="line"><span class="string">                            Calico-controlled \tendpoints that do have the label \&quot;my_label\&quot;.</span></span><br><span class="line"><span class="string">                            \n The effect is that the latter will accept packets from</span></span><br><span class="line"><span class="string">                            non-Calico sources whereas the former is limited to packets</span></span><br><span class="line"><span class="string">                            from Calico-controlled endpoints.&quot;</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                        <span class="attr">serviceAccounts:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">ServiceAccounts</span> <span class="string">is</span> <span class="string">an</span> <span class="string">optional</span> <span class="string">field</span> <span class="string">that</span> <span class="string">restricts</span></span><br><span class="line">                            <span class="string">the</span> <span class="string">rule</span> <span class="string">to</span> <span class="string">only</span> <span class="string">apply</span> <span class="string">to</span> <span class="string">traffic</span> <span class="string">that</span> <span class="string">originates</span> <span class="string">from</span></span><br><span class="line">                            <span class="string">(or</span> <span class="string">terminates</span> <span class="string">at)</span> <span class="string">a</span> <span class="string">pod</span> <span class="string">running</span> <span class="string">as</span> <span class="string">a</span> <span class="string">matching</span> <span class="string">service</span></span><br><span class="line">                            <span class="string">account.</span></span><br><span class="line">                          <span class="attr">properties:</span></span><br><span class="line">                            <span class="attr">names:</span></span><br><span class="line">                              <span class="attr">description:</span> <span class="string">Names</span> <span class="string">is</span> <span class="string">an</span> <span class="string">optional</span> <span class="string">field</span> <span class="string">that</span> <span class="string">restricts</span></span><br><span class="line">                                <span class="string">the</span> <span class="string">rule</span> <span class="string">to</span> <span class="string">only</span> <span class="string">apply</span> <span class="string">to</span> <span class="string">traffic</span> <span class="string">that</span> <span class="string">originates</span></span><br><span class="line">                                <span class="string">from</span> <span class="string">(or</span> <span class="string">terminates</span> <span class="string">at)</span> <span class="string">a</span> <span class="string">pod</span> <span class="string">running</span> <span class="string">as</span> <span class="string">a</span> <span class="string">service</span></span><br><span class="line">                                <span class="string">account</span> <span class="string">whose</span> <span class="string">name</span> <span class="string">is</span> <span class="string">in</span> <span class="string">the</span> <span class="string">list.</span></span><br><span class="line">                              <span class="attr">items:</span></span><br><span class="line">                                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                              <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">                            <span class="attr">selector:</span></span><br><span class="line">                              <span class="attr">description:</span> <span class="string">Selector</span> <span class="string">is</span> <span class="string">an</span> <span class="string">optional</span> <span class="string">field</span> <span class="string">that</span> <span class="string">restricts</span></span><br><span class="line">                                <span class="string">the</span> <span class="string">rule</span> <span class="string">to</span> <span class="string">only</span> <span class="string">apply</span> <span class="string">to</span> <span class="string">traffic</span> <span class="string">that</span> <span class="string">originates</span></span><br><span class="line">                                <span class="string">from</span> <span class="string">(or</span> <span class="string">terminates</span> <span class="string">at)</span> <span class="string">a</span> <span class="string">pod</span> <span class="string">running</span> <span class="string">as</span> <span class="string">a</span> <span class="string">service</span></span><br><span class="line">                                <span class="string">account</span> <span class="string">that</span> <span class="string">matches</span> <span class="string">the</span> <span class="string">given</span> <span class="string">label</span> <span class="string">selector.</span> <span class="string">If</span></span><br><span class="line">                                <span class="string">both</span> <span class="string">Names</span> <span class="string">and</span> <span class="string">Selector</span> <span class="string">are</span> <span class="string">specified</span> <span class="string">then</span> <span class="string">they</span> <span class="string">are</span></span><br><span class="line">                                <span class="string">AND&#x27;ed.</span></span><br><span class="line">                              <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                        <span class="attr">services:</span></span><br><span class="line">                          <span class="attr">description:</span> <span class="string">&quot;Services is an optional field that contains</span></span><br><span class="line"><span class="string">                            options for matching Kubernetes Services. If specified,</span></span><br><span class="line"><span class="string">                            only traffic that originates from or terminates at endpoints</span></span><br><span class="line"><span class="string">                            within the selected service(s) will be matched, and only</span></span><br><span class="line"><span class="string">                            to/from each endpoint&#x27;s port. \n Services cannot be specified</span></span><br><span class="line"><span class="string">                            on the same rule as Selector, NotSelector, NamespaceSelector,</span></span><br><span class="line"><span class="string">                            Nets, NotNets or ServiceAccounts. \n Ports and NotPorts</span></span><br><span class="line"><span class="string">                            can only be specified with Services on ingress rules.&quot;</span></span><br><span class="line">                          <span class="attr">properties:</span></span><br><span class="line">                            <span class="attr">name:</span></span><br><span class="line">                              <span class="attr">description:</span> <span class="string">Name</span> <span class="string">specifies</span> <span class="string">the</span> <span class="string">name</span> <span class="string">of</span> <span class="string">a</span> <span class="string">Kubernetes</span></span><br><span class="line">                                <span class="string">Service</span> <span class="string">to</span> <span class="string">match.</span></span><br><span class="line">                              <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                            <span class="attr">namespace:</span></span><br><span class="line">                              <span class="attr">description:</span> <span class="string">Namespace</span> <span class="string">specifies</span> <span class="string">the</span> <span class="string">namespace</span> <span class="string">of</span> <span class="string">the</span></span><br><span class="line">                                <span class="string">given</span> <span class="string">Service.</span> <span class="string">If</span> <span class="string">left</span> <span class="string">empty,</span> <span class="string">the</span> <span class="string">rule</span> <span class="string">will</span> <span class="string">match</span></span><br><span class="line">                                <span class="string">within</span> <span class="string">this</span> <span class="string">policy&#x27;s</span> <span class="string">namespace.</span></span><br><span class="line">                              <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                          <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                      <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                  <span class="attr">required:</span></span><br><span class="line">                  <span class="bullet">-</span> <span class="string">action</span></span><br><span class="line">                  <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">              <span class="attr">order:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">Order</span> <span class="string">is</span> <span class="string">an</span> <span class="string">optional</span> <span class="string">field</span> <span class="string">that</span> <span class="string">specifies</span> <span class="string">the</span> <span class="string">order</span> <span class="string">in</span></span><br><span class="line">                  <span class="string">which</span> <span class="string">the</span> <span class="string">policy</span> <span class="string">is</span> <span class="string">applied.</span> <span class="string">Policies</span> <span class="string">with</span> <span class="string">higher</span> <span class="string">&quot;order&quot;</span> <span class="string">are</span> <span class="string">applied</span></span><br><span class="line">                  <span class="string">after</span> <span class="string">those</span> <span class="string">with</span> <span class="string">lower</span> <span class="string">order.</span>  <span class="string">If</span> <span class="string">the</span> <span class="string">order</span> <span class="string">is</span> <span class="string">omitted,</span> <span class="string">it</span> <span class="string">may</span> <span class="string">be</span></span><br><span class="line">                  <span class="string">considered</span> <span class="string">to</span> <span class="string">be</span> <span class="string">&quot;infinite&quot;</span> <span class="bullet">-</span> <span class="string">i.e.</span> <span class="string">the</span> <span class="string">policy</span> <span class="string">will</span> <span class="string">be</span> <span class="string">applied</span> <span class="string">last.</span>  <span class="string">Policies</span></span><br><span class="line">                  <span class="string">with</span> <span class="string">identical</span> <span class="string">order</span> <span class="string">will</span> <span class="string">be</span> <span class="string">applied</span> <span class="string">in</span> <span class="string">alphanumerical</span> <span class="string">order</span> <span class="string">based</span></span><br><span class="line">                  <span class="string">on</span> <span class="string">the</span> <span class="string">Policy</span> <span class="string">&quot;Name&quot;</span><span class="string">.</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">number</span></span><br><span class="line">              <span class="attr">selector:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&quot;The selector is an expression used to pick pick out</span></span><br><span class="line"><span class="string">                  the endpoints that the policy should be applied to. \n Selector</span></span><br><span class="line"><span class="string">                  expressions follow this syntax: \n \tlabel == \&quot;string_literal\&quot;</span></span><br><span class="line"><span class="string">                  \ -&gt;  comparison, e.g. my_label == \&quot;foo bar\&quot; \tlabel != \&quot;string_literal\&quot;</span></span><br><span class="line"><span class="string">                  \  -&gt;  not equal; also matches if label is not present \tlabel in</span></span><br><span class="line"><span class="string">                  &#123; \&quot;a\&quot;, \&quot;b\&quot;, \&quot;c\&quot;, ... &#125;  -&gt;  true if the value of label X is</span></span><br><span class="line"><span class="string">                  one of \&quot;a\&quot;, \&quot;b\&quot;, \&quot;c\&quot; \tlabel not in &#123; \&quot;a\&quot;, \&quot;b\&quot;, \&quot;c\&quot;,</span></span><br><span class="line"><span class="string">                  ... &#125;  -&gt;  true if the value of label X is not one of \&quot;a\&quot;, \&quot;b\&quot;,</span></span><br><span class="line"><span class="string">                  \&quot;c\&quot; \thas(label_name)  -&gt; True if that label is present \t! expr</span></span><br><span class="line"><span class="string">                  -&gt; negation of expr \texpr &amp;&amp; expr  -&gt; Short-circuit and \texpr</span></span><br><span class="line"><span class="string">                  || expr  -&gt; Short-circuit or \t( expr ) -&gt; parens for grouping \tall()</span></span><br><span class="line"><span class="string">                  or the empty selector -&gt; matches all endpoints. \n Label names are</span></span><br><span class="line"><span class="string">                  allowed to contain alphanumerics, -, _ and /. String literals are</span></span><br><span class="line"><span class="string">                  more permissive but they do not support escape characters. \n Examples</span></span><br><span class="line"><span class="string">                  (with made-up labels): \n \ttype == \&quot;webserver\&quot; &amp;&amp; deployment</span></span><br><span class="line"><span class="string">                  == \&quot;prod\&quot; \ttype in &#123;\&quot;frontend\&quot;, \&quot;backend\&quot;&#125; \tdeployment !=</span></span><br><span class="line"><span class="string">                  \&quot;dev\&quot; \t! has(label_name)&quot;</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">serviceAccountSelector:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">ServiceAccountSelector</span> <span class="string">is</span> <span class="string">an</span> <span class="string">optional</span> <span class="string">field</span> <span class="string">for</span> <span class="string">an</span> <span class="string">expression</span></span><br><span class="line">                  <span class="string">used</span> <span class="string">to</span> <span class="string">select</span> <span class="string">a</span> <span class="string">pod</span> <span class="string">based</span> <span class="string">on</span> <span class="string">service</span> <span class="string">accounts.</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">types:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">&quot;Types indicates whether this policy applies to ingress,</span></span><br><span class="line"><span class="string">                  or to egress, or to both.  When not explicitly specified (and so</span></span><br><span class="line"><span class="string">                  the value on creation is empty or nil), Calico defaults Types according</span></span><br><span class="line"><span class="string">                  to what Ingress and Egress are present in the policy.  The default</span></span><br><span class="line"><span class="string">                  is: \n - [ PolicyTypeIngress ], if there are no Egress rules (including</span></span><br><span class="line"><span class="string">                  the case where there are   also no Ingress rules) \n - [ PolicyTypeEgress</span></span><br><span class="line"><span class="string">                  ], if there are Egress rules but no Ingress rules \n - [ PolicyTypeIngress,</span></span><br><span class="line"><span class="string">                  PolicyTypeEgress ], if there are both Ingress and Egress rules.</span></span><br><span class="line"><span class="string">                  \n When the policy is read back again, Types will always be one</span></span><br><span class="line"><span class="string">                  of these values, never empty or nil.&quot;</span></span><br><span class="line">                <span class="attr">items:</span></span><br><span class="line">                  <span class="attr">description:</span> <span class="string">PolicyType</span> <span class="string">enumerates</span> <span class="string">the</span> <span class="string">possible</span> <span class="string">values</span> <span class="string">of</span> <span class="string">the</span> <span class="string">PolicySpec</span></span><br><span class="line">                    <span class="string">Types</span> <span class="string">field.</span></span><br><span class="line">                  <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">    <span class="attr">served:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">storage:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">status:</span></span><br><span class="line">  <span class="attr">acceptedNames:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">conditions:</span> []</span><br><span class="line">  <span class="attr">storedVersions:</span> []</span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apiextensions.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CustomResourceDefinition</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">networksets.crd.projectcalico.org</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">group:</span> <span class="string">crd.projectcalico.org</span></span><br><span class="line">  <span class="attr">names:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">NetworkSet</span></span><br><span class="line">    <span class="attr">listKind:</span> <span class="string">NetworkSetList</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">networksets</span></span><br><span class="line">    <span class="attr">singular:</span> <span class="string">networkset</span></span><br><span class="line">  <span class="attr">scope:</span> <span class="string">Namespaced</span></span><br><span class="line">  <span class="attr">versions:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">v1</span></span><br><span class="line">    <span class="attr">schema:</span></span><br><span class="line">      <span class="attr">openAPIV3Schema:</span></span><br><span class="line">        <span class="attr">description:</span> <span class="string">NetworkSet</span> <span class="string">is</span> <span class="string">the</span> <span class="string">Namespaced-equivalent</span> <span class="string">of</span> <span class="string">the</span> <span class="string">GlobalNetworkSet.</span></span><br><span class="line">        <span class="attr">properties:</span></span><br><span class="line">          <span class="attr">apiVersion:</span></span><br><span class="line">            <span class="attr">description:</span> <span class="string">&#x27;APIVersion defines the versioned schema of this representation</span></span><br><span class="line"><span class="string">              of an object. Servers should convert recognized schemas to the latest</span></span><br><span class="line"><span class="string">              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources&#x27;</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">          <span class="attr">kind:</span></span><br><span class="line">            <span class="attr">description:</span> <span class="string">&#x27;Kind is a string value representing the REST resource this</span></span><br><span class="line"><span class="string">              object represents. Servers may infer this from the endpoint the client</span></span><br><span class="line"><span class="string">              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds&#x27;</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">          <span class="attr">metadata:</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">          <span class="attr">spec:</span></span><br><span class="line">            <span class="attr">description:</span> <span class="string">NetworkSetSpec</span> <span class="string">contains</span> <span class="string">the</span> <span class="string">specification</span> <span class="string">for</span> <span class="string">a</span> <span class="string">NetworkSet</span></span><br><span class="line">              <span class="string">resource.</span></span><br><span class="line">            <span class="attr">properties:</span></span><br><span class="line">              <span class="attr">nets:</span></span><br><span class="line">                <span class="attr">description:</span> <span class="string">The</span> <span class="string">list</span> <span class="string">of</span> <span class="string">IP</span> <span class="string">networks</span> <span class="string">that</span> <span class="string">belong</span> <span class="string">to</span> <span class="string">this</span> <span class="string">set.</span></span><br><span class="line">                <span class="attr">items:</span></span><br><span class="line">                  <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">    <span class="attr">served:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">storage:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">status:</span></span><br><span class="line">  <span class="attr">acceptedNames:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">conditions:</span> []</span><br><span class="line">  <span class="attr">storedVersions:</span> []</span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Source: calico/templates/calico-kube-controllers-rbac.yaml</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Include a clusterrole for the kube-controllers component,</span></span><br><span class="line"><span class="comment"># and bind it to the calico-kube-controllers serviceaccount.</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">calico-kube-controllers</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="comment"># Nodes are watched to monitor for deletions.</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">nodes</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">  <span class="comment"># Pods are watched to check for existence as part of IPAM controller.</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">pods</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line">  <span class="comment"># IPAM resources are manipulated when nodes are deleted.</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;crd.projectcalico.org&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ippools</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ipreservations</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;crd.projectcalico.org&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">blockaffinities</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ipamblocks</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ipamhandles</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">create</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">update</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">delete</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line">  <span class="comment"># kube-controllers manages hostendpoints.</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;crd.projectcalico.org&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">hostendpoints</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">create</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">update</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">delete</span></span><br><span class="line">  <span class="comment"># Needs access to update clusterinformations.</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;crd.projectcalico.org&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">clusterinformations</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">create</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">update</span></span><br><span class="line">  <span class="comment"># KubeControllersConfiguration is where it gets its config</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;crd.projectcalico.org&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">kubecontrollersconfigurations</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="comment"># read its own config</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">      <span class="comment"># create a default if none exists</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">create</span></span><br><span class="line">      <span class="comment"># update status</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">update</span></span><br><span class="line">      <span class="comment"># watch for changes</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">calico-kube-controllers</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">calico-kube-controllers</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">calico-kube-controllers</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Source: calico/templates/calico-node-rbac.yaml</span></span><br><span class="line"><span class="comment"># Include a clusterrole for the calico-node DaemonSet,</span></span><br><span class="line"><span class="comment"># and bind it to the calico-node serviceaccount.</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">calico-node</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="comment"># The CNI plugin needs to get pods, nodes, and namespaces.</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">pods</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">nodes</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">namespaces</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">  <span class="comment"># EndpointSlices are used for Service-based network policy rule</span></span><br><span class="line">  <span class="comment"># enforcement.</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;discovery.k8s.io&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">endpointslices</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">watch</span> </span><br><span class="line">      <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">endpoints</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">services</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="comment"># Used to discover service IPs for advertisement.</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">      <span class="comment"># Used to discover Typhas.</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">  <span class="comment"># Pod CIDR auto-detection on kubeadm needs access to config maps.</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">configmaps</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">nodes/status</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="comment"># Needed for clearing NodeNetworkUnavailable flag.</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">patch</span></span><br><span class="line">      <span class="comment"># Calico stores some configuration information in node annotations.</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">update</span></span><br><span class="line">  <span class="comment"># Watch for changes to Kubernetes NetworkPolicies.</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;networking.k8s.io&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">networkpolicies</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">  <span class="comment"># Used by Calico for policy information.</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">pods</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">namespaces</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">serviceaccounts</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line">  <span class="comment"># The CNI plugin patches pods/status.</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">pods/status</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">patch</span></span><br><span class="line">  <span class="comment"># Calico monitors various CRDs for config.</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;crd.projectcalico.org&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">globalfelixconfigs</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">felixconfigurations</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">bgppeers</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">globalbgpconfigs</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">bgpconfigurations</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ippools</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ipreservations</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ipamblocks</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">globalnetworkpolicies</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">globalnetworksets</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">networkpolicies</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">networksets</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">clusterinformations</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">hostendpoints</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">blockaffinities</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">caliconodestatuses</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line">  <span class="comment"># Calico must create and update some CRDs on startup.</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;crd.projectcalico.org&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ippools</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">felixconfigurations</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">clusterinformations</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">create</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">update</span></span><br><span class="line">  <span class="comment"># Calico must update some CRDs.</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [ <span class="string">&quot;crd.projectcalico.org&quot;</span> ]</span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">caliconodestatuses</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">update</span></span><br><span class="line">  <span class="comment"># Calico stores some configuration information on the node.</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">nodes</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line">  <span class="comment"># These permissions are only required for upgrade from v2.6, and can</span></span><br><span class="line">  <span class="comment"># be removed after upgrade or on fresh installations.</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;crd.projectcalico.org&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">bgpconfigurations</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">bgppeers</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">create</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">update</span></span><br><span class="line">  <span class="comment"># These permissions are required for Calico CNI to perform IPAM allocations.</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;crd.projectcalico.org&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">blockaffinities</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ipamblocks</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ipamhandles</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">create</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">update</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">delete</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;crd.projectcalico.org&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ipamconfigs</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">  <span class="comment"># Block affinities must also be watchable by confd for route aggregation.</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;crd.projectcalico.org&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">blockaffinities</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line">  <span class="comment"># The Calico IPAM migration needs to get daemonsets. These permissions can be</span></span><br><span class="line">  <span class="comment"># removed if not upgrading from an installation using host-local IPAM.</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;apps&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">daemonsets</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">calico-node</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">calico-node</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">calico-node</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Source: calico/templates/calico-node.yaml</span></span><br><span class="line"><span class="comment"># This manifest installs the calico-node container, as well</span></span><br><span class="line"><span class="comment"># as the CNI plugins and network config on</span></span><br><span class="line"><span class="comment"># each master and worker node in a Kubernetes cluster.</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">DaemonSet</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">calico-node</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">k8s-app:</span> <span class="string">calico-node</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">k8s-app:</span> <span class="string">calico-node</span></span><br><span class="line">  <span class="attr">updateStrategy:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">RollingUpdate</span></span><br><span class="line">    <span class="attr">rollingUpdate:</span></span><br><span class="line">      <span class="attr">maxUnavailable:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">k8s-app:</span> <span class="string">calico-node</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">nodeSelector:</span></span><br><span class="line">        <span class="attr">kubernetes.io/os:</span> <span class="string">linux</span></span><br><span class="line">      <span class="attr">hostNetwork:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">tolerations:</span></span><br><span class="line">        <span class="comment"># Make sure calico-node gets scheduled on all nodes.</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">effect:</span> <span class="string">NoSchedule</span></span><br><span class="line">          <span class="attr">operator:</span> <span class="string">Exists</span></span><br><span class="line">        <span class="comment"># Mark the pod as a critical add-on for rescheduling.</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">CriticalAddonsOnly</span></span><br><span class="line">          <span class="attr">operator:</span> <span class="string">Exists</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">effect:</span> <span class="string">NoExecute</span></span><br><span class="line">          <span class="attr">operator:</span> <span class="string">Exists</span></span><br><span class="line">      <span class="attr">serviceAccountName:</span> <span class="string">calico-node</span></span><br><span class="line">      <span class="comment"># Minimize downtime during a rolling upgrade or deletion; tell Kubernetes to do a &quot;force</span></span><br><span class="line">      <span class="comment"># deletion&quot;: https://kubernetes.io/docs/concepts/workloads/pods/pod/#termination-of-pods.</span></span><br><span class="line">      <span class="attr">terminationGracePeriodSeconds:</span> <span class="number">0</span></span><br><span class="line">      <span class="attr">priorityClassName:</span> <span class="string">system-node-critical</span></span><br><span class="line">      <span class="attr">initContainers:</span></span><br><span class="line">        <span class="comment"># This container performs upgrade from host-local IPAM to calico-ipam.</span></span><br><span class="line">        <span class="comment"># It can be deleted if this is a fresh installation, or if you have already</span></span><br><span class="line">        <span class="comment"># upgraded to use calico-ipam.</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">upgrade-ipam</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">docker.io/calico/cni:v3.22.1</span></span><br><span class="line">          <span class="attr">command:</span> [<span class="string">&quot;/opt/cni/bin/calico-ipam&quot;</span>, <span class="string">&quot;-upgrade&quot;</span>]</span><br><span class="line">          <span class="attr">envFrom:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">configMapRef:</span></span><br><span class="line">              <span class="comment"># Allow KUBERNETES_SERVICE_HOST and KUBERNETES_SERVICE_PORT to be overridden for eBPF mode.</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">kubernetes-services-endpoint</span></span><br><span class="line">              <span class="attr">optional:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">env:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">KUBERNETES_NODE_NAME</span></span><br><span class="line">              <span class="attr">valueFrom:</span></span><br><span class="line">                <span class="attr">fieldRef:</span></span><br><span class="line">                  <span class="attr">fieldPath:</span> <span class="string">spec.nodeName</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">CALICO_NETWORKING_BACKEND</span></span><br><span class="line">              <span class="attr">valueFrom:</span></span><br><span class="line">                <span class="attr">configMapKeyRef:</span></span><br><span class="line">                  <span class="attr">name:</span> <span class="string">calico-config</span></span><br><span class="line">                  <span class="attr">key:</span> <span class="string">calico_backend</span></span><br><span class="line">          <span class="attr">volumeMounts:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/var/lib/cni/networks</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">host-local-net-dir</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/host/opt/cni/bin</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">cni-bin-dir</span></span><br><span class="line">          <span class="attr">securityContext:</span></span><br><span class="line">            <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">        <span class="comment"># This container installs the CNI binaries</span></span><br><span class="line">        <span class="comment"># and CNI network config file on each node.</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">install-cni</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">docker.io/calico/cni:v3.22.1</span></span><br><span class="line">          <span class="attr">command:</span> [<span class="string">&quot;/opt/cni/bin/install&quot;</span>]</span><br><span class="line">          <span class="attr">envFrom:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">configMapRef:</span></span><br><span class="line">              <span class="comment"># Allow KUBERNETES_SERVICE_HOST and KUBERNETES_SERVICE_PORT to be overridden for eBPF mode.</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">kubernetes-services-endpoint</span></span><br><span class="line">              <span class="attr">optional:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">env:</span></span><br><span class="line">            <span class="comment"># Name of the CNI config file to create.</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">CNI_CONF_NAME</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&quot;10-calico.conflist&quot;</span></span><br><span class="line">            <span class="comment"># The CNI network config to install on each node.</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">CNI_NETWORK_CONFIG</span></span><br><span class="line">              <span class="attr">valueFrom:</span></span><br><span class="line">                <span class="attr">configMapKeyRef:</span></span><br><span class="line">                  <span class="attr">name:</span> <span class="string">calico-config</span></span><br><span class="line">                  <span class="attr">key:</span> <span class="string">cni_network_config</span></span><br><span class="line">            <span class="comment"># Set the hostname based on the k8s node name.</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">KUBERNETES_NODE_NAME</span></span><br><span class="line">              <span class="attr">valueFrom:</span></span><br><span class="line">                <span class="attr">fieldRef:</span></span><br><span class="line">                  <span class="attr">fieldPath:</span> <span class="string">spec.nodeName</span></span><br><span class="line">            <span class="comment"># CNI MTU Config variable</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">CNI_MTU</span></span><br><span class="line">              <span class="attr">valueFrom:</span></span><br><span class="line">                <span class="attr">configMapKeyRef:</span></span><br><span class="line">                  <span class="attr">name:</span> <span class="string">calico-config</span></span><br><span class="line">                  <span class="attr">key:</span> <span class="string">veth_mtu</span></span><br><span class="line">            <span class="comment"># Prevents the container from sleeping forever.</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">SLEEP</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&quot;false&quot;</span></span><br><span class="line">          <span class="attr">volumeMounts:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/host/opt/cni/bin</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">cni-bin-dir</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/host/etc/cni/net.d</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">cni-net-dir</span></span><br><span class="line">          <span class="attr">securityContext:</span></span><br><span class="line">            <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">        <span class="comment"># Adds a Flex Volume Driver that creates a per-pod Unix Domain Socket to allow Dikastes</span></span><br><span class="line">        <span class="comment"># to communicate with Felix over the Policy Sync API.</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">flexvol-driver</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">docker.io/calico/pod2daemon-flexvol:v3.22.1</span></span><br><span class="line">          <span class="attr">volumeMounts:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">flexvol-driver-host</span></span><br><span class="line">            <span class="attr">mountPath:</span> <span class="string">/host/driver</span></span><br><span class="line">          <span class="attr">securityContext:</span></span><br><span class="line">            <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="comment"># Runs calico-node container on each Kubernetes node. This</span></span><br><span class="line">        <span class="comment"># container programs network policy and routes on each</span></span><br><span class="line">        <span class="comment"># host.</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">calico-node</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">docker.io/calico/node:v3.22.1</span></span><br><span class="line">          <span class="attr">envFrom:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">configMapRef:</span></span><br><span class="line">              <span class="comment"># Allow KUBERNETES_SERVICE_HOST and KUBERNETES_SERVICE_PORT to be overridden for eBPF mode.</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">kubernetes-services-endpoint</span></span><br><span class="line">              <span class="attr">optional:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">env:</span></span><br><span class="line">            <span class="comment"># Use Kubernetes API as the backing datastore.</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">DATASTORE_TYPE</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&quot;kubernetes&quot;</span></span><br><span class="line">            <span class="comment"># Wait for the datastore.</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">WAIT_FOR_DATASTORE</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line">            <span class="comment"># Set based on the k8s node name.</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">NODENAME</span></span><br><span class="line">              <span class="attr">valueFrom:</span></span><br><span class="line">                <span class="attr">fieldRef:</span></span><br><span class="line">                  <span class="attr">fieldPath:</span> <span class="string">spec.nodeName</span></span><br><span class="line">            <span class="comment"># Choose the backend to use.</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">CALICO_NETWORKING_BACKEND</span></span><br><span class="line">              <span class="attr">valueFrom:</span></span><br><span class="line">                <span class="attr">configMapKeyRef:</span></span><br><span class="line">                  <span class="attr">name:</span> <span class="string">calico-config</span></span><br><span class="line">                  <span class="attr">key:</span> <span class="string">calico_backend</span></span><br><span class="line">            <span class="comment"># Cluster type to identify the deployment type</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">CLUSTER_TYPE</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&quot;k8s,bgp&quot;</span></span><br><span class="line">            <span class="comment"># Auto-detect the BGP IP address.</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">IP</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&quot;autodetect&quot;</span></span><br><span class="line">            <span class="comment"># Enable IPIP</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">CALICO_IPV4POOL_IPIP</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&quot;Always&quot;</span></span><br><span class="line">            <span class="comment"># Enable or Disable VXLAN on the default IP pool.</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">CALICO_IPV4POOL_VXLAN</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&quot;Never&quot;</span></span><br><span class="line">            <span class="comment"># Set MTU for tunnel device used if ipip is enabled</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">FELIX_IPINIPMTU</span></span><br><span class="line">              <span class="attr">valueFrom:</span></span><br><span class="line">                <span class="attr">configMapKeyRef:</span></span><br><span class="line">                  <span class="attr">name:</span> <span class="string">calico-config</span></span><br><span class="line">                  <span class="attr">key:</span> <span class="string">veth_mtu</span></span><br><span class="line">            <span class="comment"># Set MTU for the VXLAN tunnel device.</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">FELIX_VXLANMTU</span></span><br><span class="line">              <span class="attr">valueFrom:</span></span><br><span class="line">                <span class="attr">configMapKeyRef:</span></span><br><span class="line">                  <span class="attr">name:</span> <span class="string">calico-config</span></span><br><span class="line">                  <span class="attr">key:</span> <span class="string">veth_mtu</span></span><br><span class="line">            <span class="comment"># Set MTU for the Wireguard tunnel device.</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">FELIX_WIREGUARDMTU</span></span><br><span class="line">              <span class="attr">valueFrom:</span></span><br><span class="line">                <span class="attr">configMapKeyRef:</span></span><br><span class="line">                  <span class="attr">name:</span> <span class="string">calico-config</span></span><br><span class="line">                  <span class="attr">key:</span> <span class="string">veth_mtu</span></span><br><span class="line">            <span class="comment"># The default IPv4 pool to create on startup if none exists. Pod IPs will be</span></span><br><span class="line">            <span class="comment"># chosen from this range. Changing this value after installation will have</span></span><br><span class="line">            <span class="comment"># no effect. This should fall within `--cluster-cidr`.</span></span><br><span class="line">            <span class="comment"># - name: CALICO_IPV4POOL_CIDR</span></span><br><span class="line">            <span class="comment">#   value: &quot;192.168.0.0/16&quot;</span></span><br><span class="line">            <span class="comment"># Disable file logging so `kubectl logs` works.</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">CALICO_DISABLE_FILE_LOGGING</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line">            <span class="comment"># Set Felix endpoint to host default action to ACCEPT.</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">FELIX_DEFAULTENDPOINTTOHOSTACTION</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&quot;ACCEPT&quot;</span></span><br><span class="line">            <span class="comment"># Disable IPv6 on Kubernetes.</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">FELIX_IPV6SUPPORT</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&quot;false&quot;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">FELIX_HEALTHENABLED</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line">          <span class="attr">securityContext:</span></span><br><span class="line">            <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">resources:</span></span><br><span class="line">            <span class="attr">requests:</span></span><br><span class="line">              <span class="attr">cpu:</span> <span class="string">250m</span></span><br><span class="line">          <span class="attr">lifecycle:</span></span><br><span class="line">            <span class="attr">preStop:</span></span><br><span class="line">              <span class="attr">exec:</span></span><br><span class="line">                <span class="attr">command:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">/bin/calico-node</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">-shutdown</span></span><br><span class="line">          <span class="attr">livenessProbe:</span></span><br><span class="line">            <span class="attr">exec:</span></span><br><span class="line">              <span class="attr">command:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">/bin/calico-node</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">-felix-live</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">-bird-live</span></span><br><span class="line">            <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br><span class="line">            <span class="attr">initialDelaySeconds:</span> <span class="number">10</span></span><br><span class="line">            <span class="attr">failureThreshold:</span> <span class="number">6</span></span><br><span class="line">            <span class="attr">timeoutSeconds:</span> <span class="number">10</span></span><br><span class="line">          <span class="attr">readinessProbe:</span></span><br><span class="line">            <span class="attr">exec:</span></span><br><span class="line">              <span class="attr">command:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">/bin/calico-node</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">-felix-ready</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">-bird-ready</span></span><br><span class="line">            <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br><span class="line">            <span class="attr">timeoutSeconds:</span> <span class="number">10</span></span><br><span class="line">          <span class="attr">volumeMounts:</span></span><br><span class="line">            <span class="comment"># For maintaining CNI plugin API credentials.</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/host/etc/cni/net.d</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">cni-net-dir</span></span><br><span class="line">              <span class="attr">readOnly:</span> <span class="literal">false</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/lib/modules</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">lib-modules</span></span><br><span class="line">              <span class="attr">readOnly:</span> <span class="literal">true</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/run/xtables.lock</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">xtables-lock</span></span><br><span class="line">              <span class="attr">readOnly:</span> <span class="literal">false</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/var/run/calico</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">var-run-calico</span></span><br><span class="line">              <span class="attr">readOnly:</span> <span class="literal">false</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/var/lib/calico</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">var-lib-calico</span></span><br><span class="line">              <span class="attr">readOnly:</span> <span class="literal">false</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">policysync</span></span><br><span class="line">              <span class="attr">mountPath:</span> <span class="string">/var/run/nodeagent</span></span><br><span class="line">            <span class="comment"># For eBPF mode, we need to be able to mount the BPF filesystem at /sys/fs/bpf so we mount in the</span></span><br><span class="line">            <span class="comment"># parent directory.</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">sysfs</span></span><br><span class="line">              <span class="attr">mountPath:</span> <span class="string">/sys/fs/</span></span><br><span class="line">              <span class="comment"># Bidirectional means that, if we mount the BPF filesystem at /sys/fs/bpf it will propagate to the host.</span></span><br><span class="line">              <span class="comment"># If the host is known to mount that filesystem already then Bidirectional can be omitted.</span></span><br><span class="line">              <span class="attr">mountPropagation:</span> <span class="string">Bidirectional</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">cni-log-dir</span></span><br><span class="line">              <span class="attr">mountPath:</span> <span class="string">/var/log/calico/cni</span></span><br><span class="line">              <span class="attr">readOnly:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">        <span class="comment"># Used by calico-node.</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">lib-modules</span></span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/lib/modules</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">var-run-calico</span></span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/var/run/calico</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">var-lib-calico</span></span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/var/lib/calico</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">xtables-lock</span></span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/run/xtables.lock</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">FileOrCreate</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">sysfs</span></span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/sys/fs/</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">DirectoryOrCreate</span></span><br><span class="line">        <span class="comment"># Used to install CNI.</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">cni-bin-dir</span></span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/opt/cni/bin</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">cni-net-dir</span></span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/etc/cni/net.d</span></span><br><span class="line">        <span class="comment"># Used to access CNI logs.</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">cni-log-dir</span></span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/var/log/calico/cni</span></span><br><span class="line">        <span class="comment"># Mount in the directory for host-local IPAM allocations. This is</span></span><br><span class="line">        <span class="comment"># used when upgrading from host-local to calico-ipam, and can be removed</span></span><br><span class="line">        <span class="comment"># if not using the upgrade-ipam init container.</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">host-local-net-dir</span></span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/var/lib/cni/networks</span></span><br><span class="line">        <span class="comment"># Used to create per-pod Unix Domain Sockets</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">policysync</span></span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">DirectoryOrCreate</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/var/run/nodeagent</span></span><br><span class="line">        <span class="comment"># Used to install Flex Volume Driver</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">flexvol-driver-host</span></span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">DirectoryOrCreate</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/usr/libexec/kubernetes/kubelet-plugins/volume/exec/nodeagent~uds</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">calico-node</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Source: calico/templates/calico-kube-controllers.yaml</span></span><br><span class="line"><span class="comment"># See https://github.com/projectcalico/kube-controllers</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">calico-kube-controllers</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">k8s-app:</span> <span class="string">calico-kube-controllers</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="comment"># The controllers can only have a single active instance.</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">k8s-app:</span> <span class="string">calico-kube-controllers</span></span><br><span class="line">  <span class="attr">strategy:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">Recreate</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">calico-kube-controllers</span></span><br><span class="line">      <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">k8s-app:</span> <span class="string">calico-kube-controllers</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">nodeSelector:</span></span><br><span class="line">        <span class="attr">kubernetes.io/os:</span> <span class="string">linux</span></span><br><span class="line">      <span class="attr">tolerations:</span></span><br><span class="line">        <span class="comment"># Mark the pod as a critical add-on for rescheduling.</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">CriticalAddonsOnly</span></span><br><span class="line">          <span class="attr">operator:</span> <span class="string">Exists</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">node-role.kubernetes.io/master</span></span><br><span class="line">          <span class="attr">effect:</span> <span class="string">NoSchedule</span></span><br><span class="line">      <span class="attr">serviceAccountName:</span> <span class="string">calico-kube-controllers</span></span><br><span class="line">      <span class="attr">priorityClassName:</span> <span class="string">system-cluster-critical</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">calico-kube-controllers</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">docker.io/calico/kube-controllers:v3.22.1</span></span><br><span class="line">          <span class="attr">env:</span></span><br><span class="line">            <span class="comment"># Choose which controllers to run.</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">ENABLED_CONTROLLERS</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">node</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">DATASTORE_TYPE</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">kubernetes</span></span><br><span class="line">          <span class="attr">livenessProbe:</span></span><br><span class="line">            <span class="attr">exec:</span></span><br><span class="line">              <span class="attr">command:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">/usr/bin/check-status</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">-l</span></span><br><span class="line">            <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br><span class="line">            <span class="attr">initialDelaySeconds:</span> <span class="number">10</span></span><br><span class="line">            <span class="attr">failureThreshold:</span> <span class="number">6</span></span><br><span class="line">            <span class="attr">timeoutSeconds:</span> <span class="number">10</span></span><br><span class="line">          <span class="attr">readinessProbe:</span></span><br><span class="line">            <span class="attr">exec:</span></span><br><span class="line">              <span class="attr">command:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">/usr/bin/check-status</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">-r</span></span><br><span class="line">            <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">calico-kube-controllers</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="comment"># This manifest creates a Pod Disruption Budget for Controller to allow K8s Cluster Autoscaler to evict</span></span><br><span class="line"></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">policy/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PodDisruptionBudget</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">calico-kube-controllers</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">k8s-app:</span> <span class="string">calico-kube-controllers</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">maxUnavailable:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">k8s-app:</span> <span class="string">calico-kube-controllers</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Source: calico/templates/calico-etcd-secrets.yaml</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Source: calico/templates/calico-typha.yaml</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Source: calico/templates/configure-canal.yaml</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h2 id="3-3配置k8s命令自动补全"><a href="#3-3配置k8s命令自动补全" class="headerlink" title="3.3配置k8s命令自动补全"></a>3.3配置k8s命令自动补全</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum install -y bash-completion</span><br><span class="line"><span class="built_in">source</span> /usr/share/bash-completion/bash_completion</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;source &lt;(kubectl completion bash)&#x27;</span> &gt;&gt;~/.bashrc</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>k8s</tag>
      </tags>
  </entry>
</search>
